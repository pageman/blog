var c={GetPage:["pagetime","foldertime","permtime"],Search:["pagetime","filetime","permtime","foldertime"],SetPageLock:["pagetime"]};var PBcacheability=PBcacheability||c;if(Object.extend){Object.extend(PBcacheability,c)}var c={kPolicyPageSizeWarning:51200,kMaxActionLength:100,kPolicySimpleTimeFormat:"%l:%M %p",kLinkifyRegex:'/(^|[^">])(http(s)?:(\\/\\/)([\\w]+(.[\\w]+))([\\w\\-\\.,@?^=%&:;\\/~\\+#]*[\\w\\-\\@?^=%&:;\\/~\\+#])?)/',PagePlugin_AVPlayer:{kStatusMetaKey:"transcoding-status",kVideoMetadataKey:"video-metadata",kUserPrefInterstitialKey:"avplayer_interstitial",kSigLength:20,kImageHelper:"/plugin_helper.php",kTemplatePath:"layout/common/templates/plugin"}};var PBconst=PBconst||c;if(Object.extend){Object.extend(PBconst,c)}var tinyMCEPreInit={suffix:"",base:"http://"+window.location.host+"/shared/editor",query:""};(function(C){var A=/^\s*|\s*$/g,D;var B={majorVersion:"3",minorVersion:"3.3",releaseDate:"2010-04-19",_init:function(){var O=this,M=document,L=navigator,F=L.userAgent,K,E,J,I,H,N;O.isOpera=C.opera&&opera.buildNumber;O.isWebKit=/WebKit/.test(F);O.isIE=!O.isWebKit&&!O.isOpera&&(/MSIE/gi).test(F)&&(/Explorer/gi).test(L.appName);O.isIE6=O.isIE&&/MSIE [56]/.test(F);O.isGecko=!O.isWebKit&&/Gecko/.test(F);O.isMac=F.indexOf("Mac")!=-1;O.isAir=/adobeair/i.test(F);if(C.tinyMCEPreInit){O.suffix=tinyMCEPreInit.suffix;O.baseURL=tinyMCEPreInit.base;O.query=tinyMCEPreInit.query;return }O.suffix="";E=M.getElementsByTagName("base");for(K=0;K<E.length;K++){if(N=E[K].href){if(/^https?:\/\/[^\/]+$/.test(N)){N+="/"}I=N?N.match(/.*\//)[0]:""}}function G(P){if(P.src&&/tiny_mce(|_gzip|_jquery|_prototype)(_dev|_src)?.js/.test(P.src)){if(/_(src|dev)\.js/g.test(P.src)){O.suffix="_src"}if((H=P.src.indexOf("?"))!=-1){O.query=P.src.substring(H+1)}O.baseURL=P.src.substring(0,P.src.lastIndexOf("/"));if(I&&O.baseURL.indexOf("://")==-1&&O.baseURL.indexOf("/")!==0){O.baseURL=I+O.baseURL}return O.baseURL}return null}E=M.getElementsByTagName("script");for(K=0;K<E.length;K++){if(G(E[K])){return }}J=M.getElementsByTagName("head")[0];if(J){E=J.getElementsByTagName("script");for(K=0;K<E.length;K++){if(G(E[K])){return }}}return },is:function(F,E){if(!E){return F!==D}if(E=="array"&&(F.hasOwnProperty&&F instanceof Array)){return true}return typeof (F)==E},each:function(H,E,G){var I,F;if(!H){return 0}G=G||H;if(H.length!==D){for(I=0,F=H.length;I<F;I++){if(E.call(G,H[I],I,H)===false){return 0}}}else{for(I in H){if(H.hasOwnProperty(I)){if(E.call(G,H[I],I,H)===false){return 0}}}}return 1},map:function(E,F){var G=[];B.each(E,function(H){G.push(F(H))});return G},grep:function(E,F){var G=[];B.each(E,function(H){if(!F||F(H)){G.push(H)}});return G},inArray:function(F,G){var H,E;if(F){for(H=0,E=F.length;H<E;H++){if(F[H]===G){return H}}}return -1},extend:function(I,H){var G,F,E=arguments;for(G=1,F=E.length;G<F;G++){H=E[G];B.each(H,function(J,K){if(J!==D){I[K]=J}})}return I},trim:function(E){return(E?""+E:"").replace(A,"")},create:function(M,E){var L=this,F,H,I,J,G,K=0;M=/^((static) )?([\w.]+)(:([\w.]+))?/.exec(M);I=M[3].match(/(^|\.)(\w+)$/i)[2];H=L.createNS(M[3].replace(/\.\w+$/,""));if(H[I]){return }if(M[2]=="static"){H[I]=E;if(this.onCreate){this.onCreate(M[2],M[3],H[I])}return }if(!E[I]){E[I]=function(){};K=1}H[I]=E[I];L.extend(H[I].prototype,E);if(M[5]){F=L.resolve(M[5]).prototype;J=M[5].match(/\.(\w+)$/i)[1];G=H[I];if(K){H[I]=function(){return F[J].apply(this,arguments)}}else{H[I]=function(){this.parent=F[J];return G.apply(this,arguments)}}H[I].prototype[I]=H[I];L.each(F,function(N,O){H[I].prototype[O]=F[O]});L.each(E,function(N,O){if(F[O]){H[I].prototype[O]=function(){this.parent=F[O];return N.apply(this,arguments)}}else{if(O!=I){H[I].prototype[O]=N}}})}L.each(E["static"],function(N,O){H[I][O]=N});if(this.onCreate){this.onCreate(M[2],M[3],H[I].prototype)}},walk:function(G,F,H,E){E=E||this;if(G){if(H){G=G[H]}B.each(G,function(J,I){if(F.call(E,J,I,H)===false){return false}B.walk(J,F,H,E)})}},createNS:function(H,G){var F,E;G=G||C;H=H.split(".");for(F=0;F<H.length;F++){E=H[F];if(!G[E]){G[E]={}}G=G[E]}return G},resolve:function(H,G){var F,E;G=G||C;H=H.split(".");for(F=0,E=H.length;F<E;F++){G=G[H[F]];if(!G){break}}return G},addUnload:function(H,G){var F=this;H={func:H,scope:G||this};if(!F.unloads){function E(){var J=F.unloads,K,L;if(J){for(L in J){K=J[L];if(K&&K.func){K.func.call(K.scope,1)}}if(C.detachEvent){C.detachEvent("onbeforeunload",I);C.detachEvent("onunload",E)}else{if(C.removeEventListener){C.removeEventListener("unload",E,false)}}F.unloads=K=J=w=E=0;if(C.CollectGarbage){CollectGarbage()}}}function I(){var K=document;if(K.readyState=="interactive"){function J(){K.detachEvent("onstop",J);if(E){E()}K=0}if(K){K.attachEvent("onstop",J)}C.setTimeout(function(){if(K){K.detachEvent("onstop",J)}},0)}}if(C.attachEvent){C.attachEvent("onunload",E);C.attachEvent("onbeforeunload",I)}else{if(C.addEventListener){C.addEventListener("unload",E,false)}}F.unloads=[H]}else{F.unloads.push(H)}return H},removeUnload:function(G){var E=this.unloads,F=null;B.each(E,function(I,H){if(I&&I.func==G){E.splice(H,1);F=G;return false}});return F},explode:function(E,F){return E?B.map(E.split(F||","),B.trim):E},_addVer:function(F){var E;if(!this.query){return F}E=(F.indexOf("?")==-1?"?":"&")+this.query;if(F.indexOf("#")==-1){return F+E}return F.replace("#",E+"#")}};B._init();C.tinymce=C.tinyMCE=B})(window);tinymce.create("tinymce.util.Dispatcher",{scope:null,listeners:null,Dispatcher:function(A){this.scope=A||this;this.listeners=[]},add:function(A,B){this.listeners.push({cb:A,scope:B||this.scope});return A},addToTop:function(A,B){this.listeners.unshift({cb:A,scope:B||this.scope});return A},remove:function(A){var B=this.listeners,C=null;tinymce.each(B,function(E,D){if(A==E.cb){C=A;B.splice(D,1);return false}});return C},dispatch:function(){var D,B=arguments,C,A=this.listeners,E;for(C=0;C<A.length;C++){E=A[C];D=E.cb.apply(E.scope,B);if(D===false){break}}return D}});(function(){var A=tinymce.each;tinymce.create("tinymce.util.URI",{URI:function(D,F){var E=this,G,C,B;D=tinymce.trim(D);F=E.settings=F||{};if(/^(mailto|tel|news|javascript|about|data):/i.test(D)||/^\s*#/.test(D)){E.source=D;return }if(D.indexOf("/")===0&&D.indexOf("//")!==0){D=(F.base_uri?F.base_uri.protocol||"http":"http")+"://mce_host"+D}if(!/^\w*:?\/\//.test(D)){D=(F.base_uri.protocol||"http")+"://mce_host"+E.toAbsPath(F.base_uri.path,D)}D=D.replace(/@@/g,"(mce_at)");D=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/.exec(D);A(["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],function(H,I){var J=D[I];if(J){J=J.replace(/\(mce_at\)/g,"@@")}E[H]=J});if(B=F.base_uri){if(!E.protocol){E.protocol=B.protocol}if(!E.userInfo){E.userInfo=B.userInfo}if(!E.port&&E.host=="mce_host"){E.port=B.port}if(!E.host||E.host=="mce_host"){E.host=B.host}E.source=""}},setPath:function(C){var B=this;C=/^(.*?)\/?(\w+)?$/.exec(C);B.path=C[0];B.directory=C[1];B.file=C[2];B.source="";B.getURI()},toRelative:function(B){var C=this,D;if(B==="./"){return B}B=new tinymce.util.URI(B,{base_uri:C});if((B.host!="mce_host"&&C.host!=B.host&&B.host)||C.port!=B.port||C.protocol!=B.protocol){return B.getURI()}D=C.toRelPath(C.path,B.path);if(B.query){D+="?"+B.query}if(B.anchor){D+="#"+B.anchor}return D},toAbsolute:function(B,C){var B=new tinymce.util.URI(B,{base_uri:this});return B.getURI(this.host==B.host&&this.protocol==B.protocol?C:0)},toRelPath:function(G,H){var C,F=0,D="",E,B;G=G.substring(0,G.lastIndexOf("/"));G=G.split("/");C=H.split("/");if(G.length>=C.length){for(E=0,B=G.length;E<B;E++){if(E>=C.length||G[E]!=C[E]){F=E+1;break}}}if(G.length<C.length){for(E=0,B=C.length;E<B;E++){if(E>=G.length||G[E]!=C[E]){F=E+1;break}}}if(F==1){return H}for(E=0,B=G.length-(F-1);E<B;E++){D+="../"}for(E=F-1,B=C.length;E<B;E++){if(E!=F-1){D+="/"+C[E]}else{D+=C[E]}}return D},toAbsPath:function(E,F){var C,B=0,H=[],D,G;D=/\/$/.test(F)?"/":"";E=E.split("/");F=F.split("/");A(E,function(I){if(I){H.push(I)}});E=H;for(C=F.length-1,H=[];C>=0;C--){if(F[C].length==0||F[C]=="."){continue}if(F[C]==".."){B++;continue}if(B>0){B--;continue}H.push(F[C])}C=E.length-B;if(C<=0){G=H.reverse().join("/")}else{G=E.slice(0,C).join("/")+"/"+H.reverse().join("/")}if(G.indexOf("/")!==0){G="/"+G}if(D&&G.lastIndexOf("/")!==G.length-1){G+=D}return G},getURI:function(D){var C,B=this;if(!B.source||D){C="";if(!D){if(B.protocol){C+=B.protocol+"://"}if(B.userInfo){C+=B.userInfo+"@"}if(B.host){C+=B.host}if(B.port){C+=":"+B.port}}if(B.path){C+=B.path}if(B.query){C+="?"+B.query}if(B.anchor){C+="#"+B.anchor}B.source=C}return B.source}})})();(function(){var A=tinymce.each;tinymce.create("static tinymce.util.Cookie",{getHash:function(D){var B=this.get(D),C;if(B){A(B.split("&"),function(E){E=E.split("=");C=C||{};C[unescape(E[0])]=unescape(E[1])})}return C},setHash:function(H,B,E,D,G,C){var F="";A(B,function(J,I){F+=(!F?"":"&")+escape(I)+"="+escape(J)});this.set(H,F,E,D,G,C)},get:function(F){var E=document.cookie,D,C=F+"=",B;if(!E){return }B=E.indexOf("; "+C);if(B==-1){B=E.indexOf(C);if(B!=0){return null}}else{B+=2}D=E.indexOf(";",B);if(D==-1){D=E.length}return unescape(E.substring(B+C.length,D))},set:function(G,B,E,D,F,C){document.cookie=G+"="+escape(B)+((E)?"; expires="+E.toGMTString():"")+((D)?"; path="+escape(D):"")+((F)?"; domain="+F:"")+((C)?"; secure":"")},remove:function(D,B){var C=new Date();C.setTime(C.getTime()-1000);this.set(D,"",C,B,C)}})})();tinymce.create("static tinymce.util.JSON",{serialize:function(E){var C,A,D=tinymce.util.JSON.serialize,B;if(E==null){return"null"}B=typeof E;if(B=="string"){A="\bb\tt\nn\ff\rr\"\"''\\\\";return'"'+E.replace(/([\u0080-\uFFFF\x00-\x1f\"])/g,function(G,F){C=A.indexOf(F);if(C+1){return"\\"+A.charAt(C+1)}G=F.charCodeAt().toString(16);return"\\u"+"0000".substring(G.length)+G})+'"'}if(B=="object"){if(E.hasOwnProperty&&E instanceof Array){for(C=0,A="[";C<E.length;C++){A+=(C>0?",":"")+D(E[C])}return A+"]"}A="{";for(C in E){A+=typeof E[C]!="function"?(A.length>1?',"':'"')+C+'":'+D(E[C]):""}return A+"}"}return""+E},parse:function(s){try{return eval("("+s+")")}catch(ex){}}});tinymce.create("static tinymce.util.XHR",{send:function(F){var A,D,B=window,G=0;F.scope=F.scope||this;F.success_scope=F.success_scope||F.scope;F.error_scope=F.error_scope||F.scope;F.async=F.async===false?false:true;F.data=F.data||"";function C(I){A=0;try{A=new ActiveXObject(I)}catch(H){}return A}A=B.XMLHttpRequest?new XMLHttpRequest():C("Microsoft.XMLHTTP")||C("Msxml2.XMLHTTP");if(A){if(A.overrideMimeType){A.overrideMimeType(F.content_type)}A.open(F.type||(F.data?"POST":"GET"),F.url,F.async);if(F.content_type){A.setRequestHeader("Content-Type",F.content_type)}A.setRequestHeader("X-Requested-With","XMLHttpRequest");A.send(F.data);function E(){if(!F.async||A.readyState==4||G++>10000){if(F.success&&G<10000&&A.status==200){F.success.call(F.success_scope,""+A.responseText,A,F)}else{if(F.error){F.error.call(F.error_scope,G>10000?"TIMED_OUT":"GENERAL",A,F)}}A=null}else{B.setTimeout(E,10)}}if(!F.async){return E()}D=B.setTimeout(E,10)}}});(function(){var C=tinymce.extend,B=tinymce.util.JSON,A=tinymce.util.XHR;tinymce.create("tinymce.util.JSONRequest",{JSONRequest:function(D){this.settings=C({},D);this.count=0},send:function(F){var E=F.error,D=F.success;F=C(this.settings,F);F.success=function(H,G){H=B.parse(H);if(typeof (H)=="undefined"){H={error:"JSON Parse error."}}if(H.error){E.call(F.error_scope||F.scope,H.error,G)}else{D.call(F.success_scope||F.scope,H.result)}};F.error=function(H,G){E.call(F.error_scope||F.scope,H,G)};F.data=B.serialize({id:F.id||"c"+(this.count++),method:F.method,params:F.params});F.content_type="application/json";A.send(F)},"static":{sendRPC:function(D){return new tinymce.util.JSONRequest().send(D)}}})}());(function(M){var K=M.each,J=M.is,I=M.isWebKit,D=M.isIE,A=/^(H[1-6R]|P|DIV|ADDRESS|PRE|FORM|T(ABLE|BODY|HEAD|FOOT|H|R|D)|LI|OL|UL|CAPTION|BLOCKQUOTE|CENTER|DL|DT|DD|DIR|FIELDSET|NOSCRIPT|MENU|ISINDEX|SAMP)$/,E=G("checked,compact,declare,defer,disabled,ismap,multiple,nohref,noresize,noshade,nowrap,readonly,selected"),F=G("src,href,style,coords,shape"),C={"&":"&amp;",'"':"&quot;","<":"&lt;",">":"&gt;"},N=/[<>&\"]/g,B=/^([a-z0-9],?)+$/i,H=/<(\w+)((?:\s+\w+(?:\s*=\s*(?:(?:"[^"]*")|(?:'[^']*')|[^>\s]+))?)*)(\s*\/?)>/g,L=/(\w+)(?:\s*=\s*(?:(?:"((?:\\.|[^"])*)")|(?:'((?:\\.|[^'])*)')|([^>\s]+)))?/g;function G(Q){var P={},O;Q=Q.split(",");for(O=Q.length;O>=0;O--){P[Q[O]]=1}return P}M.create("tinymce.dom.DOMUtils",{doc:null,root:null,files:null,pixelStyles:/^(top|left|bottom|right|width|height|borderWidth)$/,props:{"for":"htmlFor","class":"className",className:"className",checked:"checked",disabled:"disabled",maxlength:"maxLength",readonly:"readOnly",selected:"selected",value:"value",id:"id",name:"name",type:"type"},DOMUtils:function(S,Q){var P=this,O;P.doc=S;P.win=window;P.files={};P.cssFlicker=false;P.counter=0;P.boxModel=!M.isIE||S.compatMode=="CSS1Compat";P.stdMode=S.documentMode===8;P.settings=Q=M.extend({keep_values:false,hex_colors:1,process_html:1},Q);if(M.isIE6){try{S.execCommand("BackgroundImageCache",false,true)}catch(R){P.cssFlicker=true}}if(Q.valid_styles){P._styles={};K(Q.valid_styles,function(U,T){P._styles[T]=M.explode(U)})}M.addUnload(P.destroy,P)},getRoot:function(){var O=this,P=O.settings;return(P&&O.get(P.root_element))||O.doc.body},getViewPort:function(P){var Q,O;P=!P?this.win:P;Q=P.document;O=this.boxModel?Q.documentElement:Q.body;return{x:P.pageXOffset||O.scrollLeft,y:P.pageYOffset||O.scrollTop,w:P.innerWidth||O.clientWidth,h:P.innerHeight||O.clientHeight}},getRect:function(R){var Q,O=this,P;R=O.get(R);Q=O.getPos(R);P=O.getSize(R);return{x:Q.x,y:Q.y,w:P.w,h:P.h}},getSize:function(R){var P=this,O,Q;R=P.get(R);O=P.getStyle(R,"width");Q=P.getStyle(R,"height");if(O.indexOf("px")===-1){O=0}if(Q.indexOf("px")===-1){Q=0}return{w:parseInt(O)||R.offsetWidth||R.clientWidth,h:parseInt(Q)||R.offsetHeight||R.clientHeight}},getParent:function(Q,P,O){return this.getParents(Q,P,O,false)},getParents:function(Q,S,O,V){var W=this,R,U=W.settings,P=[];Q=W.get(Q);V=V===undefined;if(U.strict_root){O=O||W.getRoot()}if(J(S,"string")){R=S;if(S==="*"){S=function(X){return X.nodeType==1}}else{S=function(X){return W.is(X,R)}}}while(Q){if(Q==O||!Q.nodeType||Q.nodeType===9){break}if(!S||S(Q)){if(V){P.push(Q)}else{return Q}}try{Q=(Q.nodeName.toUpperCase()=="BODY")?null:Q.parentNode}catch(T){break}}return V?P:null},get:function(O){var P;if(O&&this.doc&&typeof (O)=="string"){P=O;O=this.doc.getElementById(O);if(O&&O.id!==P){return this.doc.getElementsByName(P)[1]}}return O},getNext:function(P,O){return this._findSib(P,O,"nextSibling")},getPrev:function(P,O){return this._findSib(P,O,"previousSibling")},select:function(Q,P){var O=this;return M.dom.Sizzle(Q,O.get(P)||O.get(O.settings.root_element)||O.doc,[])},is:function(Q,O){var P;if(Q.length===undefined){if(O==="*"){return Q.nodeType==1}if(B.test(O)){O=O.toLowerCase().split(/,/);Q=Q.nodeName.toLowerCase();for(P=O.length-1;P>=0;P--){if(O[P]==Q){return true}}return false}}return M.dom.Sizzle.matches(O,Q.nodeType?[Q]:Q).length>0},add:function(R,T,O,Q,S){var P=this;return this.run(R,function(W){var V,U;V=J(T,"string")?P.doc.createElement(T):T;P.setAttribs(V,O);if(Q){if(Q.nodeType){V.appendChild(Q)}else{P.setHTML(V,Q)}}return !S?W.appendChild(V):V})},create:function(Q,O,P){return this.add(this.doc.createElement(Q),Q,O,P,1)},createHTML:function(T,O,R){var S="",Q=this,P;S+="<"+T;for(P in O){if(O.hasOwnProperty(P)){S+=" "+P+'="'+Q.encode(O[P])+'"'}}if(M.is(R)){return S+">"+R+"</"+T+">"}return S+" />"},remove:function(O,P){return this.run(O,function(R){var Q,S;Q=R.parentNode;if(!Q){return null}if(P){while(S=R.firstChild){if(S.nodeType!==3||S.nodeValue){Q.insertBefore(S,R)}else{R.removeChild(S)}}}return Q.removeChild(R)})},setStyle:function(R,O,P){var Q=this;return Q.run(R,function(U){var T,S;T=U.style;O=O.replace(/-(\D)/g,function(W,V){return V.toUpperCase()});if(Q.pixelStyles.test(O)&&(M.is(P,"number")||/^[\-0-9\.]+$/.test(P))){P+="px"}switch(O){case"opacity":if(D){T.filter=P===""?"":"alpha(opacity="+(P*100)+")";if(!R.currentStyle||!R.currentStyle.hasLayout){T.display="inline-block"}}T[O]=T["-moz-opacity"]=T["-khtml-opacity"]=P||"";break;case"float":D?T.styleFloat=P:T.cssFloat=P;break;default:T[O]=P||""}if(Q.settings.update_styles){Q.setAttrib(U,"_mce_style")}})},getStyle:function(R,O,Q){R=this.get(R);if(!R){return false}if(this.doc.defaultView&&Q){O=O.replace(/[A-Z]/g,function(S){return"-"+S});try{return this.doc.defaultView.getComputedStyle(R,null).getPropertyValue(O)}catch(P){return null}}O=O.replace(/-(\D)/g,function(T,S){return S.toUpperCase()});if(O=="float"){O=D?"styleFloat":"cssFloat"}if(R.currentStyle&&Q){return R.currentStyle[O]}return R.style[O]},setStyles:function(R,S){var P=this,Q=P.settings,O;O=Q.update_styles;Q.update_styles=0;K(S,function(T,U){P.setStyle(R,U,T)});Q.update_styles=O;if(Q.update_styles){P.setAttrib(R,Q.cssText)}},setAttrib:function(Q,R,O){var P=this;if(!Q||!R){return }if(P.settings.strict){R=R.toLowerCase()}return this.run(Q,function(T){var S=P.settings;switch(R){case"style":if(!J(O,"string")){K(O,function(U,V){P.setStyle(T,V,U)});return }if(S.keep_values){if(O&&!P._isRes(O)){T.setAttribute("_mce_style",O,2)}else{T.removeAttribute("_mce_style",2)}}T.style.cssText=O;break;case"class":T.className=O||"";break;case"src":case"href":if(S.keep_values){if(S.url_converter){O=S.url_converter.call(S.url_converter_scope||P,O,R,T)}P.setAttrib(T,"_mce_"+R,O,2)}break;case"shape":T.setAttribute("_mce_style",O);break}if(J(O)&&O!==null&&O.length!==0){T.setAttribute(R,""+O,2)}else{T.removeAttribute(R,2)}})},setAttribs:function(P,Q){var O=this;return this.run(P,function(R){K(Q,function(S,T){O.setAttrib(R,T,S)})})},getAttrib:function(R,S,Q){var O,P=this;R=P.get(R);if(!R||R.nodeType!==1){return false}if(!J(Q)){Q=""}if(/^(src|href|style|coords|shape)$/.test(S)){O=R.getAttribute("_mce_"+S);if(O){return O}}if(D&&P.props[S]){O=R[P.props[S]];O=O&&O.nodeValue?O.nodeValue:O}if(!O){O=R.getAttribute(S,2)}if(/^(checked|compact|declare|defer|disabled|ismap|multiple|nohref|noshade|nowrap|readonly|selected)$/.test(S)){if(R[P.props[S]]===true&&O===""){return S}return O?S:""}if(R.nodeName==="FORM"&&R.getAttributeNode(S)){return R.getAttributeNode(S).nodeValue}if(S==="style"){O=O||R.style.cssText;if(O){O=P.serializeStyle(P.parseStyle(O),R.nodeName);if(P.settings.keep_values&&!P._isRes(O)){R.setAttribute("_mce_style",O)}}}if(I&&S==="class"&&O){O=O.replace(/(apple|webkit)\-[a-z\-]+/gi,"")}if(D){switch(S){case"rowspan":case"colspan":if(O===1){O=""}break;case"size":if(O==="+0"||O===20||O===0){O=""}break;case"width":case"height":case"vspace":case"checked":case"disabled":case"readonly":if(O===0){O=""}break;case"hspace":if(O===-1){O=""}break;case"maxlength":case"tabindex":if(O===32768||O===2147483647||O==="32768"){O=""}break;case"multiple":case"compact":case"noshade":case"nowrap":if(O===65535){return S}return Q;case"shape":O=O.toLowerCase();break;default:if(S.indexOf("on")===0&&O){O=(""+O).replace(/^function\s+\w+\(\)\s+\{\s+(.*)\s+\}$/,"$1")}}}return(O!==undefined&&O!==null&&O!=="")?""+O:Q},getPos:function(V,R){var P=this,O=0,U=0,S,T=P.doc,Q;V=P.get(V);R=R||T.body;if(V){if(D&&!P.stdMode){V=V.getBoundingClientRect();S=P.boxModel?T.documentElement:T.body;O=P.getStyle(P.select("html")[0],"borderWidth");O=(O=="medium"||P.boxModel&&!P.isIE6)&&2||O;V.top+=P.win.self!=P.win.top?2:0;return{x:V.left+S.scrollLeft-O,y:V.top+S.scrollTop-O}}Q=V;while(Q&&Q!=R&&Q.nodeType){O+=Q.offsetLeft||0;U+=Q.offsetTop||0;Q=Q.offsetParent}Q=V.parentNode;while(Q&&Q!=R&&Q.nodeType){O-=Q.scrollLeft||0;U-=Q.scrollTop||0;Q=Q.parentNode}}return{x:O,y:U}},parseStyle:function(Q){var R=this,S=R.settings,T={};if(!Q){return T}function O(a,X,Z){var W,Y,U,V;W=T[a+"-top"+X];if(!W){return }Y=T[a+"-right"+X];if(W!=Y){return }U=T[a+"-bottom"+X];if(Y!=U){return }V=T[a+"-left"+X];if(U!=V){return }T[Z]=V;delete T[a+"-top"+X];delete T[a+"-right"+X];delete T[a+"-bottom"+X];delete T[a+"-left"+X]}function P(W,V,U,Y){var X;X=T[V];if(!X){return }X=T[U];if(!X){return }X=T[Y];if(!X){return }T[W]=T[V]+" "+T[U]+" "+T[Y];delete T[V];delete T[U];delete T[Y]}Q=Q.replace(/&(#?[a-z0-9]+);/g,"&$1_MCE_SEMI_");K(Q.split(";"),function(V){var U,W=[];if(V){V=V.replace(/_MCE_SEMI_/g,";");V=V.replace(/url\([^\)]+\)/g,function(X){W.push(X);return"url("+W.length+")"});V=V.split(":");U=M.trim(V[1]);U=U.replace(/url\(([^\)]+)\)/g,function(Y,X){return W[parseInt(X)-1]});U=U.replace(/rgb\([^\)]+\)/g,function(X){return R.toHex(X)});if(S.url_converter){U=U.replace(/url\([\'\"]?([^\)\'\"]+)[\'\"]?\)/g,function(X,Y){return"url("+S.url_converter.call(S.url_converter_scope||R,R.decode(Y),"style",null)+")"})}T[M.trim(V[0]).toLowerCase()]=U}});O("border","","border");O("border","-width","border-width");O("border","-color","border-color");O("border","-style","border-style");O("padding","","padding");O("margin","","margin");P("border","border-width","border-style","border-color");if(D){if(T.border=="medium none"){T.border=""}}return T},serializeStyle:function(S,O){var P=this,Q="";function R(U,T){if(T&&U){if(T.indexOf("-")===0){return }switch(T){case"font-weight":if(U==700){U="bold"}break;case"color":case"background-color":U=U.toLowerCase();break}Q+=(Q?" ":"")+T+": "+U+";"}}if(O&&P._styles){K(P._styles["*"],function(T){R(S[T],T)});K(P._styles[O.toLowerCase()],function(T){R(S[T],T)})}else{K(S,R)}return Q},loadCSS:function(O){var Q=this,R=Q.doc,P;if(!O){O=""}P=Q.select("head")[0];K(O.split(","),function(S){var T;if(Q.files[S]){return }Q.files[S]=true;T=Q.create("link",{rel:"stylesheet",href:M._addVer(S)});if(D&&R.documentMode){T.onload=function(){R.recalc();T.onload=null}}P.appendChild(T)})},addClass:function(O,P){return this.run(O,function(Q){var R;if(!P){return 0}if(this.hasClass(Q,P)){return Q.className}R=this.removeClass(Q,P);return Q.className=(R!=""?(R+" "):"")+P})},removeClass:function(Q,R){var O=this,P;return O.run(Q,function(T){var S;if(O.hasClass(T,R)){if(!P){P=new RegExp("(^|\\s+)"+R+"(\\s+|$)","g")}S=T.className.replace(P," ");S=M.trim(S!=" "?S:"");T.className=S;if(!S){T.removeAttribute("class");T.removeAttribute("className")}return S}return T.className})},hasClass:function(P,O){P=this.get(P);if(!P||!O){return false}return(" "+P.className+" ").indexOf(" "+O+" ")!==-1},show:function(O){return this.setStyle(O,"display","block")},hide:function(O){return this.setStyle(O,"display","none")},isHidden:function(O){O=this.get(O);return !O||O.style.display=="none"||this.getStyle(O,"display")=="none"},uniqueId:function(O){return(!O?"mce_":O)+(this.counter++)},setHTML:function(Q,P){var O=this;return this.run(Q,function(V){var R,T,S,X,U,R;P=O.processHTML(P);if(D){function W(){while(V.firstChild){V.firstChild.removeNode()}try{V.innerHTML="<br />"+P;V.removeChild(V.firstChild)}catch(Y){R=O.create("div");R.innerHTML="<br />"+P;K(R.childNodes,function(a,Z){if(Z){V.appendChild(a)}})}}if(O.settings.fix_ie_paragraphs){P=P.replace(/<p><\/p>|<p([^>]+)><\/p>|<p[^\/+]\/>/gi,'<p$1 _mce_keep="true">&nbsp;</p>')}W();if(O.settings.fix_ie_paragraphs){S=V.getElementsByTagName("p");for(T=S.length-1,R=0;T>=0;T--){X=S[T];if(!X.hasChildNodes()){if(!X._mce_keep){R=1;break}X.removeAttribute("_mce_keep")}}}if(R){P=P.replace(/<p ([^>]+)>|<p>/ig,'<div $1 _mce_tmp="1">');P=P.replace(/<\/p>/g,"</div>");W();if(O.settings.fix_ie_paragraphs){S=V.getElementsByTagName("DIV");for(T=S.length-1;T>=0;T--){X=S[T];if(X._mce_tmp){U=O.doc.createElement("p");X.cloneNode(false).outerHTML.replace(/([a-z0-9\-_]+)=/gi,function(Z,Y){var e;if(Y!=="_mce_tmp"){e=X.getAttribute(Y);if(!e&&Y==="class"){e=X.className}U.setAttribute(Y,e)}});for(R=0;R<X.childNodes.length;R++){U.appendChild(X.childNodes[R].cloneNode(true))}X.swapNode(U)}}}}}else{V.innerHTML=P}return P})},processHTML:function(R){var P=this,Q=P.settings,T=[];if(!Q.process_html){return R}if(D){R=R.replace(/&apos;/g,"&#39;");R=R.replace(/\s+(disabled|checked|readonly|selected)\s*=\s*[\"\']?(false|0)[\"\']?/gi,"")}R=R.replace(/<a( )([^>]+)\/>|<a\/>/gi,"<a$1$2></a>");if(Q.keep_values){if(/<script|noscript|style/i.test(R)){function O(U){U=U.replace(/(<!--\[CDATA\[|\]\]-->)/g,"\n");U=U.replace(/^[\r\n]*|[\r\n]*$/g,"");U=U.replace(/^\s*(\/\/\s*<!--|\/\/\s*<!\[CDATA\[|<!--|<!\[CDATA\[)[\r\n]*/g,"");U=U.replace(/\s*(\/\/\s*\]\]>|\/\/\s*-->|\]\]>|-->|\]\]-->)\s*$/g,"");return U}R=R.replace(/<script([^>]+|)>([\s\S]*?)<\/script>/gi,function(U,W,V){if(!W){W=' type="text/javascript"'}W=W.replace(/src=\"([^\"]+)\"?/i,function(X,Y){if(Q.url_converter){Y=P.encode(Q.url_converter.call(Q.url_converter_scope||P,P.decode(Y),"src","script"))}return'_mce_src="'+Y+'"'});if(M.trim(V)){T.push(O(V));V="<!--\nMCE_SCRIPT:"+(T.length-1)+"\n// -->"}return"<mce:script"+W+">"+V+"</mce:script>"});R=R.replace(/<style([^>]+|)>([\s\S]*?)<\/style>/gi,function(U,W,V){if(V){T.push(O(V));V="<!--\nMCE_SCRIPT:"+(T.length-1)+"\n-->"}return"<mce:style"+W+">"+V+"</mce:style><style "+W+' _mce_bogus="1">'+V+"</style>"});R=R.replace(/<noscript([^>]+|)>([\s\S]*?)<\/noscript>/g,function(U,W,V){return"<mce:noscript"+W+"><!--"+P.encode(V).replace(/--/g,"&#45;&#45;")+"--></mce:noscript>"})}R=R.replace(/<!\[CDATA\[([\s\S]+)\]\]>/g,"<!--[CDATA[$1]]-->");function S(U){return U.replace(H,function(X,Y,W,V){return"<"+Y+W.replace(L,function(a,Z,f,e,b){var g;Z=Z.toLowerCase();f=f||e||b||"";if(E[Z]){if(f==="false"||f==="0"){return }return Z+'="'+Z+'"'}if(F[Z]&&W.indexOf("_mce_"+Z)==-1){g=P.decode(f);if(Q.url_converter&&(Z=="src"||Z=="href")){g=Q.url_converter.call(Q.url_converter_scope||P,g,Z,Y)}if(Z=="style"){g=P.serializeStyle(P.parseStyle(g),Z)}return Z+'="'+f+'" _mce_'+Z+'="'+P.encode(g)+'"'}return a})+V+">"})}R=S(R);R=R.replace(/MCE_SCRIPT:([0-9]+)/g,function(V,U){return T[U]})}return R},getOuterHTML:function(O){var P;O=this.get(O);if(!O){return null}if(O.outerHTML!==undefined){return O.outerHTML}P=(O.ownerDocument||this.doc).createElement("body");P.appendChild(O.cloneNode(true));return P.innerHTML},setOuterHTML:function(R,P,S){var O=this;function Q(U,T,W){var X,V;V=W.createElement("body");V.innerHTML=T;X=V.lastChild;while(X){O.insertAfter(X.cloneNode(true),U);X=X.previousSibling}O.remove(U)}return this.run(R,function(U){U=O.get(U);if(U.nodeType==1){S=S||U.ownerDocument||O.doc;if(D){try{if(D&&U.nodeType==1){U.outerHTML=P}else{Q(U,P,S)}}catch(T){Q(U,P,S)}}else{Q(U,P,S)}}})},decode:function(P){var Q,R,O;if(/&[\w#]+;/.test(P)){Q=this.doc.createElement("div");Q.innerHTML=P;R=Q.firstChild;O="";if(R){do{O+=R.nodeValue}while(R=R.nextSibling)}return O||P}return P},encode:function(O){return(""+O).replace(N,function(P){return C[P]})},insertAfter:function(O,P){P=this.get(P);return this.run(O,function(R){var Q,S;Q=P.parentNode;S=P.nextSibling;if(S){Q.insertBefore(R,S)}else{Q.appendChild(R)}return R})},isBlock:function(O){if(O.nodeType&&O.nodeType!==1){return false}O=O.nodeName||O;return A.test(O)},replace:function(R,Q,O){var P=this;if(J(Q,"array")){R=R.cloneNode(true)}return P.run(Q,function(S){if(O){K(M.grep(S.childNodes),function(T){R.appendChild(T)})}return S.parentNode.replaceChild(R,S)})},rename:function(R,O){var Q=this,P;if(R.nodeName!=O.toUpperCase()){P=Q.create(O);K(Q.getAttribs(R),function(S){Q.setAttrib(P,S.nodeName,Q.getAttrib(R,S.nodeName))});Q.replace(P,R,1)}return P||R},findCommonAncestor:function(Q,O){var R=Q,P;while(R){P=O;while(P&&R!=P){P=P.parentNode}if(R==P){break}R=R.parentNode}if(!R&&Q.ownerDocument){return Q.ownerDocument.documentElement}return R},toHex:function(O){var Q=/^\s*rgb\s*?\(\s*?([0-9]+)\s*?,\s*?([0-9]+)\s*?,\s*?([0-9]+)\s*?\)\s*$/i.exec(O);function P(R){R=parseInt(R).toString(16);return R.length>1?R:"0"+R}if(Q){O="#"+P(Q[1])+P(Q[2])+P(Q[3]);return O}return O},getClasses:function(){var S=this,O=[],R,T={},U=S.settings.class_filter,Q;if(S.classes){return S.classes}function V(W){K(W.imports,function(X){V(X)});K(W.cssRules||W.rules,function(X){switch(X.type||1){case 1:if(X.selectorText){K(X.selectorText.split(","),function(Y){Y=Y.replace(/^\s*|\s*$|^\s\./g,"");if(/\.mce/.test(Y)||!/\.[\w\-]+$/.test(Y)){return }Q=Y;Y=Y.replace(/.*\.([a-z0-9_\-]+).*/i,"$1");if(U&&!(Y=U(Y,Q))){return }if(!T[Y]){O.push({"class":Y});T[Y]=1}})}break;case 3:V(X.styleSheet);break}})}try{K(S.doc.styleSheets,V)}catch(P){}if(O.length>0){S.classes=O}return O},run:function(R,Q,P){var O=this,S;if(O.doc&&typeof (R)==="string"){R=O.get(R)}if(!R){return false}P=P||this;if(!R.nodeType&&(R.length||R.length===0)){S=[];K(R,function(U,T){if(U){if(typeof (U)=="string"){U=O.doc.getElementById(U)}S.push(Q.call(P,U,T))}});return S}return Q.call(P,R)},getAttribs:function(P){var O;P=this.get(P);if(!P){return[]}if(D){O=[];if(P.nodeName=="OBJECT"){return P.attributes}if(P.nodeName==="OPTION"&&this.getAttrib(P,"selected")){O.push({specified:1,nodeName:"selected"})}P.cloneNode(false).outerHTML.replace(/<\/?[\w:\-]+ ?|=[\"][^\"]+\"|=\'[^\']+\'|=[\w\-]+|>/gi,"").replace(/[\w:\-]+/gi,function(Q){O.push({specified:1,nodeName:Q})});return O}return P.attributes},destroy:function(P){var O=this;if(O.events){O.events.destroy()}O.win=O.doc=O.root=O.events=null;if(!P){M.removeUnload(O.destroy)}},createRng:function(){var O=this.doc;return O.createRange?O.createRange():new M.dom.Range(this)},nodeIndex:function(S,T){var O=0,Q,R,P;if(S){for(Q=S.nodeType,S=S.previousSibling,R=S;S;S=S.previousSibling){P=S.nodeType;if(!T||P!=3||(Q!=P&&S.nodeValue.length)){O++}Q=P}}return O},split:function(S,R,V){var W=this,O=W.createRng(),T,Q,U;function P(Z){var Y,X=Z.childNodes;if(Z.nodeType==1&&Z.getAttribute("_mce_type")=="bookmark"){return }for(Y=X.length-1;Y>=0;Y--){P(X[Y])}if(Z.nodeType!=9){if(Z.nodeType==3&&Z.nodeValue.length>0){return }if(Z.nodeType==1){X=Z.childNodes;if(X.length==1&&X[0]&&X[0].nodeType==1&&X[0].getAttribute("_mce_type")=="bookmark"){Z.parentNode.insertBefore(X[0],Z)}if(X.length||/^(br|hr|input|img)$/i.test(Z.nodeName)){return }}W.remove(Z)}return Z}if(S&&R){O.setStart(S.parentNode,W.nodeIndex(S));O.setEnd(R.parentNode,W.nodeIndex(R));T=O.extractContents();O=W.createRng();O.setStart(R.parentNode,W.nodeIndex(R)+1);O.setEnd(S.parentNode,W.nodeIndex(S)+1);Q=O.extractContents();U=S.parentNode;U.insertBefore(P(T),S);if(V){U.replaceChild(V,R)}else{U.insertBefore(R,S)}U.insertBefore(P(Q),S);W.remove(S);return V||R}},isList:function(O){return(O&&O.nodeType==1&&["UL","OL"].indexOf(O.nodeName.toUpperCase())!=-1)},combineAdjacentLists:function(P){if(!P||!this.isList(P)){return }var R=P.previousSibling,Q=P.nextSibling,S=[],T,O=this;var U=function(){while(S.length>0){T=S.pop();T.parentNode.removeChild(T)}};while(R&&((R.nodeType==1&&R.nodeName==P.nodeName)||(R.nodeType==3&&R.data.search(/^[\n\r\t ]*$/)==0))){if(R.nodeType==3){S.push(R);R=R.previousSibling;continue}U();while(R.lastChild){P.insertBefore(R.lastChild,P.firstChild)}R=R.previousSibling;P.previousSibling.parentNode.removeChild(P.previousSibling)}S=[];while(Q&&((Q.nodeType==1&&Q.nodeName==P.nodeName)||(Q.nodeType==3&&Q.data.search(/^[\n\r\t ]*$/)==0))){if(Q.nodeType==3){S.push(Q);Q=Q.nextSibling;continue}U();while(Q.firstChild){P.appendChild(Q.firstChild)}Q=Q.nextSibling;P.nextSibling.parentNode.removeChild(P.nextSibling)}M.each(P.childNodes,function(V){if(V&&V.nodeType==1&&O.isList(V)){O.combineAdjacentLists(V)}})},combineAllAdjacentLists:function(P){var O=this;M.each(O.getAllLists(P),function(Q){O.combineAdjacentLists(Q)});return P},cleanupForPBStyles:function(V,O){var Q=this;if(!O){var P=function(W){var X=/([\d\.]+)(em|in|pt|%|px)/.exec(W);if(!X||(X[1]%2==0&&X[2]=="em")||X[2]=="%"){return }if(X[1]==0){return false}switch(X[2]){case"in":W=(X[1]*80)+"px";break;case"em":W=(X[1]*16)+"px";break;case"pt":W=Math.round(X[1]*1.33)+"px";break}return W};var U=function(X){var Z=/([\d\.]+)(em|in|pt|%|px)/.exec(X);if(!Z||Z[1]==0){return }switch(Z[2]){case"em":Z[1]=Z[1]*100;break;case"pt":Z[1]=Math.round((Z[1]/10)*100);break;case"px":Z[1]=Math.round((Z[1]/13)*100);break}if(Z[1]<20){return }var W=[75,85,100,115,130,150,200];for(var Y=0;Y<W.length;Y++){if(Z[1]>=W[Y]&&(Y+1==W.length||Z[1]<W[Y+1])){return W[Y]+"%"}}};var T=function(W){if(W.indexOf("#")==-1&&W.indexOf("rgb")){var X={maroon:"#800000",red:"#ff0000",orange:"#ffA500",yellow:"#ffff00",olive:"#808000",purple:"#800080",fuchsia:"#ff00ff",lime:"#00ff00",green:"#008000",navy:"#000080",blue:"#0000ff",aqua:"#00ffff",teal:"#008080",black:"#000000",silver:"#c0c0c0",gray:"#808080"};for(itm in X){W=W.replace(itm,X[itm])}}var Y=/(#[a-fA-F0-9]{3,6}|rbg\s*\(\d{1,3},\s*\d{1,3},\s*\d{1,3}\))/.exec(W);if(Y[0]){return Y[0]}return W};var R=function(W){W=W.replace(/&quot;/g,"");return W};O={span:{"background-color":true,background:T,color:true,"text-decoration":["underline","line-through"],"font-size":U,"font-family":R,"font-weight":"bold"},p:{"text-align":["left","center","right"],"margin-left":P,"padding-left":P},img:{"text-align":["left","center","right"],border:true,"float":["left","right"],display:"block","margin-left":"auto","margin-right":"auto"},table:{width:P,height:P,"background-color":true,background:T,"border-color":true,border:true},td:{width:P,height:P,"background-color":true,background:T,"border-color":true,border:true}}}var S=["pbSortable","pbNoBorder","tips"];M.each([V].concat(Q.select("*",V)),function(b){var W=Q.parseStyle(b.getAttribute("mce_style")||b.style.cssText),X=[],Y,a=b.getAttribute("mce_name")||b.nodeName.toLowerCase();if(b.className!=""){var Z=[];M.each(b.className.split(" "),function(e){if(S.indexOf(e)!=-1){Z.push(e)}});b.className=Z.join(" ")}M.each(W,function(f,e){if(!O[a]||!O[a][e]){return }if(f=="inherit"){return }var h=false,l=O[a][e],j,g;if(l===true){h=true}else{if(l.constructor==Array){h=(l.indexOf(f)!=-1)}else{if(typeof (l)=="string"){h=(l==f)}else{if(typeof (l)=="function"){var m=l(f);if(m===true){h=true}else{if(typeof (m)=="string"){f=m;h=true}}}}}}if(h&&Q.isRedudentStyle(b,e)){h=false}if(h){X.push(e+": "+f+";")}});Y=X.join(" ");if(Y!=b.style.cssText){b.style.cssText=Y;b.setAttribute("_mce_style",Y)}if(Y==""){b.removeAttribute("style");b.removeAttribute("_mce_style")}})},cleanupStructuralMarkup:function(P){var O=this;M.each(O.select("span",P),function(Q){if(!Q.style.cssText){O.remove(Q,true)}else{if(O.isEmpty(Q)||Q.innerHTML=="&nbsp;"){O.remove(Q,false)}}});M.each(O.select("div",P),function(R){var Q=false;if(O.isEmpty(R)){Q=true}if(!Q){M.each(R.childNodes,function(S){if(S.nodeType==3&&S.data.replace(/\n/g,"")!=""){Q=true;return false}})}if(!Q){O.remove(R,true)}});M.each(P.childNodes,function(Q){if(Q.nodeType==1&&Q.nodeName.toUpperCase()=="DIV"){O.replace(O.create("p"),Q,true)}})},isRedudentStyle:function(T,P){if(["font-weight","color","background-color","font-size","font-family"].indexOf(P)==-1){return }var Q=this;if(Q.doc.defaultView&&Q.doc.defaultView.getComputedStyle){actualStyle=Q.doc.defaultView.getComputedStyle(T,null).getPropertyValue(P);var R=T.style.cssText;T.style.cssText="";parentStyle=Q.doc.defaultView.getComputedStyle(T,null).getPropertyValue(P);T.style.cssText=R;switch(P){case"font-family":var O=new RegExp("['\"]","g");if(actualStyle&&parentStyle&&actualStyle.replace(O,"")==parentStyle.replace(O,"")){actualStyle=parentStyle}break}}else{if(T.currentStyle){var S=P.replace(/-(\D)/g,function(V,U){return U.toUpperCase()});actualStyle=T.currentStyle[S];parentStyle=T.parentNode.currentStyle[S];switch(P){case"font-size":if(actualStyle=="13px"){actualStyle="100%"}break}}}if(actualStyle&&parentStyle&&actualStyle==parentStyle){return true}},cleanupListNesting:function(Q){var P=this,O=false;M.each(P.select("LI"),function(R){if(!P.getParent(R,P.isList)){var S=P.create("UL");R.parentNode.insertBefore(S,R);S.appendChild(R);O=true}});if(O){P.combineAllAdjacentLists(Q)}},getAllLists:function(R){var P=this;if(!R){R=P.doc}var O=P.select("UL,OL",R);var Q=[];M.each(O,function(S){if(!S||!S.parentNode){return }if(P.getParent(S.parentNode,P.isList)){return }Q.push(S)});return Q},cleanupAllLists:function(P){var O=this;if(O.select("LI > UL,OL",P).length==0&&O.select("DIV > UL,OL",P).length==0){return }M.each(O.getAllLists(P),function(Q){O.cleanupList(Q)});return P},getParentList:function(O){var R=this.getParents(O),Q;for(var P=0;P<R.length;P++){if(this.isList(R[P])){Q=R[P]}}return Q},cleanupParentList:function(O){var P=this.getParentList(O);if(!P){return }this.cleanupList(P)},cleanupList:function(Q){if(!this.isList(Q)||!Q.firstChild){return }if(Q.parentNode.nodeType==1&&Q.parentNode.nodeName=="DIV"){this.divToLists(Q.parentNode,Q.nodeName)}var O=this.select("LI > UL,OL",Q),P=this,S;var R=this.select("DIV",Q);if(R.length==0&&O.length==0){return Q}M.each(R,function(T){if(T){P.divToLists(T,Q.nodeName)}});do{S=0;M.each(O,function(T){if(T){if(P.cleanupListItem(T.parentNode)){S++}}});O=this.select("LI > UL,OL",Q)}while(S>0);return Q},cleanupListItem:function(O){if(O.nodeName.toUpperCase()!="LI"||!O.firstChild){return false}var T=O.firstChild;var R=false;do{if(this.isList(T)){var Q=this.createRng(true);Q.setStart(O,0);Q.setEndBefore(T);var S=Q.extractContents();var P=this.doc.createElement("li");P.appendChild(S);O.parentNode.insertBefore(P,O);if(this.isEmpty(P)){P.parentNode.removeChild(P)}O.parentNode.insertBefore(T,O);R=true}}while(T&&(T=T.nextSibling));if(R&&this.isEmpty(O)){O.parentNode.removeChild(O);return R}return R},divToLists:function(U,W){if(!U||U.nodeName.toUpperCase()!="DIV"){return }var O=/(\d+)em/.exec(U.style.marginLeft);if(O&&O[1]>0&&O[1]%2==0){var S=O[1]/2,Q,V;var Q=this.doc.createElement(W),P=Q;for(var R=1;R<S;R++){var T=this.doc.createElement(W);P.appendChild(T);P=T}if(P){while(V=U.firstChild){P.appendChild(U.firstChild)}U.parentNode.replaceChild(Q,U);return Q}}return U},isEmpty:function(O){O=this.getOuterHTML(O);O=O.replace(/<(img|hr|table|input|select|textarea|iframe|object|embed)[ \>]/gi,"-");O=O.replace(/<[^>]+>/g,"");return O.replace(/[ \t\r\n]+/g,"")==""},bind:function(S,O,R,Q){var P=this;if(!P.events){P.events=new M.dom.EventUtils()}return P.events.add(S,O,R,Q||this)},unbind:function(R,O,Q){var P=this;if(!P.events){P.events=new M.dom.EventUtils()}return P.events.remove(R,O,Q)},_findSib:function(R,O,P){var Q=this,S=O;if(R){if(J(S,"string")){S=function(T){return Q.is(T,O)}}for(R=R[P];R;R=R[P]){if(S(R)){return R}}}return null},_isRes:function(O){return/^(top|left|bottom|right|width|height)/i.test(O)||/;\s*(top|left|bottom|right|width|height)/i.test(O)}});M.DOM=new M.dom.DOMUtils(document,{process_html:0})})(tinymce);(function(A){function B(C){var p=this,E=C.doc,AA=0,e=1,J=2,b=true,z=false,AC="startOffset",H="startContainer",u="endContainer",X="endOffset",K=tinymce.extend,N=C.nodeIndex;K(p,{startContainer:E,startOffset:0,endContainer:E,endOffset:0,collapsed:b,commonAncestorContainer:E,START_TO_START:0,START_TO_END:1,END_TO_END:2,END_TO_START:3,setStart:Q,setEnd:S,setStartBefore:G,setStartAfter:j,setEndBefore:k,setEndAfter:T,collapse:Y,selectNode:V,selectNodeContents:f,compareBoundaryPoints:U,deleteContents:P,extractContents:h,cloneContents:D,insertNode:a,surroundContents:o,cloneRange:l});function Q(AD,t){Z(b,AD,t)}function S(AD,t){Z(z,AD,t)}function G(t){Q(t.parentNode,N(t))}function j(t){Q(t.parentNode,N(t)+1)}function k(t){S(t.parentNode,N(t))}function T(t){S(t.parentNode,N(t)+1)}function Y(t){if(t){p[u]=p[H];p[X]=p[AC]}else{p[H]=p[u];p[AC]=p[X]}p.collapsed=b}function V(t){G(t);T(t)}function f(t){Q(t,0);S(t,t.nodeType===1?t.childNodes.length:t.nodeValue.length)}function U(AE,AF){var AH=p[H],AG=p[AC],AD=p[u],t=p[X];if(AE===0){return g(AH,AG,AH,AG)}if(AE===1){return g(AH,AG,AD,t)}if(AE===2){return g(AD,t,AD,t)}if(AE===3){return g(AD,t,AH,AG)}}function P(){M(J)}function h(){return M(AA)}function D(){return M(e)}function a(AG){var AD=this[H],t=this[AC],AF,AE;if((AD.nodeType===3||AD.nodeType===4)&&AD.nodeValue){if(!t){AD.parentNode.insertBefore(AG,AD)}else{if(t>=AD.nodeValue.length){C.insertAfter(AG,AD)}else{AF=AD.splitText(t);AD.parentNode.insertBefore(AG,AF)}}}else{if(AD.childNodes.length>0){AE=AD.childNodes[t]}if(AE){AD.insertBefore(AG,AE)}else{AD.appendChild(AG)}}}function o(AD){var t=p.extractContents();p.insertNode(AD);AD.appendChild(t);p.selectNode(AD)}function l(){return K(new B(C),{startContainer:p[H],startOffset:p[AC],endContainer:p[u],endOffset:p[X],collapsed:p.collapsed,commonAncestorContainer:p.commonAncestorContainer})}function q(t,AD){var AE;if(t.nodeType==3){return t}if(AD<0){return t}AE=t.firstChild;while(AE&&AD>0){--AD;AE=AE.nextSibling}if(AE){return AE}return t}function L(){return(p[H]==p[u]&&p[AC]==p[X])}function g(AF,AH,AD,AG){var AI,AE,t,AJ,AL,AK;if(AF==AD){if(AH==AG){return 0}if(AH<AG){return -1}return 1}AI=AD;while(AI&&AI.parentNode!=AF){AI=AI.parentNode}if(AI){AE=0;t=AF.firstChild;while(t!=AI&&AE<AH){AE++;t=t.nextSibling}if(AH<=AE){return -1}return 1}AI=AF;while(AI&&AI.parentNode!=AD){AI=AI.parentNode}if(AI){AE=0;t=AD.firstChild;while(t!=AI&&AE<AG){AE++;t=t.nextSibling}if(AE<AG){return -1}return 1}AJ=C.findCommonAncestor(AF,AD);AL=AF;while(AL&&AL.parentNode!=AJ){AL=AL.parentNode}if(!AL){AL=AJ}AK=AD;while(AK&&AK.parentNode!=AJ){AK=AK.parentNode}if(!AK){AK=AJ}if(AL==AK){return 0}t=AJ.firstChild;while(t){if(t==AL){return -1}if(t==AK){return 1}t=t.nextSibling}}function Z(AD,AG,AF){var t,AE;if(AD){p[H]=AG;p[AC]=AF}else{p[u]=AG;p[X]=AF}t=p[u];while(t.parentNode){t=t.parentNode}AE=p[H];while(AE.parentNode){AE=AE.parentNode}if(AE==t){if(g(p[H],p[AC],p[u],p[X])>0){p.collapse(AD)}}else{p.collapse(AD)}p.collapsed=L();p.commonAncestorContainer=C.findCommonAncestor(p[H],p[u])}function M(AJ){var AI,AF=0,AL=0,AD,AH,AE,AG,t,AK;if(p[H]==p[u]){return F(AJ)}for(AI=p[u],AD=AI.parentNode;AD;AI=AD,AD=AD.parentNode){if(AD==p[H]){return R(AI,AJ)}++AF}for(AI=p[H],AD=AI.parentNode;AD;AI=AD,AD=AD.parentNode){if(AD==p[u]){return AB(AI,AJ)}++AL}AH=AL-AF;AE=p[H];while(AH>0){AE=AE.parentNode;AH--}AG=p[u];while(AH<0){AG=AG.parentNode;AH++}for(t=AE.parentNode,AK=AG.parentNode;t!=AK;t=t.parentNode,AK=AK.parentNode){AE=t;AG=AK}return O(AE,AG,AJ)}function F(AH){var AJ,AG,AF,AI,t,AE,AD;if(AH!=J){AJ=E.createDocumentFragment()}if(p[AC]==p[X]){return AJ}if(p[H].nodeType==3){AG=p[H].nodeValue;AF=AG.substring(p[AC],p[X]);if(AH!=e){p[H].deleteData(p[AC],p[X]-p[AC]);p.collapse(b)}if(AH==J){return }AJ.appendChild(E.createTextNode(AF));return AJ}AI=q(p[H],p[AC]);t=p[X]-p[AC];while(t>0){AE=AI.nextSibling;AD=W(AI,AH);if(AJ){AJ.appendChild(AD)}--t;AI=AE}if(AH!=e){p.collapse(b)}return AJ}function R(AJ,AG){var AI,AH,AD,t,AF,AE;if(AG!=J){AI=E.createDocumentFragment()}AH=I(AJ,AG);if(AI){AI.appendChild(AH)}AD=N(AJ);t=AD-p[AC];if(t<=0){if(AG!=e){p.setEndBefore(AJ);p.collapse(z)}return AI}AH=AJ.previousSibling;while(t>0){AF=AH.previousSibling;AE=W(AH,AG);if(AI){AI.insertBefore(AE,AI.firstChild)}--t;AH=AF}if(AG!=e){p.setEndBefore(AJ);p.collapse(z)}return AI}function AB(AH,AG){var AJ,AD,AI,t,AF,AE;if(AG!=J){AJ=E.createDocumentFragment()}AI=v(AH,AG);if(AJ){AJ.appendChild(AI)}AD=N(AH);++AD;t=p[X]-AD;AI=AH.nextSibling;while(t>0){AF=AI.nextSibling;AE=W(AI,AG);if(AJ){AJ.appendChild(AE)}--t;AI=AF}if(AG!=e){p.setStartAfter(AH);p.collapse(b)}return AJ}function O(AH,t,AK){var AE,AM,AG,AI,AJ,AD,AL,AF;if(AK!=J){AM=E.createDocumentFragment()}AE=v(AH,AK);if(AM){AM.appendChild(AE)}AG=AH.parentNode;AI=N(AH);AJ=N(t);++AI;AD=AJ-AI;AL=AH.nextSibling;while(AD>0){AF=AL.nextSibling;AE=W(AL,AK);if(AM){AM.appendChild(AE)}AL=AF;--AD}AE=I(t,AK);if(AM){AM.appendChild(AE)}if(AK!=e){p.setStartAfter(AH);p.collapse(b)}return AM}function I(AI,AJ){var AE=q(p[u],p[X]-1),AK,AH,AG,t,AD,AF=AE!=p[u];if(AE==AI){return m(AE,AF,z,AJ)}AK=AE.parentNode;AH=m(AK,z,z,AJ);while(AK){while(AE){AG=AE.previousSibling;t=m(AE,AF,z,AJ);if(AJ!=J){AH.insertBefore(t,AH.firstChild)}AF=b;AE=AG}if(AK==AI){return AH}AE=AK.previousSibling;AK=AK.parentNode;AD=m(AK,z,z,AJ);if(AJ!=J){AD.appendChild(AH)}AH=AD}}function v(AI,AJ){var AF=q(p[H],p[AC]),AG=AF!=p[H],AK,AH,AE,t,AD;if(AF==AI){return m(AF,AG,b,AJ)}AK=AF.parentNode;AH=m(AK,z,b,AJ);while(AK){while(AF){AE=AF.nextSibling;t=m(AF,AG,b,AJ);if(AJ!=J){AH.appendChild(t)}AG=b;AF=AE}if(AK==AI){return AH}AF=AK.nextSibling;AK=AK.parentNode;AD=m(AK,z,b,AJ);if(AJ!=J){AD.appendChild(AH)}AH=AD}}function m(t,AG,AJ,AK){var AF,AE,AH,AD,AI;if(AG){return W(t,AK)}if(t.nodeType==3){AF=t.nodeValue;if(AJ){AD=p[AC];AE=AF.substring(AD);AH=AF.substring(0,AD)}else{AD=p[X];AE=AF.substring(0,AD);AH=AF.substring(AD)}if(AK!=e){t.nodeValue=AH}if(AK==J){return }AI=t.cloneNode(z);AI.nodeValue=AE;return AI}if(AK==J){return }return t.cloneNode(z)}function W(AD,t){if(t!=J){return t==e?AD.cloneNode(b):AD}AD.parentNode.removeChild(AD)}}A.Range=B})(tinymce.dom);(function(){function A(G){var I=this,J="\uFEFF",E,H,D=G.dom,C=true,F=false;function B(){var O=G.getRng(),K=D.createRng(),L,M,Q,P;M=O.item?O.item(0):O.parentElement();if(M.ownerDocument!=D.doc){return K}if(O.item||!M.hasChildNodes()){K.setStart(M.parentNode,D.nodeIndex(M));K.setEnd(K.startContainer,K.startOffset+1);return K}L=O.duplicate();Q=G.isCollapsed();O.collapse();O.pasteHTML('<span id="_mce_start" _mce_type="bookmark" style="display:none;line-height:0">'+J+"</span>");if(!Q){L.collapse(F);L.pasteHTML('<span id="_mce_end" _mce_type="bookmark" style="display:none;line-height:0">'+J+"</span>")}function N(V){var S,U,R,T;R=D.get("_mce_"+(V?"start":"end"));T=R.previousSibling;if(T&&T.nodeType==3){S=T;U=S.nodeValue.length;D.remove(R);T=S.nextSibling;if(T&&T.nodeType==3){P=C;S.appendData(T.nodeValue);D.remove(T)}}else{T=R.nextSibling;if(T&&T.nodeType==3){S=T;U=0}else{if(T){U=D.nodeIndex(T)-1}else{U=D.nodeIndex(R)}S=R.parentNode}D.remove(R)}if(V){K.setStart(S,U)}if(!V||Q){K.setEnd(S,U)}}N(C);if(!Q){N(F)}if(P){I.addRange(K)}return K}this.addRange=function(L){var T,Y,X=G.dom.doc,R=X.body,U,N,W,O,S,K,P,Q,V,M;this.destroy();W=L.startContainer;O=L.startOffset;S=L.endContainer;K=L.endOffset;T=R.createTextRange();if(W==X||S==X){T=R.createTextRange();T.collapse();T.select();return }if(W.nodeType==1&&W.hasChildNodes()){Q=W.childNodes.length-1;if(O>Q){V=1;W=W.childNodes[Q]}else{W=W.childNodes[O]}if(W.nodeType==3){O=0}}if(S.nodeType==1&&S.hasChildNodes()){Q=S.childNodes.length-1;if(K==0){M=1;S=S.childNodes[0]}else{S=S.childNodes[Math.min(Q,K-1)];if(S.nodeType==3){K=S.nodeValue.length}}}if(W==S&&W.nodeType==1){if(/^(IMG|TABLE)$/.test(W.nodeName)&&O!=K){T=R.createControlRange();T.addElement(W)}else{T=R.createTextRange();if(!W.hasChildNodes()&&W.canHaveHTML){W.innerHTML=J}T.moveToElementText(W);if(W.innerHTML==J){T.collapse(C);W.removeChild(W.firstChild)}}if(O==K){T.collapse(K<=L.endContainer.childNodes.length-1)}T.select();T.scrollIntoView();return }T=R.createTextRange();P=X.createElement("span");P.innerHTML=" ";if(W.nodeType==3){if(V){D.insertAfter(P,W)}else{W.parentNode.insertBefore(P,W)}T.moveToElementText(P);P.parentNode.removeChild(P);T.move("character",O)}else{T.moveToElementText(W);if(V){T.collapse(F)}}if(W==S&&W.nodeType==3){T.moveEnd("character",K-O);T.select();T.scrollIntoView();return }Y=R.createTextRange();if(S.nodeType==3){S.parentNode.insertBefore(P,S);Y.moveToElementText(P);P.parentNode.removeChild(P);Y.move("character",K);T.setEndPoint("EndToStart",Y)}else{Y.moveToElementText(S);Y.collapse(!!M);T.setEndPoint("EndToEnd",Y)}T.select();T.scrollIntoView()};this.getRangeAt=function(){if(!E||!tinymce.dom.RangeUtils.compareRanges(H,G.getRng())){E=B();H=G.getRng()}try{E.startContainer.nextSibling}catch(K){E=B();H=null}return E};this.destroy=function(){H=E=null};if(G.dom.boxModel){(function(){var Q=D.doc,L=Q.body,N,O;Q.documentElement.unselectable=C;function P(R,U){var S=L.createTextRange();try{S.moveToPoint(R,U)}catch(T){S=null}return S}function M(S){var R;if(S.button){R=P(S.x,S.y);if(R){if(R.compareEndPoints("StartToStart",O)>0){R.setEndPoint("StartToStart",O)}else{R.setEndPoint("EndToEnd",O)}R.select()}}else{K()}}function K(){D.unbind(Q,"mouseup",K);D.unbind(Q,"mousemove",M);N=0}D.bind(Q,"mousedown",function(R){if(R.target.nodeName==="HTML"){if(N){K()}N=1;O=P(R.x,R.y);if(O){D.bind(Q,"mouseup",K);D.bind(Q,"mousemove",M);O.select()}}})})()}}tinymce.dom.TridentSelection=A})();(function(){var O=/((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^[\]]*\]|['"][^'"]*['"]|[^[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?/g,H=0,D=Object.prototype.toString,M=false;var B=function(f,T,a,V){a=a||[];var Q=T=T||document;if(T.nodeType!==1&&T.nodeType!==9){return[]}if(!f||typeof f!=="string"){return a}var b=[],e,Y,j,h,Z,S,R=true,W=N(T);O.lastIndex=0;while((e=O.exec(f))!==null){b.push(e[1]);if(e[2]){S=RegExp.rightContext;break}}if(b.length>1&&I.exec(f)){if(b.length===2&&E.relative[b[0]]){Y=F(b[0]+b[1],T)}else{Y=E.relative[b[0]]?[T]:B(b.shift(),T);while(b.length){f=b.shift();if(E.relative[f]){f+=b.shift()}Y=F(f,Y)}}}else{if(!V&&b.length>1&&T.nodeType===9&&!W&&E.match.ID.test(b[0])&&!E.match.ID.test(b[b.length-1])){var k=B.find(b.shift(),T,W);T=k.expr?B.filter(k.expr,k.set)[0]:k.set[0]}if(T){var k=V?{expr:b.pop(),set:A(V)}:B.find(b.pop(),b.length===1&&(b[0]==="~"||b[0]==="+")&&T.parentNode?T.parentNode:T,W);Y=k.expr?B.filter(k.expr,k.set):k.set;if(b.length>0){j=A(Y)}else{R=false}while(b.length){var U=b.pop(),X=U;if(!E.relative[U]){U=""}else{X=b.pop()}if(X==null){X=T}E.relative[U](j,X,W)}}else{j=b=[]}}if(!j){j=Y}if(!j){throw"Syntax error, unrecognized expression: "+(U||f)}if(D.call(j)==="[object Array]"){if(!R){a.push.apply(a,j)}else{if(T&&T.nodeType===1){for(var g=0;j[g]!=null;g++){if(j[g]&&(j[g]===true||j[g].nodeType===1&&G(T,j[g]))){a.push(Y[g])}}}else{for(var g=0;j[g]!=null;g++){if(j[g]&&j[g].nodeType===1){a.push(Y[g])}}}}}else{A(j,a)}if(S){B(S,Q,a,V)}return a};B.uniqueSort=function(R){if(C){M=false;R.sort(C);if(M){for(var Q=1;Q<R.length;Q++){if(R[Q]===R[Q-1]){R.splice(Q--,1)}}}}};B.matches=function(Q,R){return B(Q,null,null,R)};B.find=function(X,Q,Y){var W,U;if(!X){return[]}for(var T=0,S=E.order.length;T<S;T++){var V=E.order[T],U;if((U=E.match[V].exec(X))){var R=RegExp.leftContext;if(R.substr(R.length-1)!=="\\"){U[1]=(U[1]||"").replace(/\\/g,"");W=E.find[V](U,Q,Y);if(W!=null){X=X.replace(E.match[V],"");break}}}}if(!W){W=Q.getElementsByTagName("*")}return{set:W,expr:X}};B.filter=function(a,Z,f,T){var S=a,h=[],X=Z,V,Q,W=Z&&Z[0]&&N(Z[0]);while(a&&Z.length){for(var Y in E.filter){if((V=E.match[Y].exec(a))!=null){var R=E.filter[Y],g,e;Q=false;if(X==h){h=[]}if(E.preFilter[Y]){V=E.preFilter[Y](V,X,f,h,T,W);if(!V){Q=g=true}else{if(V===true){continue}}}if(V){for(var U=0;(e=X[U])!=null;U++){if(e){g=R(e,V,U,X);var b=T^!!g;if(f&&g!=null){if(b){Q=true}else{X[U]=false}}else{if(b){h.push(e);Q=true}}}}}if(g!==undefined){if(!f){X=h}a=a.replace(E.match[Y],"");if(!Q){return[]}break}}}if(a==S){if(Q==null){throw"Syntax error, unrecognized expression: "+a}else{break}}S=a}return X};var E=B.selectors={order:["ID","NAME","TAG"],match:{ID:/#((?:[\w\u00c0-\uFFFF_-]|\\.)+)/,CLASS:/\.((?:[\w\u00c0-\uFFFF_-]|\\.)+)/,NAME:/\[name=['"]*((?:[\w\u00c0-\uFFFF_-]|\\.)+)['"]*\]/,ATTR:/\[\s*((?:[\w\u00c0-\uFFFF_-]|\\.)+)\s*(?:(\S?=)\s*(['"]*)(.*?)\3|)\s*\]/,TAG:/^((?:[\w\u00c0-\uFFFF\*_-]|\\.)+)/,CHILD:/:(only|nth|last|first)-child(?:\((even|odd|[\dn+-]*)\))?/,POS:/:(nth|eq|gt|lt|first|last|even|odd)(?:\((\d*)\))?(?=[^-]|$)/,PSEUDO:/:((?:[\w\u00c0-\uFFFF_-]|\\.)+)(?:\((['"]*)((?:\([^\)]+\)|[^\2\(\)]*)+)\2\))?/},attrMap:{"class":"className","for":"htmlFor"},attrHandle:{href:function(Q){return Q.getAttribute("href")}},relative:{"+":function(X,Q,W){var U=typeof Q==="string",Y=U&&!/\W/.test(Q),V=U&&!Y;if(Y&&!W){Q=Q.toUpperCase()}for(var T=0,S=X.length,R;T<S;T++){if((R=X[T])){while((R=R.previousSibling)&&R.nodeType!==1){}X[T]=V||R&&R.nodeName===Q?R||false:R===Q}}if(V){B.filter(Q,X,true)}},">":function(W,R,X){var U=typeof R==="string";if(U&&!/\W/.test(R)){R=X?R:R.toUpperCase();for(var S=0,Q=W.length;S<Q;S++){var V=W[S];if(V){var T=V.parentNode;W[S]=T.nodeName===R?T:false}}}else{for(var S=0,Q=W.length;S<Q;S++){var V=W[S];if(V){W[S]=U?V.parentNode:V.parentNode===R}}if(U){B.filter(R,W,true)}}},"":function(T,R,V){var S=H++,Q=P;if(!R.match(/\W/)){var U=R=V?R:R.toUpperCase();Q=L}Q("parentNode",R,S,T,U,V)},"~":function(T,R,V){var S=H++,Q=P;if(typeof R==="string"&&!R.match(/\W/)){var U=R=V?R:R.toUpperCase();Q=L}Q("previousSibling",R,S,T,U,V)}},find:{ID:function(R,S,T){if(typeof S.getElementById!=="undefined"&&!T){var Q=S.getElementById(R[1]);return Q?[Q]:[]}},NAME:function(S,V,W){if(typeof V.getElementsByName!=="undefined"){var R=[],U=V.getElementsByName(S[1]);for(var T=0,Q=U.length;T<Q;T++){if(U[T].getAttribute("name")===S[1]){R.push(U[T])}}return R.length===0?null:R}},TAG:function(Q,R){return R.getElementsByTagName(Q[1])}},preFilter:{CLASS:function(T,R,S,Q,W,X){T=" "+T[1].replace(/\\/g,"")+" ";if(X){return T}for(var U=0,V;(V=R[U])!=null;U++){if(V){if(W^(V.className&&(" "+V.className+" ").indexOf(T)>=0)){if(!S){Q.push(V)}}else{if(S){R[U]=false}}}}return false},ID:function(Q){return Q[1].replace(/\\/g,"")},TAG:function(R,Q){for(var S=0;Q[S]===false;S++){}return Q[S]&&N(Q[S])?R[1]:R[1].toUpperCase()},CHILD:function(Q){if(Q[1]=="nth"){var R=/(-?)(\d*)n((?:\+|-)?\d*)/.exec(Q[2]=="even"&&"2n"||Q[2]=="odd"&&"2n+1"||!/\D/.test(Q[2])&&"0n+"+Q[2]||Q[2]);Q[2]=(R[1]+(R[2]||1))-0;Q[3]=R[3]-0}Q[0]=H++;return Q},ATTR:function(U,R,S,Q,V,W){var T=U[1].replace(/\\/g,"");if(!W&&E.attrMap[T]){U[1]=E.attrMap[T]}if(U[2]==="~="){U[4]=" "+U[4]+" "}return U},PSEUDO:function(U,R,S,Q,V){if(U[1]==="not"){if(U[3].match(O).length>1||/^\w/.test(U[3])){U[3]=B(U[3],null,null,R)}else{var T=B.filter(U[3],R,S,true^V);if(!S){Q.push.apply(Q,T)}return false}}else{if(E.match.POS.test(U[0])||E.match.CHILD.test(U[0])){return true}}return U},POS:function(Q){Q.unshift(true);return Q}},filters:{enabled:function(Q){return Q.disabled===false&&Q.type!=="hidden"},disabled:function(Q){return Q.disabled===true},checked:function(Q){return Q.checked===true},selected:function(Q){Q.parentNode.selectedIndex;return Q.selected===true},parent:function(Q){return !!Q.firstChild},empty:function(Q){return !Q.firstChild},has:function(S,R,Q){return !!B(Q[3],S).length},header:function(Q){return/h\d/i.test(Q.nodeName)},text:function(Q){return"text"===Q.type},radio:function(Q){return"radio"===Q.type},checkbox:function(Q){return"checkbox"===Q.type},file:function(Q){return"file"===Q.type},password:function(Q){return"password"===Q.type},submit:function(Q){return"submit"===Q.type},image:function(Q){return"image"===Q.type},reset:function(Q){return"reset"===Q.type},button:function(Q){return"button"===Q.type||Q.nodeName.toUpperCase()==="BUTTON"},input:function(Q){return/input|select|textarea|button/i.test(Q.nodeName)}},setFilters:{first:function(R,Q){return Q===0},last:function(S,R,Q,T){return R===T.length-1},even:function(R,Q){return Q%2===0},odd:function(R,Q){return Q%2===1},lt:function(S,R,Q){return R<Q[3]-0},gt:function(S,R,Q){return R>Q[3]-0},nth:function(S,R,Q){return Q[3]-0==R},eq:function(S,R,Q){return Q[3]-0==R}},filter:{PSEUDO:function(W,S,T,X){var R=S[1],U=E.filters[R];if(U){return U(W,T,S,X)}else{if(R==="contains"){return(W.textContent||W.innerText||"").indexOf(S[3])>=0}else{if(R==="not"){var V=S[3];for(var T=0,Q=V.length;T<Q;T++){if(V[T]===W){return false}}return true}}}},CHILD:function(Q,T){var W=T[1],R=Q;switch(W){case"only":case"first":while(R=R.previousSibling){if(R.nodeType===1){return false}}if(W=="first"){return true}R=Q;case"last":while(R=R.nextSibling){if(R.nodeType===1){return false}}return true;case"nth":var S=T[2],Z=T[3];if(S==1&&Z==0){return true}var V=T[0],Y=Q.parentNode;if(Y&&(Y.sizcache!==V||!Q.nodeIndex)){var U=0;for(R=Y.firstChild;R;R=R.nextSibling){if(R.nodeType===1){R.nodeIndex=++U}}Y.sizcache=V}var X=Q.nodeIndex-Z;if(S==0){return X==0}else{return(X%S==0&&X/S>=0)}}},ID:function(R,Q){return R.nodeType===1&&R.getAttribute("id")===Q},TAG:function(R,Q){return(Q==="*"&&R.nodeType===1)||R.nodeName===Q},CLASS:function(R,Q){return(" "+(R.className||R.getAttribute("class"))+" ").indexOf(Q)>-1},ATTR:function(V,T){var S=T[1],Q=E.attrHandle[S]?E.attrHandle[S](V):V[S]!=null?V[S]:V.getAttribute(S),W=Q+"",U=T[2],R=T[4];return Q==null?U==="!=":U==="="?W===R:U==="*="?W.indexOf(R)>=0:U==="~="?(" "+W+" ").indexOf(R)>=0:!R?W&&Q!==false:U==="!="?W!=R:U==="^="?W.indexOf(R)===0:U==="$="?W.substr(W.length-R.length)===R:U==="|="?W===R||W.substr(0,R.length+1)===R+"-":false},POS:function(U,R,S,V){var Q=R[2],T=E.setFilters[Q];if(T){return T(U,S,R,V)}}}};var I=E.match.POS;for(var K in E.match){E.match[K]=new RegExp(E.match[K].source+/(?![^\[]*\])(?![^\(]*\))/.source)}var A=function(R,Q){R=Array.prototype.slice.call(R);if(Q){Q.push.apply(Q,R);return Q}return R};try{Array.prototype.slice.call(document.documentElement.childNodes)}catch(J){A=function(U,T){var R=T||[];if(D.call(U)==="[object Array]"){Array.prototype.push.apply(R,U)}else{if(typeof U.length==="number"){for(var S=0,Q=U.length;S<Q;S++){R.push(U[S])}}else{for(var S=0;U[S];S++){R.push(U[S])}}}return R}}var C;if(document.documentElement.compareDocumentPosition){C=function(R,Q){var S=R.compareDocumentPosition(Q)&4?-1:R===Q?0:1;if(S===0){M=true}return S}}else{if("sourceIndex" in document.documentElement){C=function(R,Q){var S=R.sourceIndex-Q.sourceIndex;if(S===0){M=true}return S}}else{if(document.createRange){C=function(T,R){var S=T.ownerDocument.createRange(),Q=R.ownerDocument.createRange();S.setStart(T,0);S.setEnd(T,0);Q.setStart(R,0);Q.setEnd(R,0);var U=S.compareBoundaryPoints(Range.START_TO_END,Q);if(U===0){M=true}return U}}}}(function(){var R=document.createElement("div"),S="script"+(new Date).getTime();R.innerHTML="<a name='"+S+"'/>";var Q=document.documentElement;Q.insertBefore(R,Q.firstChild);if(!!document.getElementById(S)){E.find.ID=function(U,V,W){if(typeof V.getElementById!=="undefined"&&!W){var T=V.getElementById(U[1]);return T?T.id===U[1]||typeof T.getAttributeNode!=="undefined"&&T.getAttributeNode("id").nodeValue===U[1]?[T]:undefined:[]}};E.filter.ID=function(V,T){var U=typeof V.getAttributeNode!=="undefined"&&V.getAttributeNode("id");return V.nodeType===1&&U&&U.nodeValue===T}}Q.removeChild(R)})();(function(){var Q=document.createElement("div");Q.appendChild(document.createComment(""));if(Q.getElementsByTagName("*").length>0){E.find.TAG=function(R,V){var U=V.getElementsByTagName(R[1]);if(R[1]==="*"){var T=[];for(var S=0;U[S];S++){if(U[S].nodeType===1){T.push(U[S])}}U=T}return U}}Q.innerHTML="<a href='#'></a>";if(Q.firstChild&&typeof Q.firstChild.getAttribute!=="undefined"&&Q.firstChild.getAttribute("href")!=="#"){E.attrHandle.href=function(R){return R.getAttribute("href",2)}}})();if(document.querySelectorAll){(function(){var Q=B,S=document.createElement("div");S.innerHTML="<p class='TEST'></p>";if(S.querySelectorAll&&S.querySelectorAll(".TEST").length===0){return }B=function(W,V,T,U){V=V||document;if(!U&&V.nodeType===9&&!N(V)){try{return A(V.querySelectorAll(W),T)}catch(X){}}return Q(W,V,T,U)};for(var R in Q){B[R]=Q[R]}})()}if(document.querySelector&&document.getElementsByClassName&&document.documentElement.getElementsByClassName){(function(){var Q=document.createElement("div");Q.innerHTML="<div class='test e'></div><div class='test'></div>";if(Q.getElementsByClassName("e").length===0){return }Q.lastChild.className="e";if(Q.getElementsByClassName("e").length===1){return }E.order.splice(1,0,"CLASS");E.find.CLASS=function(R,S,T){if(typeof S.getElementsByClassName!=="undefined"&&!T){return S.getElementsByClassName(R[1])}}})()}function L(R,W,V,a,X,Z){var Y=R=="previousSibling"&&!Z;for(var T=0,S=a.length;T<S;T++){var Q=a[T];if(Q){if(Y&&Q.nodeType===1){Q.sizcache=V;Q.sizset=T}Q=Q[R];var U=false;while(Q){if(Q.sizcache===V){U=a[Q.sizset];break}if(Q.nodeType===1&&!Z){Q.sizcache=V;Q.sizset=T}if(Q.nodeName===W){U=Q;break}Q=Q[R]}a[T]=U}}}function P(R,W,V,a,X,Z){var Y=R=="previousSibling"&&!Z;for(var T=0,S=a.length;T<S;T++){var Q=a[T];if(Q){if(Y&&Q.nodeType===1){Q.sizcache=V;Q.sizset=T}Q=Q[R];var U=false;while(Q){if(Q.sizcache===V){U=a[Q.sizset];break}if(Q.nodeType===1){if(!Z){Q.sizcache=V;Q.sizset=T}if(typeof W!=="string"){if(Q===W){U=true;break}}else{if(B.filter(W,[Q]).length>0){U=Q;break}}}Q=Q[R]}a[T]=U}}}var G=document.compareDocumentPosition?function(R,Q){return R.compareDocumentPosition(Q)&16}:function(R,Q){return R!==Q&&(R.contains?R.contains(Q):true)};var N=function(Q){return Q.nodeType===9&&Q.documentElement.nodeName!=="HTML"||!!Q.ownerDocument&&Q.ownerDocument.documentElement.nodeName!=="HTML"};var F=function(Q,X){var T=[],U="",V,S=X.nodeType?[X]:X;while((V=E.match.PSEUDO.exec(Q))){U+=V[0];Q=Q.replace(E.match.PSEUDO,"")}Q=E.relative[Q]?Q+"*":Q;for(var W=0,R=S.length;W<R;W++){B(Q,S[W],T)}return B.filter(U,T)};window.tinymce.dom.Sizzle=B})();(function(D){var F=D.each,C=D.DOM,B=D.isIE,E=D.isWebKit,A;D.create("tinymce.dom.EventUtils",{EventUtils:function(){this.inits=[];this.events=[]},add:function(M,N,L,J){var G,H=this,I=H.events,K;if(N instanceof Array){K=[];F(N,function(O){K.push(H.add(M,O,L,J))});return K}if(M&&M.hasOwnProperty&&M instanceof Array){K=[];F(M,function(O){O=C.get(O);K.push(H.add(O,N,L,J))});return K}M=C.get(M);if(!M){return }G=function(O){if(H.disabled){return }O=O||window.event;if(O&&B){if(!O.target){O.target=O.srcElement}D.extend(O,H._stoppers)}if(!J){return L(O)}return L.call(J,O)};if(N=="unload"){D.unloads.unshift({func:G});return G}if(N=="init"){if(H.domLoaded){G()}else{H.inits.push(G)}return G}I.push({obj:M,name:N,func:L,cfunc:G,scope:J});H._add(M,N,G);return L},remove:function(L,M,K){var H=this,G=H.events,I=false,J;if(L&&L.hasOwnProperty&&L instanceof Array){J=[];F(L,function(N){N=C.get(N);J.push(H.remove(N,M,K))});return J}L=C.get(L);F(G,function(O,N){if(O.obj==L&&O.name==M&&(!K||(O.func==K||O.cfunc==K))){G.splice(N,1);H._remove(L,M,O.cfunc);I=true;return false}});return I},clear:function(K){var I=this,G=I.events,H,J;if(K){K=C.get(K);for(H=G.length-1;H>=0;H--){J=G[H];if(J.obj===K){I._remove(J.obj,J.name,J.cfunc);J.obj=J.cfunc=null;G.splice(H,1)}}}},cancel:function(G){if(!G){return false}this.stop(G);return this.prevent(G)},stop:function(G){if(G.stopPropagation){G.stopPropagation()}else{G.cancelBubble=true}return false},prevent:function(G){if(G.preventDefault){G.preventDefault()}else{G.returnValue=false}return false},destroy:function(){var G=this;F(G.events,function(I,H){G._remove(I.obj,I.name,I.cfunc);I.obj=I.cfunc=null});G.events=[];G=null},_add:function(H,I,G){if(H.attachEvent){H.attachEvent("on"+I,G)}else{if(H.addEventListener){H.addEventListener(I,G,false)}else{H["on"+I]=G}}},_remove:function(I,J,H){if(I){try{if(I.detachEvent){I.detachEvent("on"+J,H)}else{if(I.removeEventListener){I.removeEventListener(J,H,false)}else{I["on"+J]=null}}}catch(G){}}},_pageInit:function(H){var G=this;if(G.domLoaded){return }G.domLoaded=true;F(G.inits,function(I){I()});G.inits=[]},_wait:function(I){var G=this,H=I.document;if(I.tinyMCE_GZ&&tinyMCE_GZ.loaded){G.domLoaded=1;return }if(H.attachEvent){H.attachEvent("onreadystatechange",function(){if(H.readyState==="complete"){H.detachEvent("onreadystatechange",arguments.callee);G._pageInit(I)}});if(H.documentElement.doScroll&&I==I.top){(function(){if(G.domLoaded){return }try{H.documentElement.doScroll("left")}catch(J){setTimeout(arguments.callee,0);return }G._pageInit(I)})()}}else{if(H.addEventListener){G._add(I,"DOMContentLoaded",function(){G._pageInit(I)})}}G._add(I,"load",function(){G._pageInit(I)})},_stoppers:{preventDefault:function(){this.returnValue=false},stopPropagation:function(){this.cancelBubble=true}}});A=D.dom.Event=new D.dom.EventUtils();A._wait(window);D.addUnload(function(){A.destroy()})})(tinymce);(function(A){A.dom.Element=function(F,D){var B=this,E,C;B.settings=D=D||{};B.id=F;B.dom=E=D.dom||A.DOM;if(!A.isIE){C=E.get(B.id)}A.each(("getPos,getRect,getParent,add,setStyle,getStyle,setStyles,setAttrib,setAttribs,getAttrib,addClass,removeClass,hasClass,getOuterHTML,setOuterHTML,remove,show,hide,isHidden,setHTML,get").split(/,/),function(G){B[G]=function(){var H=[F],I;for(I=0;I<arguments.length;I++){H.push(arguments[I])}H=E[G].apply(E,H);B.update(G);return H}});A.extend(B,{on:function(I,H,G){return A.dom.Event.add(B.id,I,H,G)},getXY:function(){return{x:parseInt(B.getStyle("left")),y:parseInt(B.getStyle("top"))}},getSize:function(){var G=E.get(B.id);return{w:parseInt(B.getStyle("width")||G.clientWidth),h:parseInt(B.getStyle("height")||G.clientHeight)}},moveTo:function(G,H){B.setStyles({left:G,top:H})},moveBy:function(G,I){var H=B.getXY();B.moveTo(H.x+G,H.y+I)},resizeTo:function(G,H){B.setStyles({width:G,height:H})},resizeBy:function(G,I){var H=B.getSize();B.resizeTo(H.w+G,H.h+I)},update:function(H){var G;if(A.isIE6&&D.blocker){H=H||"";if(H.indexOf("get")===0||H.indexOf("has")===0||H.indexOf("is")===0){return }if(H=="remove"){E.remove(B.blocker);return }if(!B.blocker){B.blocker=E.uniqueId();G=E.add(D.container||E.getRoot(),"iframe",{id:B.blocker,style:"position:absolute;",frameBorder:0,src:'javascript:""'});E.setStyle(G,"opacity",0)}else{G=E.get(B.blocker)}E.setStyles(G,{left:B.getStyle("left",1),top:B.getStyle("top",1),width:B.getStyle("width",1),height:B.getStyle("height",1),display:B.getStyle("display",1),zIndex:parseInt(B.getStyle("zIndex",1)||0)-1})}}})}})(tinymce);(function(C){function E(F){return F.replace(/[\n\r]+/g,"")}var B=C.is,A=C.isIE,D=C.each;C.create("tinymce.dom.Selection",{Selection:function(I,H,G){var F=this;F.dom=I;F.win=H;F.serializer=G;D(["onBeforeSetContent","onBeforeGetContent","onSetContent","onGetContent"],function(J){F[J]=new C.util.Dispatcher(F)});if(!F.win.getSelection){F.tridentSel=new C.dom.TridentSelection(F)}C.addUnload(F.destroy,F)},getContent:function(G){var F=this,H=F.getRng(),L=F.dom.create("body"),J=F.getSel(),I,K,M;G=G||{};I=K="";G.get=true;G.format=G.format||"html";F.onBeforeGetContent.dispatch(F,G);if(G.format=="text"){return F.isCollapsed()?"":(H.text||(J.toString?J.toString():""))}if(H.cloneContents){M=H.cloneContents();if(M){L.appendChild(M)}}else{if(B(H.item)||B(H.htmlText)){L.innerHTML=H.item?H.item(0).outerHTML:H.htmlText}else{L.innerHTML=H.toString()}}if(/^\s/.test(L.innerHTML)){I=" "}if(/\s+$/.test(L.innerHTML)){K=" "}G.getInner=true;G.content=F.isCollapsed()?"":I+F.serializer.serialize(L,G)+K;F.onGetContent.dispatch(F,G);return G.content},setContent:function(H,G){var F=this,I=F.getRng(),K,J=F.win.document;G=G||{format:"html"};G.set=true;H=G.content=F.dom.processHTML(H);F.onBeforeSetContent.dispatch(F,G);H=G.content;if(I.insertNode){H+='<span id="__caret">_</span>';if(I.startContainer==J&&I.endContainer==J){J.body.innerHTML=H}else{I.deleteContents();I.insertNode(F.getRng().createContextualFragment(H))}K=F.dom.get("__caret");I=J.createRange();I.setStartBefore(K);I.setEndBefore(K);F.setRng(I);F.dom.remove("__caret")}else{if(I.item){J.execCommand("Delete",false,null);I=F.getRng()}I.pasteHTML(H)}F.onSetContent.dispatch(F,G)},getStart:function(){var F=this,G=F.getRng(),H;if(G.duplicate||G.item){if(G.item){return G.item(0)}G=G.duplicate();G.collapse(1);H=G.parentElement();if(H&&H.nodeName=="BODY"){return H.firstChild||H}return H}else{H=G.startContainer;if(H.nodeType==1&&H.hasChildNodes()){H=H.childNodes[Math.min(H.childNodes.length-1,G.startOffset)]}if(H&&H.nodeType==3){return H.parentNode}return H}},getEnd:function(){var G=this,H=G.getRng(),I,F;if(H.duplicate||H.item){if(H.item){return H.item(0)}H=H.duplicate();H.collapse(0);I=H.parentElement();if(I&&I.nodeName=="BODY"){return I.lastChild||I}return I}else{I=H.endContainer;F=H.endOffset;if(I.nodeType==1&&I.hasChildNodes()){I=I.childNodes[F>0?F-1:F]}if(I&&I.nodeType==3){return I.parentNode}return I}},getBookmark:function(Q,R){var T=this,M=T.dom,G,J,I,N,H,O,P,L="\uFEFF",S;function F(V,W){var U=0;D(M.select(V),function(Y,X){if(Y==W){U=X}});return U}if(Q==2){function K(){var V=T.getRng(true),U=M.getRoot(),W={};function X(Y,b){var a=Y[b?"startContainer":"endContainer"],g=Y[b?"startOffset":"endOffset"],j=[],f,k,Z=0;if(a.nodeType==3){if(R){for(f=a.previousSibling;f&&f.nodeType==3;f=f.previousSibling){g+=f.nodeValue.length}}j.push(g)}else{k=a.childNodes;if(g>=k.length){Z=1;g=k.length-1}try{j.push(T.dom.nodeIndex(k[g],R)+Z)}catch(h){}}for(;a&&a!=U;a=a.parentNode){j.push(T.dom.nodeIndex(a,R))}return j}W.start=X(V,true);if(!T.isCollapsed()){W.end=X(V)}return W}return K()}if(Q){return{rng:T.getRng()}}G=T.getRng();I=M.uniqueId();N=tinyMCE.activeEditor.selection.isCollapsed();S="overflow:hidden;line-height:0px";if(G.duplicate||G.item){if(!G.item){J=G.duplicate();G.collapse();G.pasteHTML('<span _mce_type="bookmark" id="'+I+'_start" style="'+S+'">'+L+"</span>");if(!N){J.collapse(false);J.pasteHTML('<span _mce_type="bookmark" id="'+I+'_end" style="'+S+'">'+L+"</span>")}}else{O=G.item(0);H=O.nodeName;return{name:H,index:F(H,O)}}}else{O=T.getNode();H=O.nodeName;if(H=="IMG"){return{name:H,index:F(H,O)}}J=G.cloneRange();if(!N){J.collapse(false);J.insertNode(M.create("span",{_mce_type:"bookmark",id:I+"_end",style:S},L))}G.collapse(true);G.insertNode(M.create("span",{_mce_type:"bookmark",id:I+"_start",style:S},L))}T.moveToBookmark({id:I,keep:1});return{id:I}},moveToBookmark:function(L){var N=this,K=N.dom,I,H,F,M;if(N.tridentSel){N.tridentSel.destroy()}if(L){if(L.start){F=K.createRng();M=K.getRoot();function G(S){var O=L[S?"start":"end"],P,Q,R;if(O){for(Q=M,P=O.length-1;P>=1;P--){Q=Q.childNodes[O[P]]}if(S){F.setStart(Q,O[0])}else{F.setEnd(Q,O[0])}}}G(true);G();N.setRng(F)}else{if(L.id){F=K.createRng();function J(U){var P=K.get(L.id+"_"+U),T,O,R,S,Q=L.keep;if(P){T=P.parentNode;if(U=="start"){if(!Q){O=K.nodeIndex(P)}else{T=P;O=1}F.setStart(T,O);F.setEnd(T,O)}else{if(!Q){O=K.nodeIndex(P)}else{T=P;O=1}F.setEnd(T,O)}if(!Q){S=P.previousSibling;R=P.nextSibling;D(C.grep(P.childNodes),function(V){if(V.nodeType==3){V.nodeValue=V.nodeValue.replace(/\uFEFF/g,"")}});while(P=K.get(L.id+"_"+U)){K.remove(P,1)}if(S&&R&&S.nodeType==R.nodeType&&S.nodeType==3){O=S.nodeValue.length;S.appendData(R.nodeValue);K.remove(R);if(U=="start"){F.setStart(S,O);F.setEnd(S,O)}else{F.setEnd(S,O)}}}}}J("start");J("end");N.setRng(F)}else{if(L.name){N.select(K.select(L.name)[L.index])}else{if(L.rng){N.setRng(L.rng)}}}}}},select:function(K,J){var I=this,L=I.dom,G=L.createRng(),F;F=L.nodeIndex(K);G.setStart(K.parentNode,F);G.setEnd(K.parentNode,F+1);if(J){function H(M,O){var N=new C.dom.TreeWalker(M,M);do{if(M.nodeType==3&&C.trim(M.nodeValue).length!=0){if(O){G.setStart(M,0)}else{G.setEnd(M,M.nodeValue.length)}return }if(M.nodeName=="BR"){if(O){G.setStartBefore(M)}else{G.setEndBefore(M)}return }}while(M=(O?N.next():N.prev()))}H(K,1);H(K)}I.setRng(G);return K},isCollapsed:function(){var F=this,H=F.getRng(),G=F.getSel();if(!H||H.item){return false}if(H.compareEndPoints){return H.compareEndPoints("StartToEnd",H)===0}return !G||H.collapsed},isAtBlockStart:function(){var H=this,J=H.dom,F=true,K;if(!this.isCollapsed()){return false}try{r=this.getRng(true);if(r.startContainer.nodeType==3&&r.startOffset>0){return false}var G=J.createRng(true);G.setEnd(r.endContainer,r.endOffset);G.setStartBefore(J.isBlock(r.startContainer)?r.startContainer:J.getParent(r.startContainer,J.isBlock));return J.isEmpty(G.cloneContents())}catch(I){return false}},collapseToNode:function(K,F){var I=this,J=I.dom;if(C.isIE){if(!K){K=I.getNode()}var H=J.create("span");var G=I.getRng(false).duplicate();K.insertBefore(H,(F)?null:K.firstChild);G.moveToElementText(H);G.collapse(false);H.parentNode.removeChild(H);G.select()}else{var G=I.getRng(true);G.selectNodeContents(K||I.getNode());G.collapse(F!==true);I.setRng(G)}},expandRange:function(G,J){var I=this;var F=function(O,P,N){var M=O[P+"Container"],R=O[P+"Offset"],S,Q;if(!J){J=function(W,U,T,V){if((W.nodeType==1&&(W.nodeName.toUpperCase()=="LI"||!I.dom.isBlock(W))&&(U||I.dom.isEmpty(W)))||(W.nodeType==3&&(W.data.replace(/\n/g,"")==""||(T&&V==0&&T=="start")||(T&&V==W.data.length&&T=="end")))){return true}return false}}var L=function(T){if(T[N]){if(J(T[N])){T=T[N]}}else{if(T.parentNode){if(J(T.parentNode,true)){T=T.parentNode}}}return T};if(!J(M,true,P,R)){return false}S=M;do{Q=L(S);if(!S||!Q||Q==S){break}else{S=Q}}while(S);return S};G=I.changeRangeType(G);var H=F(G,"start","previousSibling");if(H&&H!=G.startContainer){G.setStartBefore(H)}var K=F(G,"end","nextSibling");if(K&&K!=G.endContainer){G.setEndAfter(K)}return G},changeRangeType:function(G){var F;if(G.startContainer.nodeType==1){G.setStart(G.startContainer.childNodes[G.startOffset],0)}if(G.endContainer.nodeType==1){if(G.endContainer.childNodes.length>G.endOffset-1&&G.endContainer.childNodes[G.endOffset-1]&&G.endContainer.childNodes[G.endOffset-1].nodeType==3){F=G.endContainer.childNodes[G.endOffset-1];G.setEnd(F,F.data.length)}else{G.setEnd(G.endContainer.lastChild,0)}}return G},getPBBookmark:function(){var N=this,J=N.isCollapsed(),F,G,H=N.dom.getViewPort(N.win),L=H.x,K=H.y;var M={start:(new Date()).valueOf()+Math.floor(Math.random()*1000)+"S",end:(new Date()).valueOf()+Math.floor(Math.random()*1000)+"E",scrollX:L,scrollY:K};G=N.getRng(false);if(A){if(G.item){return N.getBookmark()}else{F=G.duplicate();F.collapse(true);F.pasteHTML('<span style="display: none;" _mce_type="bookmark" id="'+M.start+'">&nbsp;</span>');if(!J){F=G.duplicate();F.collapse(false);F.pasteHTML('<span style="display: none;" _mce_type="bookmark" id="'+M.end+'">&nbsp;</span>')}return M}}G=N.getRng();F=G.cloneRange();F.collapse(true);r2=G.cloneRange();r2.collapse(false);if(!J){var I=N.dom.create("span",{id:M.end,"class":"pb_bookmark",_mce_type:"bookmark"});I.style.display="none";I.innerHTML="&nbsp;";r2.insertNode(I)}var O=N.dom.create("span",{id:M.start,"class":"pb_bookmark",_mce_type:"bookmark"});O.innerHTML="&nbsp;";O.style.display="none";F.insertNode(O);return M},moveToPBBookmark:function(K){var I=this,H=I.dom.get(K.start),F=I.dom.get(K.end),J,G;if(!H&&!F&&!K.name){return }if(typeof (K.scrollX)!="undefined"&&typeof (K.scrollY)!="undefined"){I.win.scrollTo(K.scrollX,K.scrollY)}if(A){if(K.name){return I.moveToBookmark(K)}I.win.focus();J=I.getRng(false).duplicate();J.moveToElementText(H);J.collapse(false);H.parentNode.removeChild(H);if(F){G=I.getRng(false).duplicate();G.moveToElementText(F);G.collapse(false);F.parentNode.removeChild(F);J.setEndPoint("StartToEnd",G)}J.select();return }else{J=I.dom.createRng(true);J.setStartBefore(H);H.parentNode.removeChild(H);if(F){J.setEndBefore(F);F.parentNode.removeChild(F)}else{J.collapse(true)}I.setRng(J)}},collapse:function(F){var G=this,H=G.getRng(),I;if(H.item){I=H.item(0);H=this.win.document.body.createTextRange();H.moveToElementText(I)}H.collapse(!!F);G.setRng(H)},getSel:function(){var G=this,F=this.win;return F.getSelection?F.getSelection():F.document.selection},getRng:function(J){var G=this,H,I;if(J&&G.tridentSel){return G.tridentSel.getRangeAt(0)}try{if(H=G.getSel()){I=H.rangeCount>0?H.getRangeAt(0):(H.createRange?H.createRange():G.win.document.createRange())}}catch(F){}if(!I){I=G.win.document.createRange?G.win.document.createRange():G.win.document.body.createTextRange()}return I},setRng:function(I){var H,G=this;if(!G.tridentSel){H=G.getSel();if(H){H.removeAllRanges();H.addRange(I)}}else{if(I.cloneRange){G.tridentSel.addRange(I);return }try{I.select()}catch(F){}}},setNode:function(G){var F=this;F.setContent(F.dom.getOuterHTML(G));return G},getNode:function(){var G=this,F=G.getRng(),H=G.getSel(),I;if(F.setStart){if(!F){return G.dom.getRoot()}I=F.commonAncestorContainer;if(!F.collapsed){if(F.startContainer==F.endContainer){if(F.startOffset-F.endOffset<2){if(F.startContainer.hasChildNodes()){I=F.startContainer.childNodes[F.startOffset]}}}if(C.isWebKit&&H.anchorNode&&H.anchorNode.nodeType==1){return H.anchorNode.childNodes[H.anchorOffset]}}if(I&&I.nodeType==3){return I.parentNode}return I}return F.item?F.item(0):F.parentElement()},getSelectedBlocks:function(G,F){var I=this,J=I.dom,M,H,L,K=[];M=J.getParent(G||I.getStart(),J.isBlock);H=J.getParent(F||I.getEnd(),J.isBlock);if(M){K.push(M)}if(M&&H&&M!=H){L=M;while((L=L.nextSibling)&&L!=H){if(J.isBlock(L)){K.push(L)}}}if(H&&M!=H){K.push(H)}return K},destroy:function(G){var F=this;F.win=null;if(F.tridentSel){F.tridentSel.destroy()}if(!G){C.removeUnload(F.destroy)}}})})(tinymce);(function(A){A.create("tinymce.dom.XMLWriter",{node:null,XMLWriter:function(C){function B(){var E=document.implementation;if(!E||!E.createDocument){try{return new ActiveXObject("MSXML2.DOMDocument")}catch(D){}try{return new ActiveXObject("Microsoft.XmlDom")}catch(D){}}else{return E.createDocument("","",null)}}this.doc=B();this.valid=A.isOpera||A.isWebKit;this.reset()},reset:function(){var B=this,C=B.doc;if(C.firstChild){C.removeChild(C.firstChild)}B.node=C.appendChild(C.createElement("html"))},writeStartElement:function(C){var B=this;B.node=B.node.appendChild(B.doc.createElement(C))},writeAttribute:function(C,B){if(this.valid){B=B.replace(/>/g,"%MCGT%")}this.node.setAttribute(C,B)},writeEndElement:function(){this.node=this.node.parentNode},writeFullEndElement:function(){var B=this,C=B.node;C.appendChild(B.doc.createTextNode(""));B.node=C.parentNode},writeText:function(B){if(this.valid){B=B.replace(/>/g,"%MCGT%")}this.node.appendChild(this.doc.createTextNode(B))},writeCDATA:function(B){this.node.appendChild(this.doc.createCDATASection(B))},writeComment:function(B){if(A.isIE){B=B.replace(/^\-|\-$/g," ")}this.node.appendChild(this.doc.createComment(B.replace(/\-\-/g," ")))},getContent:function(){var B;B=this.doc.xml||new XMLSerializer().serializeToString(this.doc);B=B.replace(/<\?[^?]+\?>|<html>|<\/html>|<html\/>|<!DOCTYPE[^>]+>/g,"");B=B.replace(/ ?\/>/g," />");if(this.valid){B=B.replace(/\%MCGT%/g,"&gt;")}return B}})})(tinymce);(function(A){A.create("tinymce.dom.StringWriter",{str:null,tags:null,count:0,settings:null,indent:null,StringWriter:function(B){this.settings=A.extend({indent_char:" ",indentation:0},B);this.reset()},reset:function(){this.indent="";this.str="";this.tags=[];this.count=0},writeStartElement:function(B){this._writeAttributesEnd();this.writeRaw("<"+B);this.tags.push(B);this.inAttr=true;this.count++;this.elementCount=this.count},writeAttribute:function(D,B){var C=this;C.writeRaw(" "+C.encode(D)+'="'+C.encode(B)+'"')},writeEndElement:function(){var B;if(this.tags.length>0){B=this.tags.pop();if(this._writeAttributesEnd(1)){this.writeRaw("</"+B+">")}if(this.settings.indentation>0){this.writeRaw("\n")}}},writeFullEndElement:function(){if(this.tags.length>0){this._writeAttributesEnd();this.writeRaw("</"+this.tags.pop()+">");if(this.settings.indentation>0){this.writeRaw("\n")}}},writeText:function(B){this._writeAttributesEnd();this.writeRaw(this.encode(B));this.count++},writeCDATA:function(B){this._writeAttributesEnd();this.writeRaw("<![CDATA["+B+"]]>");this.count++},writeComment:function(B){this._writeAttributesEnd();this.writeRaw("<!-- "+B+"-->");this.count++},writeRaw:function(B){this.str+=B},encode:function(B){return B.replace(/[<>&"]/g,function(C){switch(C){case"<":return"&lt;";case">":return"&gt;";case"&":return"&amp;";case'"':return"&quot;"}return C})},getContent:function(){return this.str},_writeAttributesEnd:function(B){if(!this.inAttr){return }this.inAttr=false;if(B&&this.elementCount==this.count){this.writeRaw(" />");return false}this.writeRaw(">");return true}})})(tinymce);(function(E){var G=E.extend,F=E.each,B=E.util.Dispatcher,D=E.isIE,A=E.isGecko;function C(H){return H.replace(/([?+*])/g,".$1")}E.create("tinymce.dom.Serializer",{Serializer:function(J){var I=this;I.key=0;I.onPreProcess=new B(I);I.onPostProcess=new B(I);try{I.writer=new E.dom.XMLWriter()}catch(H){I.writer=new E.dom.StringWriter()}I.settings=J=G({dom:E.DOM,valid_nodes:0,node_filter:0,attr_filter:0,invalid_attrs:/^(_mce_|_moz_|sizset|sizcache)/,closed:/^(br|hr|input|meta|img|link|param|area)$/,entity_encoding:"named",entities:"160,nbsp,161,iexcl,162,cent,163,pound,164,curren,165,yen,166,brvbar,167,sect,168,uml,169,copy,170,ordf,171,laquo,172,not,173,shy,174,reg,175,macr,176,deg,177,plusmn,178,sup2,179,sup3,180,acute,181,micro,182,para,183,middot,184,cedil,185,sup1,186,ordm,187,raquo,188,frac14,189,frac12,190,frac34,191,iquest,192,Agrave,193,Aacute,194,Acirc,195,Atilde,196,Auml,197,Aring,198,AElig,199,Ccedil,200,Egrave,201,Eacute,202,Ecirc,203,Euml,204,Igrave,205,Iacute,206,Icirc,207,Iuml,208,ETH,209,Ntilde,210,Ograve,211,Oacute,212,Ocirc,213,Otilde,214,Ouml,215,times,216,Oslash,217,Ugrave,218,Uacute,219,Ucirc,220,Uuml,221,Yacute,222,THORN,223,szlig,224,agrave,225,aacute,226,acirc,227,atilde,228,auml,229,aring,230,aelig,231,ccedil,232,egrave,233,eacute,234,ecirc,235,euml,236,igrave,237,iacute,238,icirc,239,iuml,240,eth,241,ntilde,242,ograve,243,oacute,244,ocirc,245,otilde,246,ouml,247,divide,248,oslash,249,ugrave,250,uacute,251,ucirc,252,uuml,253,yacute,254,thorn,255,yuml,402,fnof,913,Alpha,914,Beta,915,Gamma,916,Delta,917,Epsilon,918,Zeta,919,Eta,920,Theta,921,Iota,922,Kappa,923,Lambda,924,Mu,925,Nu,926,Xi,927,Omicron,928,Pi,929,Rho,931,Sigma,932,Tau,933,Upsilon,934,Phi,935,Chi,936,Psi,937,Omega,945,alpha,946,beta,947,gamma,948,delta,949,epsilon,950,zeta,951,eta,952,theta,953,iota,954,kappa,955,lambda,956,mu,957,nu,958,xi,959,omicron,960,pi,961,rho,962,sigmaf,963,sigma,964,tau,965,upsilon,966,phi,967,chi,968,psi,969,omega,977,thetasym,978,upsih,982,piv,8226,bull,8230,hellip,8242,prime,8243,Prime,8254,oline,8260,frasl,8472,weierp,8465,image,8476,real,8482,trade,8501,alefsym,8592,larr,8593,uarr,8594,rarr,8595,darr,8596,harr,8629,crarr,8656,lArr,8657,uArr,8658,rArr,8659,dArr,8660,hArr,8704,forall,8706,part,8707,exist,8709,empty,8711,nabla,8712,isin,8713,notin,8715,ni,8719,prod,8721,sum,8722,minus,8727,lowast,8730,radic,8733,prop,8734,infin,8736,ang,8743,and,8744,or,8745,cap,8746,cup,8747,int,8756,there4,8764,sim,8773,cong,8776,asymp,8800,ne,8801,equiv,8804,le,8805,ge,8834,sub,8835,sup,8836,nsub,8838,sube,8839,supe,8853,oplus,8855,otimes,8869,perp,8901,sdot,8968,lceil,8969,rceil,8970,lfloor,8971,rfloor,9001,lang,9002,rang,9674,loz,9824,spades,9827,clubs,9829,hearts,9830,diams,338,OElig,339,oelig,352,Scaron,353,scaron,376,Yuml,710,circ,732,tilde,8194,ensp,8195,emsp,8201,thinsp,8204,zwnj,8205,zwj,8206,lrm,8207,rlm,8211,ndash,8212,mdash,8216,lsquo,8217,rsquo,8218,sbquo,8220,ldquo,8221,rdquo,8222,bdquo,8224,dagger,8225,Dagger,8240,permil,8249,lsaquo,8250,rsaquo,8364,euro",valid_elements:"*[*]",extended_valid_elements:0,invalid_elements:0,fix_table_elements:1,fix_list_elements:true,fix_content_duplication:true,convert_fonts_to_spans:false,font_size_classes:0,apply_source_formatting:0,indent_mode:"simple",indent_char:"\t",indent_levels:1,remove_linebreaks:1,remove_redundant_brs:1,element_format:"xhtml"},J);I.dom=J.dom;I.schema=J.schema;if(J.entity_encoding=="named"&&!J.entities){J.entity_encoding="raw"}if(J.remove_redundant_brs){I.onPostProcess.add(function(K,L){L.content=L.content.replace(/(<br \/>\s*)+<\/(p|h[1-6]|div|li)>/gi,function(N,M,O){if(/^<br \/>\s*<\//.test(N)){return"</"+O+">"}return N})})}if(J.element_format=="html"){I.onPostProcess.add(function(K,L){L.content=L.content.replace(/<([^>]+) \/>/g,"<$1>")})}if(J.fix_list_elements){I.onPreProcess.add(function(R,O){var L,T,S=["ol","ul"],Q,P,N,K=/^(OL|UL)$/,U;function M(X,Y){var V=Y.split(","),W;while((X=X.previousSibling)!=null){for(W=0;W<V.length;W++){if(X.nodeName==V[W]){return X}}}return null}for(T=0;T<S.length;T++){L=I.dom.select(S[T],O.node);for(Q=0;Q<L.length;Q++){P=L[Q];N=P.parentNode;if(K.test(N.nodeName)){U=M(P,"LI");if(!U){U=I.dom.create("li");U.innerHTML="&nbsp;";U.appendChild(P);N.insertBefore(U,N.firstChild)}else{U.appendChild(P)}}}}})}if(J.fix_table_elements){I.onPreProcess.add(function(K,L){if(!E.isOpera||opera.buildNumber()>=1767){F(I.dom.select("p table",L.node).reverse(),function(O){var N=I.dom.getParent(O.parentNode,"table,p");if(N.nodeName!="TABLE"){try{I.dom.split(N,O)}catch(M){}}})}})}},setEntities:function(M){var L=this,I,K,H={},J;if(L.entityLookup){return }I=M.split(",");for(K=0;K<I.length;K+=2){J=I[K];if(J==34||J==38||J==60||J==62){continue}H[String.fromCharCode(I[K])]=I[K+1];J=parseInt(I[K]).toString(16)}L.entityLookup=H},setRules:function(I){var H=this;H._setup();H.rules={};H.wildRules=[];H.validElements={};return H.addRules(I)},addRules:function(I){var H=this,J;if(!I){return }H._setup();F(I.split(","),function(M){var P=M.split(/\[|\]/),L=P[0].split("/"),Q,K,O,N=[];if(J){K=E.extend([],J.attribs)}if(P.length>1){F(P[1].split("|"),function(T){var R={},S;K=K||[];T=T.replace(/::/g,"~");T=/^([!\-])?([\w*.?~_\-]+|)([=:<])?(.+)?$/.exec(T);T[2]=T[2].replace(/~/g,":");if(T[1]=="!"){Q=Q||[];Q.push(T[2])}if(T[1]=="-"){for(S=0;S<K.length;S++){if(K[S].name==T[2]){K.splice(S,1);return }}}switch(T[3]){case"=":R.defaultVal=T[4]||"";break;case":":R.forcedVal=T[4];break;case"<":R.validVals=T[4].split("?");break}if(/[*.?]/.test(T[2])){O=O||[];R.nameRE=new RegExp("^"+C(T[2])+"$");O.push(R)}else{R.name=T[2];K.push(R)}N.push(T[2])})}F(L,function(U,T){var V=U.charAt(0),S=1,R={};if(J){if(J.noEmpty){R.noEmpty=J.noEmpty}if(J.fullEnd){R.fullEnd=J.fullEnd}if(J.padd){R.padd=J.padd}}switch(V){case"-":R.noEmpty=true;break;case"+":R.fullEnd=true;break;case"#":R.padd=true;break;default:S=0}L[T]=U=U.substring(S);H.validElements[U]=1;if(/[*.?]/.test(L[0])){R.nameRE=new RegExp("^"+C(L[0])+"$");H.wildRules=H.wildRules||{};H.wildRules.push(R)}else{R.name=L[0];if(L[0]=="@"){J=R}H.rules[U]=R}R.attribs=K;if(Q){R.requiredAttribs=Q}if(O){U="";F(N,function(W){if(U){U+="|"}U+="("+C(W)+")"});R.validAttribsRE=new RegExp("^"+U.toLowerCase()+"$");R.wildAttribs=O}})});I="";F(H.validElements,function(L,K){if(I){I+="|"}if(K!="@"){I+=K}});H.validElementsRE=new RegExp("^("+C(I.toLowerCase())+")$")},findRule:function(L){var I=this,K=I.rules,H,J;I._setup();J=K[L];if(J){return J}K=I.wildRules;for(H=0;H<K.length;H++){if(K[H].nameRE.test(L)){return K[H]}}return null},findAttribRule:function(H,K){var I,J=H.wildAttribs;for(I=0;I<J.length;I++){if(J[I].nameRE.test(K)){return J[I]}}return null},serialize:function(O,N){var L,J=this,M,H,I,K;J._setup();N=N||{};N.format=N.format||"html";J.processObj=N;if(D){K=[];F(O.getElementsByTagName("option"),function(Q){var P=J.dom.getAttrib(Q,"selected");K.push(P?P:null)})}O=O.cloneNode(true);if(D){F(O.getElementsByTagName("option"),function(Q,P){J.dom.setAttrib(Q,"selected",K[P])})}I=O.ownerDocument.implementation;if(I.createHTMLDocument&&(E.isOpera&&opera.buildNumber()>=1767)){M=I.createHTMLDocument("");F(O.nodeName=="BODY"?O.childNodes:[O],function(P){M.body.appendChild(M.importNode(P,true))});if(O.nodeName!="BODY"){O=M.body.firstChild}else{O=M.body}H=J.dom.doc;J.dom.doc=M}J.key=""+(parseInt(J.key)+1);if(!N.no_events){N.node=O;J.onPreProcess.dispatch(J,N)}J.writer.reset();J._info=N;J._serializeNode(O,N.getInner);N.content=J.writer.getContent();if(H){J.dom.doc=H}if(!N.no_events){J.onPostProcess.dispatch(J,N)}J._postProcess(N);N.node=null;return E.trim(N.content)},_postProcess:function(M){var H=this,J=H.settings,I=M.content,L=[],K;if(M.format=="html"){K=H._protect({content:I,patterns:[{pattern:/(<script[^>]*>)(.*?)(<\/script>)/g},{pattern:/(<noscript[^>]*>)(.*?)(<\/noscript>)/g},{pattern:/(<style[^>]*>)(.*?)(<\/style>)/g},{pattern:/(<pre[^>]*>)(.*?)(<\/pre>)/g,encode:1},{pattern:/(<!--\[CDATA\[)(.*?)(\]\]-->)/g}]});I=K.content;if(J.entity_encoding!=="raw"){I=H._encode(I)}if(!M.set){I=I.replace(/<p>\s+<\/p>|<p([^>]+)>\s+<\/p>/g,J.entity_encoding=="numeric"?"<p$1>&#160;</p>":"<p$1>&nbsp;</p>");if(J.remove_linebreaks){I=I.replace(/\r?\n|\r/g," ");I=I.replace(/(<[^>]+>)\s+/g,"$1 ");I=I.replace(/\s+(<\/[^>]+>)/g," $1");I=I.replace(/<(p|h[1-6]|blockquote|hr|div|table|tbody|tr|td|body|head|html|title|meta|style|pre|script|link|object) ([^>]+)>\s+/g,"<$1 $2>");I=I.replace(/<(p|h[1-6]|blockquote|hr|div|table|tbody|tr|td|body|head|html|title|meta|style|pre|script|link|object)>\s+/g,"<$1>");I=I.replace(/\s+<\/(p|h[1-6]|blockquote|hr|div|table|tbody|tr|td|body|head|html|title|meta|style|pre|script|link|object)>/g,"</$1>")}if(J.apply_source_formatting&&J.indent_mode=="simple"){I=I.replace(/<(\/?)(ul|hr|table|meta|link|tbody|tr|object|body|head|html|map)(|[^>]+)>\s*/g,"\n<$1$2$3>\n");I=I.replace(/\s*<(p|h[1-6]|blockquote|div|title|style|pre|script|td|li|area)(|[^>]+)>/g,"\n<$1$2>");I=I.replace(/<\/(p|h[1-6]|blockquote|div|title|style|pre|script|td|li)>\s*/g,"</$1>\n");I=I.replace(/\n\n/g,"\n")}}I=H._unprotect(I,K);I=I.replace(/<!--\[CDATA\[([\s\S]+)\]\]-->/g,"<![CDATA[$1]]>");if(J.entity_encoding=="raw"){I=I.replace(/<p>&nbsp;<\/p>|<p([^>]+)>&nbsp;<\/p>/g,"<p$1>\u00a0</p>")}I=I.replace(/<noscript([^>]+|)>([\s\S]*?)<\/noscript>/g,function(N,P,O){return"<noscript"+P+">"+H.dom.decode(O.replace(/<!--|-->/g,""))+"</noscript>"})}M.content=I},_serializeNode:function(W,e){var S=this,T=S.settings,Q=S.writer,N,I,P,Y,X,b,U,H,R,J,O,V,M,K,Z,L;if(!T.node_filter||T.node_filter(W)){switch(W.nodeType){case 1:if(W.hasAttribute?W.hasAttribute("_mce_bogus"):W.getAttribute("_mce_bogus")){return }M=Z=false;N=W.hasChildNodes();J=W.getAttribute("_mce_name")||W.nodeName.toLowerCase();L=W.getAttribute("_mce_type");if(L){if(!S._info.cleanup){M=true;return }else{Z=1}}if(D){if(W.scopeName!=="HTML"&&W.scopeName!=="html"){J=W.scopeName+":"+J}}if(J.indexOf("mce:")===0){J=J.substring(4)}if(!Z){if(!S.validElementsRE||!S.validElementsRE.test(J)||(S.invalidElementsRE&&S.invalidElementsRE.test(J))||e){M=true;break}}if(D){if(T.fix_content_duplication){if(W._mce_serialized==S.key){return }W._mce_serialized=S.key}if(J.charAt(0)=="/"){J=J.substring(1)}}else{if(A){if(W.nodeName==="BR"&&W.getAttribute("type")=="_moz"){return }}}if(T.validate_children){if(S.elementName&&!S.schema.isValid(S.elementName,J)){M=true;break}S.elementName=J}O=S.findRule(J);if(!O){M=true;break}J=O.name||J;K=T.closed.test(J);if((!N&&O.noEmpty)||(D&&!J)){M=true;break}if(O.requiredAttribs){b=O.requiredAttribs;for(Y=b.length-1;Y>=0;Y--){if(this.dom.getAttrib(W,b[Y])!==""){break}}if(Y==-1){M=true;break}}Q.writeStartElement(J);if(O.attribs){for(Y=0,U=O.attribs,X=U.length;Y<X;Y++){b=U[Y];R=S._getAttrib(W,b);if(R!==null){Q.writeAttribute(b.name,R)}}}if(O.validAttribsRE){U=S.dom.getAttribs(W);for(Y=U.length-1;Y>-1;Y--){H=U[Y];if(H.specified){b=H.nodeName.toLowerCase();if(T.invalid_attrs.test(b)||!O.validAttribsRE.test(b)){continue}V=S.findAttribRule(O,b);R=S._getAttrib(W,V,b);if(R!==null){Q.writeAttribute(b,R)}}}}if(L&&Z){Q.writeAttribute("_mce_type",L)}if(J==="script"&&E.trim(W.innerHTML)){Q.writeText("// ");Q.writeCDATA(W.innerHTML.replace(/<!--|-->|<\[CDATA\[|\]\]>/g,""));N=false;break}if(O.padd){if(N&&(P=W.firstChild)&&P.nodeType===1&&W.childNodes.length===1){if((P.hasAttribute?P.hasAttribute("_mce_bogus"):P.getAttribute("_mce_bogus"))||P.nodeName=="BR"){Q.writeText("\u00a0")}}else{if(!N){Q.writeText("\u00a0")}}}break;case 3:if(T.validate_children&&S.elementName&&!S.schema.isValid(S.elementName,"#text")){return }return Q.writeText(W.nodeValue);case 4:return Q.writeCDATA(W.nodeValue);case 8:return Q.writeComment(W.nodeValue)}}else{if(W.nodeType==1){N=W.hasChildNodes()}}if(N&&!K){P=W.firstChild;while(P){S._serializeNode(P);S.elementName=J;P=P.nextSibling}}if(!M){if(!K){Q.writeFullEndElement()}else{Q.writeEndElement()}}},_protect:function(J){var I=this;J.items=J.items||[];function H(L){return L.replace(/[\r\n\\]/g,function(M){if(M==="\n"){return"\\n"}else{if(M==="\\"){return"\\\\"}}return"\\r"})}function K(L){return L.replace(/\\[\\rn]/g,function(M){if(M==="\\n"){return"\n"}else{if(M==="\\\\"){return"\\"}}return"\r"})}F(J.patterns,function(L){J.content=K(H(J.content).replace(L.pattern,function(N,O,M,P){M=K(M);if(L.encode){M=I._encode(M)}J.items.push(M);return O+"<!--mce:"+(J.items.length-1)+"-->"+P}))});return J},_unprotect:function(H,I){H=H.replace(/\<!--mce:([0-9]+)--\>/g,function(K,J){return I.items[parseInt(J)]});I.items=[];return H},_encode:function(K){var I=this,J=I.settings,H;if(J.entity_encoding!=="raw"){if(J.entity_encoding.indexOf("named")!=-1){I.setEntities(J.entities);H=I.entityLookup;K=K.replace(/[\u007E-\uFFFF]/g,function(L){var M;if(M=H[L]){L="&"+M+";"}return L})}if(J.entity_encoding.indexOf("numeric")!=-1){K=K.replace(/[\u007E-\uFFFF]/g,function(L){return"&#"+L.charCodeAt(0)+";"})}}return K},_setup:function(){var H=this,I=this.settings;if(H.done){return }H.done=1;H.setRules(I.valid_elements);H.addRules(I.extended_valid_elements);if(I.invalid_elements){H.invalidElementsRE=new RegExp("^("+C(I.invalid_elements.replace(/,/g,"|").toLowerCase())+")$")}if(I.attrib_value_filter){H.attribValueFilter=I.attribValueFilter}},_getAttrib:function(L,I,H){var K,J;H=H||I.name;if(I.forcedVal&&(J=I.forcedVal)){if(J==="{$uid}"){return this.dom.uniqueId()}return J}J=this.dom.getAttrib(L,H);switch(H){case"rowspan":case"colspan":if(J=="1"){J=""}break}if(this.attribValueFilter){J=this.attribValueFilter(H,J,L)}if(I.validVals){for(K=I.validVals.length-1;K>=0;K--){if(J==I.validVals[K]){break}}if(K==-1){return null}}if(J===""&&typeof (I.defaultVal)!="undefined"){J=I.defaultVal;if(J==="{$uid}"){return this.dom.uniqueId()}return J}else{if(H=="class"&&this.processObj.get){J=J.replace(/(^|\s+)mceItem\w+(\s+|$)/g," ");J=E.trim(J!=" "?J:"")}}if(J===""){return null}return J}})})(tinymce);(function(A){A.dom.ScriptLoader=function(H){var C=0,K=1,I=2,L={},J=[],F={},D=[],G=0,E;function B(M,T){var U=this,Q=A.DOM,S,O,R,N;function P(){Q.remove(N);if(S){S.onreadystatechange=S.onload=S=null}T()}N=Q.uniqueId();if(A.isIE6){O=new A.util.URI(M);R=location;if(O.host==R.hostname&&O.port==R.port&&(O.protocol+":")==R.protocol){A.util.XHR.send({url:A._addVer(O.getURI()),success:function(W){var V=Q.create("script",{type:"text/javascript"});V.text=W;document.getElementsByTagName("head")[0].appendChild(V);Q.remove(V);P()}});return }}S=Q.create("script",{id:N,type:"text/javascript",src:A._addVer(M)});S.onload=P;S.onreadystatechange=function(){var V=S.readyState;if(V=="complete"||V=="loaded"){P()}};(document.getElementsByTagName("head")[0]||document.body).appendChild(S)}this.isDone=function(M){return L[M]==I};this.markDone=function(M){L[M]=I};this.add=this.load=function(M,Q,N){var O,P=L[M];if(P==E){J.push(M);L[M]=C}if(Q){if(!F[M]){F[M]=[]}F[M].push({func:Q,scope:N||this})}};this.loadQueue=function(N,M){this.loadScripts(J,N,M)};this.loadScripts=function(M,Q,P){var O;function N(R){A.each(F[R],function(S){S.func.call(S.scope)});F[R]=E}D.push({func:Q,scope:P||this});O=function(){var R=A.grep(M);M.length=0;A.each(R,function(S){if(L[S]==I){N(S);return }if(L[S]!=K){L[S]=K;G++;B(S,function(){L[S]=I;G--;N(S);O()})}});if(!G){A.each(D,function(S){S.func.call(S.scope)});D.length=0}};O()}};A.ScriptLoader=new A.dom.ScriptLoader()})(tinymce);tinymce.dom.TreeWalker=function(A,C){var B=A;function D(I,F,E,J){var H,G;if(I){if(!J&&I[F]){return I[F]}if(I!=C){H=I[E];if(H){return H}for(G=I.parentNode;G&&G!=C;G=G.parentNode){H=G[E];if(H){return H}}}}}this.current=function(){return B};this.next=function(E){return(B=D(B,"firstChild","nextSibling",E))};this.prev=function(E){return(B=D(B,"lastChild","lastSibling",E))}};(function(){var A={};function B(F,E){var D;function C(G){return G.replace(/[A-Z]+/g,function(H){return C(F[H])})}for(D in F){if(F.hasOwnProperty(D)){F[D]=C(F[D])}}C(E).replace(/#/g,"#text").replace(/(\w+)\[([^\]]+)\]/g,function(K,G,I){var H,J={};I=I.split(/\|/);for(H=I.length-1;H>=0;H--){J[I[H]]=1}A[G]=J})}B({Z:"#|H|K|N|O|P",Y:"#|X|form|R|Q",X:"p|T|div|U|W|isindex|fieldset|table",W:"pre|hr|blockquote|address|center|noframes",U:"ul|ol|dl|menu|dir",ZC:"#|p|Y|div|U|W|table|br|span|bdo|object|applet|img|map|K|N|Q",T:"h1|h2|h3|h4|h5|h6",ZB:"#|X|S|Q",S:"R|P",ZA:"#|a|G|J|M|O|P",R:"#|a|H|K|N|O",Q:"noscript|P",P:"ins|del|script",O:"input|select|textarea|label|button",N:"M|L",M:"em|strong|dfn|code|q|samp|kbd|var|cite|abbr|acronym",L:"sub|sup",K:"J|I",J:"tt|i|b|u|s|strike",I:"big|small|font|basefont",H:"G|F",G:"br|span|bdo",F:"object|applet|img|map|iframe"},"script[]style[]object[#|param|X|form|a|H|K|N|O|Q]param[]p[S]a[Z]br[]span[S]bdo[S]applet[#|param|X|form|a|H|K|N|O|Q]h1[S]img[]map[X|form|Q|area]h2[S]iframe[#|X|form|a|H|K|N|O|Q]h3[S]tt[S]i[S]b[S]u[S]s[S]strike[S]big[S]small[S]font[S]basefont[]em[S]strong[S]dfn[S]code[S]q[S]samp[S]kbd[S]var[S]cite[S]abbr[S]acronym[S]sub[S]sup[S]input[]select[optgroup|option]optgroup[option]option[]textarea[]label[S]button[#|p|T|div|U|W|table|G|object|applet|img|map|K|N|Q]h4[S]ins[#|X|form|a|H|K|N|O|Q]h5[S]del[#|X|form|a|H|K|N|O|Q]h6[S]div[#|X|form|a|H|K|N|O|Q]ul[li]li[#|X|form|a|H|K|N|O|Q]ol[li]dl[dt|dd]dt[S]dd[#|X|form|a|H|K|N|O|Q]menu[li]dir[li]pre[ZA]hr[]blockquote[#|X|form|a|H|K|N|O|Q]address[S|p]center[#|X|form|a|H|K|N|O|Q]noframes[#|X|form|a|H|K|N|O|Q]isindex[]fieldset[#|legend|X|form|a|H|K|N|O|Q]legend[S]table[caption|col|colgroup|thead|tfoot|tbody|tr]caption[S]col[]colgroup[col]thead[tr]tr[th|td]th[#|X|form|a|H|K|N|O|Q]form[#|X|a|H|K|N|O|Q]noscript[#|X|form|a|H|K|N|O|Q]td[#|X|form|a|H|K|N|O|Q]tfoot[tr]tbody[tr]area[]base[]body[#|X|form|a|H|K|N|O|Q]");tinymce.dom.Schema=function(){var C=this,D=A;C.isValid=function(F,E){var G=D[F];return !!(G&&(!E||G[E]))}}})();(function(A){A.dom.RangeUtils=function(C){var B="\uFEFF";this.walk=function(D,R){var H=D.startContainer,K=D.startOffset,S=D.endContainer,L=D.endOffset,I,F,N,G,Q,P,E;E=C.select("td.mceSelected,th.mceSelected");if(E.length>0){A.each(E,function(T){R([T])});return }function O(V,U,T){var W=[];for(;V&&V!=T;V=V[U]){W.push(V)}return W}function M(U,T){do{if(U.parentNode==T){return U}U=U.parentNode}while(U)}function J(V,U,W){var T=W?"nextSibling":"previousSibling";for(G=V,Q=G.parentNode;G&&G!=U;G=Q){Q=G.parentNode;P=O(G==V?G:G[T],T);if(P.length){if(!W){P.reverse()}R(P)}}}if(H.nodeType==1&&H.hasChildNodes()){H=H.childNodes[K]}if(S.nodeType==1&&S.hasChildNodes()){S=S.childNodes[Math.min(K==L?L:L-1,S.childNodes.length-1)]}I=C.findCommonAncestor(H,S);if(H==S){return R([H])}for(G=H;G;G=G.parentNode){if(G==S){return J(H,I,true)}if(G==I){break}}for(G=S;G;G=G.parentNode){if(G==H){return J(S,I)}if(G==I){break}}F=M(H,I)||H;N=M(S,I)||S;J(H,F,true);P=O(F==H?F:F.nextSibling,"nextSibling",N==S?N.nextSibling:N);if(P.length){R(P)}J(S,N)}};A.dom.RangeUtils.compareRanges=function(C,B){if(C&&B){if(C.item||C.duplicate){if(C.item&&B.item&&C.item(0)===B.item(0)){return true}if(C.isEqual&&B.isEqual&&B.isEqual(C)){return true}}else{return C.startContainer==B.startContainer&&C.startOffset==B.startOffset}}return false}})(tinymce);(function(C){var B=C.DOM,A=C.is;C.create("tinymce.ui.Control",{Control:function(E,D){this.id=E;this.settings=D=D||{};this.rendered=false;this.onRender=new C.util.Dispatcher(this);this.classPrefix="";this.scope=D.scope||this;this.disabled=0;this.active=0},setDisabled:function(D){var E;if(D!=this.disabled){E=B.get(this.id);if(E&&this.settings.unavailable_prefix){if(D){this.prevTitle=E.title;E.title=this.settings.unavailable_prefix+": "+E.title}else{E.title=this.prevTitle}}this.setState("Disabled",D);this.setState("Enabled",!D);this.disabled=D}},isDisabled:function(){return this.disabled},setActive:function(D){if(D!=this.active){this.setState("Active",D);this.active=D}},isActive:function(){return this.active},setState:function(F,D){var E=B.get(this.id);F=this.classPrefix+F;if(D){B.addClass(E,F)}else{B.removeClass(E,F)}},isRendered:function(){return this.rendered},renderHTML:function(){},renderTo:function(D){B.setHTML(D,this.renderHTML())},postRender:function(){var E=this,D;if(A(E.disabled)){D=E.disabled;E.disabled=-1;E.setDisabled(D)}if(A(E.active)){D=E.active;E.active=-1;E.setActive(D)}},remove:function(){B.remove(this.id);this.destroy()},destroy:function(){C.dom.Event.clear(this.id)}})})(tinymce);tinymce.create("tinymce.ui.Container:tinymce.ui.Control",{Container:function(B,A){this.parent(B,A);this.controls=[];this.lookup={}},add:function(A){this.lookup[A.id]=A;this.controls.push(A);return A},get:function(A){return this.lookup[A]}});tinymce.create("tinymce.ui.Separator:tinymce.ui.Control",{Separator:function(B,A){this.parent(B,A);this.classPrefix="mceSeparator"},renderHTML:function(){return tinymce.DOM.createHTML("span",{"class":this.classPrefix})}});(function(D){var C=D.is,B=D.DOM,E=D.each,A=D.walk;D.create("tinymce.ui.MenuItem:tinymce.ui.Control",{MenuItem:function(G,F){this.parent(G,F);this.classPrefix="mceMenuItem"},setSelected:function(F){this.setState("Selected",F);this.selected=F},isSelected:function(){return this.selected},postRender:function(){var F=this;F.parent();if(C(F.selected)){F.setSelected(F.selected)}}})})(tinymce);(function(D){var C=D.is,B=D.DOM,E=D.each,A=D.walk;D.create("tinymce.ui.Menu:tinymce.ui.MenuItem",{Menu:function(H,G){var F=this;F.parent(H,G);F.items={};F.collapsed=false;F.menuCount=0;F.onAddItem=new D.util.Dispatcher(this)},expand:function(G){var F=this;if(G){A(F,function(H){if(H.expand){H.expand()}},"items",F)}F.collapsed=false},collapse:function(G){var F=this;if(G){A(F,function(H){if(H.collapse){H.collapse()}},"items",F)}F.collapsed=true},isCollapsed:function(){return this.collapsed},add:function(F){if(!F.settings){F=new D.ui.MenuItem(F.id||B.uniqueId(),F)}this.onAddItem.dispatch(this,F);return this.items[F.id]=F},addSeparator:function(){return this.add({separator:true})},addMenu:function(F){if(!F.collapse){F=this.createMenu(F)}this.menuCount++;return this.add(F)},hasMenus:function(){return this.menuCount!==0},remove:function(F){delete this.items[F.id]},removeAll:function(){var F=this;A(F,function(G){if(G.removeAll){G.removeAll()}else{G.remove()}G.destroy()},"items",F);F.items={}},createMenu:function(G){var F=new D.ui.Menu(G.id||B.uniqueId(),G);F.onAddItem.add(this.onAddItem.dispatch,this.onAddItem);return F}})})(tinymce);(function(E){var D=E.is,C=E.DOM,F=E.each,A=E.dom.Event,B=E.dom.Element;E.create("tinymce.ui.DropMenu:tinymce.ui.Menu",{DropMenu:function(H,G){G=G||{};G.container=G.container||C.doc.body;G.offset_x=G.offset_x||0;G.offset_y=G.offset_y||0;G.vp_offset_x=G.vp_offset_x||0;G.vp_offset_y=G.vp_offset_y||0;if(D(G.icons)&&!G.icons){G["class"]+=" mceNoIcons"}this.parent(H,G);this.onShowMenu=new E.util.Dispatcher(this);this.onHideMenu=new E.util.Dispatcher(this);this.classPrefix="mceMenu"},createMenu:function(J){var H=this,I=H.settings,G;J.container=J.container||I.container;J.parent=H;J.constrain=J.constrain||I.constrain;J["class"]=J["class"]||I["class"];J.vp_offset_x=J.vp_offset_x||I.vp_offset_x;J.vp_offset_y=J.vp_offset_y||I.vp_offset_y;G=new E.ui.DropMenu(J.id||C.uniqueId(),J);G.onAddItem.add(H.onAddItem.dispatch,H.onAddItem);return G},createMenuOfType:function(K,J){var H=this,I=H.settings,G;J.container=J.container||I.container;J.parent=H;J.constrain=J.constrain||I.constrain;J["class"]=J["class"]||I["class"];J.vp_offset_x=J.vp_offset_x||I.vp_offset_x;J.vp_offset_y=J.vp_offset_y||I.vp_offset_y;G=new E.ui[K](J.id||E.DOM.uniqueId(),J);G.onAddItem.add(H.onAddItem.dispatch,H.onAddItem);return G},update:function(){var I=this,J=I.settings,G=C.get("menu_"+I.id+"_tbl"),L=C.get("menu_"+I.id+"_co"),H,K;H=J.max_width?Math.min(G.clientWidth,J.max_width):G.clientWidth;K=J.max_height?Math.min(G.clientHeight,J.max_height):G.clientHeight;if(!C.boxModel){I.element.setStyles({width:H+2,height:K+2})}else{I.element.setStyles({width:H,height:K})}if(J.max_width){C.setStyle(L,"width",H)}if(J.max_height){C.setStyle(L,"height",K);if(G.clientHeight<J.max_height){C.setStyle(L,"overflow","hidden")}}},showMenu:function(O,M,Q){var T=this,U=T.settings,N,G=C.getViewPort(),R,K,S,P,H=2,J,I,L=T.classPrefix;T.collapse(1);if(T.isMenuVisible){return }if(!T.rendered){N=C.add(T.settings.container,T.renderNode());F(T.items,function(V){V.postRender()});T.element=new B("menu_"+T.id,{blocker:1,container:U.container})}else{N=C.get("menu_"+T.id)}if(!E.isOpera){C.setStyles(N,{left:-65535,top:-65535})}C.show(N);T.update();O+=U.offset_x||0;M+=U.offset_y||0;G.w-=4;G.h-=4;if(U.constrain){R=N.clientWidth-H;K=N.clientHeight-H;S=G.x+G.w;P=G.y+G.h;if((O+U.vp_offset_x+R)>S){O=Q?Q-R:Math.max(0,(S-U.vp_offset_x)-R)}if((M+U.vp_offset_y+K)>P){M=Math.max(0,(P-U.vp_offset_y)-K)}}C.setStyles(N,{left:O,top:M});T.element.update();T.isMenuVisible=1;T.mouseClickFunc=A.add(N,"click",function(W){var V;W=W.target;if(W&&(W=C.getParent(W,"tr"))&&!C.hasClass(W,L+"ItemSub")){V=T.items[W.id];if(V.isDisabled()){return }J=T;while(J){if(J.hideMenu){J.hideMenu()}J=J.settings.parent}if(V.settings.onclick){V.settings.onclick(W)}return A.cancel(W)}});if(T.hasMenus()){T.mouseOverFunc=A.add(N,"mouseover",function(Y){var V,X,W;Y=Y.target;if(Y&&(Y=C.getParent(Y,"tr"))){V=T.items[Y.id];if(T.lastMenu){T.lastMenu.collapse(1)}if(V.isDisabled()){return }if(Y&&C.hasClass(Y,L+"ItemSub")){X=C.getRect(Y);V.showMenu((X.x+X.w-H),X.y-H,X.x);T.lastMenu=V;C.addClass(C.get(V.id).firstChild,L+"ItemActive")}}})}T.onShowMenu.dispatch(T);if(U.keyboard_focus){A.add(N,"keydown",T._keyHandler,T);C.select("a","menu_"+T.id)[0].focus();T._focusIdx=0}},hideMenu:function(J){var G=this,I=C.get("menu_"+G.id),H;if(!G.isMenuVisible){return }A.remove(I,"mouseover",G.mouseOverFunc);A.remove(I,"click",G.mouseClickFunc);A.remove(I,"keydown",G._keyHandler);C.hide(I);G.isMenuVisible=0;if(!J){G.collapse(1)}if(G.element){G.element.hide()}if(H=C.get(G.id)){C.removeClass(H.firstChild,G.classPrefix+"ItemActive")}G.onHideMenu.dispatch(G)},add:function(I){var G=this,H;I=G.parent(I);if(G.isRendered&&(H=C.get("menu_"+G.id))){G._add(C.select("tbody",H)[0],I)}return I},collapse:function(G){this.parent(G);this.hideMenu(1)},remove:function(G){C.remove(G.id);this.destroy();return this.parent(G)},destroy:function(){var G=this,H=C.get("menu_"+G.id);A.remove(H,"mouseover",G.mouseOverFunc);A.remove(H,"click",G.mouseClickFunc);if(G.element){G.element.remove()}C.remove(H)},renderNode:function(){var I=this,J=I.settings,L,H,K,G;G=C.create("div",{id:"menu_"+I.id,"class":J["class"],style:"position:absolute;left:0;top:0;z-index:200000"});K=C.add(G,"div",{id:"menu_"+I.id+"_co","class":I.classPrefix+(J["class"]?" "+J["class"]:"")});I.element=new B("menu_"+I.id,{blocker:1,container:J.container});if(J.menu_line){C.add(K,"span",{"class":I.classPrefix+"Line"})}L=C.add(K,"table",{id:"menu_"+I.id+"_tbl",border:0,cellPadding:0,cellSpacing:0});H=C.add(L,"tbody");F(I.items,function(M){I._add(H,M)});I.rendered=true;return G},_keyHandler:function(J){var I=this,H=J.keyCode;function G(M){var K=I._focusIdx+M,L=C.select("a","menu_"+I.id)[K];if(L){I._focusIdx=K;L.focus()}}switch(H){case 38:G(-1);return ;case 40:G(1);return ;case 13:return ;case 27:return this.hideMenu()}},_add:function(K,H){var I,P=H.settings,O,M,L,N=this.classPrefix,G;if(P.separator){M=C.add(K,"tr",{id:H.id,"class":N+"ItemSeparator"});C.add(M,"td",{"class":N+"ItemSeparator"});if(I=M.previousSibling){C.addClass(I,"mceLast")}return }I=M=C.add(K,"tr",{id:H.id,"class":N+"Item "+N+"ItemEnabled"});I=L=C.add(I,"td");I=O=C.add(I,"a",{href:"javascript:;",onclick:"return false;",onmousedown:"return false;"});C.addClass(L,P["class"]);G=C.add(I,"span",{"class":"mceIcon"+(P.icon?" mce_"+P.icon:"")});if(H.settings.shortcut){var J=E.isMac?"&#8984;"+H.settings.shortcut:"Ctrl+"+H.settings.shortcut;C.add(I,"span",{"class":"mceShortcut",title:J},J)}if(P.icon_src){C.add(G,"img",{src:P.icon_src})}I=C.add(I,P.element||"span",{"class":"mceText",title:H.settings.title},H.settings.title);if(H.settings.style){C.setAttrib(I,"style",H.settings.style)}if(K.childNodes.length==1){C.addClass(M,"mceFirst")}if((I=M.previousSibling)&&C.hasClass(I,N+"ItemSeparator")){C.addClass(M,"mceFirst")}if(H.collapse){C.addClass(M,N+"ItemSub")}if(I=M.previousSibling){C.removeClass(I,"mceLast")}C.addClass(M,"mceLast")}})})(tinymce);(function(B){var A=B.DOM;B.create("tinymce.ui.Button:tinymce.ui.Control",{Button:function(D,C){this.parent(D,C);this.classPrefix="mceButton"},renderHTML:function(){var F=this.classPrefix,E=this.settings,D,C;C=A.encode(E.label||"");D='<a id="'+this.id+'" href="javascript:;" class="'+F+" "+F+"Enabled "+E["class"]+(C?" "+F+"Labeled":"")+'" onmousedown="return false;" onclick="return false;" title="'+A.encode(E.title)+'">';if(E.image){D+='<img class="mceIcon" src="'+E.image+'" />'+C+"</a>"}else{D+='<span class="mceIcon '+E["class"]+'"></span>'+(C?'<span class="'+F+'Label">'+C+"</span>":"")+"</a>"}return D},postRender:function(){var C=this,D=C.settings;B.dom.Event.add(C.id,"click",function(E){if(!C.isDisabled()){return D.onclick.call(D.scope,E)}});B.dom.Event.add(C.id,"click",function(G){var E=C.id.replace("content_","");var F={bullist:"insertunorderedlist",numlist:"insertorderedlist",pbcopy:"copy",pbpaste:"paste",pbplugin:"pbwikiplugin",pbtable:"table",pblink:"link",spellchecker:"pbspell",pbcode:"source",rule:"hr",fsedit:"fullscreen"};if(F[E]){E=F[E]}Util.tracking("editor-"+E)})}})})(tinymce);(function(D){var C=D.DOM,B=D.dom.Event,E=D.each,A=D.util.Dispatcher;D.create("tinymce.ui.ListBox:tinymce.ui.Control",{ListBox:function(H,G){var F=this;F.parent(H,G);F.items=[];F.onChange=new A(F);F.onPostRender=new A(F);F.onAdd=new A(F);F.onRenderMenu=new D.util.Dispatcher(this);F.classPrefix="mceListBox"},select:function(G){var F=this,I,H;if(G==undefined){return F.selectByIndex(-1)}if(G&&G.call){H=G}else{H=function(J){return J==G}}if(G!=F.selectedValue){E(F.items,function(K,J){if(H(K.value)){I=1;F.selectByIndex(J);return false}});if(!I){F.selectByIndex(-1)}}},selectByIndex:function(F){var G=this,H,I;if(F!=G.selectedIndex){H=C.get(G.id+"_text");I=G.items[F];if(I){G.selectedValue=I.value;G.selectedIndex=F;C.setHTML(H,C.encode(I.title));C.removeClass(H,"mceTitle")}else{C.setHTML(H,C.encode(G.settings.title));C.addClass(H,"mceTitle");G.selectedValue=G.selectedIndex=null}H=0}},add:function(I,F,H){var G=this;H=H||{};H=D.extend(H,{title:I,value:F});G.items.push(H);G.onAdd.dispatch(G,H)},getLength:function(){return this.items.length},renderHTML:function(){var H="",F=this,G=F.settings,I=F.classPrefix;H='<table id="'+F.id+'" cellpadding="0" cellspacing="0" class="'+I+" "+I+"Enabled"+(G["class"]?(" "+G["class"]):"")+'"><tbody><tr>';H+="<td>"+C.createHTML("a",{id:F.id+"_text",href:"javascript:;","class":"mceText",onclick:"return false;",onmousedown:"return false;"},C.encode(F.settings.title))+"</td>";H+="<td>"+C.createHTML("a",{id:F.id+"_open",tabindex:-1,href:"javascript:;","class":"mceOpen",onclick:"return false;",onmousedown:"return false;"},"<span></span>")+"</td>";H+="</tr></tbody></table>";return H},showMenu:function(){var G=this,J,I,H=C.get(this.id),F;if(G.isDisabled()||G.items.length==0){return }if(G.menu&&G.menu.isMenuVisible){return G.hideMenu()}if(!G.isMenuRendered){G.renderMenu();G.isMenuRendered=true}J=C.getPos(this.settings.menu_container);I=C.getPos(H);F=G.menu;F.settings.offset_x=I.x;F.settings.offset_y=I.y;F.settings.keyboard_focus=!D.isOpera;if(G.oldID){F.items[G.oldID].setSelected(0)}E(G.items,function(K){if(K.value===G.selectedValue){F.items[K.id].setSelected(1);G.oldID=K.id}});F.showMenu(0,H.clientHeight);B.add(C.doc,"mousedown",G.hideMenu,G);C.addClass(G.id,G.classPrefix+"Selected")},hideMenu:function(G){var F=this;if(F.menu&&F.menu.isMenuVisible){if(G&&G.type=="mousedown"&&(G.target.id==F.id+"_text"||G.target.id==F.id+"_open")){return }if(!G||!C.getParent(G.target,".mceMenu")){C.removeClass(F.id,F.classPrefix+"Selected");B.remove(C.doc,"mousedown",F.hideMenu,F);F.menu.hideMenu()}}},renderMenu:function(){var G=this,F;F=G.settings.control_manager.createDropMenu(G.id+"_menu",{menu_line:1,"class":G.classPrefix+"Menu mceNoIcons",max_width:150,max_height:200});F.onHideMenu.add(G.hideMenu,G);F.add({title:G.settings.title,"class":"mceMenuItemTitle",onclick:function(){if(G.settings.onselect("")!==false){G.select("")}}});E(G.items,function(H){if(H.value===undefined){F.add({title:H.title,"class":"mceMenuItemTitle",onclick:function(){if(G.settings.onselect("")!==false){G.select("")}}})}else{H.id=C.uniqueId();H.onclick=function(){if(G.settings.onselect(H.value)!==false){G.select(H.value)}};F.add(H)}});G.onRenderMenu.dispatch(G,F);G.menu=F},postRender:function(){var F=this,G=F.classPrefix;B.add(F.id,"click",F.showMenu,F);B.add(F.id+"_text","focus",function(H){if(!F._focused){F.keyDownHandler=B.add(F.id+"_text","keydown",function(L){var I=-1,J,K=L.keyCode;E(F.items,function(M,N){if(F.selectedValue==M.value){I=N}});if(K==38){J=F.items[I-1]}else{if(K==40){J=F.items[I+1]}else{if(K==13){J=F.selectedValue;F.selectedValue=null;F.settings.onselect(J);return B.cancel(L)}}}if(J){F.hideMenu();F.select(J.value)}})}F._focused=1});B.add(F.id+"_text","blur",function(){B.remove(F.id+"_text","keydown",F.keyDownHandler);F._focused=0});if(D.isIE6||!C.boxModel){B.add(F.id,"mouseover",function(){if(!C.hasClass(F.id,G+"Disabled")){C.addClass(F.id,G+"Hover")}});B.add(F.id,"mouseout",function(){if(!C.hasClass(F.id,G+"Disabled")){C.removeClass(F.id,G+"Hover")}})}F.onPostRender.dispatch(F,C.get(F.id))},destroy:function(){this.parent();B.clear(this.id+"_text");B.clear(this.id+"_open")}})})(tinymce);(function(D){var C=D.DOM,B=D.dom.Event,E=D.each,A=D.util.Dispatcher;D.create("tinymce.ui.NativeListBox:tinymce.ui.ListBox",{NativeListBox:function(G,F){this.parent(G,F);this.classPrefix="mceNativeListBox"},setDisabled:function(F){C.get(this.id).disabled=F},isDisabled:function(){return C.get(this.id).disabled},select:function(G){var F=this,I,H;if(G==undefined){return F.selectByIndex(-1)}if(G&&G.call){H=G}else{H=function(J){return J==G}}if(G!=F.selectedValue){E(F.items,function(K,J){if(H(K.value)){I=1;F.selectByIndex(J);return false}});if(!I){F.selectByIndex(-1)}}},selectByIndex:function(F){C.get(this.id).selectedIndex=F+1;this.selectedValue=this.items[F]?this.items[F].value:null},add:function(J,G,F){var I,H=this;F=F||{};F.value=G;if(H.isRendered()){C.add(C.get(this.id),"option",F,J)}I={title:J,value:G,attribs:F};H.items.push(I);H.onAdd.dispatch(H,I)},getLength:function(){return this.items.length},renderHTML:function(){var G,F=this;G=C.createHTML("option",{value:""},"-- "+F.settings.title+" --");E(F.items,function(H){G+=C.createHTML("option",{value:H.value},H.title)});G=C.createHTML("select",{id:F.id,"class":"mceNativeListBox"},G);return G},postRender:function(){var G=this,H;G.rendered=true;function F(J){var I=G.items[J.target.selectedIndex-1];if(I&&(I=I.value)){G.onChange.dispatch(G,I);if(G.settings.onselect){G.settings.onselect(I)}}}B.add(G.id,"change",F);B.add(G.id,"keydown",function(J){var I;B.remove(G.id,"change",H);I=B.add(G.id,"blur",function(){B.add(G.id,"change",F);B.remove(G.id,"blur",I)});if(J.keyCode==13||J.keyCode==32){F(J);return B.cancel(J)}});G.onPostRender.dispatch(G,C.get(G.id))}})})(tinymce);(function(C){var B=C.DOM,A=C.dom.Event,D=C.each;C.create("tinymce.ui.MenuButton:tinymce.ui.Button",{MenuButton:function(F,E){this.parent(F,E);this.onRenderMenu=new C.util.Dispatcher(this);E.menu_container=E.menu_container||B.doc.body},showMenu:function(){var F=this,I,H,G=B.get(F.id),E;if(F.isDisabled()){return }if(!F.isMenuRendered){F.renderMenu();F.isMenuRendered=true}if(F.isMenuVisible){return F.hideMenu()}I=B.getPos(F.settings.menu_container);H=B.getPos(G);E=F.menu;E.settings.offset_x=H.x;E.settings.offset_y=H.y;E.settings.vp_offset_x=H.x;E.settings.vp_offset_y=H.y;E.settings.keyboard_focus=F._focused;E.showMenu(0,G.clientHeight);A.add(B.doc,"mousedown",F.hideMenu,F);F.setState("Selected",1);F.isMenuVisible=1},renderMenu:function(){var F=this,E;E=F.settings.control_manager.createDropMenu(F.id+"_menu",{menu_line:1,"class":this.classPrefix+"Menu",icons:F.settings.icons});E.onHideMenu.add(F.hideMenu,F);F.onRenderMenu.dispatch(F,E);F.menu=E},hideMenu:function(F){var E=this;if(F&&F.type=="mousedown"&&B.getParent(F.target,function(G){return G.id===E.id||G.id===E.id+"_open"})){return }if(!F||!B.getParent(F.target,".mceMenu")){E.setState("Selected",0);A.remove(B.doc,"mousedown",E.hideMenu,E);if(E.menu){E.menu.hideMenu()}}E.isMenuVisible=0},postRender:function(){var E=this,F=E.settings;A.add(E.id,"click",function(){if(!E.isDisabled()){if(F.onclick){F.onclick(E.value)}E.showMenu()}})}})})(tinymce);(function(C){var B=C.DOM,A=C.dom.Event,D=C.each;C.create("tinymce.ui.SplitButton:tinymce.ui.MenuButton",{SplitButton:function(F,E){this.parent(F,E);this.classPrefix="mceSplitButton"},renderHTML:function(){var H,F=this,G=F.settings,E;H="<tbody><tr>";if(G.image){E=B.createHTML("img ",{src:G.image,"class":"mceAction "+G["class"]})}else{E=B.createHTML("span",{"class":"mceAction "+G["class"]},"")}H+="<td>"+B.createHTML("a",{id:F.id+"_action",href:"javascript:;","class":"mceAction "+G["class"],onclick:"return false;",onmousedown:"return false;",title:G.title},E)+"</td>";E=B.createHTML("span",{"class":"mceOpen "+G["class"]});H+="<td>"+B.createHTML("a",{id:F.id+"_open",href:"javascript:;","class":"mceOpen "+G["class"],onclick:"return false;",onmousedown:"return false;",title:G.title},E)+"</td>";H+="</tr></tbody>";return B.createHTML("table",{id:F.id,"class":"mceSplitButton mceSplitButtonEnabled "+G["class"],cellpadding:"0",cellspacing:"0",onmousedown:"return false;",title:G.title},H)},postRender:function(){var E=this,F=E.settings;if(F.onclick){A.add(E.id+"_action","click",function(){if(!E.isDisabled()){F.onclick(E.value)}})}A.add(E.id+"_open","click",E.showMenu,E);A.add(E.id+"_open","focus",function(){E._focused=1});A.add(E.id+"_open","blur",function(){E._focused=0});if(C.isIE6||!B.boxModel){A.add(E.id,"mouseover",function(){if(!B.hasClass(E.id,"mceSplitButtonDisabled")){B.addClass(E.id,"mceSplitButtonHover")}});A.add(E.id,"mouseout",function(){if(!B.hasClass(E.id,"mceSplitButtonDisabled")){B.removeClass(E.id,"mceSplitButtonHover")}})}},destroy:function(){this.parent();A.clear(this.id+"_action");A.clear(this.id+"_open")}})})(tinymce);(function(D){var C=D.DOM,A=D.dom.Event,B=D.is,E=D.each;D.create("tinymce.ui.ColorSplitButton:tinymce.ui.SplitButton",{ColorSplitButton:function(H,G){var F=this;F.parent(H,G);F.settings=G=D.extend({colors:"000000,993300,333300,003300,003366,000080,333399,333333,800000,FF6600,808000,008000,008080,0000FF,666699,808080,FF0000,FF9900,99CC00,339966,33CCCC,3366FF,800080,999999,FF00FF,FFCC00,FFFF00,00FF00,00FFFF,00CCFF,993366,C0C0C0,FF99CC,FFCC99,FFFF99,CCFFCC,CCFFFF,99CCFF,CC99FF,FFFFFF",grid_width:8,default_color:"#888888"},F.settings);F.onShowMenu=new D.util.Dispatcher(F);F.onHideMenu=new D.util.Dispatcher(F);F.value=G.default_color},showMenu:function(){var F=this,G,J,I,H;if(F.isDisabled()){return }if(!F.isMenuRendered){F.renderMenu();F.isMenuRendered=true}if(F.isMenuVisible){return F.hideMenu()}I=C.get(F.id);C.show(F.id+"_menu");C.addClass(I,"mceSplitButtonSelected");H=C.getPos(I);C.setStyles(F.id+"_menu",{left:H.x,top:H.y+I.clientHeight,zIndex:200000});I=0;A.add(C.doc,"mousedown",F.hideMenu,F);F.onShowMenu.dispatch(F);if(F._focused){F._keyHandler=A.add(F.id+"_menu","keydown",function(K){if(K.keyCode==27){F.hideMenu()}});C.select("a",F.id+"_menu")[0].focus()}F.isMenuVisible=1},hideMenu:function(G){var F=this;if(G&&G.type=="mousedown"&&C.getParent(G.target,function(H){return H.id===F.id+"_open"})){return }if(!G||!C.getParent(G.target,".mceSplitButtonMenu")){C.removeClass(F.id,"mceSplitButtonSelected");A.remove(C.doc,"mousedown",F.hideMenu,F);A.remove(F.id+"_menu","keydown",F._keyHandler);C.hide(F.id+"_menu")}F.onHideMenu.dispatch(F);F.isMenuVisible=0},renderMenu:function(){var J=this,F,I=0,K=J.settings,M,H,L,G;G=C.add(K.menu_container,"div",{id:J.id+"_menu","class":K.menu_class+" "+K["class"],style:"position:absolute;left:0;top:-1000px;"});F=C.add(G,"div",{"class":K["class"]+" mceSplitButtonMenu"});C.add(F,"span",{"class":"mceMenuLine"});M=C.add(F,"table",{"class":"mceColorSplitMenu"});H=C.add(M,"tbody");M=C.add(H,"tr");M=C.add(M,"td",{colspan:K.grid_width,"class":"mceMoreColors"});M=C.add(M,"a",{id:J.id+"_more",href:"javascript:;",onclick:"return false;","class":"mceMoreColors"},"Automatic");A.add(M,"click",function(N){J.setColor(K.default_color);return A.cancel(N)});I=0;E(B(K.colors,"array")?K.colors:K.colors.split(","),function(N){N=N.replace(/^#/,"");if(!I--){L=C.add(H,"tr");I=K.grid_width-1}M=C.add(L,"td");M=C.add(M,"a",{href:"javascript:;",style:{backgroundColor:"#"+N},_mce_color:"#"+N})});if(K.more_colors_func){M=C.add(H,"tr");M=C.add(M,"td",{colspan:K.grid_width,"class":"mceMoreColors"});M=C.add(M,"a",{id:J.id+"_more",href:"javascript:;",onclick:"return false;","class":"mceMoreColors"},K.more_colors_title);A.add(M,"click",function(N){K.more_colors_func.call(K.more_colors_scope||this);J.hideMenu();return A.cancel(N)})}C.addClass(F,"mceColorSplitMenu");A.add(J.id+"_menu","click",function(N){var O;N=N.target;if(N.nodeName=="A"&&(O=N.getAttribute("_mce_color"))){J.setColor(O)}return A.cancel(N)});return G},setColor:function(G){var F=this;C.setStyle(F.id+"_preview","backgroundColor",G);F.value=G;F.hideMenu();F.settings.onselect(G)},postRender:function(){var F=this,G=F.id;F.parent();C.add(G+"_action","div",{id:G+"_preview","class":"mceColorPreview"});C.setStyle(F.id+"_preview","backgroundColor",F.value)},destroy:function(){this.parent();A.clear(this.id+"_menu");A.clear(this.id+"_more");C.remove(this.id+"_menu")}})})(tinymce);tinymce.create("tinymce.ui.Toolbar:tinymce.ui.Container",{renderHTML:function(){var I=this,D="",F,G,B=tinymce.DOM,J=I.settings,C,A,E,H;H=I.controls;for(C=0;C<H.length;C++){G=H[C];A=H[C-1];E=H[C+1];if(C===0){F="mceToolbarStart";if(G.Button){F+=" mceToolbarStartButton"}else{if(G.SplitButton){F+=" mceToolbarStartSplitButton"}else{if(G.ListBox){F+=" mceToolbarStartListBox"}}}D+=B.createHTML("td",{"class":F},B.createHTML("span",null,"<!-- IE -->"))}if(A&&G.ListBox){if(A.Button||A.SplitButton){D+=B.createHTML("td",{"class":"mceToolbarEnd"},B.createHTML("span",null,"<!-- IE -->"))}}if(B.stdMode){D+='<td style="position: relative">'+G.renderHTML()+"</td>"}else{D+="<td>"+G.renderHTML()+"</td>"}if(E&&G.ListBox){if(E.Button||E.SplitButton){D+=B.createHTML("td",{"class":"mceToolbarStart"},B.createHTML("span",null,"<!-- IE -->"))}}}F="mceToolbarEnd";if(G.Button){F+=" mceToolbarEndButton"}else{if(G.SplitButton){F+=" mceToolbarEndSplitButton"}else{if(G.ListBox){F+=" mceToolbarEndListBox"}}}D+=B.createHTML("td",{"class":F},B.createHTML("span",null,"<!-- IE -->"));return B.createHTML("table",{id:I.id,"class":"mceToolbar"+(J["class"]?" "+J["class"]:""),cellpadding:"0",cellspacing:"0",align:I.settings.align||""},"<tbody><tr>"+D+"</tr></tbody>")}});(function(B){var A=B.util.Dispatcher,C=B.each;B.create("tinymce.AddOnManager",{items:[],urls:{},lookup:{},onAdd:new A(this),get:function(D){return this.lookup[D]},requireLangPack:function(E){var D=B.settings;if(D&&D.language){B.ScriptLoader.add(this.urls[E]+"/langs/"+D.language+".js")}},add:function(E,D){this.items.push(D);this.lookup[E]=D;this.onAdd.dispatch(this,E,D);return D},load:function(H,E,D,G){var F=this;if(F.urls[H]){return }if(E.indexOf("/")!=0&&E.indexOf("://")==-1){E=B.baseURL+"/"+E}F.urls[H]=E.substring(0,E.lastIndexOf("/"));B.ScriptLoader.add(E,D,G)}});B.PluginManager=new B.AddOnManager();B.ThemeManager=new B.AddOnManager()}(tinymce));(function(J){var G=J.each,D=J.extend,K=J.DOM,I=J.dom.Event,F=J.ThemeManager,B=J.PluginManager,E=J.explode,H=J.util.Dispatcher,A,C=0;J.documentBaseURL=window.location.href.replace(/[\?#].*$/,"").replace(/[\/\\][^\/]+$/,"");if(!/[\/\\]$/.test(J.documentBaseURL)){J.documentBaseURL+="/"}J.baseURL=new J.util.URI(J.documentBaseURL).toAbsolute(J.baseURL);J.baseURI=new J.util.URI(J.baseURL);J.onBeforeUnload=new H(J);I.add(window,"beforeunload",function(L){J.onBeforeUnload.dispatch(J,L)});J.onAddEditor=new H(J);J.onRemoveEditor=new H(J);J.EditorManager=D(J,{editors:[],i18n:{},activeEditor:null,init:function(Q){var N=this,P,L=J.ScriptLoader,S,O=[],M;function R(V,W,T){var U=V[W];if(!U){return }if(J.is(U,"string")){T=U.replace(/\.\w+$/,"");T=T?J.resolve(T):0;U=J.resolve(U)}return U.apply(T||this,Array.prototype.slice.call(arguments,2))}Q=D({theme:"simple",language:"en"},Q);N.settings=Q;I.add(document,"init",function(){var T,V;R(Q,"onpageload");switch(Q.mode){case"exact":T=Q.elements||"";if(T.length>0){G(E(T),function(W){if(K.get(W)){M=new J.Editor(W,Q);O.push(M);M.render(1)}else{G(document.forms,function(X){G(X.elements,function(Y){if(Y.name===W){W="mce_editor_"+C++;K.setAttrib(Y,"id",W);M=new J.Editor(W,Q);O.push(M);M.render(1)}})})}})}break;case"textareas":case"specific_textareas":function U(X,W){return W.constructor===RegExp?W.test(X.className):K.hasClass(X,W)}G(K.select("textarea"),function(W){if(Q.editor_deselector&&U(W,Q.editor_deselector)){return }if(!Q.editor_selector||U(W,Q.editor_selector)){S=K.get(W.name);if(!W.id&&!S){W.id=W.name}if(!W.id||N.get(W.id)){W.id=K.uniqueId()}M=new J.Editor(W.id,Q);O.push(M);M.render(1)}});break}if(Q.oninit){T=V=0;G(O,function(W){V++;if(!W.initialized){W.onInit.add(function(){T++;if(T==V){R(Q,"oninit")}})}else{T++}if(T==V){R(Q,"oninit")}})}})},get:function(L){if(L===A){return this.editors}return this.editors[L]},getInstanceById:function(L){return this.get(L)},add:function(M){var L=this,N=L.editors;N[M.id]=M;N.push(M);L._setActive(M);L.onAddEditor.dispatch(L,M);return M},remove:function(N){var M=this,L,O=M.editors;if(!O[N.id]){return null}delete O[N.id];for(L=0;L<O.length;L++){if(O[L]==N){O.splice(L,1);break}}if(M.activeEditor==N){M._setActive(O[0])}N.destroy();M.onRemoveEditor.dispatch(M,N);return N},execCommand:function(R,P,O){var Q=this,N=Q.get(O),L;switch(R){case"mceFocus":N.focus();return true;case"mceAddEditor":case"mceAddControl":if(!Q.get(O)){new J.Editor(O,Q.settings).render()}return true;case"mceAddFrameControl":L=O.window;L.tinyMCE=tinyMCE;L.tinymce=J;J.DOM.doc=L.document;J.DOM.win=L;N=new J.Editor(O.element_id,O);N.render();if(J.isIE){function M(){N.destroy();L.detachEvent("onunload",M);L=L.tinyMCE=L.tinymce=null}L.attachEvent("onunload",M)}O.page_window=null;return true;case"mceRemoveEditor":case"mceRemoveControl":if(N){N.remove()}return true;case"mceToggleEditor":if(!N){Q.execCommand("mceAddControl",0,O);return true}if(N.isHidden()){N.show()}else{N.hide()}return true}if(Q.activeEditor){return Q.activeEditor.execCommand(R,P,O)}return false},execInstanceCommand:function(P,O,N,M){var L=this.get(P);if(L){return L.execCommand(O,N,M)}return false},triggerSave:function(){G(this.editors,function(L){L.save()})},addI18n:function(N,O){var L,M=this.i18n;if(!J.is(N,"string")){G(N,function(Q,P){G(Q,function(S,R){G(S,function(U,T){if(R==="common"){M[P+"."+T]=U}else{M[P+"."+R+"."+T]=U}})})})}else{G(O,function(Q,P){M[N+"."+P]=Q})}},_setActive:function(L){this.selectedInstance=this.activeEditor=L}})})(tinymce);(function(M){var N=M.DOM,J=M.dom.Event,F=M.extend,K=M.util.Dispatcher,I=M.each,A=M.isGecko,B=M.isIE,E=M.isWebKit,D=M.is,H=M.ThemeManager,C=M.PluginManager,O=M.inArray,L=M.grep,G=M.explode;M.create("tinymce.Editor",{Editor:function(R,Q){var P=this;P.id=P.editorId=R;P.execCommands={};P.queryStateCommands={};P.queryValueCommands={};P.isNotDirty=false;P.plugins={};I(["onPreInit","onBeforeRenderUI","onPostRender","onInit","onRemove","onActivate","onDeactivate","onClick","onEvent","onMouseUp","onMouseDown","onDblClick","onKeyDown","onKeyUp","onKeyPress","onContextMenu","onSubmit","onReset","onPaste","onCopy","onPreProcess","onPostProcess","onBeforeSetContent","onBeforeGetContent","onSetContent","onGetContent","onLoadContent","onSaveContent","onNodeChange","onChange","onBeforeExecCommand","onExecCommand","onUndo","onRedo","onVisualAid","onSetProgressState"],function(S){P[S]=new K(P)});P.settings=Q=F({id:R,language:"en",docs_language:"en",theme:"simple",skin:"default",delta_width:0,delta_height:0,popup_css:"",plugins:"",document_base_url:M.documentBaseURL,add_form_submit_trigger:1,submit_patch:1,add_unload_trigger:1,convert_urls:1,relative_urls:1,remove_script_host:1,table_inline_editing:0,object_resizing:1,cleanup:1,accessibility_focus:1,custom_shortcuts:1,custom_undo_redo_keyboard_shortcuts:1,custom_undo_redo_restore_selection:1,custom_undo_redo:1,doctype:M.isIE6?'<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">':"<!DOCTYPE>",visual_table_class:"mceItemTable",visual:1,font_size_style_values:"xx-small,x-small,small,medium,large,x-large,xx-large",apply_source_formatting:1,directionality:"ltr",forced_root_block:"p",valid_elements:"@[id|class|style|title|dir<ltr?rtl|lang|xml::lang|onclick|ondblclick|onmousedown|onmouseup|onmouseover|onmousemove|onmouseout|onkeypress|onkeydown|onkeyup],a[rel|rev|charset|hreflang|tabindex|accesskey|type|name|href|target|title|class|onfocus|onblur],strong/b,em/i,strike,u,#p,-ol[type|compact],-ul[type|compact],-li,br,img[longdesc|usemap|src|border|alt=|title|hspace|vspace|width|height|align],-sub,-sup,-blockquote[cite],-table[border|cellspacing|cellpadding|width|frame|rules|height|align|summary|bgcolor|background|bordercolor],-tr[rowspan|width|height|align|valign|bgcolor|background|bordercolor],tbody,thead,tfoot,#td[colspan|rowspan|width|height|align|valign|bgcolor|background|bordercolor|scope],#th[colspan|rowspan|width|height|align|valign|scope],caption,-div,-span,-code,-pre,address,-h1,-h2,-h3,-h4,-h5,-h6,hr[size|noshade],-font[face|size|color],dd,dl,dt,cite,abbr,acronym,del[datetime|cite],ins[datetime|cite],object[classid|width|height|codebase|*],param[name|value],embed[type|width|height|src|*],script[src|type],map[name],area[shape|coords|href|alt|target],bdo,button,col[align|char|charoff|span|valign|width],colgroup[align|char|charoff|span|valign|width],dfn,fieldset,form[action|accept|accept-charset|enctype|method],input[accept|alt|checked|disabled|maxlength|name|readonly|size|src|type|value|tabindex|accesskey],kbd,label[for],legend,noscript,optgroup[label|disabled],option[disabled|label|selected|value],q[cite],samp,select[disabled|multiple|name|size],small,textarea[cols|rows|disabled|name|readonly],tt,var,big",hidden_input:1,padd_empty_editor:1,render_ui:1,init_theme:1,force_p_newlines:1,indentation:"30px",keep_styles:1,fix_table_elements:1,inline_styles:1,convert_fonts_to_spans:true},Q);P.documentBaseURI=new M.util.URI(Q.document_base_url||M.documentBaseURL,{base_uri:tinyMCE.baseURI});P.baseURI=M.baseURI;P.execCallback("setup",P)},render:function(R){var S=this,T=S.settings,U=S.id,P=M.ScriptLoader;if(!J.domLoaded){J.add(document,"init",function(){S.render()});return }tinyMCE.settings=T;if(!S.getElement()){return }if(!/TEXTAREA|INPUT/i.test(S.getElement().nodeName)&&T.hidden_input&&N.getParent(U,"form")){N.insertAfter(N.create("input",{type:"hidden",name:U}),U)}if(M.WindowManager){S.windowManager=new M.WindowManager(S)}if(T.encoding=="xml"){S.onGetContent.add(function(V,W){if(W.save){W.content=N.encode(W.content)}})}if(T.add_form_submit_trigger){S.onSubmit.addToTop(function(){if(S.initialized){S.save();S.isNotDirty=1}})}if(T.add_unload_trigger){S._beforeUnload=tinyMCE.onBeforeUnload.add(function(){if(S.initialized&&!S.destroyed&&!S.isHidden()){S.save({format:"raw",no_events:true})}})}M.addUnload(S.destroy,S);if(T.submit_patch){S.onBeforeRenderUI.add(function(){var V=S.getElement().form;if(!V){return }if(V._mceOldSubmit){return }if(!V.submit.nodeType&&!V.submit.length){S.formElement=V;V._mceOldSubmit=V.submit;V.submit=function(){M.triggerSave();S.isNotDirty=1;return S.formElement._mceOldSubmit(S.formElement)}}V=null})}function Q(){if(T.language){P.add(M.baseURL+"/langs/"+T.language+".js")}if(T.theme&&T.theme.charAt(0)!="-"&&!H.urls[T.theme]){H.load(T.theme,"themes/"+T.theme+"/editor_template"+M.suffix+".js")}I(G(T.plugins),function(V){if(V&&V.charAt(0)!="-"&&!C.urls[V]){if(V=="safari"){return }C.load(V,"plugins/"+V+"/editor_plugin"+M.suffix+".js")}});P.loadQueue(function(){if(!S.removed){S.init()}})}Q()},init:function(){var R,a=this,b=a.settings,X,U,W=a.getElement(),Q,P,Y,T,V,Z;M.add(a);if(b.theme){b.theme=b.theme.replace(/-/,"");Q=H.get(b.theme);a.theme=new Q();if(a.theme.init&&b.init_theme){a.theme.init(a,H.urls[b.theme]||M.documentBaseURL.replace(/\/$/,""))}}I(G(b.plugins.replace(/\-/g,"")),function(g){var h=C.get(g),f=C.urls[g]||M.documentBaseURL.replace(/\/$/,""),e;if(h){e=new h(a,f);a.plugins[g]=e;if(e.init){e.init(a,f)}}});if(b.popup_css!==false){if(b.popup_css){b.popup_css=a.documentBaseURI.toAbsolute(b.popup_css)}else{b.popup_css=a.baseURI.toAbsolute("themes/"+b.theme+"/skins/"+b.skin+"/dialog.css")}}if(b.popup_css_add){b.popup_css+=","+a.documentBaseURI.toAbsolute(b.popup_css_add)}a.controlManager=new M.ControlManager(a);if(b.custom_undo_redo){a.onBeforeExecCommand.add(function(f,h,g,j,e){if(h!="Undo"&&h!="Redo"&&h!="mceRepaint"&&(!e||!e.skip_undo)){if(!a.undoManager.hasUndo()){a.undoManager.add()}}});a.onExecCommand.add(function(f,h,g,j,e){if(h!="Undo"&&h!="Redo"&&h!="mceRepaint"&&(!e||!e.skip_undo)){a.undoManager.add()}})}a.onExecCommand.add(function(e,f){if(!/^(FontName|FontSize)$/.test(f)){a.nodeChanged()}});if(A){function S(e,f){if(!f||!f.initial){a.execCommand("mceRepaint")}}a.onUndo.add(S);a.onRedo.add(S);a.onSetContent.add(S)}a.onBeforeRenderUI.dispatch(a,a.controlManager);if(b.render_ui){X=b.width||W.style.width||W.offsetWidth;U=b.height||W.style.height||W.offsetHeight;a.orgDisplay=W.style.display;Z=/^[0-9\.]+(|px)$/i;if(Z.test(""+X)){X=Math.max(parseInt(X)+(Q.deltaWidth||0),100)}if(Z.test(""+U)){U=Math.max(parseInt(U)+(Q.deltaHeight||0),100)}Q=a.theme.renderUI({targetNode:W,width:X,height:U,deltaWidth:b.delta_width,deltaHeight:b.delta_height});a.editorContainer=Q.editorContainer}if(document.domain&&location.hostname!=document.domain){M.relaxedDomain=document.domain}N.setStyles(Q.sizeContainer||Q.editorContainer,{width:X,height:U});U=(Q.iframeHeight||U)+(typeof (U)=="number"?(Q.deltaHeight||0):"");if(U<100){U=100}a.iframeHTML=b.doctype+'<html><head xmlns="http://www.w3.org/1999/xhtml">';if(b.document_base_url!=M.documentBaseURL){a.iframeHTML+='<base href="'+a.documentBaseURI.getURI()+'" />'}a.iframeHTML+='<meta http-equiv="X-UA-Compatible" content="IE=7" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />';if(M.relaxedDomain){a.iframeHTML+='<script type="text/javascript">document.domain = "'+M.relaxedDomain+'";<\/script>'}T=b.body_id||"tinymce";if(T.indexOf("=")!=-1){T=a.getParam("body_id","","hash");T=T[a.id]||T}V=b.body_class||"";if(V.indexOf("=")!=-1){V=a.getParam("body_class","","hash");V=V[a.id]||""}if(b.content_css_txt){a.iframeHTML+="<style>"+b.content_css_txt+"</style>"}a.iframeHTML+='</head><body id="'+T+'" class="mceContentBody '+V+'"></body></html>';if(M.relaxedDomain){if(B||(M.isOpera&&parseFloat(opera.version())>=9.5)){Y='javascript:(function(){document.open();document.domain="'+document.domain+'";var ed = window.parent.tinyMCE.get("'+a.id+'");document.write(ed.iframeHTML);document.close();ed.setupIframe();})()'}else{if(M.isOpera){Y='javascript:(function(){document.open();document.domain="'+document.domain+'";document.close();ed.setupIframe();})()'}}}R=N.add(Q.iframeContainer,"iframe",{id:a.id+"_ifr",src:Y||'javascript:""',frameBorder:"0",style:{width:"100%",height:U}});a.contentAreaContainer=Q.iframeContainer;N.get(Q.editorContainer).style.display=a.orgDisplay;N.get(a.id).style.display="none";if(!B||!M.relaxedDomain){a.setupIframe()}W=R=Q=null},setupIframe:function(){var W=this,X=W.settings,R=N.get(W.id),S=W.getDoc(),Q,U;if(!B||!M.relaxedDomain){S.open();S.write(W.iframeHTML);S.close()}if(!B){try{if(!X.readonly){S.designMode="On"}}catch(T){}}if(B){U=W.getBody();N.hide(U);if(!X.readonly){U.contentEditable=true}N.show(U)}W.dom=new M.dom.DOMUtils(W.getDoc(),{keep_values:true,url_converter:W.convertURL,url_converter_scope:W,hex_colors:X.force_hex_style_colors,class_filter:X.class_filter,update_styles:1,fix_ie_paragraphs:1,valid_styles:X.valid_styles});W.schema=new M.dom.Schema();W.serializer=new M.dom.Serializer(F(X,{valid_elements:X.verify_html===false?"*[*]":X.valid_elements,dom:W.dom,schema:W.schema}));W.selection=new M.dom.Selection(W.dom,W.getWin(),W.serializer);W.formatter=new M.Formatter(this);W.formatter.register({alignleft:[{selector:"p,h1,h2,h3,h4,h5,h6,td,th,div,ul,ol,li",styles:{textAlign:"left"}},{selector:"img,table",styles:{"float":"left"}}],aligncenter:[{selector:"p,h1,h2,h3,h4,h5,h6,td,th,div,ul,ol,li",styles:{textAlign:"center"}},{selector:"img",styles:{display:"block",marginLeft:"auto",marginRight:"auto"}}],alignright:[{selector:"p,h1,h2,h3,h4,h5,h6,td,th,div,ul,ol,li",styles:{textAlign:"right"}},{selector:"img,table",styles:{"float":"right"}}],alignfull:[{selector:"p,h1,h2,h3,h4,h5,h6,td,th,div,ul,ol,li",styles:{textAlign:"justify"}}],bold:[{inline:"strong"},{inline:"span",styles:{fontWeight:"bold"}},{inline:"b"}],italic:[{inline:"em"},{inline:"span",styles:{fontStyle:"italic"}},{inline:"i"}],underline:[{inline:"span",styles:{textDecoration:"underline"},exact:true},{inline:"u"}],strikethrough:[{inline:"span",styles:{textDecoration:"line-through"},exact:true},{inline:"u"}],forecolor:{inline:"span",styles:{color:"%value"}},hilitecolor:{inline:"span",styles:{backgroundColor:"%value"}},fontname:{inline:"span",styles:{fontFamily:"%value"}},fontsize:{inline:"span",styles:{fontSize:"%value"}},blockquote:{block:"blockquote",wrapper:1,remove:"all"},forecolor_default:{inline:"span",styles:["color"],remove:"empty",split:true,expand:false,deep:true},hilitecolor_default:{inline:"span",styles:["backgroundColor"],remove:"empty",split:true,expand:false,deep:true},fontname_default:{inline:"span",styles:["fontFamily"],remove:"empty",split:true,expand:false,deep:true},fontsize_default:{inline:"span",styles:["fontSize"],remove:"empty",split:true,expand:false,deep:true},removeformat:[{selector:"b,strong,em,i,font,u,strike",remove:"all",split:true,expand:false,block_expand:true,deep:true},{selector:"span",attributes:["style","class"],remove:"empty",split:true,expand:false,deep:true},{selector:"*",attributes:["style","class"],split:false,expand:false,deep:true}]});I("p h1 h2 h3 h4 h5 h6 div address pre div code dt dd samp".split(/\s/),function(Y){W.formatter.register(Y,{block:Y,remove:"all"})});W.formatter.register(W.settings.formats);W.undoManager=new M.UndoManager(W);W.undoManager.onAdd.add(function(Z,Y){if(!Y.initial){return W.onChange.dispatch(W,Y,Z)}});W.undoManager.onUndo.add(function(Z,Y){return W.onUndo.dispatch(W,Y,Z)});W.undoManager.onRedo.add(function(Z,Y){return W.onRedo.dispatch(W,Y,Z)});W.forceBlocks=new M.ForceBlocks(W,{forced_root_block:X.forced_root_block});W.editorCommands=new M.EditorCommands(W);W.serializer.onPreProcess.add(function(Y,Z){return W.onPreProcess.dispatch(W,Z,Y)});W.serializer.onPostProcess.add(function(Y,Z){return W.onPostProcess.dispatch(W,Z,Y)});W.onPreInit.dispatch(W);if(!X.gecko_spellcheck){W.getBody().spellcheck=0}if(!X.readonly){W._addEvents()}W.controlManager.onPostRender.dispatch(W,W.controlManager);W.onPostRender.dispatch(W);if(X.directionality){W.getBody().dir=X.directionality}if(X.nowrap){W.getBody().style.whiteSpace="nowrap"}if(X.custom_elements){function V(Y,Z){I(G(X.custom_elements),function(a){var b;if(a.indexOf("~")===0){a=a.substring(1);b="span"}else{b="div"}Z.content=Z.content.replace(new RegExp("<("+a+")([^>]*)>","g"),"<"+b+' _mce_name="$1"$2>');Z.content=Z.content.replace(new RegExp("</("+a+")>","g"),"</"+b+">")})}W.onBeforeSetContent.add(V);W.onPostProcess.add(function(Y,Z){if(Z.set){V(Y,Z)}})}if(X.handle_node_change_callback){W.onNodeChange.add(function(Z,Y,a){W.execCallback("handle_node_change_callback",W.id,a,-1,-1,true,W.selection.isCollapsed())})}if(X.save_callback){W.onSaveContent.add(function(Y,a){var Z=W.execCallback("save_callback",W.id,a.content,W.getBody());if(Z){a.content=Z}})}if(X.onchange_callback){W.onChange.add(function(Z,Y){W.execCallback("onchange_callback",W,Y)})}if(X.convert_newlines_to_brs){W.onBeforeSetContent.add(function(Y,Z){if(Z.initial){Z.content=Z.content.replace(/\r?\n/g,"<br />")}})}if(X.fix_nesting&&B){W.onBeforeSetContent.add(function(Y,Z){Z.content=W._fixNesting(Z.content)})}if(X.preformatted){W.onPostProcess.add(function(Y,Z){Z.content=Z.content.replace(/^\s*<pre.*?>/,"");Z.content=Z.content.replace(/<\/pre>\s*$/,"");if(Z.set){Z.content='<pre class="mceItemHidden">'+Z.content+"</pre>"}})}if(X.verify_css_classes){W.serializer.attribValueFilter=function(b,Z){var a,Y;if(b=="class"){if(!W.classesRE){Y=W.dom.getClasses();if(Y.length>0){a="";I(Y,function(e){a+=(a?"|":"")+e["class"]});W.classesRE=new RegExp("("+a+")","gi")}}return !W.classesRE||/(\bmceItem\w+\b|\bmceTemp\w+\b)/g.test(Z)||W.classesRE.test(Z)?Z:""}return Z}}if(X.cleanup_callback){W.onBeforeSetContent.add(function(Y,Z){Z.content=W.execCallback("cleanup_callback","insert_to_editor",Z.content,Z)});W.onPreProcess.add(function(Y,Z){if(Z.set){W.execCallback("cleanup_callback","insert_to_editor_dom",Z.node,Z)}if(Z.get){W.execCallback("cleanup_callback","get_from_editor_dom",Z.node,Z)}});W.onPostProcess.add(function(Y,Z){if(Z.set){Z.content=W.execCallback("cleanup_callback","insert_to_editor",Z.content,Z)}if(Z.get){Z.content=W.execCallback("cleanup_callback","get_from_editor",Z.content,Z)}})}if(X.save_callback){W.onGetContent.add(function(Y,Z){if(Z.save){Z.content=W.execCallback("save_callback",W.id,Z.content,W.getBody())}})}if(X.handle_event_callback){W.onEvent.add(function(Y,Z,a){if(W.execCallback("handle_event_callback",Z,Y,a)===false){J.cancel(Z)}})}W.onSetContent.add(function(){W.addVisual(W.getBody())});if(X.padd_empty_editor){W.onPostProcess.add(function(Y,Z){Z.content=Z.content.replace(/^(<p[^>]*>(&nbsp;|&#160;|\s|\u00a0|)<\/p>[\r\n]*|<br \/>[\r\n]*)$/,"")})}if(A){function P(Y,Z){I(Y.dom.select("a"),function(b){var a=b.parentNode;if(Y.dom.isBlock(a)&&a.lastChild===b){Y.dom.add(a,"br",{_mce_bogus:1})}})}W.onExecCommand.add(function(Y,Z){if(Z==="CreateLink"){P(Y)}});W.onSetContent.add(W.selection.onSetContent.add(P));if(!X.readonly){try{S.designMode="Off";S.designMode="On"}catch(T){}}}setTimeout(function(){if(W.removed){return }W.load({initial:true,format:(X.cleanup_on_startup?"html":"raw")});W.startContent=W.getContent({format:"raw"});W.initialized=true;W.onInit.dispatch(W);W.execCallback("setupcontent_callback",W.id,W.getBody(),W.getDoc());W.execCallback("init_instance_callback",W);W.focus(true);W.nodeChanged({initial:1});if(X.content_css){M.each(G(X.content_css),function(Y){W.dom.loadCSS(W.documentBaseURI.toAbsolute(Y))})}if(X.auto_focus){setTimeout(function(){var Y=M.get(X.auto_focus);Y.selection.select(Y.getBody(),1);Y.selection.collapse(1);Y.getWin().focus()},100)}},1);R=null},focus:function(Q){var S,P=this,R=P.settings.content_editable;if(!Q){if(!R){P.getWin().focus()}}if(M.activeEditor!=P){if((S=M.activeEditor)!=null){S.onDeactivate.dispatch(S,P)}P.onActivate.dispatch(P,S)}M._setActive(P)},execCallback:function(S){var P=this,R=P.settings[S],Q;if(!R){return }if(P.callbackLookup&&(Q=P.callbackLookup[S])){R=Q.func;Q=Q.scope}if(D(R,"string")){Q=R.replace(/\.\w+$/,"");Q=Q?M.resolve(Q):0;R=M.resolve(R);P.callbackLookup=P.callbackLookup||{};P.callbackLookup[S]={func:R,scope:Q}}return R.apply(Q||P,Array.prototype.slice.call(arguments,1))},translate:function(P){var R=this.settings.language||"en",Q=M.i18n;if(!P){return""}return Q[R+"."+P]||P.replace(/{\#([^}]+)\}/g,function(T,S){return Q[R+"."+S]||"{#"+S+"}"})},getLang:function(Q,P){return M.i18n[(this.settings.language||"en")+"."+Q]||(D(P)?P:"{#"+Q+"}")},getParam:function(U,R,P){var S=M.trim,Q=D(this.settings[U])?this.settings[U]:R,T;if(P==="hash"){T={};if(D(Q,"string")){I(Q.indexOf("=")>0?Q.split(/[;,](?![^=;,]*(?:[;,]|$))/):Q.split(","),function(V){V=V.split("=");if(V.length>1){T[S(V[0])]=S(V[1])}else{T[S(V[0])]=S(V)}})}else{T=Q}return T}return Q},nodeChanged:function(R){var P=this,Q=P.selection,S=(B?Q.getNode():Q.getStart())||P.getBody();if(P.initialized){R=R||{};S=B&&S.ownerDocument!=P.getDoc()?P.getBody():S;R.parents=[];P.dom.getParent(S,function(T){if(T.nodeName=="BODY"){return true}R.parents.push(T)});P.onNodeChange.dispatch(P,R?R.controlManager||P.controlManager:P.controlManager,S,Q.isCollapsed(),R)}},addButton:function(R,Q){var P=this;P.buttons=P.buttons||{};P.buttons[R]=Q},addCommand:function(R,Q,P){this.execCommands[R]={func:Q,scope:P||this}},addQueryStateHandler:function(R,Q,P){this.queryStateCommands[R]={func:Q,scope:P||this}},addQueryValueHandler:function(R,Q,P){this.queryValueCommands[R]={func:Q,scope:P||this}},addShortcut:function(R,T,P,S){var Q=this,U;if(!Q.settings.custom_shortcuts){return false}Q.shortcuts=Q.shortcuts||{};if(D(P,"string")){U=P;P=function(){Q.execCommand(U,false,null)}}if(D(P,"object")){U=P;P=function(){Q.execCommand(U[0],U[1],U[2])}}I(G(R),function(V){var W={func:P,scope:S||this,desc:T,alt:false,ctrl:false,shift:false};I(G(V,"+"),function(X){switch(X){case"alt":case"ctrl":case"shift":W[X]=true;break;default:W.charCode=X.charCodeAt(0);W.keyCode=X.toUpperCase().charCodeAt(0)}});Q.shortcuts[(W.ctrl?"ctrl":"")+","+(W.alt?"alt":"")+","+(W.shift?"shift":"")+","+W.keyCode]=W});return true},execCommand:function(U,T,W,P){var R=this,S=0,V,Q;if(!/^(mceAddUndoLevel|mceEndUndoLevel|mceBeginUndoLevel|mceRepaint|SelectAll)$/.test(U)&&(!P||!P.skip_focus)){R.focus()}V={};R.onBeforeExecCommand.dispatch(R,U,T,W,V);if(V.terminate){return false}if(R.execCallback("execcommand_callback",R.id,R.selection.getNode(),U,T,W)){R.onExecCommand.dispatch(R,U,T,W,P);return true}if(V=R.execCommands[U]){Q=V.func.call(V.scope,T,W);if(Q!==true){R.onExecCommand.dispatch(R,U,T,W,P);return Q}}I(R.plugins,function(X){if(X.execCommand&&X.execCommand(U,T,W)){R.onExecCommand.dispatch(R,U,T,W,P);S=1;return false}});if(S){return true}if(R.theme&&R.theme.execCommand&&R.theme.execCommand(U,T,W)){R.onExecCommand.dispatch(R,U,T,W,P);return true}if(M.GlobalCommands.execCommand(R,U,T,W)){R.onExecCommand.dispatch(R,U,T,W,P);return true}if(R.editorCommands.execCommand(U,T,W)){R.onExecCommand.dispatch(R,U,T,W,P);return true}R.getDoc().execCommand(U,T,W);R.onExecCommand.dispatch(R,U,T,W,P)},queryCommandState:function(S){var Q=this,T,R;if(Q._isHidden()){return }if(T=Q.queryStateCommands[S]){R=T.func.call(T.scope);if(R!==true){return R}}T=Q.editorCommands.queryCommandState(S);if(T!==-1){return T}try{return this.getDoc().queryCommandState(S)}catch(P){}},queryCommandValue:function(T){var Q=this,S,R;if(Q._isHidden()){return }if(S=Q.queryValueCommands[T]){R=S.func.call(S.scope);if(R!==true){return R}}S=Q.editorCommands.queryCommandValue(T);if(D(S)){return S}try{return this.getDoc().queryCommandValue(T)}catch(P){}},show:function(){var P=this;N.show(P.getContainer());N.hide(P.id);P.load()},hide:function(){var P=this,Q=P.getDoc();if(B&&Q){Q.execCommand("SelectAll")}P.save();N.hide(P.getContainer());N.setStyle(P.id,"display",P.orgDisplay)},isHidden:function(){return !N.isHidden(this.id)},setProgressState:function(P,Q,R){this.onSetProgressState.dispatch(this,P,Q,R);return P},load:function(S){var P=this,R=P.getElement(),Q;if(R){S=S||{};S.load=true;Q=P.setContent(D(R.value)?R.value:R.innerHTML,S);S.element=R;if(!S.no_events){P.onLoadContent.dispatch(P,S)}S.element=R=null;return Q}},save:function(T){var P=this,S=P.getElement(),Q,R;if(!S||!P.initialized){return }T=T||{};T.save=true;if(!T.no_events){P.undoManager.typing=0;P.undoManager.add()}T.element=S;Q=T.content=P.getContent(T);if(!T.no_events){P.onSaveContent.dispatch(P,T)}Q=T.content;if(!/TEXTAREA|INPUT/i.test(S.nodeName)){S.innerHTML=Q;if(R=N.getParent(P.id,"form")){I(R.elements,function(U){if(U.name==P.id){U.value=Q;return false}})}}else{S.value=Q}T.element=S=null;return Q},setContent:function(Q,R){var P=this;R=R||{};R.format=R.format||"html";R.set=true;R.content=Q;if(!R.no_events){P.onBeforeSetContent.dispatch(P,R)}if(!M.isIE&&(Q.length===0||/^\s+$/.test(Q))){R.content=P.dom.setHTML(P.getBody(),'<br _mce_bogus="1" />');R.format="raw"}R.content=P.dom.setHTML(P.getBody(),M.trim(R.content));if(R.format!="raw"&&P.settings.cleanup){R.getInner=true;R.content=P.dom.setHTML(P.getBody(),P.serializer.serialize(P.getBody(),R))}if(!R.no_events){P.onSetContent.dispatch(P,R)}return R.content},getContent:function(R){var P=this,Q;R=R||{};R.format=R.format||"html";R.get=true;if(!R.no_events){P.onBeforeGetContent.dispatch(P,R)}if(R.format!="raw"&&P.settings.cleanup){R.getInner=true;Q=P.serializer.serialize(P.getBody(),R)}else{Q=P.getBody().innerHTML}Q=Q.replace(/^\s*|\s*$/g,"");R.content=Q;if(!R.no_events){P.onGetContent.dispatch(P,R)}return R.content},isDirty:function(){var P=this;return M.trim(P.startContent)!=M.trim(P.getContent({format:"raw",no_events:1}))&&!P.isNotDirty},getContainer:function(){var P=this;if(!P.container){P.container=N.get(P.editorContainer||P.id+"_parent")}return P.container},getContentAreaContainer:function(){return this.contentAreaContainer},getElement:function(){return N.get(this.settings.content_element||this.id)},getWin:function(){var P=this,Q;if(!P.contentWindow){Q=N.get(P.id+"_ifr");if(Q){P.contentWindow=Q.contentWindow}}return P.contentWindow},getDoc:function(){var Q=this,P;if(!Q.contentDocument){P=Q.getWin();if(P){Q.contentDocument=P.document}}return Q.contentDocument},getBody:function(){return this.bodyElement||this.getDoc().body},convertURL:function(P,T,S){var Q=this,R=Q.settings;if(R.urlconverter_callback){return Q.execCallback("urlconverter_callback",P,S,true,T)}if(!R.convert_urls||(S&&S.nodeName=="LINK")||P.indexOf("file:")===0){return P}if(R.relative_urls){return Q.documentBaseURI.toRelative(P)}P=Q.documentBaseURI.toAbsolute(P,R.remove_script_host);return P},addVisual:function(R){var P=this,Q=P.settings;R=R||P.getBody();if(!D(P.hasVisual)){P.hasVisual=Q.visual}I(P.dom.select("table,a",R),function(T){var S;switch(T.nodeName){case"TABLE":S=P.dom.getAttrib(T,"border");if(!S||S=="0"){if(P.hasVisual){P.dom.addClass(T,Q.visual_table_class)}else{P.dom.removeClass(T,Q.visual_table_class)}}return ;case"A":S=P.dom.getAttrib(T,"name");if(S){if(P.hasVisual){P.dom.addClass(T,"mceItemAnchor")}else{P.dom.removeClass(T,"mceItemAnchor")}}return }});P.onVisualAid.dispatch(P,R,P.hasVisual)},remove:function(){var P=this,Q=P.getContainer();P.removed=1;P.hide();P.execCallback("remove_instance_callback",P);P.onRemove.dispatch(P);P.onExecCommand.listeners=[];M.remove(P);N.remove(Q)},destroy:function(Q){var P=this;if(P.destroyed){return }if(!Q){M.removeUnload(P.destroy);tinyMCE.onBeforeUnload.remove(P._beforeUnload);if(P.theme&&P.theme.destroy){P.theme.destroy()}P.controlManager.destroy();P.selection.destroy();P.dom.destroy();if(!P.settings.content_editable){J.clear(P.getWin());J.clear(P.getDoc())}J.clear(P.getBody());J.clear(P.formElement)}if(P.formElement){P.formElement.submit=P.formElement._mceOldSubmit;P.formElement._mceOldSubmit=null}P.contentAreaContainer=P.formElement=P.container=P.settings.content_element=P.bodyElement=P.contentDocument=P.contentWindow=null;if(P.selection){P.selection=P.selection.win=P.selection.dom=P.selection.dom.doc=null}P.destroyed=1},_addEvents:function(){var T=this,S,V=T.settings,U={mouseup:"onMouseUp",mousedown:"onMouseDown",click:"onClick",keyup:"onKeyUp",keydown:"onKeyDown",keypress:"onKeyPress",submit:"onSubmit",reset:"onReset",contextmenu:"onContextMenu",dblclick:"onDblClick",copy:"onCopy",beforecopy:"onCopy",paste:"onPaste"};function R(Y,Z){var X=Y.type;if(T.removed){return }if(T.onEvent.dispatch(T,Y,Z)!==false){T[U[Y.fakeType||Y.type]].dispatch(T,Y,Z)}}I(U,function(Y,X){switch(X){case"contextmenu":T.dom.bind(T.getBody(),X,R);break;case"copy":if(M.isIE){X="beforecopy"}case"paste":T.dom.bind(T.getBody(),X,function(Z){R(Z)});break;case"submit":case"reset":T.dom.bind(T.getElement().form||N.getParent(T.id,"form"),X,R);break;default:T.dom.bind(V.content_editable?T.getBody():T.getDoc(),X,R)}});T.dom.bind(V.content_editable?T.getBody():(A?T.getDoc():T.getWin()),"focus",function(X){T.focus(true)});if(M.isGecko){T.dom.bind(T.getDoc(),"DOMNodeInserted",function(Y){var X;Y=Y.target;if(Y.nodeType===1&&Y.nodeName==="IMG"&&(X=Y.getAttribute("_mce_src"))){Y.src=T.documentBaseURI.toAbsolute(X)}})}if(A){function P(){var Y=this,a=Y.getDoc(),Z=Y.settings;if(A&&!Z.readonly){if(Y._isHidden()){try{if(!Z.content_editable){a.designMode="On"}}catch(X){}}try{a.execCommand("styleWithCSS",0,false)}catch(X){if(!Y._isHidden()){try{a.execCommand("useCSS",0,true)}catch(X){}}}if(!Z.table_inline_editing){try{a.execCommand("enableInlineTableEditing",false,false)}catch(X){}}if(!Z.object_resizing){try{a.execCommand("enableObjectResizing",false,false)}catch(X){}}}}T.onBeforeExecCommand.add(P);T.onMouseDown.add(P)}if(M.isWebKit){T.onClick.add(function(X,Y){Y=Y.target;if(Y.nodeName=="IMG"||(Y.nodeName=="A"&&T.dom.hasClass(Y,"mceItemAnchor"))){T.selection.getSel().setBaseAndExtent(Y,0,Y,1)}})}T.onMouseUp.add(T.nodeChanged);T.onClick.add(T.nodeChanged);T.onKeyUp.add(function(X,Y){var Z=Y.keyCode;if((Z>=33&&Z<=36)||(Z>=37&&Z<=40)||Z==13||Z==45||Z==46||Z==8||(M.isMac&&(Z==91||Z==93))||Y.ctrlKey){T.nodeChanged()}});T.onReset.add(function(){T.setContent(T.startContent,{format:"raw"})});if(V.custom_shortcuts){if(V.custom_undo_redo_keyboard_shortcuts){T.addShortcut("ctrl+z",T.getLang("undo_desc"),"Undo");T.addShortcut("ctrl+y",T.getLang("redo_desc"),"Redo")}if(A){T.addShortcut("ctrl+b",T.getLang("bold_desc"),"Bold");T.addShortcut("ctrl+i",T.getLang("italic_desc"),"Italic");T.addShortcut("ctrl+u",T.getLang("underline_desc"),"Underline")}for(S=1;S<=6;S++){T.addShortcut("ctrl+"+S,"",["FormatBlock",false,"h"+S])}T.addShortcut("ctrl+7","",["FormatBlock",false,"<p>"]);T.addShortcut("ctrl+8","",["FormatBlock",false,"<div>"]);T.addShortcut("ctrl+9","",["FormatBlock",false,"<address>"]);function W(Y){var X=null;if(!Y.altKey&&!Y.ctrlKey&&!Y.metaKey){return X}I(T.shortcuts,function(Z){if(M.isMac&&Z.ctrl!=Y.metaKey){return }else{if(!M.isMac&&Z.ctrl!=Y.ctrlKey){return }}if(Z.alt!=Y.altKey){return }if(Z.shift!=Y.shiftKey){return }if(Y.keyCode==Z.keyCode||(Y.charCode&&Y.charCode==Z.charCode)){X=Z;return false}});return X}T.onKeyUp.add(function(X,Y){var Z=W(Y);if(Z){return J.cancel(Y)}});T.onKeyPress.add(function(X,Y){var Z=W(Y);if(Z){return J.cancel(Y)}});T.onKeyDown.add(function(X,Y){var Z=W(Y);if(Z){Z.func.call(Z.scope);return J.cancel(Y)}})}if(M.isIE){T.dom.bind(T.getDoc(),"controlselect",function(Z){var Y=T.resizeInfo,X;Z=Z.target;if(Z.nodeName!=="IMG"){return }if(Y){T.dom.unbind(Y.node,Y.ev,Y.cb)}if(!T.dom.hasClass(Z,"mceItemNoResize")){ev="resizeend";X=T.dom.bind(Z,ev,function(b){var a;b=b.target;if(a=T.dom.getStyle(b,"width")){T.dom.setAttrib(b,"width",a.replace(/[^0-9%]+/g,""));T.dom.setStyle(b,"width","")}if(a=T.dom.getStyle(b,"height")){T.dom.setAttrib(b,"height",a.replace(/[^0-9%]+/g,""));T.dom.setStyle(b,"height","")}})}else{ev="resizestart";X=T.dom.bind(Z,"resizestart",J.cancel,J)}Y=T.resizeInfo={node:Z,ev:ev,cb:X}});T.onKeyDown.add(function(X,Y){switch(Y.keyCode){case 8:if(T.selection.getRng().item){X.dom.remove(T.selection.getRng().item(0));return J.cancel(Y)}}})}if(M.isOpera){T.onClick.add(function(X,Y){J.prevent(Y)})}if(V.custom_undo_redo){function Q(){T.undoManager.typing=0;T.undoManager.add()}T.dom.bind(T.getDoc(),"focusout",function(X){if(!T.removed&&T.undoManager.typing){Q()}});T.onKeyUp.add(function(X,Y){if((Y.keyCode>=33&&Y.keyCode<=36)||(Y.keyCode>=37&&Y.keyCode<=40)||Y.keyCode==13||Y.keyCode==45||Y.ctrlKey){Q()}});T.onKeyDown.add(function(X,Y){if((Y.keyCode>=33&&Y.keyCode<=36)||(Y.keyCode>=37&&Y.keyCode<=40)||Y.keyCode==13||Y.keyCode==45){if(T.undoManager.typing){Q()}return }if(!T.undoManager.typing){T.undoManager.add();T.undoManager.typing=1}});T.onMouseDown.add(function(){if(T.undoManager.typing){Q()}})}},_isHidden:function(){var P;if(!A){return 0}P=this.selection.getSel();return(!P||!P.rangeCount||P.rangeCount==0)},_fixNesting:function(Q){var R=[],P;Q=Q.replace(/<(\/)?([^\s>]+)[^>]*?>/g,function(T,S,V){var U;if(S==="/"){if(!R.length){return""}if(V!==R[R.length-1].tag){for(P=R.length-1;P>=0;P--){if(R[P].tag===V){R[P].close=1;break}}return""}else{R.pop();if(R.length&&R[R.length-1].close){T=T+"</"+R[R.length-1].tag+">";R.pop()}}}else{if(/^(br|hr|input|meta|img|link|param)$/i.test(V)){return T}if(/\/>$/.test(T)){return T}R.push({tag:V})}return T});for(P=R.length-1;P>=0;P--){Q+="</"+R[P].tag+">"}return Q}})})(tinymce);(function(C){var D=C.each,E,A=true,B=false;C.EditorCommands=function(N){var L=N.dom,P=N.selection,J={state:{},exec:{},value:{}},K=N.settings,O;function Q(X,W,V){var U;X=X.toLowerCase();if(U=J.exec[X]){U(X,W,V);return A}return B}function M(V){var U;V=V.toLowerCase();if(U=J.state[V]){return U(V)}return -1}function H(V){var U;V=V.toLowerCase();if(U=J.value[V]){return U(V)}return B}function T(U,V){V=V||"exec";D(U,function(X,W){D(W.toLowerCase().split(","),function(Y){J[V][Y]=X})})}C.extend(this,{execCommand:Q,queryCommandState:M,queryCommandValue:H,addCommands:T});function F(W,V,U){if(V===E){V=B}if(U===E){U=null}return N.getDoc().execCommand(W,V,U)}function S(U){return N.formatter.match(U)}function R(U,V){N.formatter.toggle(U,V?{value:V}:E)}function I(U){O=P.getBookmark(U)}function G(){P.moveToBookmark(O)}T({"mceResetDesignMode,mceBeginUndoLevel":function(){},"mceEndUndoLevel,mceAddUndoLevel":function(){N.undoManager.add()},"Cut,Copy,Paste":function(X){var W=N.getDoc(),U;try{F(X)}catch(V){U=A}if(U||!W.queryCommandSupported(X)){if(C.isGecko){N.windowManager.confirm(N.getLang("clipboard_msg"),function(Y){if(Y){open("http://www.mozilla.org/editor/midasdemo/securityprefs.html","_blank")}})}else{N.windowManager.alert(N.getLang("clipboard_no_support"))}}},unlink:function(W){var X=P.getNode();if(P.isCollapsed()){P.select(X)}var U=(X&&X.nodeName.toUpperCase()=="A")?X:L.getParent(X,"A");if(U){var V=P.getBookmark();L.remove(U,true);P.moveToBookmark(V);P.collapse(false)}F(W);P.collapse(B)},"JustifyLeft,JustifyCenter,JustifyRight,JustifyFull":function(U){var V=U.substring(7);D("left,center,right,full".split(","),function(W){if(V!=W){N.formatter.remove("align"+W)}});R("align"+V)},"InsertUnorderedList,InsertOrderedList":function(W){var U,V;F(W);U=L.getParent(P.getNode(),"ol,ul");if(U){V=U.parentNode;if(/^(H[1-6]|P|ADDRESS|PRE)$/.test(V.nodeName)){I();L.split(V,U);G()}}},"Bold,Italic,Underline,Strikethrough":function(U){R(U)},"ForeColor,HiliteColor,FontName":function(W,V,U){switch(W){case"forecolor":if(U==K.theme_advanced_default_foreground_color){N.formatter.remove("forecolor_default");break}case"hilitecolor":if(U==K.theme_advanced_default_background_color){N.formatter.remove("hilitecolor_default");break}case"fontname":if(U==K.theme_advanced_default_font_family){N.formatter.remove("fontname_default");break}default:R(W,U)}},FontSize:function(X,W,V){var U,Y;if(V>=1&&V<=7){Y=C.explode(K.font_size_style_values);U=C.explode(K.font_size_classes);if(U){V=U[V-1]||V}else{V=Y[V-1]||V}}if(V==K.theme_advanced_default_font_size){N.formatter.remove("fontsize_default")}else{R(X,V)}},RemoveFormat:function(U){N.formatter.remove(U)},mceBlockQuote:function(U){R("blockquote")},FormatBlock:function(W,V,U){return R(U)},mceCleanup:function(){I();N.setContent(N.getContent({cleanup:A}),{cleanup:A});G()},mceRemoveNode:function(X,W,V){var U=V||P.getNode();if(U!=N.getBody()){I();N.dom.remove(U,A);G()}},mceSelectNodeDepth:function(X,W,V){var U=0;L.getParent(P.getNode(),function(Y){if(Y.nodeType==1&&U++==V){P.select(Y);return B}},N.getBody())},mceSelectNode:function(W,V,U){P.select(U)},mceInsertContent:function(W,V,U){P.setContent(U)},mceInsertRawHTML:function(W,V,U){P.setContent("tiny_mce_marker");N.setContent(N.getContent().replace(/tiny_mce_marker/g,U))},mceSetContent:function(W,V,U){N.setContent(U)},"Indent,Outdent":function(X){var V,U,W;V=K.indentation;U=/[a-z%]+$/i.exec(V);V=parseInt(V);if(!M("InsertUnorderedList")&&!M("InsertOrderedList")){D(P.getSelectedBlocks(),function(Y){if(X=="outdent"){W=Math.max(0,parseInt(Y.style.paddingLeft||0)-V);L.setStyle(Y,"paddingLeft",W?W+U:"")}else{L.setStyle(Y,"paddingLeft",(parseInt(Y.style.paddingLeft||0)+V)+U)}})}else{F(X)}},mceRepaint:function(){var V;if(C.isGecko){try{I(A);if(P.getSel()){P.getSel().selectAllChildren(N.getBody())}P.collapse(A);G()}catch(U){}}},mceToggleFormat:function(W,V,U){N.formatter.toggle(U)},InsertHorizontalRule:function(){P.setContent("<hr />")},mceToggleVisualAid:function(){N.hasVisual=!N.hasVisual;N.addVisual()},mceReplaceContent:function(W,V,U){P.setContent(U.replace(/\{\$selection\}/g,P.getContent({format:"text"})))},mceInsertLink:function(X,W,V){var U=L.getParent(P.getNode(),"a");if(C.is(V,"string")){V={href:V}}if(!U){F("CreateLink",B,"javascript:mctmp(0);");D(L.select("a[href=javascript:mctmp(0);]"),function(Y){L.setAttribs(Y,V)})}else{if(V.href){L.setAttribs(U,V)}else{N.dom.remove(U,A)}}}});T({"JustifyLeft,JustifyCenter,JustifyRight,JustifyFull":function(U){return S("align"+U.substring(7))},"Bold,Italic,Underline,Strikethrough":function(U){return S(U)},mceBlockQuote:function(){return S("blockquote")},Outdent:function(){var U;if(K.inline_styles){if((U=L.getParent(P.getStart(),L.isBlock))&&parseInt(U.style.paddingLeft)>0){return A}if((U=L.getParent(P.getEnd(),L.isBlock))&&parseInt(U.style.paddingLeft)>0){return A}if((U=L.getParent(P.getStart(),L.isBlock))&&parseInt(U.style.marginLeft)>0){return A}if((U=L.getParent(P.getEnd(),L.isBlock))&&parseInt(U.style.marginLeft)>0){return A}}return M("InsertUnorderedList")||M("InsertOrderedList")||(!K.inline_styles&&!!L.getParent(P.getNode(),"BLOCKQUOTE"))},"InsertUnorderedList,InsertOrderedList":function(U){return L.getParent(P.getNode(),U=="insertunorderedlist"?"UL":"OL")}},"state");T({"FontSize,FontName":function(W){var V=0,U;if(U=L.getParent(P.getNode(),"span")){if(W=="fontsize"){V=U.style.fontSize}else{V=U.style.fontFamily.replace(/, /g,",").replace(/[\'\"]/g,"").toLowerCase()}}return V}},"value");if(K.custom_undo_redo){T({Undo:function(){N.undoManager.undo()},Redo:function(){N.undoManager.redo()}})}}})(tinymce);(function(B){var A=B.util.Dispatcher;B.UndoManager=function(E){var C,D=0,G=[];function F(){return B.trim(E.getContent({format:"raw",no_events:1}))}return C={typing:0,onAdd:new A(C),onUndo:new A(C),onRedo:new A(C),add:function(K){var H,I=E.settings,J;K=K||{};K.content=F();J=G[D];if(J&&J.content==K.content){if(D>0||G.length==1){return null}}if(I.custom_undo_redo_levels){if(G.length>I.custom_undo_redo_levels){for(H=0;H<G.length-1;H++){G[H]=G[H+1]}G.length--;D=G.length}}K.bookmark=E.selection.getBookmark(2,true);if(D<G.length-1){if(D==0){G=[]}else{G.length=D+1}}G.push(K);D=G.length-1;C.onAdd.dispatch(C,K);E.isNotDirty=0;return K},undo:function(){var I,H;if(C.typing){C.add();C.typing=0}if(D>0){I=G[--D];E.setContent(I.content,{format:"raw"});E.selection.moveToBookmark(I.bookmark);C.onUndo.dispatch(C,I)}return I},redo:function(){var H;if(D<G.length-1){H=G[++D];E.setContent(H.content,{format:"raw"});E.selection.moveToBookmark(H.bookmark);C.onRedo.dispatch(C,H)}return H},clear:function(){G=[];D=C.typing=0},hasUndo:function(){return D>0||C.typing},hasRedo:function(){return D<G.length-1}}}})(tinymce);(function(L){var K=L.dom.Event,C=L.isIE,A=L.isGecko,B=L.isOpera,J=L.each,I=L.extend,D=true,H=false;function G(N,O){var M=O.ownerDocument.createRange();M.setStart(N.endContainer,N.endOffset);M.setEndAfter(O);return M.cloneContents().textContent.length==0}function F(M){M=M.innerHTML;M=M.replace(/<(img|hr|table|input|select|textarea)[ \>]/gi,"-");M=M.replace(/<[^>]+>/g,"");return M.replace(/[ \u00a0\t\r\n]+/g,"")==""}function E(O,Q,M){var N,P;if(F(M)){N=Q.getParent(M,"ul,ol");if(!Q.getParent(N.parentNode,"ul,ol")){Q.split(N,M);P=Q.create("p",0,'<br _mce_bogus="1" />');Q.replace(P,M);O.select(P,1)}return H}return D}L.create("tinymce.ForceBlocks",{ForceBlocks:function(N){var O=this,P=N.settings,Q;O.editor=N;O.dom=N.dom;Q=(P.forced_root_block||"p").toLowerCase();P.element=Q.toUpperCase();N.onPreInit.add(O.setup,O);O.reOpera=new RegExp("(\\u00a0|&#160;|&nbsp;)</"+Q+">","gi");O.rePadd=new RegExp("<p( )([^>]+)><\\/p>|<p( )([^>]+)\\/>|<p( )([^>]+)>\\s+<\\/p>|<p><\\/p>|<p\\/>|<p>\\s+<\\/p>".replace(/p/g,Q),"gi");O.reNbsp2BR1=new RegExp("<p( )([^>]+)>[\\s\\u00a0]+<\\/p>|<p>[\\s\\u00a0]+<\\/p>".replace(/p/g,Q),"gi");O.reNbsp2BR2=new RegExp("<%p()([^>]+)>(&nbsp;|&#160;)<\\/%p>|<%p>(&nbsp;|&#160;)<\\/%p>".replace(/%p/g,Q),"gi");O.reBR2Nbsp=new RegExp("<p( )([^>]+)>\\s*<br \\/>\\s*<\\/p>|<p>\\s*<br \\/>\\s*<\\/p>".replace(/p/g,Q),"gi");function M(R,S){if(B){S.content=S.content.replace(O.reOpera,"</"+Q+">")}S.content=S.content.replace(O.rePadd,"<"+Q+"$1$2$3$4$5$6>\u00a0</"+Q+">");if(!C&&!B&&S.set){S.content=S.content.replace(O.reNbsp2BR1,"<"+Q+"$1$2><br /></"+Q+">");S.content=S.content.replace(O.reNbsp2BR2,"<"+Q+"$1$2><br /></"+Q+">")}else{S.content=S.content.replace(O.reBR2Nbsp,"<"+Q+"$1$2>\u00a0</"+Q+">")}}N.onBeforeSetContent.add(M);N.onPostProcess.add(M);if(P.forced_root_block){N.onInit.add(O.forceRoots,O);N.onSetContent.add(O.forceRoots,O);N.onBeforeGetContent.add(O.forceRoots,O)}},setup:function(){var N=this,M=N.editor,P=M.settings,R=M.dom,O=M.selection;if(P.forced_root_block){M.onBeforeExecCommand.add(N.forceRoots,N);M.onKeyUp.add(N.forceRoots,N);M.onPreProcess.add(N.forceRoots,N)}if(P.force_br_newlines){if(C){M.onKeyPress.add(function(S,T){var U;if(T.keyCode==13&&O.getNode().nodeName!="LI"){O.setContent('<br id="__" /> ',{format:"raw"});U=R.get("__");U.removeAttribute("id");O.select(U);O.collapse();return K.cancel(T)}})}}if(!C&&P.force_p_newlines){M.onKeyPress.add(function(S,T){if(T.keyCode==13&&!T.shiftKey&&!N.insertPara(T)){K.cancel(T)}});if(A){M.onKeyDown.add(function(S,T){if((T.keyCode==8||T.keyCode==46)&&!T.shiftKey){N.backspaceDelete(T,T.keyCode==8)}})}}if(L.isWebKit){function Q(T){var S=O.getRng(),U,X=R.create("div",null," "),W,V=R.getViewPort(T.getWin()).h;S.insertNode(U=R.create("br"));S.setStartAfter(U);S.setEndAfter(U);O.setRng(S);if(O.getSel().focusNode==U.previousSibling){O.select(R.insertAfter(R.doc.createTextNode("\u00a0"),U));O.collapse(D)}R.insertAfter(X,U);W=R.getPos(X).y;R.remove(X);if(W>V){T.getWin().scrollTo(0,W)}}M.onKeyPress.add(function(S,T){if(T.keyCode==13&&(T.shiftKey||P.force_br_newlines)){Q(S);K.cancel(T)}})}M.onPreProcess.add(function(S,T){J(R.select("p,h1,h2,h3,h4,h5,h6,div",T.node),function(U){if(F(U)){J(R.select("span,em,strong,b,i",T.node),function(V){if(!V.hasChildNodes()){V.appendChild(S.getDoc().createTextNode("\u00a0"));return H}})}})});if(C){if(P.element!="P"){M.onKeyPress.add(function(S,T){N.lastElm=O.getNode().nodeName});M.onKeyUp.add(function(T,U){var W,V=O.getNode(),S=T.getBody();if(S.childNodes.length===1&&V.nodeName=="P"){V=R.rename(V,P.element);O.select(V);O.collapse();T.nodeChanged()}else{if(U.keyCode==13&&!U.shiftKey&&N.lastElm!="P"){W=R.getParent(V,"p");if(W){R.rename(W,P.element);T.nodeChanged()}}}})}}},find:function(R,O,P){var N=this.editor,M=N.getDoc().createTreeWalker(R,4,null,H),Q=-1;while(R=M.nextNode()){Q++;if(O==0&&R==P){return Q}if(O==1&&Q==P){return R}}return -1},forceRoots:function(R,g){var T=this,R=T.editor,l=R.getBody(),h=R.getDoc(),p=R.selection,U=p.getSel(),V=p.getRng(),m=-2,Q,a,M,N,j=-16777215;var k,O,o,Z,W,P=l.childNodes,Y,X,S;for(Y=P.length-1;Y>=0;Y--){k=P[Y];if(k.nodeType===1&&k.getAttribute("_mce_type")){O=null;continue}if(k.nodeType===3||(!T.dom.isBlock(k)&&k.nodeType!==8&&!/^(script|mce:script|style|mce:style)$/i.test(k.nodeName))){if(!O){if(k.nodeType!=3||/[^\s]/g.test(k.nodeValue)){if(m==-2&&V){if(!C){if(V.startContainer.nodeType==1&&(X=V.startContainer.childNodes[V.startOffset])&&X.nodeType==1){S=X.getAttribute("id");X.setAttribute("id","__mce")}else{if(R.dom.getParent(V.startContainer,function(b){return b===l})){a=V.startOffset;M=V.endOffset;m=T.find(l,0,V.startContainer);Q=T.find(l,0,V.endContainer)}}}else{if(V.item){N=h.body.createTextRange();N.moveToElementText(V.item(0));V=N}N=h.body.createTextRange();N.moveToElementText(l);N.collapse(1);o=N.move("character",j)*-1;N=V.duplicate();N.collapse(1);Z=N.move("character",j)*-1;N=V.duplicate();N.collapse(0);W=(N.move("character",j)*-1)-Z;m=Z-o;Q=W}}O=R.dom.create(R.settings.forced_root_block);k.parentNode.replaceChild(O,k);O.appendChild(k)}}else{if(O.hasChildNodes()){O.insertBefore(k,O.firstChild)}else{O.appendChild(k)}}}else{O=null}}if(m!=-2){if(!C){O=l.getElementsByTagName(R.settings.element)[0];V=h.createRange();if(m!=-1){V.setStart(T.find(l,1,m),a)}else{V.setStart(O,0)}if(Q!=-1){V.setEnd(T.find(l,1,Q),M)}else{V.setEnd(O,0)}if(U){U.removeAllRanges();U.addRange(V)}}else{try{V=U.createRange();V.moveToElementText(l);V.collapse(1);V.moveStart("character",m);V.moveEnd("character",Q);V.select()}catch(f){}}}else{if(!C&&(X=R.dom.get("__mce"))){if(S){X.setAttribute("id",S)}else{X.removeAttribute("id")}V=h.createRange();V.setStartBefore(X);V.setEndBefore(X);p.setRng(V)}}},getParentBlock:function(N){var M=this.dom;return M.getParent(N,M.isBlock)},insertPara:function(u){var Z=this,R=Z.editor,m=R.dom,v=R.getDoc(),AC=R.settings,a=R.selection.getSel(),f=a.getRangeAt(0),AB=v.body;var j,k,g,p,o,P,N,Q,T,M,X,AA,O,S,h,l=m.getViewPort(R.getWin()),W,Y,V;j=v.createRange();j.setStart(a.anchorNode,a.anchorOffset);j.collapse(D);k=v.createRange();k.setStart(a.focusNode,a.focusOffset);k.collapse(D);g=j.compareBoundaryPoints(j.START_TO_END,k)<0;p=g?a.anchorNode:a.focusNode;o=g?a.anchorOffset:a.focusOffset;P=g?a.focusNode:a.anchorNode;N=g?a.focusOffset:a.anchorOffset;if(p===P&&/^(TD|TH)$/.test(p.nodeName)){if(p.firstChild.nodeName=="BR"){m.remove(p.firstChild)}if(p.childNodes.length==0){R.dom.add(p,AC.element,null,"<br />");AA=R.dom.add(p,AC.element,null,"<br />")}else{h=p.innerHTML;p.innerHTML="";R.dom.add(p,AC.element,null,h);AA=R.dom.add(p,AC.element,null,"<br />")}f=v.createRange();f.selectNodeContents(AA);f.collapse(1);R.selection.setRng(f);return H}if(p==AB&&P==AB&&AB.firstChild&&R.dom.isBlock(AB.firstChild)){p=P=p.firstChild;o=N=0;j=v.createRange();j.setStart(p,0);k=v.createRange();k.setStart(P,0)}p=p.nodeName=="HTML"?v.body:p;p=p.nodeName=="BODY"?p.firstChild:p;P=P.nodeName=="HTML"?v.body:P;P=P.nodeName=="BODY"?P.firstChild:P;Q=Z.getParentBlock(p);T=Z.getParentBlock(P);M=Q?Q.nodeName:AC.element;if(Z.dom.getParent(Q,"ol,ul,pre")){return true}if(Q&&(Q.nodeName=="CAPTION"||/absolute|relative|fixed/gi.test(m.getStyle(Q,"position",1)))){M=AC.element;Q=null}if(T&&(T.nodeName=="CAPTION"||/absolute|relative|fixed/gi.test(m.getStyle(Q,"position",1)))){M=AC.element;T=null}if(/(TD|TABLE|TH|CAPTION)/.test(M)||(Q&&M=="DIV"&&/left|right/gi.test(m.getStyle(Q,"float",1)))){M=AC.element;Q=T=null}X=(Q&&Q.nodeName==M)?Q.cloneNode(0):R.dom.create(M);AA=(T&&T.nodeName==M)?T.cloneNode(0):R.dom.create(M);AA.removeAttribute("id");if(/^(H[1-6])$/.test(M)&&G(f,Q)){AA=R.dom.create(AC.element)}h=O=p;do{if(h==AB||h.nodeType==9||Z.dom.isBlock(h)||/(TD|TABLE|TH|CAPTION)/.test(h.nodeName)){break}O=h}while((h=h.previousSibling?h.previousSibling:h.parentNode));h=S=P;do{if(h==AB||h.nodeType==9||Z.dom.isBlock(h)||/(TD|TABLE|TH|CAPTION)/.test(h.nodeName)){break}S=h}while((h=h.nextSibling?h.nextSibling:h.parentNode));if(O.nodeName==M){j.setStart(O,0)}else{j.setStartBefore(O)}j.setEnd(p,o);X.appendChild(j.cloneContents()||v.createTextNode(""));try{k.setEndAfter(S)}catch(q){}k.setStart(P,N);AA.appendChild(k.cloneContents()||v.createTextNode(""));f=v.createRange();if(!O.previousSibling&&O.parentNode.nodeName==M){f.setStartBefore(O.parentNode)}else{if(j.startContainer.nodeName==M&&j.startOffset==0){f.setStartBefore(j.startContainer)}else{f.setStart(j.startContainer,j.startOffset)}}if(!S.nextSibling&&S.parentNode.nodeName==M){f.setEndAfter(S.parentNode)}else{f.setEnd(k.endContainer,k.endOffset)}f.deleteContents();if(B){R.getWin().scrollTo(0,l.y)}if(X.firstChild&&X.firstChild.nodeName==M){X.innerHTML=X.firstChild.innerHTML}if(AA.firstChild&&AA.firstChild.nodeName==M){AA.innerHTML=AA.firstChild.innerHTML}if(F(X)){X.innerHTML="<br />"}function z(AE,t){var b=[],AG,AF,AD;AE.innerHTML="";if(AC.keep_styles){AF=t;do{if(/^(SPAN|STRONG|B|EM|I|FONT|STRIKE|U)$/.test(AF.nodeName)){AG=AF.cloneNode(H);m.setAttrib(AG,"id","");b.push(AG)}}while(AF=AF.parentNode)}if(b.length>0){for(AD=b.length-1,AG=AE;AD>=0;AD--){AG=AG.appendChild(b[AD])}b[0].innerHTML=B?"&nbsp;":"<br />";return b[0]}else{AE.innerHTML=B?"&nbsp;":"<br />"}}if(F(AA)){V=z(AA,P)}if(B&&parseFloat(opera.version())<9.5){f.insertNode(X);f.insertNode(AA)}else{f.insertNode(AA);f.insertNode(X)}AA.normalize();X.normalize();function U(b){return v.createTreeWalker(b,NodeFilter.SHOW_TEXT,null,H).nextNode()||b}f=v.createRange();f.selectNodeContents(A?U(V||AA):V||AA);f.collapse(1);a.removeAllRanges();a.addRange(f);W=R.dom.getPos(AA).y;Y=AA.clientHeight;if(W<l.y||W+Y>l.y+l.h){R.getWin().scrollTo(0,W<l.y?W:W-l.h+25)}return H},backspaceDelete:function(Q,W){var Y=this,P=Y.editor,T=P.getBody(),O=P.dom,N,R=P.selection,M=R.getRng(),S=M.startContainer,N,U,V;if(S&&R.isCollapsed()&&P.dom.isBlock(S)&&!/^(TD|TH)$/.test(S.nodeName)&&W){if(S.childNodes.length==0||(S.childNodes.length==1&&S.firstChild.nodeName=="BR")){N=S;while((N=N.previousSibling)&&!P.dom.isBlock(N)){}if(N){if(S!=T.firstChild){U=P.dom.doc.createTreeWalker(N,NodeFilter.SHOW_TEXT,null,H);while(V=U.nextNode()){N=V}M=P.getDoc().createRange();M.setStart(N,N.nodeValue?N.nodeValue.length:0);M.setEnd(N,N.nodeValue?N.nodeValue.length:0);R.setRng(M);P.dom.remove(S)}return K.cancel(Q)}}}function X(Z){var a;Z=Z.target;if(Z&&Z.parentNode&&Z.nodeName=="BR"&&(N=Y.getParentBlock(Z))){a=Z.previousSibling;K.remove(T,"DOMNodeInserted",X);if(a&&a.nodeType==3&&/\s+$/.test(a.nodeValue)){return }if(Z.previousSibling||Z.nextSibling){P.dom.remove(Z)}}}K._add(T,"DOMNodeInserted",X);window.setTimeout(function(){K._remove(T,"DOMNodeInserted",X)},1)}})})(tinymce);(function(C){var B=C.DOM,A=C.dom.Event,D=C.each,E=C.extend;C.create("tinymce.ControlManager",{ControlManager:function(F,I){var H=this,G;I=I||{};H.editor=F;H.controls={};H.onAdd=new C.util.Dispatcher(H);H.onPostRender=new C.util.Dispatcher(H);H.prefix=I.prefix||F.id+"_";H._cls={};H.onPostRender.add(function(){D(H.controls,function(J){J.postRender()})})},get:function(F){return this.controls[this.prefix+F]||this.controls[F]},setActive:function(H,F){var G=null;if(G=this.get(H)){G.setActive(F)}return G},setDisabled:function(H,F){var G=null;if(G=this.get(H)){G.setDisabled(F)}return G},add:function(G){var F=this;if(G){F.controls[G.id]=G;F.onAdd.dispatch(G,F)}return G},createControl:function(I){var H,G=this,F=G.editor;D(F.plugins,function(J){if(J.createControl){H=J.createControl(I,G);if(H){return false}}});switch(I){case"|":case"separator":return G.createSeparator()}if(!H&&F.buttons&&(H=F.buttons[I])){return G.createButton(I,H)}return G.add(H)},createDropMenu:function(F,N,H){var M=this,I=M.editor,J,G,K,L;N=E({"class":"mceDropDown",constrain:I.settings.constrain_menus},N);N["class"]=N["class"]+" "+I.getParam("skin")+"Skin";if(K=I.getParam("skin_variant")){N["class"]+=" "+I.getParam("skin")+"Skin"+K.substring(0,1).toUpperCase()+K.substring(1)}F=M.prefix+F;L=H||M._cls.dropmenu||C.ui.DropMenu;J=M.controls[F]=new L(F,N);J.onAddItem.add(function(Q,P){var O=P.settings;O.title=I.getLang(O.title,O.title);if(!O.onclick){O.onclick=function(R){if(O.cmd){I.execCommand(O.cmd,O.ui||false,O.value)}}}});I.onRemove.add(function(){J.destroy()});if(C.isIE){J.onShowMenu.add(function(){I.focus();G=I.selection.getBookmark(1)});J.onHideMenu.add(function(){if(G){I.selection.moveToBookmark(G);G=0}})}return M.add(J)},createListBox:function(M,I,L){var H=this,G=H.editor,J,K,F;if(H.get(M)){return null}I.title=G.translate(I.title);I.scope=I.scope||G;if(!I.onselect){I.onselect=function(N){G.execCommand(I.cmd,I.ui||false,N||I.value)}}I=E({title:I.title,"class":"mce_"+M,scope:I.scope,control_manager:H},I);M=H.prefix+M;if(G.settings.use_native_selects){K=new C.ui.NativeListBox(M,I)}else{F=L||H._cls.listbox||C.ui.ListBox;K=new F(M,I)}H.controls[M]=K;if(C.isWebKit){K.onPostRender.add(function(O,N){A.add(N,"mousedown",function(){G.bookmark=G.selection.getBookmark(1)});A.add(N,"focus",function(){G.selection.moveToBookmark(G.bookmark);G.bookmark=null})})}if(K.hideMenu){G.onMouseDown.add(K.hideMenu,K)}return H.add(K)},createButton:function(M,I,L){var H=this,G=H.editor,J,K,F;if(H.get(M)){return null}I.title=G.translate(I.title);I.label=G.translate(I.label);I.scope=I.scope||G;if(!I.onclick&&!I.menu_button){I.onclick=function(){G.execCommand(I.cmd,I.ui||false,I.value)}}I=E({title:I.title,"class":"mce_"+M,unavailable_prefix:G.getLang("unavailable",""),scope:I.scope,control_manager:H},I);M=H.prefix+M;if(I.menu_button){F=L||H._cls.menubutton||C.ui.MenuButton;K=new F(M,I);G.onMouseDown.add(K.hideMenu,K)}else{F=H._cls.button||C.ui.Button;K=new F(M,I)}return H.add(K)},createMenuButton:function(H,F,G){F=F||{};F.menu_button=1;return this.createButton(H,F,G)},createSplitButton:function(M,I,L){var H=this,G=H.editor,J,K,F;if(H.get(M)){return null}I.title=G.translate(I.title);I.scope=I.scope||G;if(!I.onclick){I.onclick=function(N){G.execCommand(I.cmd,I.ui||false,N||I.value)}}if(!I.onselect){I.onselect=function(N){G.execCommand(I.cmd,I.ui||false,N||I.value)}}I=E({title:I.title,"class":"mce_"+M,scope:I.scope,control_manager:H},I);M=H.prefix+M;F=L||H._cls.splitbutton||C.ui.SplitButton;K=H.add(new F(M,I));G.onMouseDown.add(K.hideMenu,K);return K},createColorSplitButton:function(F,N,H){var L=this,J=L.editor,I,K,M,G;if(L.get(F)){return null}N.title=J.translate(N.title);N.scope=N.scope||J;if(!N.onclick){N.onclick=function(O){if(C.isIE){G=J.selection.getBookmark(1)}J.execCommand(N.cmd,N.ui||false,O||N.value)}}if(!N.onselect){N.onselect=function(O){J.execCommand(N.cmd,N.ui||false,O||N.value)}}N=E({title:N.title,"class":"mce_"+F,menu_class:J.getParam("skin")+"Skin",scope:N.scope,more_colors_title:J.getLang("more_colors")},N);F=L.prefix+F;M=H||L._cls.colorsplitbutton||C.ui.ColorSplitButton;K=new M(F,N);J.onMouseDown.add(K.hideMenu,K);J.onRemove.add(function(){K.destroy()});if(C.isIE){K.onShowMenu.add(function(){J.focus();G=J.selection.getBookmark(1)});K.onHideMenu.add(function(){if(G){J.selection.moveToBookmark(G);G=0}})}return L.add(K)},createToolbar:function(K,H,J){var I,G=this,F;K=G.prefix+K;F=J||G._cls.toolbar||C.ui.Toolbar;I=new F(K,H);if(G.get(K)){return null}return G.add(I)},createSeparator:function(G){var F=G||this._cls.separator||C.ui.Separator;return new F()},setControlType:function(G,F){return this._cls[G.toLowerCase()]=F},destroy:function(){D(this.controls,function(F){F.destroy()});this.controls=null}})})(tinymce);(function(D){var A=D.util.Dispatcher,E=D.each,C=D.isIE,B=D.isOpera;D.create("tinymce.WindowManager",{WindowManager:function(F){var G=this;G.editor=F;G.onOpen=new A(G);G.onClose=new A(G);G.params={};G.features={}},open:function(R,G){var Q=this,J="",M,L,H=Q.editor.settings.dialog_type=="modal",O,N,I,F=D.DOM.getViewPort(),P;R=R||{};G=G||{};N=B?F.w:screen.width;I=B?F.h:screen.height;R.name=R.name||"mc_"+new Date().getTime();R.width=parseInt(R.width||320);R.height=parseInt(R.height||240);R.resizable=true;R.left=R.left||parseInt(N/2)-(R.width/2);R.top=R.top||parseInt(I/2)-(R.height/2);G.inline=false;G.mce_width=R.width;G.mce_height=R.height;G.mce_auto_focus=R.auto_focus;if(H){if(C){R.center=true;R.help=false;R.dialogWidth=R.width+"px";R.dialogHeight=R.height+"px";R.scroll=R.scrollbars||false}}E(R,function(T,S){if(D.is(T,"boolean")){T=T?"yes":"no"}if(!/^(name|url)$/.test(S)){if(C&&H){J+=(J?";":"")+S+":"+T}else{J+=(J?",":"")+S+"="+T}}});Q.features=R;Q.params=G;Q.onOpen.dispatch(Q,R,G);P=R.url||R.file;P=D._addVer(P);try{if(C&&H){O=1;window.showModalDialog(P,window,J)}else{O=window.open(P,R.name,J)}}catch(K){}if(!O){alert(Q.editor.getLang("popup_blocked"))}},close:function(F){F.close();this.onClose.dispatch(this)},createInstance:function(H,G,F,L,K,J){var I=D.resolve(H);return new I(G,F,L,K,J)},confirm:function(H,F,I,G){G=G||window;F.call(I||this,G.confirm(this._decode(this.editor.getLang(H,H))))},alert:function(H,F,J,G){var I=this;G=G||window;G.alert(I._decode(I.editor.getLang(H,H)));if(F){F.call(J||I)}},resizeBy:function(F,G,H){H.resizeBy(F,G)},_decode:function(F){return D.DOM.decode(F).replace(/\\n/g,"\n")}})}(tinymce));(function(A){function B(){var D={},C={},E={};function F(J,I,H,G){if(typeof (I)=="string"){I=[I]}A.each(I,function(K){J[K.toLowerCase()]={func:H,scope:G}})}A.extend(this,{add:function(I,H,G){F(D,I,H,G)},addQueryStateHandler:function(I,H,G){F(C,I,H,G)},addQueryValueHandler:function(I,H,G){F(E,I,H,G)},execCommand:function(H,K,J,I,G){if(K=D[K.toLowerCase()]){if(K.func.call(H||K.scope,J,I,G)!==false){return true}}},queryCommandValue:function(){if(cmd=E[cmd.toLowerCase()]){return cmd.func.call(scope||cmd.scope,ui,value,args)}},queryCommandState:function(){if(cmd=C[cmd.toLowerCase()]){return cmd.func.call(scope||cmd.scope,ui,value,args)}}})}A.GlobalCommands=new B()})(tinymce);(function(A){A.Formatter=function(AB){var m={},p=A.each,C=AB.dom,P=AB.selection,S=A.dom.TreeWalker,k=new A.dom.RangeUtils(C),D=AB.schema.isValid,f=C.isBlock,K=AB.settings.forced_root_block,R=C.nodeIndex,e="\uFEFF",E=/^(src|href|style)$/,v=false,Z=true,O,q={apply:[],remove:[]};function X(AC){return AC instanceof Array}function L(AD,AC){return C.getParents(AD,AC,C.getRoot())}function B(AC){return AC.nodeType===1&&(AC.face==="mceinline"||AC.style.fontFamily==="mceinline")}function u(AC){return AC?m[AC]:m}function J(AC,AD){if(AC){if(typeof (AC)!=="string"){p(AC,function(AF,AE){J(AE,AF)})}else{AD=AD.length?AD:[AD];p(AD,function(AE){if(AE.deep===O){AE.deep=!AE.selector}if(AE.split===O){AE.split=!AE.selector||AE.inline}if(AE.remove===O&&AE.selector&&!AE.inline){AE.remove="none"}if(AE.selector&&AE.inline){AE.mixed=true;AE.block_expand=true}if(typeof (AE.classes)==="string"){AE.classes=AE.classes.split(/\s+/)}});m[AC]=AD}}}function z(AE,AK,AG){var AH=u(AE),AL=AH[0],AJ,AD,AI;function AF(AO){var AN=AO.startContainer,AR=AO.startOffset,AQ,AP;if(AN.nodeType==1||AN.nodeValue===""){AN=AN.nodeType==1?AN.childNodes[AR]:AN;AQ=new S(AN,AN);for(AP=AQ.current();AP;AP=AQ.next()){if(AP.nodeType==3&&!f(AP.parentNode)&&!F(AP)){AO.setStart(AP,0);break}}}return AO}function AC(AO,AN){AN=AN||AL;if(AO){p(AN.styles,function(AQ,AP){C.setStyle(AO,AP,Q(AQ,AK))});p(AN.attributes,function(AQ,AP){C.setAttrib(AO,AP,Q(AQ,AK))});p(AN.classes,function(AP){AP=Q(AP,AK);if(!C.hasClass(AO,AP)){C.addClass(AO,AP)}})}}function AM(AO){var AN=[],AQ,AP;AQ=AL.inline||AL.block;AP=C.create(AQ);AC(AP);k.walk(AO,function(AR){var AS;function AT(AU){var AY=AU.nodeName.toLowerCase(),AW=AU.parentNode.nodeName.toLowerCase(),AV;if(G(AY,"br")){AS=0;if(AL.block){C.remove(AU)}return }if(AL.wrapper&&V(AU,AE,AK)){AS=0;return }if(AL.block&&!AL.wrapper&&g(AY)){AU=C.rename(AU,AQ);AC(AU);AN.push(AU);AS=0;return }if(AL.selector){p(AH,function(AZ){if(C.is(AU,AZ.selector)&&!B(AU)){AC(AU,AZ);AV=true}});if(!AL.inline||AV){AS=0;return }}var AX=(AQ=="span")&&(AY=="a"||C.select("a",AU).length>0);if(D(AQ,AY)&&D(AW,AQ)&&!AX){if(!AS){AS=AP.cloneNode(v);AU.parentNode.insertBefore(AS,AU);AN.push(AS)}AS.appendChild(AU)}else{AS=0;p(A.grep(AU.childNodes),AT);AS=0}}p(AR,AT)});p(AN,function(AT){var AR;function AU(AW){var AV=0;p(AW.childNodes,function(AX){if(!F(AX)&&!h(AX)){AV++}});return AV}function AS(AV){var AX,AW;p(AV.childNodes,function(AY){if(AY.nodeType==1&&!h(AY)&&!B(AY)){AX=AY;return v}});if(AX&&H(AX,AL)){AW=AX.cloneNode(v);AC(AW);C.replace(AW,AV,Z);C.remove(AX,1)}return AW||AV}AR=AU(AT);if(AR===0){C.remove(AT,1);return }if(AL.inline||AL.wrapper){if(!AL.exact&&AR===1){AT=AS(AT)}p(AH,function(AV){p(C.select(AV.inline,AT),function(AW){AA(AV,AK,AW,AV.exact?AW:null)})});C.getParent(AT.parentNode,function(AV){if(V(AV,AE,AK)){C.remove(AT,1);AT=0;return Z}});if(AT){AT=T(a(AT),AT);AT=T(AT,a(AT,Z))}}})}if(AL){if(AG){AD=C.createRng();AD.setStartBefore(AG);AD.setEndAfter(AG);AM(AD)}else{if(!P.isCollapsed()||!AL.inline){AJ=P.getBookmark();AM(N(P.getRng(Z),AH));P.moveToBookmark(AJ);P.setRng(AF(P.getRng(Z)));AB.nodeChanged()}else{t("apply",AE,AK)}}}}function Y(AE,AM,AG){var AH=u(AE),AO=AH[0],AL,AK,AD;function AF(AT){var AS,AR,AQ;AS=A.grep(AT.childNodes);for(AR=0,AQ=AH.length;AR<AQ;AR++){if(AA(AH[AR],AM,AT,AT)){break}}if(AO.deep){for(AR=0,AQ=AS.length;AR<AQ;AR++){AF(AS[AR])}}}function AI(AQ){var AR;p(L(AQ.parentNode).reverse(),function(AS){var AT;if(!AR&&AS.id!="_start"&&AS.id!="_end"){AT=V(AS,AE,AM);if(AT&&AT.split!==false){AR=AS}}});return AR}function AC(AT,AQ,AV,AY){var AZ,AX,AW,AS,AU,AR;if(AT){AR=AT.parentNode;for(AZ=AQ.parentNode;AZ&&AZ!=AR;AZ=AZ.parentNode){AX=AZ.cloneNode(v);for(AU=0;AU<AH.length;AU++){if(AA(AH[AU],AM,AX,AX)){AX=0;break}}if(AX){if(AW){AX.appendChild(AW)}if(!AS){AS=AX}AW=AX}}if(AY&&(!AO.mixed||!f(AT))){AQ=C.split(AT,AQ)}if(AW){AV.parentNode.insertBefore(AW,AV);AS.appendChild(AV)}}return AQ}function AN(AQ){return AC(AI(AQ),AQ,AQ,true)}function AJ(AS){var AR=C.get(AS?"_start":"_end"),AQ=AR[AS?"firstChild":"lastChild"];C.remove(AR,1);return AQ}function AP(AQ){var AR,AS;AQ=N(AQ,AH,Z);if(AO.split){AR=j(AQ,Z);AS=j(AQ);if(AR!=AS){AR=o(AR,"span",{id:"_start",_mce_type:"bookmark"});AS=o(AS,"span",{id:"_end",_mce_type:"bookmark"});AN(AR);AN(AS);AR=AJ(Z);AS=AJ()}else{AR=AS=AN(AR)}AQ.startContainer=AR.parentNode;AQ.startOffset=R(AR);AQ.endContainer=AS.parentNode;AQ.endOffset=R(AS)+1}k.walk(AQ,function(AT){p(AT,function(AU){AF(AU)})})}if(AG){AD=C.createRng();AD.setStartBefore(AG);AD.setEndAfter(AG);AP(AD);return }if(!P.isCollapsed()||!AO.inline){AL=P.getBookmark();AP(P.getRng(Z));P.moveToBookmark(AL);AB.nodeChanged()}else{t("remove",AE,AM)}}function b(AC,AE,AD){if(I(AC,AE,AD)){Y(AC,AE,AD)}else{z(AC,AE,AD)}}function V(AF,AC,AH){var AI=u(AC),AG,AE,AD;function AJ(AN,AP,AQ){var AM,AO,AK=AP[AQ],AL;if(AK){if(AK.length===O){for(AM in AK){if(AK.hasOwnProperty(AM)){if(AQ==="attributes"){AO=C.getAttrib(AN,AM)}else{AO=l(AN,AM)}if(!G(AO,Q(AK[AM],AH))){return }}}}else{for(AL=0;AL<AK.length;AL++){if(AQ==="attributes"?C.getAttrib(AN,AK[AL]):l(AN,AK[AL])){return AP}}}}return AP}if(AI&&AF){for(AE=0;AE<AI.length;AE++){AG=AI[AE];if(H(AF,AG)&&AJ(AF,AG,"attributes")&&AJ(AF,AG,"styles")){if(AD=AG.classes){for(AE=0;AE<AD.length;AE++){if(!C.hasClass(AF,AD[AE])){return }}}return AG}}}}function I(AE,AH,AG){var AD,AF;function AC(AI){AI=C.getParent(AI,function(AJ){return !!V(AJ,AE,AH)});return V(AI,AE,AH)}if(AG){return AC(AG)}if(P.isCollapsed()){for(AF=q.apply.length-1;AF>=0;AF--){if(q.apply[AF].name==AE){return true}}for(AF=q.remove.length-1;AF>=0;AF--){if(q.remove[AF].name==AE){return false}}return AC(P.getNode())}AG=P.getNode();if(AC(AG)){return Z}AD=P.getStart();if(AD!=AG){if(AC(AD)){return Z}}return v}function U(AJ,AI){var AG,AH=[],AF={},AE,AD,AC;if(P.isCollapsed()){for(AD=0;AD<AJ.length;AD++){for(AE=q.remove.length-1;AE>=0;AE--){AC=AJ[AD];if(q.remove[AE].name==AC){AF[AC]=true;break}}}for(AE=q.apply.length-1;AE>=0;AE--){for(AD=0;AD<AJ.length;AD++){AC=AJ[AD];if(!AF[AC]&&q.apply[AE].name==AC){AF[AC]=true;AH.push(AC)}}}}AG=P.getStart();C.getParent(AG,function(AM){var AL,AK;for(AL=0;AL<AJ.length;AL++){AK=AJ[AL];if(!AF[AK]&&V(AM,AK,AI)){AF[AK]=true;AH.push(AK)}}});return AH}function W(AG){var AI=u(AG),AF,AE,AH,AD,AC;if(AI){AF=P.getStart();AE=L(AF);for(AD=AI.length-1;AD>=0;AD--){AC=AI[AD].selector;if(!AC){return Z}for(AH=AE.length-1;AH>=0;AH--){if(C.is(AE[AH],AC)){return Z}}}}return v}A.extend(this,{get:u,register:J,apply:z,remove:Y,toggle:b,match:I,matchAll:U,matchNode:V,canApply:W});function H(AC,AD){if(G(AC,AD.inline)){return Z}if(G(AC,AD.block)){return Z}if(AD.selector){return C.is(AC,AD.selector)}}function G(AD,AC){AD=AD||"";AC=AC||"";AD=""+(AD.nodeName||AD);AC=""+(AC.nodeName||AC);return AD.toLowerCase()==AC.toLowerCase()}function l(AD,AC){var AE=C.getStyle(AD,AC);if(AC=="color"||AC=="backgroundColor"){AE=C.toHex(AE)}if(AC=="fontWeight"&&AE==700){AE="bold"}return""+AE}function Q(AC,AD){if(typeof (AC)!="string"){AC=AC(AD)}else{if(AD){AC=AC.replace(/%(\w+)/g,function(AF,AE){return AD[AE]||AF})}}return AC}function F(AC){return AC&&AC.nodeType===3&&/^\s*$/.test(AC.nodeValue)}function o(AE,AD,AC){var AF=C.create(AD,AC);AE.parentNode.insertBefore(AF,AE);AF.appendChild(AE);return AF}function N(AC,AK,AF){var AE=AC.startContainer,AH=AC.startOffset,AN=AC.endContainer,AI=AC.endOffset,AM,AJ;function AL(AQ,AR,AO,AP){var AS,AT;AP=AP||C.getRoot();for(;;){AS=AQ.parentNode;if(AS==AP||(!AK[0].block_expand&&f(AS))){return AQ}for(AM=AS[AR];AM&&AM!=AQ;AM=AM[AO]){if(AM.nodeType==1&&!h(AM)){return AQ}if(AM.nodeType==3&&!F(AM)){return AQ}}AQ=AQ.parentNode}return AQ}if(AE.nodeType==1&&AE.hasChildNodes()){AJ=AE.childNodes.length-1;AE=AE.childNodes[AH>AJ?AJ:AH];if(AE.nodeType==3){AH=0}}if(AN.nodeType==1&&AN.hasChildNodes()){AJ=AN.childNodes.length-1;AN=AN.childNodes[AI>AJ?AJ:AI-1];if(AN.nodeType==3){AI=AN.nodeValue.length}}if(h(AE.parentNode)){AE=AE.parentNode}if(h(AE)){AE=AE.nextSibling||AE}if(h(AN.parentNode)){AN=AN.parentNode}if(h(AN)){AN=AN.previousSibling||AN}if(AK[0].inline||AK[0].block_expand){AE=AL(AE,"firstChild","nextSibling");AN=AL(AN,"lastChild","previousSibling")}if(AK[0].selector&&AK[0].expand!==v&&!AK[0].inline){function AG(AP,AO){var AQ,AR,AS;if(AP.nodeType==3&&AP.nodeValue.length==0&&AP[AO]){AP=AP[AO]}AQ=L(AP);for(AR=0;AR<AQ.length;AR++){for(AS=0;AS<AK.length;AS++){if(C.is(AQ[AR],AK[AS].selector)){return AQ[AR]}}}return AP}AE=AG(AE,"previousSibling");AN=AG(AN,"nextSibling")}if(AK[0].block||AK[0].selector){function AD(AP,AO,AR){var AQ;if(!AK[0].wrapper){AQ=C.getParent(AP,AK[0].block)}if(!AQ){AQ=C.getParent(AP.nodeType==3?AP.parentNode:AP,f)}if(AQ&&AK[0].wrapper){AQ=L(AQ,"ul,ol").reverse()[0]||AQ}if(!AQ){AQ=AP;while(AQ[AO]&&!f(AQ[AO])){AQ=AQ[AO];if(G(AQ,"br")){break}}}return AQ||AP}AE=AD(AE,"previousSibling");AN=AD(AN,"nextSibling");if(AK[0].block){if(!f(AE)){AE=AL(AE,"firstChild","nextSibling")}if(!f(AN)){AN=AL(AN,"lastChild","previousSibling")}}}if(AE.nodeType==1){AH=R(AE);AE=AE.parentNode}if(AN.nodeType==1){AI=R(AN)+1;AN=AN.parentNode}return{startContainer:AE,startOffset:AH,endContainer:AN,endOffset:AI}}function AA(AI,AH,AF,AC){var AE,AD,AG;if(!H(AF,AI)){return v}if(AI.remove!="all"){p(AI.styles,function(AK,AJ){AK=Q(AK,AH);if(typeof (AJ)==="number"){AJ=AK;AC=0}if(!AC||G(l(AC,AJ),AK)){C.setStyle(AF,AJ,"")}AG=1});if(AG&&C.getAttrib(AF,"style")==""){AF.removeAttribute("style");AF.removeAttribute("_mce_style")}p(AI.attributes,function(AL,AJ){var AK;AL=Q(AL,AH);if(typeof (AJ)==="number"){AJ=AL;AC=0}if(!AC||G(C.getAttrib(AC,AJ),AL)){if(AJ=="class"){AL=C.getAttrib(AF,AJ);if(AL){AK="";p(AL.split(/\s+/),function(AM){if(/mce\w+/.test(AM)){AK+=(AK?" ":"")+AM}});if(AK){C.setAttrib(AF,AJ,AK);return }}}if(AJ=="class"){AF.removeAttribute("className")}if(E.test(AJ)){AF.removeAttribute("_mce_"+AJ)}AF.removeAttribute(AJ);if(AJ=="style"){AF.removeAttribute("_mce_style")}}});p(AI.classes,function(AJ){AJ=Q(AJ,AH);if(!AC||C.hasClass(AC,AJ)){C.removeClass(AF,AJ)}});AD=C.getAttribs(AF);for(AE=0;AE<AD.length;AE++){if(AD[AE].nodeName.indexOf("_")!==0){return v}}}if(AI.remove!="none"){M(AF,AI);return Z}}function M(AE,AF){var AC=AE.parentNode,AD;if(AF.block){if(!K){function AG(AI,AH,AJ){AI=a(AI,AH,AJ);return !AI||(AI.nodeName=="BR"||f(AI))}if(f(AE)&&!f(AC)){if(!AG(AE,v)&&!AG(AE.firstChild,Z,1)){AE.insertBefore(C.create("br"),AE.firstChild)}if(!AG(AE,Z)&&!AG(AE.lastChild,v,1)){AE.appendChild(C.create("br"))}}}else{if(AC==C.getRoot()){if(!AF.list_block||!G(AE,AF.list_block)){p(A.grep(AE.childNodes),function(AH){if(D(K,AH.nodeName.toLowerCase())){if(!AD){AD=o(AH,K)}else{AD.appendChild(AH)}}else{AD=0}})}}}}if(AF.selector&&AF.inline&&!G(AF.inline,AE)){return }C.remove(AE,1)}function a(AD,AC,AE){if(AD){AC=AC?"nextSibling":"previousSibling";for(AD=AE?AD:AD[AC];AD;AD=AD[AC]){if(AD.nodeType==1||!F(AD)){return AD}}}}function h(AC){return AC&&AC.nodeType==1&&AC.getAttribute("_mce_type")=="bookmark"}function T(AG,AF){var AC,AE,AD;function AI(AL,AK){if(AL.nodeName!=AK.nodeName){return v}function AJ(AN){var AO={};p(C.getAttribs(AN),function(AP){var AQ=AP.nodeName.toLowerCase();if(AQ.indexOf("_")!==0&&AQ!=="style"){AO[AQ]=C.getAttrib(AN,AQ)}});return AO}function AM(AQ,AP){var AO,AN;for(AN in AQ){if(AQ.hasOwnProperty(AN)){AO=AP[AN];if(AO===O){return v}if(AQ[AN]!=AO){return v}delete AP[AN]}}for(AN in AP){if(AP.hasOwnProperty(AN)){return v}}return Z}if(!AM(AJ(AL),AJ(AK))){return v}if(!AM(C.parseStyle(C.getAttrib(AL,"style")),C.parseStyle(C.getAttrib(AK,"style")))){return v}return Z}if(AG&&AF){function AH(AK,AJ){for(AE=AK;AE;AE=AE[AJ]){if(AE.nodeType==3&&!F(AE)){return AK}if(AE.nodeType==1&&!h(AE)){return AE}}return AK}AG=AH(AG,"previousSibling");AF=AH(AF,"nextSibling");if(AI(AG,AF)){for(AE=AG.nextSibling;AE&&AE!=AF;){AD=AE;AE=AE.nextSibling;AG.appendChild(AD)}C.remove(AF);p(A.grep(AF.childNodes),function(AJ){AG.appendChild(AJ)});return AG}}return AF}function g(AC){return/^(h[1-6]|p|div|pre|address|dl|dt|dd)$/.test(AC)}function j(AD,AG){var AC,AF,AE;AC=AD[AG?"startContainer":"endContainer"];AF=AD[AG?"startOffset":"endOffset"];if(AC.nodeType==1){AE=AC.childNodes.length-1;if(!AG&&AF){AF--}AC=AC.childNodes[AF>AE?AE:AF]}return AC}function t(AI,AD,AH){var AF,AC=q[AI],AJ=q[AI=="apply"?"remove":"apply"];function AK(){return q.apply.length||q.remove.length}function AG(){q.apply=[];q.remove=[]}function AL(AM){p(q.apply.reverse(),function(AN){z(AN.name,AN.vars,AM)});p(q.remove.reverse(),function(AN){Y(AN.name,AN.vars,AM)});C.remove(AM,1);AG()}for(AF=AC.length-1;AF>=0;AF--){if(AC[AF].name==AD){return }}AC.push({name:AD,vars:AH});for(AF=AJ.length-1;AF>=0;AF--){if(AJ[AF].name==AD){AJ.splice(AF,1)}}if(AK()){if(A.isIE){var AE=AB.selection.getPBBookmark();AB.getDoc().execCommand("FontName",false,"mceinline");AB.selection.moveToPBBookmark(AE)}else{AB.getDoc().execCommand("FontName",false,"mceinline")}p(C.select("font,span"),function(AN){var AM;if(B(AN)){AM=P.getBookmark();AL(AN);P.moveToBookmark(AM);AB.nodeChanged()}});if(!q.isListening&&AK()){q.isListening=true;p("onKeyDown,onKeyUp,onKeyPress,onMouseUp".split(","),function(AM){AB[AM].addToTop(function(AN,AO){if(AK()){p(C.select("font,span"),function(AR){var AQ,AS,AP;if(B(AR)){AS=AR.firstChild;AL(AR);AP=C.createRng();AP.setStart(AS,AS.nodeValue.length);AP.setEnd(AS,AS.nodeValue.length);P.setRng(AP);AN.nodeChanged()}});if(AO.type=="mouseup"||(AO.type=="keydown"&&AO.keyCode>=37&&AO.keyCode<=40)){AG()}}})})}}}}})(tinymce);tinymce.onAddEditor.add(function(E,A){var D,H,G,C=A.settings;if(C.inline_styles){H=E.explode(C.font_size_style_values);function B(J,I){G.replace(G.create("span",{style:I}),J,1)}D={font:function(J,I){B(I,{backgroundColor:I.style.backgroundColor,color:I.color,fontFamily:I.face,fontSize:H[parseInt(I.size)-1]})},u:function(J,I){B(I,{textDecoration:"underline"})},strike:function(J,I){B(I,{textDecoration:"line-through"})}};function F(I,J){G=I.dom;if(C.convert_fonts_to_spans){E.each(G.select("font,u,strike",J.node),function(K){D[K.nodeName.toLowerCase()](A.dom,K)})}}A.onPreProcess.add(F);A.onInit.add(function(){A.selection.onSetContent.add(F)})}});tinyMCE.addI18n({en:{common:{edit_confirm:"Do you want to use the WYSIWYG mode for this textarea?",apply:"Apply",insert:"Insert",update:"Update",cancel:"Cancel",close:"Close",browse:"Browse",class_name:"Class",not_set:"-- Not set --",clipboard_msg:"Copy/Cut/Paste is not available in Mozilla and Firefox.\nDo you want more information about this issue?",clipboard_no_support:"Currently not supported by your browser, use keyboard shortcuts instead.",popup_blocked:"Sorry, but we have noticed that your popup-blocker has disabled a window that provides application functionality. You will need to disable popup blocking on this site in order to fully utilize this tool.",invalid_data:"Error: Invalid values entered, these are marked in red.",more_colors:"More colors"},contextmenu:{align:"Alignment",left:"Left",center:"Center",right:"Right",full:"Full"},insertdatetime:{date_fmt:"%Y-%m-%d",time_fmt:"%H:%M:%S",insertdate_desc:"Insert date",inserttime_desc:"Insert time",months_long:"January,February,March,April,May,June,July,August,September,October,November,December",months_short:"Jan,Feb,Mar,Apr,May,Jun,Jul,Aug,Sep,Oct,Nov,Dec",day_long:"Sunday,Monday,Tuesday,Wednesday,Thursday,Friday,Saturday,Sunday",day_short:"Sun,Mon,Tue,Wed,Thu,Fri,Sat,Sun"},print:{print_desc:"Print"},preview:{preview_desc:"Preview"},directionality:{ltr_desc:"Direction left to right",rtl_desc:"Direction right to left"},layer:{insertlayer_desc:"Insert new layer",forward_desc:"Move forward",backward_desc:"Move backward",absolute_desc:"Toggle absolute positioning",content:"New layer..."},save:{save_desc:"Save",cancel_desc:"Cancel all changes"},nonbreaking:{nonbreaking_desc:"Insert non-breaking space character"},iespell:{iespell_desc:"Run spell checking",download:"ieSpell not detected. Do you want to install it now?"},advhr:{advhr_desc:"Horizontal rule"},emotions:{emotions_desc:"Emotions"},searchreplace:{search_desc:"Find",replace_desc:"Find/Replace"},advimage:{image_desc:"Insert/edit image"},advlink:{link_desc:"Insert/edit link"},xhtmlxtras:{cite_desc:"Citation",abbr_desc:"Abbreviation",acronym_desc:"Acronym",del_desc:"Deletion",ins_desc:"Insertion",attribs_desc:"Insert/Edit Attributes"},style:{desc:"Edit CSS Style"},paste:{paste_text_desc:"Paste as Plain Text",paste_word_desc:"Paste from Word",selectall_desc:"Select All"},paste_dlg:{text_title:"Use CTRL+V on your keyboard to paste the text into the window.",text_linebreaks:"Keep linebreaks",word_title:"Use CTRL+V on your keyboard to paste the text into the window."},table:{desc:"Inserts a new table",row_before_desc:"Insert row before",row_after_desc:"Insert row after",delete_row_desc:"Delete row",col_before_desc:"Insert column before",col_after_desc:"Insert column after",delete_col_desc:"Remove column",split_cells_desc:"Split merged table cells",merge_cells_desc:"Merge table cells",row_desc:"Table row properties",cell_desc:"Table cell properties",props_desc:"Table properties",paste_row_before_desc:"Paste table row before",paste_row_after_desc:"Paste table row after",cut_row_desc:"Cut table row",copy_row_desc:"Copy table row",del:"Delete table",row:"Row",col:"Column",cell:"Cell"},autosave:{unload_msg:"The changes you made will be lost if you navigate away from this page."},fullscreen:{desc:"Toggle fullscreen mode"},media:{desc:"Insert / edit embedded media",edit:"Edit embedded media"},fullpage:{desc:"Document properties"},template:{desc:"Insert predefined template content"},visualchars:{desc:"Visual control characters on/off."},spellchecker:{desc:"Check spelling",menu:"Spellchecker settings",ignore_word:"Ignore word",ignore_words:"Ignore all",langs:"Languages",wait:"Please wait...",sug:"Suggestions",no_sug:"No suggestions",no_mpell:"No misspellings found."},pagebreak:{desc:"Insert page break."}}});(function(E){var D=E.DOM,B=E.dom.Event,H=E.extend,F=E.each,A=E.util.Cookie,G,C=E.explode;E.ThemeManager.requireLangPack("advanced");E.create("tinymce.themes.AdvancedTheme",{sizes:[8,10,12,14,18,24,36],controls:{bold:["bold_desc","Bold"],italic:["italic_desc","Italic"],underline:["underline_desc","Underline"],strikethrough:["striketrough_desc","Strikethrough"],justifyleft:["justifyleft_desc","JustifyLeft"],justifycenter:["justifycenter_desc","JustifyCenter"],justifyright:["justifyright_desc","JustifyRight"],justifyfull:["justifyfull_desc","JustifyFull"],bullist:["bullist_desc","InsertUnorderedList"],numlist:["numlist_desc","InsertOrderedList"],outdent:["outdent_desc","Outdent"],indent:["indent_desc","Indent"],cut:["cut_desc","Cut"],copy:["copy_desc","Copy"],paste:["paste_desc","Paste"],undo:["undo_desc","Undo"],redo:["redo_desc","Redo"],link:["link_desc","mceLink"],unlink:["unlink_desc","unlink"],image:["image_desc","mceImage"],cleanup:["cleanup_desc","mceCleanup"],help:["help_desc","mceHelp"],code:["code_desc","mceCodeEditor"],hr:["hr_desc","InsertHorizontalRule"],removeformat:["removeformat_desc","RemoveFormat"],sub:["sub_desc","subscript"],sup:["sup_desc","superscript"],forecolor:["forecolor_desc","ForeColor"],forecolorpicker:["forecolor_desc","mceForeColor"],backcolor:["backcolor_desc","HiliteColor"],backcolorpicker:["backcolor_desc","mceBackColor"],charmap:["charmap_desc","mceCharMap"],visualaid:["visualaid_desc","mceToggleVisualAid"],anchor:["anchor_desc","mceInsertAnchor"],newdocument:["newdocument_desc","mceNewDocument"],blockquote:["blockquote_desc","mceBlockQuote"]},stateControls:["bold","italic","underline","strikethrough","bullist","numlist","justifyleft","justifycenter","justifyright","justifyfull","blockquote"],init:function(J,K){var L=this,M,I,N;L.editor=J;L.url=K;L.onResolveName=new E.util.Dispatcher(this);L.settings=M=H({theme_advanced_path:true,theme_advanced_toolbar_location:"bottom",theme_advanced_buttons1:"bold,italic,underline,strikethrough,|,justifyleft,justifycenter,justifyright,justifyfull,|,styleselect,formatselect",theme_advanced_buttons2:"bullist,numlist,|,outdent,indent,|,undo,redo,|,link,unlink,anchor,image,cleanup,help,code",theme_advanced_buttons3:"hr,removeformat,visualaid,|,sub,sup,|,charmap",theme_advanced_blockformats:"p,h1,h2,h3,h4,h5,h6,pre,address",theme_advanced_toolbar_align:"center",theme_advanced_fonts:"Andale Mono=andale mono,times;Arial=arial,helvetica,sans-serif;Arial Black=arial black,avant garde;Book Antiqua=book antiqua,palatino;Comic Sans MS=comic sans ms,sans-serif;Courier New=courier new,courier;Georgia=georgia,palatino;Helvetica=helvetica;Impact=impact,chicago;Symbol=symbol;Tahoma=tahoma,arial,helvetica,sans-serif;Terminal=terminal,monaco;Times New Roman=times new roman,times;Trebuchet MS=trebuchet ms,geneva;Verdana=verdana,geneva;Webdings=webdings;Wingdings=wingdings,zapf dingbats",theme_advanced_more_colors:1,theme_advanced_row_height:23,theme_advanced_resize_horizontal:1,theme_advanced_resizing_use_cookie:1,theme_advanced_font_sizes:"1,2,3,4,5,6,7",readonly:J.settings.readonly},J.settings);if(!M.font_size_style_values){M.font_size_style_values="8pt,10pt,12pt,14pt,18pt,24pt,36pt"}if(E.is(M.theme_advanced_font_sizes,"string")){M.font_size_style_values=E.explode(M.font_size_style_values);M.font_size_classes=E.explode(M.font_size_classes||"");N={};J.settings.theme_advanced_font_sizes=M.theme_advanced_font_sizes;F(J.getParam("theme_advanced_font_sizes","","hash"),function(Q,P){var O;if(P==Q&&Q>=1&&Q<=7){P=Q+" ("+L.sizes[Q-1]+"pt)";O=M.font_size_classes[Q-1];Q=M.font_size_style_values[Q-1]||(L.sizes[Q-1]+"pt")}if(/^\s*\./.test(Q)){O=Q.replace(/\./g,"")}N[P]=O?{"class":O}:{fontSize:Q}});M.theme_advanced_font_sizes=N}if((I=M.theme_advanced_path_location)&&I!="none"){M.theme_advanced_statusbar_location=M.theme_advanced_path_location}if(M.theme_advanced_statusbar_location=="none"){M.theme_advanced_statusbar_location=0}J.onInit.add(function(){if(!J.settings.readonly){J.onNodeChange.add(L._nodeChanged,L)}});J.onSetProgressState.add(function(Q,O,R){var S,T=Q.id,P;if(O){L.progressTimer=setTimeout(function(){S=Q.getContainer();S=S.insertBefore(D.create("DIV",{style:"position:relative"}),S.firstChild);P=D.get(Q.id+"_tbl");D.add(S,"div",{id:T+"_blocker","class":"mceBlocker",style:{width:P.clientWidth+2,height:P.clientHeight+2}});D.add(S,"div",{id:T+"_progress","class":"mceProgress",style:{left:P.clientWidth/2,top:P.clientHeight/2}})},R||0)}else{D.remove(T+"_blocker");D.remove(T+"_progress");clearTimeout(L.progressTimer)}});if(M.skin_variant){D.loadCSS(K+"/skins/"+J.settings.skin+"/ui_"+M.skin_variant+".css")}},createControl:function(L,I){var J,K;if(K=I.createControl(L)){return K}switch(L){case"styleselect":return this._createStyleSelect();case"formatselect":return this._createBlockFormats();case"fontselect":return this._createFontSelect();case"fontsizeselect":return this._createFontSizeSelect();case"forecolor":return this._createForeColorMenu();case"backcolor":return this._createBackColorMenu()}if((J=this.controls[L])){return I.createButton(L,{title:"advanced."+J[0],cmd:J[1],ui:J[2],value:J[3]})}},execCommand:function(K,J,L){var I=this["_"+K];if(I){I.call(this,J,L);return true}return false},_importClasses:function(K){var I=this.editor,J=I.controlManager.get("styleselect");if(J.getLength()==0){F(I.dom.getClasses(),function(N,L){var M="style_"+L;I.formatter.register(M,{inline:"span",classes:N["class"]});J.add(N["class"],M)})}},_createStyleSelect:function(M){var K=this,I=K.editor,J=I.controlManager,L;L=J.createListBox("styleselect",{title:"advanced.style_select",onselect:function(N){I.focus();I.formatter.toggle(N);return false}});I.onInit.add(function(){var O=0,N=I.getParam("style_formats");if(N){F(N,function(P){var Q,R=0;F(P,function(){R++});if(R>1){Q=P.name=P.name||"style_"+(O++);I.formatter.register(Q,P);L.add(P.title,Q)}else{L.add(P.title)}})}else{F(I.getParam("theme_advanced_styles","","hash"),function(R,Q){var P;if(R){P="style_"+(O++);I.formatter.register(P,{inline:"span",classes:R});L.add(K.editor.translate(Q),P)}})}});if(L.getLength()==0){L.onPostRender.add(function(N,O){if(!L.NativeListBox){B.add(O.id+"_text","focus",K._importClasses,K);B.add(O.id+"_text","mousedown",K._importClasses,K);B.add(O.id+"_open","focus",K._importClasses,K);B.add(O.id+"_open","mousedown",K._importClasses,K)}else{B.add(O.id,"focus",K._importClasses,K)}})}return L},_createFontSelect:function(){var K,J=this,I=J.editor;K=I.controlManager.createListBox("fontselect",{title:"advanced.fontdefault",onselect:function(L){I.execCommand("FontName",false,L);return false}});if(K){F(I.getParam("theme_advanced_fonts",J.settings.theme_advanced_fonts,"hash"),function(M,L){K.add(I.translate(L),M,{style:M.indexOf("dings")==-1?"font-family:"+M:""})})}return K},_createFontSizeSelect:function(){var L=this,J=L.editor,M,K=0,I=[];M=J.controlManager.createListBox("fontsizeselect",{title:"advanced.font_size",onselect:function(N){if(N.fontSize){J.execCommand("FontSize",false,N.fontSize)}else{F(L.settings.theme_advanced_font_sizes,function(P,O){if(P["class"]){I.push(P["class"])}});J.editorCommands._applyInlineStyle("span",{"class":N["class"]},{check_classes:I})}return false}});if(M){F(L.settings.theme_advanced_font_sizes,function(O,N){var P=O.fontSize;if(P>=1&&P<=7){P=L.sizes[parseInt(P)-1]+"pt"}M.add(N,O,{style:"font-size:"+P,"class":"mceFontSize"+(K++)+(" "+(O["class"]||""))})})}return M},_createBlockFormats:function(){var K,I={p:"advanced.paragraph",address:"advanced.address",pre:"advanced.pre",h1:"advanced.h1",h2:"advanced.h2",h3:"advanced.h3",h4:"advanced.h4",h5:"advanced.h5",h6:"advanced.h6",div:"advanced.div",blockquote:"advanced.blockquote",code:"advanced.code",dt:"advanced.dt",dd:"advanced.dd",samp:"advanced.samp"},J=this;K=J.editor.controlManager.createListBox("formatselect",{title:"advanced.block",cmd:"FormatBlock"});if(K){F(J.editor.getParam("theme_advanced_blockformats",J.settings.theme_advanced_blockformats,"hash"),function(M,L){K.add(J.editor.translate(L!=M?L:I[M]),M,{"class":"mce_formatPreview mce_"+M})})}return K},_createForeColorMenu:function(){var M,J=this,K=J.settings,L={},I;if(K.theme_advanced_more_colors){L.more_colors_func=function(){J._mceColorPicker(0,{color:M.value,func:function(N){M.setColor(N)}})}}if(I=K.theme_advanced_text_colors){L.colors=I}if(K.theme_advanced_default_foreground_color){L.default_color=K.theme_advanced_default_foreground_color}L.title="advanced.forecolor_desc";L.cmd="ForeColor";L.scope=this;M=J.editor.controlManager.createColorSplitButton("forecolor",L);return M},_createBackColorMenu:function(){var M,J=this,K=J.settings,L={},I;if(K.theme_advanced_more_colors){L.more_colors_func=function(){J._mceColorPicker(0,{color:M.value,func:function(N){M.setColor(N)}})}}if(I=K.theme_advanced_background_colors){L.colors=I}if(K.theme_advanced_default_background_color){L.default_color=K.theme_advanced_default_background_color}L.title="advanced.backcolor_desc";L.cmd="HiliteColor";L.scope=this;M=J.editor.controlManager.createColorSplitButton("backcolor",L);return M},renderUI:function(K){var M,L,N,Q=this,O=Q.editor,R=Q.settings,P,J,I;M=J=D.create("span",{id:O.id+"_parent","class":"mceEditor "+O.settings.skin+"Skin"+(R.skin_variant?" "+O.settings.skin+"Skin"+Q._ufirst(R.skin_variant):"")});if(!D.boxModel){M=D.add(M,"div",{"class":"mceOldBoxModel"})}M=P=D.add(M,"table",{id:O.id+"_tbl","class":"mceLayout",cellSpacing:0,cellPadding:0});M=N=D.add(M,"tbody");switch((R.theme_advanced_layout_manager||"").toLowerCase()){case"rowlayout":L=Q._rowLayout(R,N,K);break;case"customlayout":L=O.execCallback("theme_advanced_custom_layout",R,N,K,J);break;default:L=Q._simpleLayout(R,N,K,J)}M=K.targetNode;I=D.stdMode?P.getElementsByTagName("tr"):P.rows;D.addClass(I[0],"mceFirst");D.addClass(I[I.length-1],"mceLast");F(D.select("tr",N),function(S){D.addClass(S.firstChild,"mceFirst");D.addClass(S.childNodes[S.childNodes.length-1],"mceLast")});if(D.get(R.theme_advanced_toolbar_container)){D.get(R.theme_advanced_toolbar_container).appendChild(J)}else{D.insertAfter(J,M)}B.add(O.id+"_path_row","click",function(S){S=S.target;if(S.nodeName=="A"){Q._sel(S.className.replace(/^.*mcePath_([0-9]+).*$/,"$1"));return B.cancel(S)}});if(!O.getParam("accessibility_focus")){B.add(D.add(J,"a",{href:"#"},"<!-- IE -->"),"focus",function(){tinyMCE.get(O.id).focus()})}if(R.theme_advanced_toolbar_location=="external"){K.deltaHeight=0}Q.deltaHeight=K.deltaHeight;K.targetNode=null;return{iframeContainer:L,editorContainer:O.id+"_parent",sizeContainer:P,deltaHeight:K.deltaHeight}},getInfo:function(){return{longname:"Advanced theme",author:"Moxiecode Systems AB",authorurl:"http://tinymce.moxiecode.com",version:E.majorVersion+"."+E.minorVersion}},resizeBy:function(I,J){var K=D.get(this.editor.id+"_tbl");this.resizeTo(K.clientWidth+I,K.clientHeight+J)},resizeTo:function(I,L){var J=this.editor,K=J.settings,N=D.get(J.id+"_tbl"),O=D.get(J.id+"_ifr"),M;L=Math.max(K.theme_advanced_resizing_min_height||100,L);L=Math.min(K.theme_advanced_resizing_max_height||65535,L);if(I){I=Math.max(K.theme_advanced_resizing_min_width||100,I);I=Math.min(K.theme_advanced_resizing_max_width||65535,I)}M=document.getElementById(J.id+"_toolbar1").parentNode.clientHeight;D.setStyle(O,"height",L-M);D.setStyle(N,"height",L);if(I){D.setStyle(N,"width",I)}},destroy:function(){var I=this.editor.id;B.clear(I+"_resize");B.clear(I+"_path_row");B.clear(I+"_external_close")},_simpleLayout:function(T,O,K,I){var S=this,P=S.editor,Q=T.theme_advanced_toolbar_location,M=T.theme_advanced_statusbar_location,L,J,N,R;if(T.readonly){L=D.add(O,"tr");L=J=D.add(L,"td",{"class":"mceIframeContainer"});return J}if(Q=="top"){S._addToolbars(O,K)}if(Q=="external"){L=R=D.create("div",{style:"position:relative"});L=D.add(L,"div",{id:P.id+"_external","class":"mceExternalToolbar"});D.add(L,"a",{id:P.id+"_external_close",href:"javascript:;","class":"mceExternalClose"});L=D.add(L,"table",{id:P.id+"_tblext",cellSpacing:0,cellPadding:0});N=D.add(L,"tbody");if(I.firstChild.className=="mceOldBoxModel"){I.firstChild.appendChild(R)}else{I.insertBefore(R,I.firstChild)}S._addToolbars(N,K);P.onMouseUp.add(function(){var V=D.get(P.id+"_external");D.show(V);D.hide(G);var U=B.add(P.id+"_external_close","click",function(){D.hide(P.id+"_external");B.remove(P.id+"_external_close","click",U)});D.show(V);D.setStyle(V,"top",0-D.getRect(P.id+"_tblext").h-1);D.hide(V);D.show(V);V.style.filter="";G=P.id+"_external";V=null})}if(M=="top"){S._addStatusBar(O,K)}if(!T.theme_advanced_toolbar_container){L=D.add(O,"tr");L=J=D.add(L,"td",{"class":"mceIframeContainer"})}if(Q=="bottom"){S._addToolbars(O,K)}if(M=="bottom"){S._addStatusBar(O,K)}return J},_rowLayout:function(S,M,K){var R=this,N=R.editor,Q,T,I=N.controlManager,L,J,P,O;Q=S.theme_advanced_containers_default_class||"";T=S.theme_advanced_containers_default_align||"center";F(C(S.theme_advanced_containers||""),function(W,V){var U=S["theme_advanced_container_"+W]||"";switch(U.toLowerCase()){case"mceeditor":L=D.add(M,"tr");L=J=D.add(L,"td",{"class":"mceIframeContainer"});break;case"mceelementpath":R._addStatusBar(M,K);break;default:O=(S["theme_advanced_container_"+W+"_align"]||T).toLowerCase();O="mce"+R._ufirst(O);L=D.add(D.add(M,"tr"),"td",{"class":"mceToolbar "+(S["theme_advanced_container_"+W+"_class"]||Q)+" "+O||T});P=I.createToolbar("toolbar"+V);R._addControls(U,P);D.setHTML(L,P.renderHTML());K.deltaHeight-=S.theme_advanced_row_height}});return J},_addControls:function(J,I){var K=this,L=K.settings,M,N=K.editor.controlManager;if(L.theme_advanced_disable&&!K._disabled){M={};F(C(L.theme_advanced_disable),function(O){M[O]=1});K._disabled=M}else{M=K._disabled}F(C(J),function(P){var O;if(M&&M[P]){return }if(P=="tablecontrols"){F(["table","|","row_props","cell_props","|","row_before","row_after","delete_row","|","col_before","col_after","delete_col","|","split_cells","merge_cells"],function(Q){Q=K.createControl(Q,N);if(Q){I.add(Q)}});return }O=K.createControl(P,N);if(O){I.add(O)}})},_addToolbars:function(Q,J){var T=this,M,L,O=T.editor,U=T.settings,S,I=O.controlManager,P,K,N=[],R;R=U.theme_advanced_toolbar_align.toLowerCase();R="mce"+T._ufirst(R);K=D.add(D.add(Q,"tr"),"td",{"class":"mceToolbar "+R});if(!O.getParam("accessibility_focus")){N.push(D.createHTML("a",{href:"#",onfocus:"tinyMCE.get('"+O.id+"').focus();"},"<!-- IE -->"))}N.push(D.createHTML("a",{href:"#",accesskey:"q",title:O.getLang("advanced.toolbar_focus")},"<!-- IE -->"));for(M=1;(S=U["theme_advanced_buttons"+M]);M++){L=I.createToolbar("toolbar"+M,{"class":"mceToolbarRow"+M});if(U["theme_advanced_buttons"+M+"_add"]){S+=","+U["theme_advanced_buttons"+M+"_add"]}if(U["theme_advanced_buttons"+M+"_add_before"]){S=U["theme_advanced_buttons"+M+"_add_before"]+","+S}T._addControls(S,L);N.push(L.renderHTML());J.deltaHeight-=U.theme_advanced_row_height}N.push(D.createHTML("a",{href:"#",accesskey:"z",title:O.getLang("advanced.toolbar_focus"),onfocus:"tinyMCE.getInstanceById('"+O.id+"').focus();"},"<!-- IE -->"));D.setHTML(K,N.join(""))},_addStatusBar:function(M,J){var K,Q=this,N=Q.editor,R=Q.settings,I,O,P,L;K=D.add(M,"tr");K=L=D.add(K,"td",{"class":"mceStatusbar"});K=D.add(K,"div",{id:N.id+"_path_row"},R.theme_advanced_path?N.translate("advanced.path")+": ":"&#160;");D.add(K,"a",{href:"#",accesskey:"x"});if(R.theme_advanced_resizing){D.add(L,"a",{id:N.id+"_resize",href:"javascript:;",onclick:"return false;","class":"mceResize"});if(R.theme_advanced_resizing_use_cookie){N.onPostRender.add(function(){var S=A.getHash("TinyMCE_"+N.id+"_size"),T=D.get(N.id+"_tbl");if(!S){return }if(R.theme_advanced_resize_horizontal){T.style.width=Math.max(10,S.cw)+"px"}T.style.height=Math.max(10,S.ch)+"px";D.get(N.id+"_ifr").style.height=Math.max(10,parseInt(S.ch)+Q.deltaHeight)+"px"})}N.onPostRender.add(function(){B.add(N.id+"_resize","mousedown",function(W){var Y,V,S,U,X,T;Y=D.get(N.id+"_tbl");S=Y.clientWidth;U=Y.clientHeight;miw=R.theme_advanced_resizing_min_width||100;mih=R.theme_advanced_resizing_min_height||100;maw=R.theme_advanced_resizing_max_width||65535;mah=R.theme_advanced_resizing_max_height||65535;V=D.add(D.get(N.id+"_parent"),"div",{"class":"mcePlaceHolder"});D.setStyles(V,{width:S,height:U});D.hide(Y);D.show(V);I={x:W.screenX,y:W.screenY,w:S,h:U,dx:null,dy:null};O=B.add(D.doc,"mousemove",function(b){var Z,a;I.dx=b.screenX-I.x;I.dy=b.screenY-I.y;Z=Math.max(miw,I.w+I.dx);a=Math.max(mih,I.h+I.dy);Z=Math.min(maw,Z);a=Math.min(mah,a);if(R.theme_advanced_resize_horizontal){V.style.width=Z+"px"}V.style.height=a+"px";return B.cancel(b)});P=B.add(D.doc,"mouseup",function(Z){var a;B.remove(D.doc,"mousemove",O);B.remove(D.doc,"mouseup",P);Y.style.display="";D.remove(V);if(I.dx===null){return }a=D.get(N.id+"_ifr");if(R.theme_advanced_resize_horizontal){Y.style.width=Math.max(10,I.w+I.dx)+"px"}Y.style.height=Math.max(10,I.h+I.dy)+"px";a.style.height=Math.max(10,a.clientHeight+I.dy)+"px";if(R.theme_advanced_resizing_use_cookie){A.setHash("TinyMCE_"+N.id+"_size",{cw:I.w+I.dx,ch:I.h+I.dy})}});return B.cancel(W)})})}J.deltaHeight-=21;K=M=null},_nodeChanged:function(N,S,L,Q,J){var V=this,I,R=0,U,O,W=V.settings,T,K,P;E.each(V.stateControls,function(X){S.setActive(X,N.queryCommandState(V.controls[X][1]))});if(["H1","H2","H3","H4","H5","H6"].indexOf(L.nodeName)!=-1){S.setActive("bold",false)}if(O=="bold"&&N.dom.isBlock(L)){S.setActive(O,false);return }function M(Y){var Z,X=J.parents,a=Y;if(typeof (Y)=="string"){a=function(b){return b.nodeName==Y}}for(Z=0;Z<X.length;Z++){if(a(X[Z])){return X[Z]}}}S.setActive("visualaid",N.hasVisual);S.setDisabled("undo",!N.undoManager.hasUndo()&&!N.typing);S.setDisabled("redo",!N.undoManager.hasRedo());S.setDisabled("outdent",!N.queryCommandState("Outdent"));I=M("A");if(O=S.get("link")){if(!I||!I.name){O.setActive(!!I)}}if(O=S.get("unlink")){O.setDisabled(!I&&Q);O.setActive(!!I&&!I.name)}if(O=S.get("anchor")){O.setActive(!!I&&I.name);if(E.isWebKit){I=M("IMG");O.setActive(!!I&&D.getAttrib(I,"mce_name")=="a")}}I=M("IMG");if(O=S.get("image")){O.setActive(!!I&&L.className.indexOf("mceItem")==-1)}if(O=S.get("styleselect")){V._importClasses();O.select(function(X){return !!N.formatter.match(X)})}if(O=S.get("formatselect")){I=M(D.isBlock);if(I){O.select(I.nodeName.toLowerCase())}}M(function(X){if(X.nodeName==="SPAN"){if(!T&&X.className){T=X.className}if(!K&&X.style.fontSize){K=X.style.fontSize}if(!P&&X.style.fontFamily){P=X.style.fontFamily.replace(/[\"\']+/g,"").replace(/^([^,]+).*/,"$1").toLowerCase()}}return false});if(O=S.get("fontselect")){O.select(function(X){return X.replace(/^([^,]+).*/,"$1").toLowerCase()==P})}if(O=S.get("fontsizeselect")){if(W.theme_advanced_runtime_fontsize&&!K&&!T){K=N.dom.getStyle(L,"fontSize",true)}O.select(function(X){if(X.fontSize&&X.fontSize===K){return true}if(X["class"]&&X["class"]===T){return true}})}if(W.theme_advanced_path&&W.theme_advanced_statusbar_location){I=D.get(N.id+"_path")||D.add(N.id+"_path_row","span",{id:N.id+"_path"});D.setHTML(I,"");M(function(b){var X=b.nodeName.toLowerCase(),Y,a,Z="";if(b.nodeType!=1||b.nodeName==="BR"||(D.hasClass(b,"mceItemHidden")||D.hasClass(b,"mceItemRemoved"))){return }if(U=D.getAttrib(b,"mce_name")){X=U}if(E.isIE&&b.scopeName!=="HTML"){X=b.scopeName+":"+X}X=X.replace(/mce\:/g,"");switch(X){case"b":X="strong";break;case"i":X="em";break;case"img":if(U=D.getAttrib(b,"src")){Z+="src: "+U+" "}break;case"a":if(U=D.getAttrib(b,"name")){Z+="name: "+U+" ";X+="#"+U}if(U=D.getAttrib(b,"href")){Z+="href: "+U+" "}break;case"font":if(W.convert_fonts_to_spans){X="span"}if(U=D.getAttrib(b,"face")){Z+="font: "+U+" "}if(U=D.getAttrib(b,"size")){Z+="size: "+U+" "}if(U=D.getAttrib(b,"color")){Z+="color: "+U+" "}break;case"span":if(U=D.getAttrib(b,"style")){Z+="style: "+U+" "}break}if(U=D.getAttrib(b,"id")){Z+="id: "+U+" "}if(U=b.className){U=U.replace(/\b\s*(webkit|mce|Apple-)\w+\s*\b/g,"");if(U){Z+="class: "+U+" ";if(D.isBlock(b)||X=="img"||X=="span"){X+="."+U}}}X=X.replace(/(html:)/g,"");X={name:X,node:b,title:Z};V.onResolveName.dispatch(V,X);Z=X.title;X=X.name;a=D.create("a",{href:"javascript:;",onmousedown:"return false;",title:Z,"class":"mcePath_"+(R++)},X);if(I.hasChildNodes()){I.insertBefore(D.doc.createTextNode(" \u00bb "),I.firstChild);I.insertBefore(a,I.firstChild)}else{I.appendChild(a)}},N.getBody())}},_sel:function(I){this.editor.execCommand("mceSelectNodeDepth",false,I)},_mceInsertAnchor:function(K,J){var I=this.editor;I.windowManager.open({url:E.baseURL+"/themes/advanced/anchor.htm",width:320+parseInt(I.getLang("advanced.anchor_delta_width",0)),height:90+parseInt(I.getLang("advanced.anchor_delta_height",0)),inline:true},{theme_url:this.url})},_mceCharMap:function(){var I=this.editor;I.windowManager.open({url:E.baseURL+"/themes/advanced/charmap.htm",width:550+parseInt(I.getLang("advanced.charmap_delta_width",0)),height:250+parseInt(I.getLang("advanced.charmap_delta_height",0)),inline:true},{theme_url:this.url})},_mceHelp:function(){var I=this.editor;I.windowManager.open({url:E.baseURL+"/themes/advanced/about.htm",width:480,height:380,inline:true},{theme_url:this.url})},_mceColorPicker:function(K,J){var I=this.editor;J=J||{};new PBwiki.DialogCommands.SelectColor({color:c.value,onSelected:J.func})},_mceCodeEditor:function(J,K){var I=this.editor;I.windowManager.open({url:E.baseURL+"/themes/advanced/source_editor.htm",width:parseInt(I.getParam("theme_advanced_source_editor_width",720)),height:parseInt(I.getParam("theme_advanced_source_editor_height",580)),inline:true,resizable:true,maximizable:true},{theme_url:this.url})},_mceImage:function(J,L){var I=this.editor;if(I.dom.getAttrib(I.selection.getNode(),"class").indexOf("mceItem")!=-1){return }var K=I.selection.getBookmark();(new PBwiki.DialogCommands.EditImage({sel:I.selection,onComplete:function(){I.execCommand("mceRepaint");I.selection.moveToBookmark(K)}}))},_mceLink:function(J,K){var I=this.editor;I.windowManager.open({url:E.baseURL+"/themes/advanced/link.htm",width:310+parseInt(I.getLang("advanced.link_delta_width",0)),height:200+parseInt(I.getLang("advanced.link_delta_height",0)),inline:true},{theme_url:this.url})},_mceNewDocument:function(){var I=this.editor;I.windowManager.confirm("advanced.newdocument",function(J){if(J){I.execCommand("mceSetContent",false,"")}})},_mceForeColor:function(){var I=this;this._mceColorPicker(0,{color:I.fgColor,func:function(J){I.fgColor=J;I.editor.execCommand("ForeColor",false,J)}})},_mceBackColor:function(){var I=this;this._mceColorPicker(0,{color:I.bgColor,func:function(J){I.bgColor=J;I.editor.execCommand("HiliteColor",false,J)}})},_ufirst:function(I){return I.substring(0,1).toUpperCase()+I.substring(1)}});E.ThemeManager.add("advanced",E.themes.AdvancedTheme)}(tinymce));tinyMCE.addI18n("en.advanced",{style_select:"Styles",font_size:"Size",fontdefault:"Font",block:"Format",paragraph:"Normal",div:"Div",address:"Address",pre:"Preformatted",h1:"Heading 1",h2:"Heading 2",h3:"Heading 3",h4:"Heading 4",h5:"Heading 5",h6:"Heading 6",blockquote:"Blockquote",code:"Code",samp:"Code sample",dt:"Definition term ",dd:"Definition description",bold_desc:"Bold",italic_desc:"Italic",underline_desc:"Underline",striketrough_desc:"Strikethrough",justifyleft_desc:"Align text left",justifycenter_desc:"Center",justifyright_desc:"Align text right",justifyfull_desc:"Justify",bullist_desc:"Bullets",numlist_desc:"Numbering",outdent_desc:"Decrease indent",indent_desc:"Increase indent",undo_desc:"Undo",redo_desc:"Redo",link_desc:"Insert/edit link",unlink_desc:"Unlink",image_desc:"Insert/edit image",cleanup_desc:"Clean up messy code",code_desc:"Edit HTML source",sub_desc:"Subscript",sup_desc:"Superscript",hr_desc:"Insert horizontal rule",removeformat_desc:"Remove formatting",custom1_desc:"Your custom description here",forecolor_desc:"Text color",backcolor_desc:"Background color",charmap_desc:"Insert custom character",visualaid_desc:"Toggle guidelines/invisible elements",anchor_desc:"Insert/edit anchor",cut_desc:"Cut",copy_desc:"Copy",paste_desc:"Paste",image_props_desc:"Image properties",newdocument_desc:"New document",help_desc:"Help",blockquote_desc:"Blockquote",clipboard_msg:"Copy/Cut/Paste is not available in Mozilla and Firefox.\r\nDo you want more information about this issue?",path:"Path",newdocument:"Are you sure you want clear all contents?",toolbar_focus:"Jump to tool buttons - Alt+Q, Jump to editor - Alt-Z, Jump to element path - Alt-X",more_colors:"More colors"});(function(){var A=tinymce.dom.Event,C=tinymce.grep,D=tinymce.each,B=tinymce.inArray;function E(I,H,G){var F,J;F=I.createTreeWalker(H,NodeFilter.SHOW_ALL,null,false);while(J=F.nextNode()){if(G){if(!G(J)){return false}}if(J.nodeType==3&&J.nodeValue&&/[^\s\u00a0]+/.test(J.nodeValue)){return false}if(J.nodeType==1&&/^(HR|IMG|TABLE)$/.test(J.nodeName)){return false}}return true}tinymce.create("tinymce.plugins.Safari",{init:function(F){var G=this,H;if(!tinymce.isWebKit){return }G.editor=F;G.webKitFontSizes=["x-small","small","medium","large","x-large","xx-large","-webkit-xxx-large"];G.namedFontSizes=["xx-small","x-small","small","medium","large","x-large","xx-large"];F.addCommand("CreateLink",function(K,J){var M=F.selection.getNode(),L=F.dom,I;if(M&&(/^(left|right)$/i.test(L.getStyle(M,"float",1))||/^(left|right)$/i.test(L.getAttrib(M,"align")))){I=L.create("a",{href:J},M.cloneNode());M.parentNode.replaceChild(I,M);F.selection.select(I)}else{F.getDoc().execCommand("CreateLink",false,J)}});F.onKeyUp.add(function(J,N){var L,I,M,O,K;if(N.keyCode==46||N.keyCode==8){I=J.getBody();L=I.innerHTML;K=J.selection;if(I.childNodes.length==1&&!/<(img|hr)/.test(L)&&tinymce.trim(L.replace(/<[^>]+>/g,"")).length==0){J.setContent('<p><br mce_bogus="1" /></p>',{format:"raw"});O=I.firstChild;M=K.getRng();M.setStart(O,0);M.setEnd(O,0);K.setRng(M)}}});F.addCommand("FormatBlock",function(J,I){var L=F.dom,K=L.getParent(F.selection.getNode(),L.isBlock);if(K){L.replace(L.create(I),K,1)}else{F.getDoc().execCommand("FormatBlock",false,I)}});F.addCommand("mceInsertContent",function(J,I){F.getDoc().execCommand("InsertText",false,"mce_marker");F.getBody().innerHTML=F.getBody().innerHTML.replace(/mce_marker/g,F.dom.processHTML(I)+'<span id="_mce_tmp">XX</span>');F.selection.select(F.dom.get("_mce_tmp"));F.getDoc().execCommand("Delete",false," ")});F.onKeyPress.add(function(N,O){var P,U,Q,L,J,K,I,T,M,S,R;if(O.keyCode==13){I=N.selection;P=I.getNode();if(O.shiftKey||N.settings.force_br_newlines&&P.nodeName!="LI"){G._insertBR(N);A.cancel(O)}if(U=H.getParent(P,"LI")){Q=H.getParent(U,"OL,UL");T=N.getDoc();R=H.create("p");H.add(R,"br",{mce_bogus:"1"});if(E(T,U)){if(K=H.getParent(Q.parentNode,"LI,OL,UL")){return }K=H.getParent(Q,"p,h1,h2,h3,h4,h5,h6,div")||Q;L=T.createRange();L.setStartBefore(K);L.setEndBefore(U);J=T.createRange();J.setStartAfter(U);J.setEndAfter(K);M=L.cloneContents();S=J.cloneContents();if(!E(T,S)){H.insertAfter(S,K)}H.insertAfter(R,K);if(!E(T,M)){H.insertAfter(M,K)}H.remove(K);K=R.firstChild;L=T.createRange();L.setStartBefore(K);L.setEndBefore(K);I.setRng(L);return A.cancel(O)}}}});F.onExecCommand.add(function(I,K){var J,M,N,L;if(K=="InsertUnorderedList"||K=="InsertOrderedList"){J=I.selection;M=I.dom;if(N=M.getParent(J.getNode(),function(O){return/^(H[1-6]|P|ADDRESS|PRE)$/.test(O.nodeName)})){L=J.getBookmark();M.remove(N,1);J.moveToBookmark(L)}}});F.onContextMenu.add(function(I,J){if(J.target.nodeName=="IMG"){G.selElm=J.target;I.selection.select(J.target);J.preventDefault()}});F.onInit.add(function(){G._fixWebKitSpans()});F.onSetContent.add(function(){H=F.dom;D(["strong","b","em","u","strike","sub","sup","a"],function(I){D(C(H.select(I)).reverse(),function(L){var K=L.nodeName.toLowerCase(),J;if(K=="a"){if(L.name&&H.isEmpty(L)){H.replace(H.create("img",{mce_name:"a",name:L.name,"class":"mceItemAnchor"}),L)}return }switch(K){case"b":case"strong":if(K=="b"){K="strong"}J="font-weight: bold;";break;case"em":J="font-style: italic;";break;case"u":J="text-decoration: underline;";break;case"sub":J="vertical-align: sub;";break;case"sup":J="vertical-align: super;";break;case"strike":J="text-decoration: line-through;";break}H.replace(H.create("span",{mce_name:K,style:J,"class":"Apple-style-span"}),L,1)})})});F.onPreProcess.add(function(I,J){H=I.dom;D(C(J.node.getElementsByTagName("span")).reverse(),function(M){var K,L;if(J.get){if(H.hasClass(M,"Apple-style-span")){L=M.style.backgroundColor;switch(H.getAttrib(M,"mce_name")){case"font":if(!I.settings.convert_fonts_to_spans){H.setAttrib(M,"style","")}break;case"strong":case"em":case"sub":case"sup":H.setAttrib(M,"style","");break;case"strike":case"u":if(!I.settings.inline_styles){H.setAttrib(M,"style","")}else{H.setAttrib(M,"mce_name","")}break;default:if(!I.settings.inline_styles){H.setAttrib(M,"style","")}}if(L){M.style.backgroundColor=L}}}if(H.hasClass(M,"mceItemRemoved")){H.remove(M,1)}})});F.onPostProcess.add(function(I,J){J.content=J.content.replace(/<br \/><\/(h[1-6]|div|p|address|pre)>/g,"</$1>");J.content=J.content.replace(/ id=\"undefined\"/g,"")})},getInfo:function(){return{longname:"Safari compatibility",author:"Moxiecode Systems AB",authorurl:"http://tinymce.moxiecode.com",infourl:"http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/safari",version:tinymce.majorVersion+"."+tinymce.minorVersion}},_fixWebKitSpans:function(){var G=this,F=G.editor;A.add(F.getDoc(),"DOMNodeInserted",function(H){H=H.target;if(H&&H.nodeType==1){G._fixAppleSpan(H)}})},_fixAppleSpan:function(L){var G=this.editor,M=G.dom,I=this.webKitFontSizes,F=this.namedFontSizes,J=G.settings,H,K;if(M.getAttrib(L,"mce_fixed")){return }if(L.nodeName=="SPAN"&&L.className=="Apple-style-span"){H=L.style;if(!J.convert_fonts_to_spans){if(H.fontSize){M.setAttrib(L,"mce_name","font");M.setAttrib(L,"size",B(I,H.fontSize)+1)}if(H.fontFamily){M.setAttrib(L,"mce_name","font");M.setAttrib(L,"face",H.fontFamily)}if(H.color){M.setAttrib(L,"mce_name","font");M.setAttrib(L,"color",M.toHex(H.color))}if(H.backgroundColor){M.setAttrib(L,"mce_name","font");M.setStyle(L,"background-color",H.backgroundColor)}}else{if(H.fontSize){M.setStyle(L,"fontSize",F[B(I,H.fontSize)])}}if(H.fontWeight=="bold"){M.setAttrib(L,"mce_name","strong")}if(H.fontStyle=="italic"){M.setAttrib(L,"mce_name","em")}if(H.textDecoration=="underline"){M.setAttrib(L,"mce_name","u")}if(H.textDecoration=="line-through"){M.setAttrib(L,"mce_name","strike")}if(H.verticalAlign=="super"){M.setAttrib(L,"mce_name","sup")}if(H.verticalAlign=="sub"){M.setAttrib(L,"mce_name","sub")}M.setAttrib(L,"mce_fixed","1")}},_insertBR:function(F){var J=F.dom,H=F.selection,I=H.getRng(),G;I.insertNode(G=J.create("br"));I.setStartAfter(G);I.setEndAfter(G);H.setRng(I);if(H.getSel().focusNode==G.previousSibling){H.select(J.insertAfter(J.doc.createTextNode("\u00a0"),G));H.collapse(1)}F.getWin().scrollTo(0,J.getPos(H.getRng().startContainer).y)}});tinymce.PluginManager.add("safari",tinymce.plugins.Safari)})();(function(){var A=tinymce.each;tinymce.create("tinymce.plugins.PastePlugin",{init:function(C,D){var E=this,B;E.editor=C;E.url=D;E.onPreProcess=new tinymce.util.Dispatcher(E);E.onPostProcess=new tinymce.util.Dispatcher(E);E.onPreProcess.add(E._preProcess);E.onPostProcess.add(E._postProcess);E.onPreProcess.add(function(H,I){C.execCallback("paste_preprocess",H,I)});E.onPostProcess.add(function(H,I){C.execCallback("paste_postprocess",H,I)});function G(J){var I=C.dom;E.onPreProcess.dispatch(E,J);J.node=I.create("div",0,J.content);C.dom.doc.body.appendChild(J.node);E.onPostProcess.dispatch(E,J);var H=false;if(C.dom.select("table",J.node).length>0){H=true;tinymce.each(J.node.childNodes,function(K){if(K.nodeName.toUpperCase()!="TABLE"&&!C.dom.isEmpty(K)){H=false;return false}})}C.dom.doc.body.removeChild(J.node);J.content=C.serializer.serialize(J.node,{getInner:1});if(H){E._insertMergeTable(C,I,J.content)}else{if(/<(p|h[1-6]|ul|ol)/.test(J.content)){E._insertBlockContent(C,I,J.content)}else{E._insert(J.content)}}I.combineAllAdjacentLists()}C.addCommand("mceInsertClipboardContent",function(H,I){G(I)});function F(P){var L,N,I,K=C.selection,M=C.dom,O=C.getBody(),H;if(M.get("_mcePaste")){return }L=M.add(O,"div",{id:"_mcePaste"},"\uFEFF");if(O!=C.getDoc().body){H=M.getPos(C.selection.getStart(),O).y}else{H=O.scrollTop}M.setStyles(L,{position:"absolute",left:-10000,top:H,width:1,height:1,overflow:"hidden"});if(tinymce.isIE){var J=C.selection.getPBBookmark();I=M.doc.body.createTextRange();I.moveToElementText(L);I.select();M.doc.execCommand("Paste");M.remove(L);C.selection.moveToPBBookmark(J);if(L.innerHTML==="\uFEFF"){C.execCommand("mcePasteWord");P.preventDefault();return }G({content:L.innerHTML});return tinymce.dom.Event.cancel(P)}else{var J=C.selection.getPBBookmark();L=L.firstChild;I=C.getDoc().createRange();I.setStart(L,0);I.setEnd(L,1);K.setRng(I);window.setTimeout(function(){var S="",Q=M.select("div[id=_mcePaste]");var R=function(V){if(!V){return false}var U=M.getParents(V);for(var T=0;T<U.length;T++){if(U[T].getAttribute("id")=="_mcePaste"){return true}}return false};A(Q,function(T){if(!R(T.parentNode)){S+=T.innerHTML.replace(/id="?_mcePaste"?/g,"")}});A(Q,function(T){M.remove(T)});C.selection.moveToPBBookmark(J);G({content:S})},0)}}if(C.getParam("paste_auto_cleanup_on_paste",true)){if(tinymce.isOpera||/Firefox\/2/.test(navigator.userAgent)){C.onKeyDown.add(function(H,I){if(((tinymce.isMac?I.metaKey:I.ctrlKey)&&I.keyCode==86)||(I.shiftKey&&I.keyCode==45)){F(I)}})}else{C.onPaste.addToTop(function(H,I){return F(I)})}}if(C.getParam("paste_block_drop")){C.onInit.add(function(){C.dom.bind(C.getBody(),["dragend","dragover","draggesture","dragdrop","drop","drag"],function(H){H.preventDefault();H.stopPropagation();return false})})}E._legacySupport()},getInfo:function(){return{longname:"Paste text/word",author:"Moxiecode Systems AB",authorurl:"http://tinymce.moxiecode.com",infourl:"http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/paste",version:tinymce.majorVersion+"."+tinymce.minorVersion}},_preProcess:function(D,H){var B=this.editor,C=H.content,G,F;function G(I){A(I,function(J){if(J.constructor==RegExp){C=C.replace(J,"")}else{C=C.replace(J[0],J[1])}})}if(/(class=\"?Mso|style=\"[^\"]*\bmso\-|w:WordDocument)/.test(C)||H.wordContent){H.wordContent=true;G([/^\s*(&nbsp;)+/g,/(&nbsp;|<br[^>]*>)+\s*$/g]);if(B.getParam("paste_convert_middot_lists",true)){G([[/<!--\[if !supportLists\]-->/gi,"$&__MCE_ITEM__"],[/(<span[^>]+:\s*symbol[^>]+>)/gi,"$1__MCE_ITEM__"],[/(<span[^>]+mso-list:[^>]+>)/gi,"$1__MCE_ITEM__"]])}G([/<!--[\s\S]+?-->/gi,/<\/?(img|font|meta|link|style|div|v:\w+)[^>]*>/gi,/<\\?\?xml[^>]*>/gi,/<\/?o:[^>]*>/gi,/ (id|name|language|type|on\w+|v:\w+)=\"([^\"]*)\"/gi,/ (id|name|language|type|on\w+|v:\w+)=(\w+)/gi,[/<(\/?)s>/gi,"<$1strike>"],/<script[^>]+>[\s\S]*?<\/script>/gi,[/&nbsp;/g,"\u00a0"]]);if(!B.getParam("paste_retain_style_properties")){G([/<\/?(span)[^>]*>/gi])}}F=B.getParam("paste_strip_class_attributes");if(F!="none"){function E(L,I){var K,J="";if(F=="all"){return""}I=tinymce.explode(I," ");for(K=I.length-1;K>=0;K--){if(!/^(Mso)/i.test(I[K])){J+=(!J?"":" ")+I[K]}}return' class="'+J+'"'}G([[/ class=\"([^\"]*)\"/gi,E],[/ class=(\w+)/gi,E]])}if(B.getParam("paste_remove_spans")){G([/<\/?(span)[^>]*>/gi])}if(tinymce.isWebKit){G([/<br[^>]*>$/gi])}H.content=C},_postProcess:function(E,G){var D=this,C=D.editor,F=C.dom,B;if(G.wordContent){A(F.select("a",G.node),function(H){if(!H.href||H.href.indexOf("#_Toc")!=-1){F.remove(H,1)}});if(D.editor.getParam("paste_convert_middot_lists",true)){D._convertLists(E,G)}}},_convertLists:function(E,C){var G=E.editor.dom,F,J,B=-1,D,K=[],I,H;A(G.select("p",C.node),function(Q){var N,R="",P,O,L,M;for(N=Q.firstChild;N&&N.nodeType==3;N=N.nextSibling){R+=N.nodeValue}R=Q.innerHTML.replace(/<\/?\w+[^>]*>/gi,"").replace(/&nbsp;/g,"\u00a0");if(/^(__MCE_ITEM__)+[\u2022\u00b7\u00a7\u00d8o]\s*\u00a0*/.test(R)){P="ul"}if(/^__MCE_ITEM__\s*\w+\.\s*\u00a0{2,}/.test(R)){P="ol"}if(P){D=parseFloat(Q.style.marginLeft||0);if(D>B){K.push(D)}if(!F||P!=I){F=G.create(P);G.insertAfter(F,Q)}else{if(D>B){F=J.appendChild(G.create(P))}else{if(D<B){L=tinymce.inArray(K,D);M=G.getParents(F.parentNode,P);F=M[M.length-1-L]||F}}}A(G.select("span",Q),function(T){var S=T.innerHTML.replace(/<\/?\w+[^>]*>/gi,"");if(P=="ul"&&/^[\u2022\u00b7\u00a7\u00d8o]/.test(S)){G.remove(T)}else{if(/^[\s\S]*\w+\.(&nbsp;|\u00a0)*\s*/.test(S)){G.remove(T)}}});O=Q.innerHTML;if(P=="ul"){O=Q.innerHTML.replace(/__MCE_ITEM__/g,"").replace(/^[\u2022\u00b7\u00a7\u00d8o]\s*(&nbsp;|\u00a0)+\s*/,"")}else{O=Q.innerHTML.replace(/__MCE_ITEM__/g,"").replace(/^\s*\w+\.(&nbsp;|\u00a0)+\s*/,"")}J=F.appendChild(G.create("li",0,O));G.remove(Q);B=D;I=P}else{F=B=0}});H=C.node.innerHTML;if(H.indexOf("__MCE_ITEM__")!=-1){C.node.innerHTML=H.replace(/__MCE_ITEM__/g,"")}},_insertMergeTable:function(B,E,C){var F=B.selection.getNode();F=F.nodeName.toUpperCase()=="TD"?F:B.dom.getParent(F,"table");if(!F){return this._insertBlockContent(B,E,C)}var D=E.create("div");D.innerHTML=C;B.execCommand("mceTableMergeToSelection",false,D.firstChild)},_insertBlockContent:function(H,E,I){var C,G,D=H.selection,M,J,B,K,F;function L(N){D.collapseToNode(N,true)}this._insert('<span id="_marker">&nbsp;</span>',1);G=E.get("_marker");C=E.getParent(G,"p,h1,h2,h3,h4,h5,h6,ul,ol,th,td");if(C&&!/TD|TH/.test(C.nodeName)){G=E.split(C,G);A(E.create("div",0,I).childNodes,function(N){M=G.parentNode.insertBefore(N.cloneNode(true),G)});L(M)}else{E.setOuterHTML(G,I);D.select(H.getBody(),1);D.collapse(0)}E.remove("_marker");J=D.getStart();B=E.getViewPort(H.getWin());K=H.dom.getPos(J).y;F=J.clientHeight;if(K<B.y||K+F>B.y+B.h){H.getDoc().body.scrollTop=K<B.y?K:K-B.h+25}},_insert:function(D,B){var C=this.editor;if(!C.selection.isCollapsed()){C.getDoc().execCommand("Delete",false,null)}C.execCommand(tinymce.isGecko?"insertHTML":"mceInsertContent",false,D,{skip_undo:B})},_legacySupport:function(){var C=this,B=C.editor;A(["mcePasteText","mcePasteWord"],function(D){B.addCommand(D,function(){B.windowManager.open({file:C.url+(D=="mcePasteText"?"/pastetext.htm":"/pasteword.htm"),width:parseInt(B.getParam("paste_dialog_width","450")),height:parseInt(B.getParam("paste_dialog_height","400")),inline:1})})});B.addButton("pastetext",{title:"paste.paste_text_desc",cmd:"mcePasteText"});B.addButton("pasteword",{title:"paste.paste_word_desc",cmd:"mcePasteWord"});B.addButton("selectall",{title:"paste.selectall_desc",cmd:"selectall"})}});tinymce.PluginManager.add("paste",tinymce.plugins.PastePlugin)})();(function(){var A=tinymce.dom.Event,C=tinymce.each,B=tinymce.DOM;tinymce.create("tinymce.plugins.ContextMenu",{init:function(D){var F=this;F.editor=D;F.onContextMenu=new tinymce.util.Dispatcher(this);D.onContextMenu.add(function(G,H){if(tinymce.isMac||(tinymce.isWebKit&&!/chrome/.test(navigator.userAgent))||!H.ctrlKey){var I=F._getMenu(G);if(I){I.showMenu(H.clientX,H.clientY);A.add(G.getDoc(),"click",E);A.cancel(H)}}});function E(){if(F._menu){F._menu.removeAll();F._menu.destroy();A.remove(D.getDoc(),"click",E)}}D.onMouseDown.add(E);D.onKeyDown.add(E)},getInfo:function(){return{longname:"Contextmenu",author:"Moxiecode Systems AB",authorurl:"http://tinymce.moxiecode.com",infourl:"http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/contextmenu",version:tinymce.majorVersion+"."+tinymce.minorVersion}},_getMenu:function(M){var T=this,H=T._menu,N=M.selection,G=N.isCollapsed(),F=N.getNode()||M.getBody(),L,R,P;if(H){H.removeAll();H.destroy()}R=B.getPos(M.getContentAreaContainer());P=B.getPos(M.getContainer());H=M.controlManager.createDropMenu("contextmenu",{offset_x:R.x+M.getParam("contextmenu_offset_x",0),offset_y:R.y+M.getParam("contextmenu_offset_y",0),constrain:1});T._menu=H;var Q=false;if(F.nodeName=="IMG"){var E=F.getAttribute("src");if(E.indexOf("/plugin_helper.php")!=-1){if(E.indexOf("plugin=task")!=-1){H.add({title:"Edit task",icon:"pbtask",cmd:"mcePbEditTask",ui:true})}else{if(E.indexOf("plugin=gliffy")!=-1){H.add({title:"Edit diagram",icon:"chart_organisation",cmd:"mcePbEditGliffyDiagram",ui:true})}else{if(E.indexOf("plugin=avplayer")==-1){H.add({title:"Edit plugin",icon:"pbplugin",cmd:"mcePbPlugin",ui:true})}}}}else{H.add({title:"Edit image",icon:"imageedit",cmd:M.plugins.advimage?"mceAdvImage":"mceImage",ui:true});H.addSeparator();if(!M.dom.getParent(F,"a")){H.add({title:"Add link",icon:"pblink",cmd:"mcePbLink",ui:true})}else{H.add({title:"Open link",icon:"pblinkgo",cmd:"mcePbOpenLink",ui:true});H.add({title:"Edit link",icon:"pblink",cmd:"mcePbLink",ui:true});H.add({title:"Remove link",icon:"unlink",cmd:"UnLink"})}}Q=true}else{if(F.nodeName.toUpperCase()=="A"||M.dom.getParent(F,"A")){var O=F.nodeName.toUpperCase()=="A"?F:M.dom.getParent(F,"A"),J=O.innerHTML,K=Util.is_valid_url(J);if(Prototype.Browser.IE){H.add({title:"advanced.copy_desc",icon:"pbcopy",cmd:"mcePbCopy"}).setDisabled(G);H.add({title:"advanced.paste_desc",icon:"pbpaste",cmd:"mcePbPaste"});H.addSeparator()}H.add({title:"Open link",icon:"pblinkgo",cmd:"mcePbOpenLink",ui:true});H.add({title:"Edit link",icon:"pblink",cmd:"mcePbLink",ui:true});if(!K){H.add({title:"Remove link",icon:"unlink",cmd:"UnLink"})}if(M.dom.hasClass(O,"iconbutton")){H.addSeparator();H.add({title:"Remove icon",icon:"pbremoveicon",cmd:"mcePbRemoveIcon"})}Q=true}}var I=F.nodeName.toUpperCase()=="TD"?F:M.dom.getParent(F,"td, th");if(!I&&tinymce.isWebKit){var D=M.selection.getRng();I=M.dom.getParent(D.startContainer,"td, th")}if(I||M.dom.getParent(F,"table")){if(Prototype.Browser.IE){H.add({title:"advanced.copy_desc",icon:"pbcopy",cmd:"mcePbCopy"}).setDisabled(G);H.add({title:"advanced.paste_desc",icon:"pbpaste",cmd:"mcePbPaste"})}H.addSeparator();H.add({title:"table.props_desc",icon:"table_props",cmd:"mceInsertTable",ui:true});H.add({title:"table.del",icon:"delete_table",cmd:"mceTableDelete",ui:true});H.addSeparator();sm=H.addMenu({title:"table.cell"});sm.add({title:"table.cell_desc",icon:"cell_props",cmd:"mceTableCellProps",ui:true});var I=F.nodeName.toUpperCase()=="TD"?F:M.dom.getParent(F,"td");sm.add({title:"Merge cells",icon:"merge_cells",cmd:"mceTableMergeCells",ui:true});var S=I?I.getAttribute("colspan")>1||I.getAttribute("rowspan")>1:false;sm.add({title:"Split selected cell",icon:"split_cells",cmd:"mceTableSplitCells",ui:true}).setDisabled(!S);sm=H.addMenu({title:"table.row"});sm.add({title:"table.row_before_desc",icon:"row_before",cmd:"mceTableInsertRowBefore"});sm.add({title:"table.row_after_desc",icon:"row_after",cmd:"mceTableInsertRowAfter"});sm.add({title:"table.delete_row_desc",icon:"delete_row",cmd:"mceTableDeleteRow"});sm.addSeparator();sm.add({title:"table.cut_row_desc",icon:"cut",cmd:"mceTableCutRow"});sm.add({title:"table.copy_row_desc",icon:"copy",cmd:"mceTableCopyRow"});sm.add({title:"table.paste_row_before_desc",icon:"paste",cmd:"mceTablePasteRowBefore"}).setDisabled(!M.clipboardRows);sm.add({title:"table.paste_row_after_desc",icon:"paste",cmd:"mceTablePasteRowAfter"}).setDisabled(!M.clipboardRows);sm=H.addMenu({title:"table.col"});sm.add({title:"table.col_before_desc",icon:"col_before",cmd:"mceTableInsertColBefore"});sm.add({title:"table.col_after_desc",icon:"col_after",cmd:"mceTableInsertColAfter"});sm.add({title:"table.delete_col_desc",icon:"delete_col",cmd:"mceTableDeleteCol"});Q=true}return(Q?H:false)}});tinymce.PluginManager.add("contextmenu",tinymce.plugins.ContextMenu)})();(function(B){var C=B.each;function A(e,b,j){var E,k,Y,M;Q();M=b.getParent(j.getStart(),"th,td");if(M){k=a(M);Y=f();M=V(k.x,k.y)}function Q(){var l=0;E=[];C(["thead","tbody","tfoot"],function(m){var o=b.select(m+" tr",e);C(o,function(p,q){q+=l;C(b.select("td,th",p),function(AB,t){var u,v,z,AA;if(E[q]){while(E[q][t]){t++}}z=G(AB,"rowspan");AA=G(AB,"colspan");for(v=q;v<q+z;v++){if(!E[v]){E[v]=[]}for(u=t;u<t+AA;u++){E[v][u]={part:m,real:v==q&&u==t,elm:AB,rowspan:z,colspan:AA}}}})});l+=o.length})}function V(l,o){var m;m=E[o];if(m){return m[l]}}function G(m,l){return parseInt(m.getAttribute(l)||1)}function H(l){return b.hasClass(l.elm,"mceSelected")||l==M}function h(){var o=[],l,m,p;C(e.rows,function(q){C(q.cells,function(t){if(b.hasClass(t,"mceSelected")||t==M.elm){var u=a(t);if(!p){l=u.y;m=u.x;p=true}if(!o[u.y-l]){o[u.y-l]=[]}o[u.y-l][u.x-m]=t}})});return o}function I(){var l=[];C(e.rows,function(m){C(m.cells,function(o){if(b.hasClass(o,"mceSelected")||o==M.elm){l.push(m);return false}})});return l}function P(){var l=b.createRng();l.setStartAfter(e);l.setEndAfter(e);j.setRng(l);b.remove(e)}function D(l){var m;B.walk(l,function(p){var o;if(p.nodeType==3){C(b.getParents(p.parentNode,null,l).reverse(),function(q){q=q.cloneNode(false);if(!m){m=o=q}else{if(o){o.appendChild(q)}}o=q});if(o){o.innerHTML=B.isIE?"&nbsp;":'<br _mce_bogus="1" />'}return false}},"childNodes");l=l.cloneNode(false);l.rowSpan=l.colSpan=1;if(m){l.appendChild(m)}else{if(!B.isIE){l.innerHTML='<br _mce_bogus="1" />'}}return l}function O(){var l=b.createRng();C(b.select("tr",e),function(m){if(m.cells.length==0){b.remove(m)}});if(b.select("tr",e).length==0){l.setStartAfter(e);l.setEndAfter(e);j.setRng(l);b.remove(e);return }C(b.select("thead,tbody,tfoot",e),function(m){if(m.rows.length==0){b.remove(m)}});Q();row=E[Math.min(E.length-1,k.y)];if(row){j.select(row[Math.min(row.length-1,k.x)].elm,true);j.collapse(true)}}function R(u,q,z,t){var p,m,l,o,v;p=E[q][u].elm.parentNode;for(l=1;l<=z;l++){p=b.getNext(p,"tr");if(p){for(m=u;m>=0;m--){v=E[q+l][m].elm;if(v.parentNode==p){for(o=1;o<=t;o++){b.insertAfter(D(v),v)}break}}if(m==-1){for(o=1;o<=t;o++){p.insertBefore(D(p.cells[0]),p.cells[0])}}}}}function X(){C(E,function(l,m){C(l,function(p,o){var u,t,v,q;if(H(p)){p=p.elm;u=G(p,"colspan");t=G(p,"rowspan");if(u>1||t>1){p.colSpan=p.rowSpan=1;for(q=0;q<u-1;q++){b.insertAfter(D(p),p)}R(o,m,t-1,u)}}})})}function N(z,t,AC){var p,o,AB,AA,v,q,u,l,z,m;if(z){pos=a(z);p=pos.x;o=pos.y;AB=p+(t-1);AA=o+(AC-1)}else{p=k.x;o=k.y;AB=Y.x;AA=Y.y}u=V(p,o);l=V(AB,AA);if(u&&l&&u.part==l.part){X();Q();u=V(p,o).elm;u.colSpan=(AB-p)+1;u.rowSpan=(AA-o)+1;for(q=o;q<=AA;q++){for(v=p;v<=AB;v++){z=E[q][v].elm;if(z!=u){m=B.grep(z.childNodes);C(m,function(AE,AD){if(AE.nodeName!="BR"||AD!=m.length-1){u.appendChild(AE)}});b.remove(z)}}}O()}}function J(p){var l,t,o,q,u,v,m,z;C(E,function(AA,AB){C(AA,function(AD,AC){if(H(AD)){AD=AD.elm;u=AD.parentNode;v=u.cloneNode(false);l=AB;if(p){return false}}});if(p){return !l}});for(q=0;q<E[0].length;q++){t=E[l][q].elm;if(t!=o){if(!p){rowSpan=G(t,"rowspan");if(rowSpan>1){t.rowSpan=rowSpan+1;continue}}else{if(l>0&&E[l-1][q]){z=E[l-1][q].elm;rowSpan=G(z,"rowspan");if(rowSpan>1){z.rowSpan=rowSpan+1;continue}}}m=D(t);m.colSpan=t.colSpan;v.appendChild(m);o=t}}if(v.hasChildNodes()){if(!p){b.insertAfter(v,u)}else{u.parentNode.insertBefore(v,u)}}}function F(m){var o,l;C(E,function(p,q){C(p,function(u,t){if(H(u)){o=t;if(m){return false}}});if(m){return !o}});C(E,function(u,v){var p=u[o].elm,q,t;if(p!=l){t=G(p,"colspan");q=G(p,"rowspan");if(t==1){if(!m){b.insertAfter(D(p),p);R(o,v,q-1,t)}else{p.parentNode.insertBefore(D(p),p);R(o,v,q-1,t)}}else{p.colSpan++}l=p}})}function L(){var l=[];C(E,function(m,o){C(m,function(q,p){if(H(q)&&B.inArray(l,p)===-1){C(E,function(v){var t=v[p].elm,u;u=G(t,"colspan");if(u>1){t.colSpan=u-1}else{b.remove(t)}});l.push(p)}})});O()}function K(){var m;function l(q){var p,t,o;p=b.getNext(q,"tr");C(q.cells,function(u){var v=G(u,"rowspan");if(v>1){u.rowSpan=v-1;t=a(u);R(t.x,t.y,1,1)}});t=a(q.cells[0]);C(E[t.y],function(u){var v;u=u.elm;if(u!=o){v=G(u,"rowspan");if(v<=1){b.remove(u)}else{u.rowSpan=v-1}o=u}})}m=I();C(m.reverse(),function(o){l(o)});O()}function Z(){var l=I();b.remove(l);O();return l}function g(){var l=I();C(l,function(o,m){l[m]=o.cloneNode(true)});return l}function W(o,m){var p=I(),l=p[m?0:p.length-1],q=l.cells.length;C(E,function(u){var t;q=0;C(u,function(z,v){if(z.real){q+=z.colspan}if(z.elm.parentNode==l){t=1}});if(t){return false}});if(!m){o.reverse()}C(o,function(v){var u=v.cells.length,t;for(i=0;i<u;i++){t=v.cells[i];t.colSpan=t.rowSpan=1}for(i=u;i<q;i++){v.appendChild(D(v.cells[u-1]))}for(i=q;i<u;i++){b.remove(v.cells[i])}if(m){l.parentNode.insertBefore(v,l)}else{b.insertAfter(v,l)}})}function a(l){var m;C(E,function(o,p){C(o,function(t,q){if(t.elm==l){m={x:q,y:p};return false}});return !m});return m}function U(l){k=a(l)}function f(){var o,m,l;m=l=0;C(E,function(p,q){C(p,function(u,t){var z,v;if(H(u)){u=E[q][t];if(t>m){m=t}if(q>l){l=q}if(u.real){z=u.colspan-1;v=u.rowspan-1;if(z){if(t+z>m){m=t+z}}if(v){if(q+v>l){l=q+v}}}}})});return{x:m,y:l}}function T(u){var p,o,z,v,m,l,q,t;Y=a(u);if(k&&Y){p=Math.min(k.x,Y.x);o=Math.min(k.y,Y.y);z=Math.max(k.x,Y.x);v=Math.max(k.y,Y.y);m=z;l=v;for(y=o;y<=l;y++){u=E[y][p];if(!u.real){if(p-(u.colspan-1)<p){p-=u.colspan-1}}}for(x=p;x<=m;x++){u=E[o][x];if(!u.real){if(o-(u.rowspan-1)<o){o-=u.rowspan-1}}}for(y=o;y<=v;y++){for(x=p;x<=z;x++){u=E[y][x];if(u.real){q=u.colspan-1;t=u.rowspan-1;if(q){if(x+q>m){m=x+q}}if(t){if(y+t>l){l=y+t}}}}}b.removeClass(b.select("td.mceSelected,th.mceSelected"),"mceSelected");for(y=o;y<=l;y++){for(x=p;x<=m;x++){b.addClass(E[y][x].elm,"mceSelected")}}}}function S(l){var m=a(l);if(m.x+1<E[m.y].length){return E[m.y][m.x+1].elm}if(m.y+1<E.length){return E[m.y+1][0].elm}return false}B.extend(this,{deleteTable:P,split:X,merge:N,insertRow:J,insertCol:F,deleteCols:L,deleteRows:K,cutRows:Z,copyRows:g,pasteRows:W,getPos:a,setStartCell:U,setEndCell:T,nextCell:S,getSelectedCells:h,getPos:a,getCell:V})}B.create("tinymce.plugins.TablePlugin",{init:function(E,F){var D,I;function H(L){var K=E.selection,J=E.dom.getParent(L||K.getNode(),"table");if(J){return new A(J,E.dom,K)}}function G(){E.getBody().style.webkitUserSelect="";E.dom.removeClass(E.dom.select("td.mceSelected,th.mceSelected"),"mceSelected")}C([["table","table.desc","mceInsertTable",true],["delete_table","table.del","mceTableDelete"],["delete_col","table.delete_col_desc","mceTableDeleteCol"],["delete_row","table.delete_row_desc","mceTableDeleteRow"],["col_after","table.col_after_desc","mceTableInsertColAfter"],["col_before","table.col_before_desc","mceTableInsertColBefore"],["row_after","table.row_after_desc","mceTableInsertRowAfter"],["row_before","table.row_before_desc","mceTableInsertRowBefore"],["row_props","table.row_desc","mceTableRowProps",true],["cell_props","table.cell_desc","mceTableCellProps",true],["split_cells","table.split_cells_desc","mceTableSplitCells",true],["merge_cells","table.merge_cells_desc","mceTableMergeCells",true]],function(J){E.addButton(J[0],{title:J[1],cmd:J[2],ui:J[3]})});if(!B.isIE){E.onClick.add(function(J,K){K=K.target;if(K.nodeName==="TABLE"){J.selection.select(K)}})}E.onNodeChange.add(function(K,J,M){var L;M=K.selection.getStart();L=K.dom.getParent(M,"td,th,caption");J.setActive("table",M.nodeName==="TABLE"||!!L);if(L&&L.nodeName==="CAPTION"){L=0}J.setDisabled("delete_table",!L);J.setDisabled("delete_col",!L);J.setDisabled("delete_table",!L);J.setDisabled("delete_row",!L);J.setDisabled("col_after",!L);J.setDisabled("col_before",!L);J.setDisabled("row_after",!L);J.setDisabled("row_before",!L);J.setDisabled("row_props",!L);J.setDisabled("cell_props",!L);J.setDisabled("split_cells",!L);J.setDisabled("merge_cells",!L)});E.onInit.add(function(K){var J,N,O=K.dom,L;D=K.windowManager;K.onMouseDown.add(function(P,Q){if(Q.button!=2){G();N=O.getParent(Q.target,"td,th");J=O.getParent(N,"table")}});O.bind(K.getDoc(),"mouseover",function(S){var Q,P,R=S.target;if(N&&(L||R!=N)&&(R.nodeName=="TD"||R.nodeName=="TH")){P=O.getParent(R,"table");if(P==J){if(!L){L=H(P);L.setStartCell(N);K.getBody().style.webkitUserSelect="none"}L.setEndCell(R)}Q=K.selection.getSel();if(Q.removeAllRanges){Q.removeAllRanges()}else{Q.empty()}S.preventDefault()}});K.onMouseUp.add(function(W,X){var Q,S=W.selection,Y,Z=S.getSel(),P,T,R,V;if(N){if(L){W.getBody().style.webkitUserSelect=""}function U(a,e){var b=new B.dom.TreeWalker(a,a);do{if(a.nodeType==3&&B.trim(a.nodeValue).length!=0){if(e){Q.setStart(a,0)}else{Q.setEnd(a,a.nodeValue.length)}return }if(a.nodeName=="BR"){if(e){Q.setStartBefore(a)}else{Q.setEndBefore(a)}return }}while(a=(e?b.next():b.prev()))}Y=O.select("td.mceSelected,th.mceSelected");if(Y.length>0){Q=O.createRng();T=Y[0];V=Y[Y.length-1];U(T,1);P=new B.dom.TreeWalker(T,O.getParent(Y[0],"table"));do{if(T.nodeName=="TD"||T.nodeName=="TH"){if(!O.hasClass(T,"mceSelected")){break}R=T}}while(T=P.next());U(R);S.setRng(Q)}W.nodeChanged();N=L=J=null}});K.onKeyUp.add(function(P,Q){if(Q.ctrlKey||Q.metaKey||Q.keyCode==17){return }G()});if(K&&K.plugins.contextmenu){K.plugins.contextmenu.onContextMenu.add(function(R,P,T){var U,S=K.selection,Q=S.getNode()||K.getBody();if(K.dom.getParent(T,"td")||K.dom.getParent(T,"th")){P.removeAll();if(Q.nodeName=="A"&&!K.dom.getAttrib(Q,"name")){P.add({title:"advanced.link_desc",icon:"link",cmd:K.plugins.advlink?"mceAdvLink":"mceLink",ui:true});P.add({title:"advanced.unlink_desc",icon:"unlink",cmd:"UnLink"});P.addSeparator()}if(Q.nodeName=="IMG"&&Q.className.indexOf("mceItem")==-1){P.add({title:"advanced.image_desc",icon:"image",cmd:K.plugins.advimage?"mceAdvImage":"mceImage",ui:true});P.addSeparator()}P.add({title:"table.desc",icon:"table",cmd:"mceInsertTable",value:{action:"insert"}});P.add({title:"table.props_desc",icon:"table_props",cmd:"mceInsertTable"});P.add({title:"table.del",icon:"delete_table",cmd:"mceTableDelete"});P.addSeparator();U=P.addMenu({title:"table.cell"});U.add({title:"table.cell_desc",icon:"cell_props",cmd:"mceTableCellProps"});U.add({title:"table.split_cells_desc",icon:"split_cells",cmd:"mceTableSplitCells"});U.add({title:"table.merge_cells_desc",icon:"merge_cells",cmd:"mceTableMergeCells"});U=P.addMenu({title:"table.row"});U.add({title:"table.row_desc",icon:"row_props",cmd:"mceTableRowProps"});U.add({title:"table.row_before_desc",icon:"row_before",cmd:"mceTableInsertRowBefore"});U.add({title:"table.row_after_desc",icon:"row_after",cmd:"mceTableInsertRowAfter"});U.add({title:"table.delete_row_desc",icon:"delete_row",cmd:"mceTableDeleteRow"});U.addSeparator();U.add({title:"table.cut_row_desc",icon:"cut",cmd:"mceTableCutRow"});U.add({title:"table.copy_row_desc",icon:"copy",cmd:"mceTableCopyRow"});U.add({title:"table.paste_row_before_desc",icon:"paste",cmd:"mceTablePasteRowBefore"}).setDisabled(!I);U.add({title:"table.paste_row_after_desc",icon:"paste",cmd:"mceTablePasteRowAfter"}).setDisabled(!I);U=P.addMenu({title:"table.col"});U.add({title:"table.col_before_desc",icon:"col_before",cmd:"mceTableInsertColBefore"});U.add({title:"table.col_after_desc",icon:"col_after",cmd:"mceTableInsertColAfter"});U.add({title:"table.delete_col_desc",icon:"delete_col",cmd:"mceTableDeleteCol"})}else{P.add({title:"table.desc",icon:"table",cmd:"mceInsertTable"})}})}if(!B.isIE){function M(){var P;for(P=K.getBody().lastChild;P&&P.nodeType==3&&!P.nodeValue.length;P=P.previousSibling){}if(P&&P.nodeName=="TABLE"){K.dom.add(K.getBody(),"p",null,'<br mce_bogus="1" />')}}if(B.isGecko){K.onKeyDown.add(function(Q,S){var P,R,T=Q.dom;if(S.keyCode==37||S.keyCode==38){P=Q.selection.getRng();R=T.getParent(P.startContainer,"table");if(R&&Q.getBody().firstChild==R){if(isAtStart(P,R)){P=T.createRng();P.setStartBefore(R);P.setEndBefore(R);Q.selection.setRng(P);S.preventDefault()}}}})}K.onKeyUp.add(M);K.onSetContent.add(M);K.onVisualAid.add(M);M()}});C({mceTableSplitCells:function(J){J.split()},mceTableMoveToNextRow:function(K){var J=E.dom.getParent(E.selection.getNode(),"th,td");var L=K.nextCell(J);if(!L){K.insertRow();K=H();L=K.nextCell(J)}E.selection.select(L.firstChild||L,true);E.selection.collapse(true);return true},mceTableMergeCells:function(K){var L,M,J;J=E.dom.getParent(E.selection.getNode(),"th,td");if(J){L=J.rowSpan;M=J.colSpan}if(!E.dom.select("td.mceSelected,th.mceSelected").length){(new PBwiki.DialogCommands.EditCellMerge({sel:E.selection,onSave:function(N){E.selection.select(J.firstChild||J,true);E.selection.collapse();K.merge(J,N.numcols,N.numrows)}}))}else{K.merge()}},mceTableInsertRowBefore:function(J){J.insertRow(true)},mceTableInsertRowAfter:function(J){J.insertRow()},mceTableInsertColBefore:function(J){J.insertCol(true)},mceTableInsertColAfter:function(J){J.insertCol()},mceTableDeleteCol:function(J){J.deleteCols()},mceTableDeleteRow:function(J){J.deleteRows()},mceTableCutRow:function(J){I=E.clipboardRows=J.cutRows()},mceTableCopyRow:function(J){I=E.clipboardRows=J.copyRows()},mceTablePasteRowBefore:function(J){J.pasteRows(I,true)},mceTablePasteRowAfter:function(J){J.pasteRows(I)},mceTableDelete:function(J){J.deleteTable()}},function(K,J){E.addCommand(J,function(){var L=H();if(L){K(L);E.execCommand("mceRepaint");G()}})});E.addCommand("mceTableMergeToSelection",function(S,O){var J=H();if(!J){return }function P(Z){var W=[],X=0,Y=0;B.each(E.dom.select("tr",Z),function(a){W[X]=[];Y=0;B.each(E.dom.select("td,th",a),function(b){W[X][Y]=b;Y++});X++});return W}var V=J.getSelectedCells(),U;var K=P(O),N,T,R;if(V.length==1&&V[0].length==1){var Q=J.getPos(V[0][0]);for(var M=0;M<K.length;M++){for(var L=0;L<K[M].length;L++){var U=J.getCell(Q.x+L,Q.y+M);if(U){if(!V[M]){V[M]=[]}V[M][L]=U.elm}}}}for(var M=0;M<V.length;M++){for(var L=0;L<V[M].length;L++){R=M;T=L;if(R>K.length-1){R=M%(K.length-1)||0}if(T>K[R].length-1){T=L%(K[R].length-1)||0}if(!K[R]){continue}N=K[R][T];U=V[M][L];if(!N||!U){continue}U.innerHTML=N.innerHTML}}setTimeout(function(){if(!V[0][0]){return }var W=E.dom.createRng();W.selectNodeContents(V[0][0]);E.selection.setRng(W);for(var Y=0;Y<V.length;Y++){for(var X=0;X<V[Y].length;X++){E.dom.addClass(V[Y][X],"mceSelected")}}J.setStartCell(V[0][0]);J.setEndCell(V[V.length-1][V[V.length-1].length])},50)});E.onCopy.add(function(R){var T=R.dom.select("td.mceSelected,th.mceSelected");var N=R.selection.getNode();N=(N.nodeName.toUpperCase()=="TD")?N:R.dom.getParent(N,"TABLE");if(T.length==0||!N){return }var Q=R.dom.create("div");var M=R.dom.create("table");Q.appendChild(M);var S=R.dom.create("tbody");M.appendChild(S);var K=H();var V=K.getSelectedCells(),W,U;for(var P=0;P<V.length;P++){W=R.dom.create("tr");S.appendChild(W);for(var O=0;O<V[P].length;O++){U=V[P][O].cloneNode(true);R.dom.removeClass(U,"mceSelected");W.appendChild(U)}}Q.appendChild(M);R.getBody().appendChild(Q);var L=R.selection.getBookmark();var J=R.dom.createRng();J.selectNodeContents(Q);R.selection.setRng(J);setTimeout(function(){R.selection.moveToBookmark(L);B.each(T,function(X){R.dom.addClass(X,"mceSelected")});if(Q){R.dom.remove(Q)}},1)});C({mceInsertTable:function(J){(new PBwiki.DialogCommands.EditTable({sel:E.selection}))},mceTableRowProps:function(){D.open({url:F+"/row.htm",width:400+parseInt(E.getLang("table.rowprops_delta_width",0)),height:295+parseInt(E.getLang("table.rowprops_delta_height",0)),inline:1},{plugin_url:F})},mceTableCellProps:function(){var L=E.dom.select("td.mceSelected,th.mceSelected");if(L.length==0){var N=E.selection.getNode();if(B.isWebKit){var K=E.selection.getRng();var J=E.dom.getParent(K.startContainer,"TD,TH")}else{var J=["TD","TH"].indexOf(N.nodeName.toUpperCase())!=-1?N:E.dom.getParent(N,"TD,TH")}if(J){L.push(J)}}var M=E.selection.getPBBookmark();(new PBwiki.DialogCommands.EditCell({sel:E.selection,cells:L,onComplete:function(){E.selection.moveToPBBookmark(M)}}))}},function(K,J){E.addCommand(J,function(L,M){K(M)})})}});B.PluginManager.add("table",B.plugins.TablePlugin)})(tinymce);(function(){var A=tinymce.util.JSONRequest,C=tinymce.each,B=tinymce.DOM;tinymce.create("tinymce.plugins.SpellcheckerPlugin",{getInfo:function(){return{longname:"Spellchecker",author:"Moxiecode Systems AB",authorurl:"http://tinymce.moxiecode.com",infourl:"http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/spellchecker",version:"2.0.2"}},init:function(E,F){var G=this,D;G.url=F;G.editor=E;E.addCommand("mceSpellCheck",function(){if(!G.active){E.setProgressState(1);document.fire("ui:autosaveTrigger",true)}else{G._done()}});if(!document.observe){return }document.observe("spellcheck:update",function(H){G.active=1;G.words=H.memo;G._markWords(Object.keys(H.memo));E.setProgressState(0);E.nodeChanged()});E.onClick.add(G._showMenu,G);E.onContextMenu.add(G._showMenu,G);E.onNodeChange.add(function(I,H){H.setActive("spellchecker",G.active)});E.onSetContent.add(function(){G._done()});E.onPreProcess.add(function(H,I){C(H.dom.select("span",I.node).reverse(),function(J){if(J&&(H.dom.hasClass(J,"mceItemHiddenSpellWord")||H.dom.hasClass(J,"mceItemHidden"))){H.dom.remove(J,1)}})});E.onBeforeExecCommand.add(function(H,I){if(I=="mceFullScreen"){G._done()}});G.languages={};C(E.getParam("spellchecker_languages","+English=en,Danish=da,Dutch=nl,Finnish=fi,French=fr,German=de,Italian=it,Polish=pl,Portuguese=pt,Spanish=es,Swedish=sv","hash"),function(I,H){if(H.indexOf("+")===0){H=H.substring(1);G.selectedLang=I}G.languages[H]=I})},createControl:function(H,D){var F=this,G,E=F.editor;if(H=="spellchecker"){G=D.createButton(H,{title:"spellchecker.desc",cmd:"mceSpellCheck",scope:F});return G}},_walk:function(G,E){var F=this.editor.getDoc(),D;if(F.createTreeWalker){D=F.createTreeWalker(G,NodeFilter.SHOW_TEXT,null,false);while((G=D.nextNode())!=null){E.call(this,G)}}else{tinymce.walk(G,E,"childNodes")}},_getSeparators:function(){var E="",D,F=this.editor.getParam("spellchecker_word_separator_chars",'\\s!"#$%&()*+,-./:;<=>?@[]^_{|}\u201d\u201c');for(D=0;D<F.length;D++){E+="\\"+F.charAt(D)}return E},_getWords:function(){var E=this.editor,G=[],D="",F={};this._walk(E.getBody(),function(H){if(H.nodeType==3){D+=H.nodeValue+" "}});D=D.replace(new RegExp("([0-9]|["+this._getSeparators()+"])","g")," ");D=tinymce.trim(D.replace(/(\s+)/g," "));C(D.split(" "),function(H){if(!F[H]){G.push(H);F[H]=1}});return G},_removeWords:function(E){var F=this.editor,H=F.dom,G=F.selection,D=G.getBookmark();C(H.select("span").reverse(),function(I){if(I&&(H.hasClass(I,"mceItemHiddenSpellWord")||H.hasClass(I,"mceItemHidden"))){if(!E||H.decode(I.innerHTML)==E){H.remove(I,1)}}});G.moveToBookmark(D)},_markWords:function(O){var I,H,G,F,E,N="",K=this.editor,P=this._getSeparators(),J=K.dom,D=[];var L=K.selection,M=L.getBookmark();C(O,function(Q){N+=(N?"|":"")+Q});I=new RegExp("(["+P+"])("+N+")(["+P+"])","g");H=new RegExp("^("+N+")","g");G=new RegExp("("+N+")(["+P+"]?)$","g");F=new RegExp("^("+N+")(["+P+"]?)$","g");E=new RegExp("("+N+")(["+P+"])","g");this._walk(this.editor.getBody(),function(Q){if(Q.nodeType==3){D.push(Q)}});C(D,function(R){var Q;if(R.nodeType==3){Q=R.nodeValue;if(I.test(Q)||H.test(Q)||G.test(Q)||F.test(Q)){Q=J.encode(Q);Q=Q.replace(E,'<span class="mceItemHiddenSpellWord">$1</span>$2');Q=Q.replace(G,'<span class="mceItemHiddenSpellWord">$1</span>$2');J.replace(J.create("span",{"class":"mceItemHidden"},Q),R)}}});L.moveToBookmark(M)},_showMenu:function(F,I){var G=this,F=G.editor,D=G._menu,K,J=F.dom,E=J.getViewPort(F.getWin());if(!D){K=B.getPos(F.getContentAreaContainer());D=F.controlManager.createDropMenu("spellcheckermenu",{offset_x:K.x,offset_y:K.y,"class":"mceNoIcons"});G._menu=D}if(J.hasClass(I.target,"mceItemHiddenSpellWord")){D.removeAll();var H=G.words[J.decode(I.target.innerHTML)];if(H){H=H.split("|")}if(H&&H.length>0){D.add({title:"spellchecker.sug","class":"mceMenuItemTitle"}).setDisabled(1);C(H,function(L){D.add({title:L,onclick:function(){J.replace(F.getDoc().createTextNode(L),I.target);G._checkDone()}})});D.addSeparator()}else{D.add({title:"spellchecker.no_sug","class":"mceMenuItemTitle"}).setDisabled(1)}D.add({title:"spellchecker.ignore_word",onclick:function(){J.remove(I.target,1);G._checkDone()}});D.add({title:"spellchecker.ignore_words",onclick:function(){G._removeWords(J.decode(I.target.innerHTML));G._checkDone()}});F.selection.select(I.target);K=J.getPos(I.target);D.showMenu(K.x,K.y+I.target.offsetHeight-E.y);return tinymce.dom.Event.cancel(I)}else{D.hideMenu()}},_checkDone:function(){var E=this,D=E.editor,G=D.dom,F;C(G.select("span"),function(H){if(H&&G.hasClass(H,"mceItemHiddenSpellWord")){F=true;return false}});if(!F){E._done()}},_done:function(){var D=this,E=D.active;if(D.active){D.active=0;D._removeWords();if(D._menu){D._menu.hideMenu()}if(E){D.editor.nodeChanged()}}},_sendRPC:function(E,H,D){var G=this,F=G.editor.getParam("spellchecker_rpc_url",this.url+"/rpc.php");if(F=="{backend}"){G.editor.setProgressState(0);alert("Please specify: spellchecker_rpc_url");return }A.sendRPC({url:F,method:E,params:H,success:D,error:function(J,I){G.editor.setProgressState(0);G.editor.windowManager.alert(J.errstr||("Error response: "+I.responseText))}})}});tinymce.PluginManager.add("spellchecker",tinymce.plugins.SpellcheckerPlugin)})();(function(){var A=tinymce.DOM;tinymce.create("tinymce.plugins.fsedit",{init:function(B){var D=this;var C=false;B.onInit.add(function(){var G=B.controlManager.createButton("fsedit",{title:"Switch to Fullscreen","class":"mce_fsedit",onclick:function(){C=!C;A.removeClass(A.select("span.mceIcon",E),(C?"mce_fsedit":"mce_fsedit_active"));A.addClass(A.select("span.mceIcon",E),(C?"mce_fsedit_active":"mce_fsedit"));A.setAttrib(A.select("a.mceButton",E),"title",(C?"Switch to Normal View":"Switch to Fullscreen"));top.document.fire((C?"ui:fullscreen":"ui:nofullscreen"))}});var E=A.create("div",{style:"float: right; height: 28px;"},G.renderHTML());var F=A.get(B.controlManager.get("toolbar1").id);F.parentNode.insertBefore(E,F);G.postRender()})}});tinymce.PluginManager.add("fsedit",tinymce.plugins.fsedit)})();(function(){var A=tinymce.DOM;tinymce.create("tinymce.plugins.pbnbsp",{init:function(C){var D=this;var B=function(F){if(!F.selection.isCollapsed()){return }var G=F.selection.getNode();var E=G?G.innerHTML:null;if(E&&E!=""&&E.replace("\u00A0","").replace("&nbsp;","")==""){F.selection.collapseToNode()}};C.onMouseUp.add(function(E,F){B(E)});C.onKeyUp.add(function(E,F){B(E)})}});tinymce.PluginManager.add("pbnbsp",tinymce.plugins.pbnbsp)})();(function(){var B=tinymce.DOM;var A=false;tinymce.create("tinymce.plugins.pbcode",{init:function(C){var D=false;C.addButton("pbcode",{label:"Source",onclick:function(){D=!D;for(itm in C.controlManager.controls){var E=C.controlManager.controls[itm];if(itm.indexOf("pbcode")!=-1){E.setActive(D)}else{if(itm.indexOf("fsedit")==-1){E.setActive(false);E.setDisabled(D)}}}top.PBwiki.currentEditor.setSourceMode(D);document.fire("ui:sourcemode")}.bind(this)})}});tinymce.PluginManager.add("pbcode",tinymce.plugins.pbcode)})();(function(){var A=tinymce.DOM;tinymce.create("tinymce.plugins.pbhr",{init:function(B){var C=this;B.addCommand("InsertHorizontalRule",function(){var U=B.dom,P=B.selection,L=P.getRng(true),K;var Q=function(Y){return Y&&((Y.nodeType==1&&U.isBlock(Y))||(Y.parentNode&&Y.parentNode.nodeName&&["TD"].indexOf(Y.parentNode.nodeName.toUpperCase())!=-1))};var I=(L.startContainer.nodeType==1&&L.startContainer.childNodes[L.startOffset])?L.startContainer.childNodes[L.startOffset]:L.startContainer;var H=(L.endContainer.nodeType==1&&L.endContainer.childNodes[L.endOffset])?L.endContainer.childNodes[L.endOffset]:L.endContainer;var W=Q(I)?I:U.getParent(I,Q);var N=Q(H)?H:U.getParent(H,Q);var R=N?N.nextSibling:null;var J=W?W.previousSibling:null;var E=N?N.parentNode:B.getBody();W=W?W:B.getBody();N=N?N:B.getBody();var F=U.createRng(true);F.setStartBefore(W);F.setEnd(L.startContainer,L.startOffset);var D=U.createRng(true);D.setStart(L.endContainer,L.endOffset);D.setEndAfter(N);var G=D.extractContents();var V=F.extractContents();K=J?J.nextSibling:E.firstChild;while(K&&K!=R){if(K.nextSibling){K=K.nextSibling;K.previousSibling.parentNode.removeChild(K.previousSibling)}else{K.parentNode.removeChild(K);K=null}}if(!U.isEmpty(V)){E.insertBefore(V,R)}var X=U.create("hr");E.insertBefore(X,R);E.insertBefore(G,R);var O=function(){var Y=U.create("p");Y.innerHTML="&nbsp;";return Y};if(!X.previousSibling){X.parentNode.insertBefore(O(),X)}if(!X.nextSibling){X.parentNode.insertBefore(O(),X.nextSibling)}P.collapseToNode(X.nextSibling);try{var S=B.dom.getViewPort(B.getWin()),M=B.dom.getPos(X.nextSibling).y;if(M+X.nextSibling.clientHeight>S.y+S.h){B.getWin().scrollTo(0,M-(S.h-X.nextSibling.clientHeight))}}catch(T){}})}});tinymce.PluginManager.add("pbhr",tinymce.plugins.pbhr)})();(function(){var A=tinymce.DOM;tinymce.create("tinymce.plugins.pbindent",{init:function(B){var C=this;B.addCommand("Indent",function(){var K=B.dom,M=B.selection,I,G,H,J=K.getParent(M.getNode(),K.isList);G=B.settings.indentation;H=/[a-z%]+$/i.exec(G);G=parseInt(G);if(M.getNode().nodeName=="BODY"&&M.isCollapsed()){B.execCommand("mceInsertContent",false,"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;");return }if(B.settings.inline_styles&&!J){tinymce.each(M.getSelectedBlocks(),function(P){if(K.isList(P)||P.nodeName.toUpperCase()=="LI"){return }var O=parseInt(P.style.paddingLeft||0);var N=parseInt(P.style.marginLeft||0);O=Math.round(O/G)*G;N=Math.round(N/G)*G;if(O&&N){N+=O;O=0}else{if(O){O+=G}else{N+=G}}if(P.nodeName.toUpperCase()=="TD"&&N){O+=N;N=0}K.setStyle(P,"paddingLeft",(O)?O+H:null);K.setStyle(P,"marginLeft",(N)?N+H:null)})}var D=M.getRng(true);if(K.getParent(D.startContainer,K.isList)||K.getParent(D.endContainer,K.isList)){var D=M.getRng(true),F=D.startContainer,L=(F.nodeName.toUpperCase()=="LI")?F:K.getParent(F,"LI");if(L){var E=M.getPBBookmark();K.cleanupParentList(L);M.moveToPBBookmark(E)}B.execCommand("IndentList")}if(tinymce.isIE){K.getParent(M.getNode(),function(N){if(N.nodeName=="BLOCKQUOTE"){N.dir=N.style.cssText=""}})}});B.addCommand("Outdent",function(){var K=B.dom,N=B.selection,I,M,G,H,J=K.getParent(N.getNode(),K.isList);G=B.settings.indentation;H=/[a-z%]+$/i.exec(G);G=parseInt(G);if(B.settings.inline_styles&&!J){tinymce.each(N.getSelectedBlocks(),function(Q){if(K.isList(Q)||Q.nodeName.toUpperCase=="LI"){return }var P=parseInt(Q.style.paddingLeft||0);var O=parseInt(Q.style.marginLeft||0);P=Math.round(P/G)*G;O=Math.round(O/G)*G;if(P&&O){O-=P;P=0}else{if(P){P-=G}else{O-=G}}if(O<0){O=0}if(P<0){P=0}if(Q.nodeName.toUpperCase()=="TD"&&O){P+=O;O=0}K.setStyle(Q,"paddingLeft",(P)?P+H:null);K.setStyle(Q,"marginLeft",(O)?O+H:null)});return }if(J){var D=N.getRng(true),F=D.startContainer,L=(F.nodeName.toUpperCase()=="LI")?F:K.getParent(F,"LI");if(L){var E=N.getPBBookmark();K.cleanupParentList(L);N.moveToPBBookmark(E)}B.execCommand("OutdentList")}})}});tinymce.PluginManager.add("pbindent",tinymce.plugins.pbindent)})();(function(){tinymce.create("tinymce.plugins.PreElementFix",{init:function(A,B){var C=this;if(tinymce.isIE||tinymce.isWebKit){A.onKeyDown.add(function(D,G){var H,F=D.selection;if(G.keyCode==13&&F.getNode().nodeName=="PRE"){var E='<br id="__preElementFix" /> ';F.setContent(E,{format:"raw"});H=D.dom.get("__preElementFix");H.removeAttribute("id");F.select(H);F.collapse();return tinymce.dom.Event.cancel(G)}})}if(tinymce.isGecko){A.onKeyDown.add(function(D,F){var G,E=D.selection;if(F.keyCode==9&&E.getNode().nodeName=="PRE"){E.setContent("\t",{format:"raw"});return tinymce.dom.Event.cancel(F)}})}A.onBeforeGetContent.add(function(D,E){C._replaceBrElementsWithNewlines(D);C._removeSpanElementsInPreElementsForWebKit(D)})},getInfo:function(){return{longname:"Pre Element Fix",author:"tan@enonic.com",authorurl:"http://www.enonic.com",infourl:"http://www.enonic.com",version:"1.0"}},_replaceBrElementsWithNewlines:function(D){var B=D.dom.select("pre br");for(var E=0;E<B.length;E++){var C;if(tinymce.isIE){C="\r"}else{C="\n"}var A=D.getDoc().createTextNode(C);D.dom.insertAfter(A,B[E]);D.dom.remove(B[E])}},_removeSpanElementsInPreElementsForWebKit:function(B){if(tinymce.isWebKit){var A=B.dom.select("pre span");for(var C=0;C<A.length;C++){var D=B.getDoc().createTextNode(A[C].innerHTML);B.dom.insertAfter(D,A[C]);B.dom.remove(A[C])}}}});tinymce.PluginManager.add("preelementfix",tinymce.plugins.PreElementFix)})();(function(){var A=tinymce.DOM;tinymce.create("tinymce.plugins.pblist",{init:function(C){var D=this;C.onKeyDown.add(function(I,J){if(J.keyCode==9&&!J.altKey&&!J.ctrlKey){var H=I.selection.getNode();if((I.dom.getParent(H,"UL")||I.dom.getParent(H,"OL"))){if(!I.selection.isAtBlockStart()&&I.selection.getSelectedBlocks().length==1){I.execCommand("mceInsertContent",false,"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;");return tinymce.dom.Event.cancel(J)}if(H.innerHTML==""||H.innerHTML=="<br>"){var O=true}if(J.shiftKey){I.execCommand("Outdent");I.selection.collapseToNode()}else{I.execCommand("Indent");I.selection.collapseToNode()}if(O){I.selection.select(H,true)}return tinymce.dom.Event.cancel(J)}else{I.execCommand("mceInsertContent",false,"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;")}return tinymce.dom.Event.cancel(J)}else{if(J.keyCode==8){var H=I.selection.getNode(),L=I.dom,F=I.selection.getRng(true),M=I.selection.isCollapsed(),K=(L.getParent(F.startContainer,L.isList)||L.getParent(F.endContainer,L.isList));if(!K){return }if(M&&I.selection.isAtBlockStart()){I.execCommand("Outdent");I.selection.collapseToNode();return tinymce.dom.Event.cancel(J)}else{if(!M){if(L.getParent(F.startContainer,"LI")==L.getParent(F.endContainer,"LI")){return }I.execCommand("RemoveListSelection");return tinymce.dom.Event.cancel(J)}}}else{if(J.keyCode==13){if(J.shiftKey){return }var L=I.dom,P=I.selection,H=P.getNode(),N=(H.nodeName.toUpperCase()=="LI")?H:I.dom.getParent(P.getNode(),"LI");if(!N){return }var G=P.getPBBookmark();L.cleanupParentList(N);P.moveToPBBookmark(G);if(I.dom.isEmpty(N)||N.innerHTML&&N.innerHTML.replace(/<[^>]+>/g,"")=="&nbsp;"){I.execCommand("OutdentList");I.selection.collapseToNode();return tinymce.dom.Event.cancel(J)}else{if(tinymce.isOpera){return }I.execCommand("InsertListItem");return tinymce.dom.Event.cancel(J)}}}}});C.onKeyUp.add(function(F,G){if(G.keyCode==8){var H=F.selection.getNode();if(H.nodeName.toUpperCase()=="LI"&&F.dom.isEmpty(H)){H.innerHTML="&nbsp;";F.selection.collapseToNode(H)}}});C.addCommand("InsertListItem",function(){d=C.dom,s=C.selection,n=s.getNode(),li=(n.nodeName.toUpperCase()=="LI")?n:d.getParent(s.getNode(),"LI");if(!li){return }if(s.tridentSel){s.tridentSel.destroy()}var F=s.getRng(true);var I=d.create("li");var J=C.dom.createRng();J.setStart(li,0);J.setEnd(F.startContainer,F.startOffset);I.appendChild(J.extractContents());F.deleteContents();var H=function(M){if(!M){return }while(M.firstChild&&M.firstChild.nodeType==3){d.remove(M.firstChild)}if(!M.firstChild||!M.firstChild.nodeType==1){M.innerHTML="&nbsp;";return }while(M.childNodes.length>1){d.remove(M.childNodes[1])}while(M.firstChild&&M.firstChild.nodeType==1&&M.firstChild.nodeName.toUpperCase()!="BR"){M=M.firstChild}M.innerHTML="&nbsp;"};if(C.dom.isEmpty(I)){H(I)}li.parentNode.insertBefore(I,li);if(C.dom.isEmpty(li)){H(li);tinymce.each(C.dom.select("a",li),function(M){if(!M){return }C.dom.remove(M,true)})}C.selection.collapseToNode(li);try{var G=C.dom.getViewPort(C.getWin()),L=C.dom.getPos(li).y;if(L+li.clientHeight>G.y+G.h){C.getWin().scrollTo(0,L-(G.h-li.clientHeight))}}catch(K){}});C.addCommand("RemoveListSelection",function(){var Q=C.dom,T=C.selection,F=T.getRng(true),S,J,M,N,L,R;if(T.isCollapsed()){return }T.expandRange(F);S=F.commonAncestorContainer;if(S!=C.getBody()){S=Q.getParent(F.commonAncestorContainer.parentNode,Q.isList)}if(!S){S=C.getBody()}var O=function(U){if(U.parentNode==S||U==S){return true}};J=Q.getParent(F.startContainer,O);M=Q.getParent(F.endContainer,O);N=M.nextSibling;L=J.previousSibling;var P=C.dom.createRng();P.setStartBefore(J);P.setEnd(F.startContainer,F.startOffset);var H=C.dom.createRng();H.setStart(F.endContainer,F.endOffset);H.setEndAfter(M);var K=H.extractContents();var I=P.extractContents();L=L?L.nextSibling:S.firstChild;while(!N||L!=N){if(L.nextSibling){L=L.nextSibling;S.removeChild(L.previousSibling)}else{S.removeChild(L);break}}if(I&&!Q.isEmpty(I)){S.insertBefore(I,N)}R=(N&&N.previousSibling)?N.previousSibling:null;if(K&&!Q.isEmpty(K)){S.insertBefore(K,N)}var G;if(!R){R=Q.select("*",C.getBody())[0];while(R&&(G=Q.select("*",R))&&G.length>0){R=G[0]}if(R){T.collapseToNode(R)}}else{while(R&&R.nodeType==3&&R.data.replace(/\n/g,"")==""){R=R.previousSibling}while(R&&(G=Q.select("*",R))&&G.length>0){R=G[G.length-1]}if(R.nodeType==3){R=R.parentNode}T.collapseToNode(R,true)}Q.combineAllAdjacentLists()});var B=function(F,Q){var R=C.dom,U=C.selection,M;var I=(F.startContainer.nodeName.toUpperCase()=="LI")?F.startContainer:R.getParent(F.startContainer,"LI");var L=(F.endContainer.nodeName.toUpperCase()=="LI")?F.endContainer:R.getParent(F.endContainer,"LI");if(I&&L){M=R.findCommonAncestor(I.parentNode,L.parentNode)}else{if(F.startContainer==F.endContainer){I=L=M=F.startContainer}else{if(R.getParents(F.startContainer).indexOf(F.endContainer)!=-1){I=(F.startContainer.nodeName.toUpperCase()=="LI")?F.startContainer:R.getParent(F.startContainer,"LI");L=M=F.endContainer}else{if(R.getParents(F.endContainer).indexOf(F.startContainer)!=-1){L=(F.endContainer.nodeName.toUpperCase()=="LI")?F.endContainer:R.getParent(F.endContainer,"LI");I=M=F.startContainer}}}}var S=M.parentNode;var O=M.nextSibling;var N=R.createRng(true);N.setStartBefore(M);N.setEndBefore(I);var H=N.extractContents();var G=R.createRng(true);G.setStartAfter(L);G.setEndAfter(M);var K=G.extractContents();if(H.firstChild&&H.firstChild.getElementsByTagName("li").length!=0){S.insertBefore(H,M)}try{if(Q){var T;while(T=M.firstChild){M.parentNode.insertBefore(T,M);if(M.childNodes.length==0){M.parentNode.removeChild(M)}if(T.nodeName.toUpperCase()=="LI"&&!R.isList(T.parentNode)){R.replace(R.create("p"),T,true)}}}else{var J=R.create(M.nodeName);M.parentNode.insertBefore(J,M);J.appendChild(M)}}catch(P){PBwiki.error(P.message)}if(K.firstChild&&K.firstChild.getElementsByTagName("li").length!=0){S.insertBefore(K,O)}R.combineAdjacentLists(R.getParentList(M))};var E=function(L){var O=C.dom,R=C.selection,K,N,Q,P=this,M,I,J,H;var G=R.getPBBookmark();var F=R.getRng(true);if(F.commonAncestorContainer.nodeName.toUpperCase()=="BODY"){tinymce.each(F.commonAncestorContainer.childNodes,function(T){return ;if(T.nodeType!=1||!O.isList(T)||!T.lastChild){return }var S=O.createRng(true);S.setStartBefore(T.firstChild);S.setEndAfter(T.lastChild);J=F.compareBoundaryPoints(F.END_TO_START,S);M=F.compareBoundaryPoints(F.START_TO_START,S);if(J==1&&M==1){return }I=F.compareBoundaryPoints(F.START_TO_END,S);H=F.compareBoundaryPoints(F.END_TO_END,S);if(I==-1&&H==-1){return false}if(M==1&&J==-1){S.setStart(F.startContainer,F.startOffset);B(S,L)}else{if(I==1&&H==-1){S.setEnd(F.endContainer,F.endOffset);B(S,L)}else{if(M==-1&&H==1){B(S,L)}}}})}else{B(F,L)}R.moveToPBBookmark(G)};C.addCommand("IndentList",function(){E()});C.addCommand("OutdentList",function(){E(true)});C.addCommand("InsertUnorderedList",function(){var G=C.dom;var F=C.selection.getNode();C.getDoc().execCommand("InsertUnorderedList",false,null);G.combineAdjacentLists(G.getParentList(C.selection.getNode()))});C.addCommand("InsertOrderedList",function(){var G=C.dom;var F=C.selection.getNode();C.getDoc().execCommand("InsertOrderedList",false,null);G.combineAdjacentLists(G.getParentList(C.selection.getNode()))})}});tinymce.PluginManager.add("pblist",tinymce.plugins.pblist)})();(function(){var A=tinymce.DOM;tinymce.create("tinymce.plugins.pbtips",{init:function(E){var J=this,F,H,G,I;var C=function(){F=new Element("div",{"class":"tooltip"});F.innerHTML='<div class="xtop"><div class="xb2"></div><div class="xb3"></div><div class="xb4"></div></div><div class="xboxcontent"></div><div class="xbottom"><div class="xb4"></div><div class="xb3"></div><div class="xb2"></div><div class="xb1"></div></div>';document.body.appendChild(F);return F};var B=function(){var X=E.selection.getNode();X=X.nodeName.toUpperCase()=="A"?X:E.dom.getParent(X,"A");var M=X.getAttribute("_mce_href")||X.getAttribute("href");if((G&&G==M)||(H&&H==M)||X.getAttribute("_no_tip")=="true"){return false}else{if(H){D()}}if(I){return }var P=E.selection.getRng(true);if(P.collapsed&&!(P.startContainer.nodeType==3&&P.startOffset<P.startContainer.data.length)){var f=E.dom.createRng();f.setStart(P.startContainer,P.startOffset);f.setEndAfter(X);if(E.dom.isEmpty(f.cloneContents())){return false}}var b=E.dom.getRect(X),S=$(E.settings.id+"_ifr"),O=S.cumulativeOffset(),T=S.getHeight(),a=S.getWidth();var L=E.getBody().scrollTop||E.getDoc().documentElement.scrollTop;var Z=E.getBody().scrollLeft||E.getDoc().documentElement.scrollLeft;var V=X.getBoundingClientRect().left+O[0]-Z;var U=b.y+b.h+O[1]-L+5;if(U<O-50||U>O+T+50){return }H=M;G=null;F=C();F.setStyle({top:U+"px",left:V+"px"});var Y=F.down("div.xboxcontent");var N=Util.getLinkInfo(H);var K=new Element("a");var W;switch(N.type){case"file":W=Util.getFileIcon(N.url);break;case"folder":W="foldericon";break}if(W){K.className="iconbutton "+W;K.setStyle({textDecoration:"underline"})}Y.appendChild(document.createTextNode("Open "+(N.type=="url"?"URL":N.type)+": "));K.setAttribute("href",N.url);K.setAttribute("target","_blank");K.update(N.txt.escapeTruncate());Y.appendChild(K);Y.appendChild(document.createTextNode(" - "));var h=new Element("a").update("edit");h.setAttribute("href","#");h.onmousedown=function(){setTimeout(function(){D()},100);E.execCommand("mcePbLink");return false};Y.appendChild(h);var R=new Element("a").update("remove");R.setAttribute("href","#");R.onmousedown=function(){E.execCommand("unlink");return false};if(!Util.is_valid_url(X.innerHTML)){Y.appendChild(document.createTextNode(" - "));Y.appendChild(R)}Y.appendChild(document.createTextNode(" "));var g=new Element("a",{href:"#"});var Q=new Element("img",{src:"/shared/images/micro-close-icon.gif"});Q.setStyle({marginBottom:"1px",verticalAlign:"text-bottom"});g.appendChild(Q);g.onmousedown=function(){G=H;D();setTimeout(function(){G=null},500);return false};Y.appendChild(g);E.dom.bind(E.getWin(),"scroll",D);document.observe("ui:fullscreen",D);document.observe("ui:nofullscreen",D);document.observe("ui:sourcemode",D);document.observe("ui:hidetips",D);Event.observe(window,"resize",D);var e=Y.getWidth();if(V+e>O[0]+a-25){F.setStyle({left:(O[0]+a-e-25)+"px"})}};var D=function(){if(F){F.remove();F=null;H=null;E.dom.unbind(E.getWin(),"scroll",D);Event.stopObserving(window,"resize",D);document.stopObserving("ui:fullscreen",D);document.stopObserving("ui:nofullscreen",D);document.stopObserving("ui:nofullscreen",D);document.stopObserving("ui:hidetips",D)}};E.onInit.add(function(K){E=K;E.onNodeChange.add(function(){var M=E.selection.getNode(),L=M.nodeName.toUpperCase();if(L=="A"||E.dom.getParent(M,"A")){B()}else{if(F){D()}}});E.onContextMenu.add(function(){D()});E.onRemove.add(function(){D()});if(tinymce.isIE){E.onSetContent.add(function(){I=true;setTimeout(function(){I=false},100)})}})}});tinymce.PluginManager.add("pbtips",tinymce.plugins.pbtips)})();(function(){var A=tinymce.DOM;tinymce.create("tinymce.plugins.webkitimgsize",{resizeControlSize:16,init:function(L){if(!tinymce.isWebKit&&!tinymce.isOpera){return }var P=this,H,I,M,C,O,G,N,F;L.onMouseDown.add(function(R,S){if(S.button==2){return }if(S.target.nodeName=="IMG"){if(I==S.target){return }else{K(R)}I=S.target;Q(R);R.selection.select(S.target);S.preventDefault()}else{if(G){if(S.target==O){E(R);S.preventDefault();return false}else{if(S.target.nodeName!="HTML"){K(R)}}}}});var E=function(R){if(!I){return }try{F=H.create("div");H.setStyles(F,{position:"absolute",zIndex:100,top:C.style.top,left:C.style.left,width:I.width,height:I.height,border:"1px dashed #000",opacity:0.8});M=R.getBody();M.appendChild(F);R.onMouseUp.add(D);M.addEventListener("mousemove",B,false)}catch(S){}};var D=function(R,T){try{if(F){if(I){H.setStyles(I,{width:F.style.width,height:F.style.height})}H.setAttrib(I,"mce_style","");H.remove(F);F=null;if(I){var S=I;K(R);I=S;Q(R)}}R.onMouseUp.remove(D);M.removeEventListener("mousemove",B,false)}catch(T){}};var B=function(W){if(!F){return }var V=(W.pageY)-parseInt(C.style.top);if(V<1){V=1}var U=(W.pageX)-parseInt(C.style.left);if(U<1){U=1}var T=V/I.height;var R=U/I.width;var S=Math.max(T,R);H.setStyles(F,{width:Math.round(S*I.width),height:Math.round(S*I.height)})};var Q=function(R){if(G){return }try{H=R.dom;var T=H.getPos(I);T.w=I.width;T.h=I.height;C=H.create("div");C.isImgSizer=true;H.setStyles(C,{border:"1px solid #000",position:"absolute",top:T.y-1,left:T.x-1,width:T.w,height:T.h,zIndex:-1});R.getBody().appendChild(C);O=H.create("div");H.setAttrib(O,"title","Drag to resize image");H.setStyles(O,{backgroundColor:"#fff",border:"1px solid #000",position:"absolute",top:T.y+T.h-(P.resizeControlSize/2),left:T.x+T.w-(P.resizeControlSize/2),width:P.resizeControlSize,height:P.resizeControlSize,zIndex:102,cursor:"se-resize"});O.onmouseover=function(){H.setStyle(O,"background-color","#000")};O.onmouseout=function(){H.setStyle(O,"background-color","#fff")};R.onKeyDown.add(J);R.getBody().appendChild(O);G=true}catch(S){}};var J=function(R,S){K(R)};var K=function(R){try{if(C){H.remove(C);C=null}if(O){H.remove(O);O=null}I=null;G=false;R.onKeyDown.remove(J)}catch(S){alert(S.message)}}}});tinymce.PluginManager.add("webkitimgsize",tinymce.plugins.webkitimgsize)})();(function(){var dom=tinymce.DOM;tinymce.create("tinymce.plugins.linkify",{init:function(ed){var nodeHasLinks=function(n){if(!n||n.nodeType!=1){return false}var foundLink=false,h=n.innerHTML;tinymce.each(h.match(/http(s)?:(\/\/)([\w]+(.[\w]+))([\w\-\.,@?^=%&:;\/~\+#]*)/g),function(l){if(h.charAt(h.indexOf(l)-1)!='"'&&h.substr(h.indexOf(l)+l.length,4)!="</a>"){foundLink=true;return false}});return foundLink};var addNodeLinks=function(n){if(!n||!n.childNodes||n.childNodes.length==0){return }var linkRegex=eval(PBconst.kLinkifyRegex+"i"),child=n.firstChild;do{if(child.nodeType==1&&["A","PRE"].indexOf(child.nodeName.toUpperCase())==-1){addNodeLinks(child)}else{if(child.nodeType==3){if(!child.data){continue}var r=linkRegex.exec(child.data);if(!r){continue}var pos=child.data.search(linkRegex);if(pos>0){child=child.splitText(pos+1)}if(r[2].length<child.data.length){child=child.splitText(r[2].length);child=child.previousSibling}var link=ed.dom.create("a");link.setAttribute("href",child.data);child.parentNode.insertBefore(link,child);link.appendChild(child);child=link}}}while(child=child.nextSibling)};ed.onBeforeGetContent.add(function(ed,o){if(nodeHasLinks(ed.getBody())){addNodeLinks(ed.getBody())}});ed.onKeyDown.add(function(ed,e){if(tinymce.isIE){return }if(e.keyCode!=32&&e.keyCode!=13){return }var s=ed.selection,n=s.getNode();if(nodeHasLinks(n)&&!ed.dom.getParent(n,"A")){var bm=ed.selection.getPBBookmark();addNodeLinks(n);ed.selection.moveToPBBookmark(bm)}})}});tinymce.PluginManager.add("linkify",tinymce.plugins.linkify)})();(function(){var C=tinymce.DOM,B,A;tinymce.create("tinymce.plugins.pbinsert",{init:function(D){B=D;B.onRemove.add(function(){$$("div.mceButtonMenu").invoke("remove")})},createControl:function(F,D){switch(F){case"pbinsert":var E=D.createMenuButton("pbinsert",{label:"Insert",icon:false},tinymce.ui.InsertMenuButton);E.onRenderMenu.add(function(J,G){G.removeAll();G.add({title:"Link",icon:"pblink",shortcut:"L",onclick:function(){B.execCommand("mcePbLink")}});var H=G.createMenuOfType("TableMenu",{title:"Table",icon:"pbtable"});G.addMenu(H);if(PBwiki.userCanCreateTask()){G.add({title:"Task",icon:"pbtask",shortcut:"K",onclick:function(){B.execCommand("mcePbNewTask")}})}G.add({title:"Horizontal line",icon:"hr",onclick:function(){B.execCommand("InsertHorizontalRule")}});G.addSeparator();if(PBinfo.CurrentWiki&&PBinfo.CurrentWiki.cloneable&&PBwiki.feature("template_variables")){G.add({title:"Template Variable",icon:"application_form_add",onclick:function(){B.execCommand("mcePbPlugin",false,"template_variables")}})}G.add({title:"Table of Contents",icon:"page_white_text",onclick:function(){B.execCommand("mcePbPlugin",false,"toc")}});var I=G.addMenu({title:"Video",icon:"film"});I.add({title:"YouTube",icon:"youtube",onclick:function(){B.execCommand("mcePbPlugin",false,"youtube")}});I.add({title:"Other...",icon:"film_go",onclick:function(){B.execCommand("mcePbPlugin",false,"oembed")}});if(!PBinfo.CurrentNetwork){I.add({title:"Upload Video",icon:"film_go",onclick:function(){B.execCommand("mcePbPlugin",false,"fliqz")}})}G.add({title:"Calendar",icon:"calendar_view_month",onclick:function(){B.execCommand("mcePbPlugin",false,"30boxes_pbwiki")}});if(PBwiki.feature("editor_gliffy")){G.add({title:"Diagram/Flowchart",icon:"chart_organisation_add",onclick:function(){B.execCommand("mcePbAddGliffyDiagram")}})}if((PBinfo.CurrentNetwork&&PBinfo.CheckPermissions.network_perm=="admin")||(!PBinfo.CurrentNetwork&&PBinfo.CheckPermissions.wikiperm=="admin")){G.add({title:"HTML/JavaScript",icon:"pbcode",onclick:function(){B.execCommand("mcePbPlugin",false,"external")}})}else{G.add({title:"HTML",icon:"pbcode",onclick:function(){B.execCommand("mcePbPlugin",false,"external")}})}A=G.createMenuOfType("PluginMenu",{id:"insert_plugin",title:"More Plugins...",icon:"pbplugin"});G.addMenu(A)});return E}}});tinymce.create("tinymce.ui.PluginMenu:tinymce.ui.DropMenu",{showMenu:function(D,G,F){var E=this;if(!E.pluginsLoaded&&!E.isLoadingPlugins){E.isLoadingPlugins=true;E.removeAll();E.add({title:"Loading Plugins..."});(new PBwiki.APIRequest("GetPlugins",{},{onSuccess:function(H){E.isLoadingPlugins=false;E.pluginsLoaded=true;E.hideMenu(1);E.removeAll();$H(H.plugins).each(function(J){var I=E.createMenu({title:J.key,icons:false});$H(J.value).each(function(K){if(["toc","youtube","fliqz","30boxes_pbwiki","external","gliffy"].indexOf(K.key)!=-1){return }I.add({id:K.key,title:K.value,onclick:function(){B.execCommand("mcePbPlugin",false,K.key)}})});E.addMenu(I)});E.showMenu(D,G,F)}}))}this.parent(D,G,F)}});tinymce.create("tinymce.ui.InsertMenuButton:tinymce.ui.MenuButton",{renderHTML:function(){var H=this.classPrefix,F=this.settings,E,D,G=tinymce.DOM;D=G.encode(F.label||"");E='<a id="'+this.id+'" href="javascript:;" class="'+H+" "+H+"Enabled "+F["class"]+(D?" "+H+"Labeled":"")+' mceButtonMenu" onmousedown="return false;" onclick="return false;" title="'+G.encode(F.title)+'">';E+='<span class="'+H+'Label">'+D+'</span><span class="mceIcon mceOpen '+F["class"]+'"></span>';return E}});tinymce.PluginManager.add("pbinsert",tinymce.plugins.pbinsert)})();(function(){var B=tinymce.DOM,A;tinymce.create("tinymce.plugins.pbtablemenu",{init:function(C){C.onInit.add(function(D){A=D})},createControl:function(E,C){switch(E){case"pbtablemenu":var D=C.createMenuButton("pbtablemenu",{label:"Table",icon:false},tinymce.ui.TableMenuButton);D.onRenderMenu.add(function(H,F){var G=F.createMenuOfType("TableMenu",{id:"insert_table",title:"Insert table",icon:"pbtable"});F.addMenu(G);F.add({title:"Table properties",icon:"table_props",cmd:"mceInsertTable",ui:true});F.add({title:"Remove table",icon:"delete_table",cmd:"mceTableDelete",ui:true});F.addSeparator();sm=F.addMenu({title:"table.cell",icon:"table_pbcell"});sm.add({title:"table.cell_desc",icon:"cell_props",cmd:"mceTableCellProps",ui:true});sm.add({title:"Merge cells",icon:"merge_cells",cmd:"mceTableMergeCells",ui:true});sm.add({title:"Split selected cell",icon:"split_cells",cmd:"mceTableSplitCells",ui:true});sm=F.addMenu({title:"table.row",icon:"table_pbrow"});sm.add({title:"table.row_before_desc",icon:"row_before",cmd:"mceTableInsertRowBefore"});sm.add({title:"table.row_after_desc",icon:"row_after",cmd:"mceTableInsertRowAfter"});sm.add({title:"table.delete_row_desc",icon:"delete_row",cmd:"mceTableDeleteRow"});sm.addSeparator();sm.add({title:"table.cut_row_desc",icon:"cut",cmd:"mceTableCutRow"});sm.add({title:"table.copy_row_desc",icon:"copy",cmd:"mceTableCopyRow"});sm.add({title:"table.paste_row_before_desc",icon:"paste",cmd:"mceTablePasteRowBefore"});sm.add({title:"table.paste_row_after_desc",icon:"paste",cmd:"mceTablePasteRowAfter"});sm=F.addMenu({title:"table.col",icon:"table_pbcolumn"});sm.add({title:"table.col_before_desc",icon:"col_before",cmd:"mceTableInsertColBefore"});sm.add({title:"table.col_after_desc",icon:"col_after",cmd:"mceTableInsertColAfter"});sm.add({title:"table.delete_col_desc",icon:"delete_col",cmd:"mceTableDeleteCol"})});return D}}});tinymce.create("tinymce.ui.TableMenuButton:tinymce.ui.MenuButton",{renderHTML:function(){var G=this.classPrefix,E=this.settings,D,C,F=tinymce.DOM;C=F.encode(E.label||"");D='<a id="'+this.id+'" href="javascript:;" class="'+G+" "+G+"Enabled "+E["class"]+(C?" "+G+"Labeled":"")+' mceButtonMenu" onmousedown="return false;" onclick="return false;" title="'+F.encode(E.title)+'">';D+='<span class="'+G+'Label">'+C+'</span><span class="mceIcon mceOpen '+E["class"]+'"></span>';return D},showMenu:function(){this.parent();var E=A.selection.getNode();E=E.nodeName.toUpperCase()=="TD"?E:A.dom.getParent(E,"TD");var C=!E&&A.dom.select("td.mceSelected,th.mceSelected").length==0;var D=E?E.getAttribute("colspan")>1||E.getAttribute("rowspan")>1:false;tinymce.each(this.menu.items,function(F){if(F.id!="insert_table"){F.setDisabled(C)}tinymce.each(F.items,function(G){switch(G.settings.cmd){case"mceTablePasteRowBefore":case"mceTablePasteRowAfter":G.setDisabled(!A.clipboardRows);case"mceTableSplitCells":G.setDisabled(!D)}})})}});tinymce.create("tinymce.ui.TableMenu:tinymce.ui.DropMenu",{showMenu:function(C,E,D){this.parent(C,E,D);if(!this.elemPanel){this.elemPanel=this._createPanel();$(this.element.id).appendChild(this.elemPanel)}},hideMenu:function(C){this.parent(C);if(this.elemPanel){this.elemPanel.parentNode.removeChild(this.elemPanel);this.elemPanel=null}},_createPanel:function(){var F=this;var H=tinymce.DOM.create("div",{"class":"te-panel"});var D=tinymce.DOM.create("div",{"class":"te-table-border-color"});var E=this.elemTable=this._createTable();tinymce.dom.Event.add(E,"mouseout",function(K){var J=K.relatedTarget||K.toElement;if(J==E||A.dom.getParent(J,"table")==E){return }F._clearTable()});var G=this.elemTitle=tinymce.DOM.create("div",{"class":"te-title"});G.innerHTML="Insert Table";var C=tinymce.DOM.create("div",{"class":"te-info"});C.appendChild(tinymce.DOM.create("div"));var I=tinymce.DOM.create("a",{"class":"te-link",href:"#"});I.innerHTML="Insert Table...";C.appendChild(I);tinymce.dom.Event.add(C,"mousedown",function(){var J=A.selection.getBookmark();new PBwiki.DialogCommands.CreateTable({insertion_function:function(L,K){A.selection.moveToBookmark(J);return F._insertTableToEditorDocument(L,K)}})});tinymce.dom.Event.add(C,"mouseover",function(){F._clearTable()});H.appendChild(G);H.appendChild(D);D.appendChild(E);H.appendChild(C);return H},_createTable:function(){var E=tinymce.DOM.create("table",{border:"0",cellSpacing:0,cellPadding:0,"class":"te-table"});var I=tinymce.DOM.create("tbody",{});var C=8,G=8;var H,J;for(var F=0;F<C;F++){H=tinymce.DOM.create("tr",{});I.appendChild(H);for(var D=0;D<G;D++){J=this._createCell(F,D);H.appendChild(J)}}E.appendChild(I);return E},_createCell:function(E,C){var F=tinymce.DOM.create("td"),D=this;F.row=E;F.col=C;F.innerHTML="<p>&nbsp;</p>";F.className="blank";tinymce.dom.Event.add(F,"mouseover",function(G){if(G.target.nodeName.toUpperCase()!="TD"){return }D._fillCells(G.target)});tinymce.dom.Event.add(F,"mousedown",function(){D._insertTableToEditorDocument((E+1),(C+1))});return F},_fillCells:function(C){var J=this.elemTable.getElementsByTagName("tr");var K=J.length;var I=C.row+1,G=C.col+1;var E,H;for(var F=0;F<K;F++){E=J[F].getElementsByTagName("td");H=E.length;for(var D=0;D<H;D++){if(D<G&&F<I){E[D].className="fill";this.elemTitle.innerHTML=(F+1)+"x"+(D+1)+" Table"}else{E[D].className="blank"}}}},_clearTable:function(){var D=this.elemTable.getElementsByTagName("td");var E=D.length;for(var C=0;C<E;C++){D[C].className="blank"}this.elemTitle.innerHTML="Insert Table"},_insertTableToEditorDocument:function(C,D){var E=A.dom;var I=(A.getBody().clientWidth*0.75);var K='<table border="0" width="'+I+'" class="mceItemTable">\n';K+="<tbody>\n";for(var G=0;G<C;G++){K+="<tr>\n";for(var F=0;F<D;F++){K+="<td";if(G==0&&F==0){K+=' class="pbSelectCell"'}K+=">&nbsp;</td>\n"}K+="</tr>\n"}K+="</tbody>\n";K+="</table><p>&nbsp;</p>\n";var J="";A.execCommand("mceInsertContent",false,'<br class="_mce_marker" />');tinymce.each("h1,h2,h3,h4,h5,h6,p".split(","),function(L){if(J){J+=","}J+=L+" ._mce_marker"});tinymce.each(E.select(J),function(L){E.split(E.getParent(L,"h1,h2,h3,h4,h5,h6,p"),L)});E.setOuterHTML(A.dom.select("._mce_marker")[0],K);var H=A.dom.select(".pbSelectCell")[0];setTimeout(function(){if(!H){return }A.focus();A.selection.select(H.firstChild||H,true);A.selection.collapse(true)},50);A.dom.removeClass(H,"pbSelectCell");return A.dom.getParent(H,"TABLE")}});tinymce.PluginManager.add("pbtablemenu",tinymce.plugins.pbtablemenu)})();(function(){var A=tinymce.DOM;tinymce.create("tinymce.plugins.pbquicklink",{init:function(L){var Q=this,K,N,O,H,G,E,D;var I=function(){N=new Element("div",{"class":"tooltip quicklink",style:"overflow: visible;"});N.innerHTML='<div id="pb_quicklink_top"><img class="arrow" src="/shared/images/edit-bubble-arrow-up.gif"></div><div class="xtop"><div class="xb2"></div><div class="xb3"></div><div class="xb4"></div></div><div class="xboxcontent"><a class="tooltip_close" href="#"><img src="/shared/images/micro-close-icon.gif" class="close"></a><div style="font-size: 13px; font-weight: bold;">Insert Link</div><div style="margin-top: 5px;">Enter part of a <strong>page name</strong>, <strong>web address</strong>, or <strong>file</strong></div><div style="margin: 5px 0pt 10px;"><form id="pb_quicklink_form"><input id="pb_quicklink_input" type="text" style="width: 300px;" class="text"></form></div><div style="margin-bottom: 5px;"><a href="#" id="pb_quicklink_browse" class="iconbutton browse">Browse Pages &amp; Files &raquo;</a></div></div><div class="xbottom"><div class="xb4"></div><div class="xb3"></div><div class="xb2"></div><div class="xb1"></div></div><div id="pb_quicklink_bottom" style="display: none;"><img class="arrow arrow_bottom" src="/shared/images/edit-bubble-arrow-down.gif"></div>';document.body.appendChild(N);return N};var J=function(){if(!N){return }document.body.removeChild(N);N=null};var M=function(){P()};var C=function(T){var k=K.dom;if(N){R()}var e=K.selection.getNode(),l=K.selection.isCollapsed(),a=K.selection.getContent({format:"text"}).strip();G=T;E=K.selection.getPBBookmark();Util.tracking("editor-linking-load-"+(!l?"txt":"collapsed"));var X="pblink-"+Math.round(Math.random()*1000000);if(!l){K.selection.moveToPBBookmark(E);K.execCommand("mceInsertLink",false,{href:"#",_no_tip:"true","class":X});E=K.selection.getPBBookmark();K.selection.collapse(false);H=false}else{var f='<a href="#" _no_tip="true" _mce_type="bookmark" class="remove_on_empty '+X+'">[new link]</a>';K.execCommand("mceInsertContent",false,f);H=true}O=K.dom.select("a."+X);var o=O[O.length-1];var j=K.dom.getRect(o),V=$(K.settings.id+"_ifr"),U=V.cumulativeOffset(),W=V.getHeight(),h=V.getWidth();var S=K.getBody().scrollTop||K.getDoc().documentElement.scrollTop;var g=K.getBody().scrollLeft||K.getDoc().documentElement.scrollLeft;var Z=o.getBoundingClientRect().left+U[0]-g;var Y=j.y+j.h+U[1]-S+5;N=I();N.setStyle({top:Y+"px",left:Z+"px"});if(Y+S+$(N).getHeight()+50>S+document.viewport.getHeight()){Y=j.y+U[1]-$(N).getHeight()-S;N.setStyle({top:Y+"px"});$("pb_quicklink_top").hide();$("pb_quicklink_bottom").show()}$("pb_quicklink_browse").observe("click",function(q){q.stop();Util.tracking("editor-linking-quicklink-browse");R();K.execCommand("mcePbLinkDialog")});N.down("a.tooltip_close").observe("click",function(q){q.stop();R()});D=$("pb_quicklink_input");var m=new Element("div",{style:"position: relative;"});var b=false;D.parentNode.appendChild(m);D.observe("keyup",function(q){if(q.keyCode==Event.KEY_ESC){R()}});var p=new PBwiki.Components.QuickLinkAutoComplete({elm:D,container:m,onSelected:function(q){if(b){return }b=true;P(true,q)}});D.focus();if(a){D.value=a;p.doRefresh()}K.dom.bind(K.getWin(),"scroll",R);document.observe("ui:fullscreen",R);document.observe("ui:nofullscreen",R);document.observe("ui:sourcemode",R);Event.observe(window,"resize",R);K.onMouseUp.add(M);K.onRemove.add(R)};var P=function(S,W){var T=D.value.strip();if(S!==true){var V=K.selection.getPBBookmark()}R();var U=false;if(W&&W.type){U={type:W.type,txt:W.name};U.href=Util.getObjectLink(W)}else{if(Util.is_valid_page_name(T)===true){if(Util.is_valid_page_name(T)){U={type:"page",txt:T,href:"/"+Util.dashified_link(T)}}}else{if(T&&Util.is_valid_email(T)===true){U={type:"url",txt:T,href:"mailto:"+T}}else{if(T){if(!/(http|mailto|https|news|ftp|file):/.test(T)){T="http://"+T}U={type:"url",txt:T,href:T}}}}}if(U){Util.tracking("editor-linking-link-quicklink-"+U.type);K.execCommand("mcePbSetLink",false,U)}if(S!==true){K.selection.moveToPBBookmark(V)}if(G&&U){B()}};var R=function(S){if(!N){return }tinymce.each(O,function(U){if(U.getAttribute("_mce_href")!="#"){return }var T=K.dom.hasClass(U,"remove_on_empty");K.dom.remove(U,!T)});J();K.dom.unbind(K.getWin(),"scroll",R);Event.stopObserving(window,"resize",R);document.stopObserving("ui:fullscreen",R);document.stopObserving("ui:nofullscreen",R);document.stopObserving("ui:nofullscreen",R);document.stopObserving("ui:hidetips",R);K.onMouseUp.remove(M);K.onRemove.remove(R);if(!S){K.focus();K.selection.moveToPBBookmark(E)}};var F=function(){var T=K.selection.getRng(true);if(!T.collapsed){return }T=K.selection.changeRangeType(T);if(T.startContainer.nodeType!=3){return }var V=K.dom.getParent(T.startContainer,K.dom.isBlock);if(!V){return }var Y=new tinymce.dom.TreeWalker(V,V),Z,X,U,W,S;do{Z=Y.current();if(Z.nodeType==3){W=Z.data.lastIndexOf("[");if(W!=-1){X=Z;U=W}}if(Z==T.startContainer&&X){S=K.dom.createRng();S.setStart(X,U);S.setEnd(T.startContainer,T.startOffset)}}while(Y.next());if(!S){return }K.selection.setRng(S);C(true)};var B=function(){var S=K.selection.getRng(true);var U=function(V){if(V.nodeType==1){tinymce.each(V.childNodes,U)}if(V.nodeType!=3||!V.data){return }if(V.data.charAt(0)=="["){V.data=V.data.substr(1)}if(V.data.charAt(V.data.length-1)=="]"){V.data=V.data.substr(0,V.data.length-1)}};K.selection.collapse(false);var T=new tinymce.dom.RangeUtils(K.dom);T.walk(S,function(V){tinymce.each(V,U)});setTimeout(function(){document.fire("ui:hidetips")},50)};L.onInit.add(function(S){K=S;K.addCommand("mcePbLinkTip",function(){C()});K.onKeyUp.add(function(T,U){if(U.keyCode==221){F()}})})}});tinymce.PluginManager.add("pbquicklink",tinymce.plugins.pbquicklink)})();
/*
// script.aculo.us effects.js v1.8.1, Thu Jan 03 22:07:12 -0500 2008

// Copyright (c) 2005-2007 Thomas Fuchs (http://script.aculo.us, http://mir.aculo.us)
// Contributors:
//  Justin Palmer (http://encytemedia.com/)
//  Mark Pilgrim (http://diveintomark.org/)
//  Martin Bialasinki
// 
// script.aculo.us is freely distributable under the terms of an MIT-style license.
// For details, see the script.aculo.us web site: http://script.aculo.us/ 
*/
String.prototype.parseColor=function(){var A="#";if(this.slice(0,4)=="rgb("){var C=this.slice(4,this.length-1).split(",");var B=0;do{A+=parseInt(C[B]).toColorPart()}while(++B<3)}else{if(this.slice(0,1)=="#"){if(this.length==4){for(var B=1;B<4;B++){A+=(this.charAt(B)+this.charAt(B)).toLowerCase()}}if(this.length==7){A=this.toLowerCase()}}}return(A.length==7?A:(arguments[0]||this))};Element.collectTextNodes=function(A){return $A($(A).childNodes).collect(function(B){return(B.nodeType==3?B.nodeValue:(B.hasChildNodes()?Element.collectTextNodes(B):""))}).flatten().join("")};Element.collectTextNodesIgnoreClass=function(A,B){return $A($(A).childNodes).collect(function(C){return(C.nodeType==3?C.nodeValue:((C.hasChildNodes()&&!Element.hasClassName(C,B))?Element.collectTextNodesIgnoreClass(C,B):""))}).flatten().join("")};Element.setContentZoom=function(A,B){A=$(A);A.setStyle({fontSize:(B/100)+"em"});if(Prototype.Browser.WebKit){window.scrollBy(0,0)}return A};Element.getInlineOpacity=function(A){return $(A).style.opacity||""};Element.forceRerendering=function(A){try{A=$(A);var C=document.createTextNode(" ");A.appendChild(C);A.removeChild(C)}catch(B){}};var Effect={_elementDoesNotExistError:{name:"ElementDoesNotExistError",message:"The specified DOM element does not exist, but is required for this effect to operate"},Transitions:{linear:Prototype.K,sinoidal:function(A){return(-Math.cos(A*Math.PI)/2)+0.5},reverse:function(A){return 1-A},flicker:function(A){var A=((-Math.cos(A*Math.PI)/4)+0.75)+Math.random()/4;return A>1?1:A},wobble:function(A){return(-Math.cos(A*Math.PI*(9*A))/2)+0.5},pulse:function(B,A){A=A||5;return(((B%(1/A))*A).round()==0?((B*A*2)-(B*A*2).floor()):1-((B*A*2)-(B*A*2).floor()))},spring:function(A){return 1-(Math.cos(A*4.5*Math.PI)*Math.exp(-A*6))},none:function(A){return 0},full:function(A){return 1}},DefaultOptions:{duration:1,fps:100,sync:false,from:0,to:1,delay:0,queue:"parallel"},tagifyText:function(A){var B="position:relative";if(Prototype.Browser.IE){B+=";zoom:1"}A=$(A);$A(A.childNodes).each(function(C){if(C.nodeType==3){C.nodeValue.toArray().each(function(D){A.insertBefore(new Element("span",{style:B}).update(D==" "?String.fromCharCode(160):D),C)});Element.remove(C)}})},multiple:function(B,C){var E;if(((typeof B=="object")||Object.isFunction(B))&&(B.length)){E=B}else{E=$(B).childNodes}var A=Object.extend({speed:0.1,delay:0},arguments[2]||{});var D=A.delay;$A(E).each(function(G,F){new C(G,Object.extend(A,{delay:F*A.speed+D}))})},PAIRS:{slide:["SlideDown","SlideUp"],blind:["BlindDown","BlindUp"],appear:["Appear","Fade"]},toggle:function(B,C){B=$(B);C=(C||"appear").toLowerCase();var A=Object.extend({queue:{position:"end",scope:(B.id||"global"),limit:1}},arguments[2]||{});Effect[B.visible()?Effect.PAIRS[C][1]:Effect.PAIRS[C][0]](B,A)}};Effect.DefaultOptions.transition=Effect.Transitions.sinoidal;Effect.ScopedQueue=Class.create(Enumerable,{initialize:function(){this.effects=[];this.interval=null},_each:function(A){this.effects._each(A)},add:function(B){var C=new Date().getTime();var A=Object.isString(B.options.queue)?B.options.queue:B.options.queue.position;switch(A){case"front":this.effects.findAll(function(D){return D.state=="idle"}).each(function(D){D.startOn+=B.finishOn;D.finishOn+=B.finishOn});break;case"with-last":C=this.effects.pluck("startOn").max()||C;break;case"end":C=this.effects.pluck("finishOn").max()||C;break}B.startOn+=C;B.finishOn+=C;if(!B.options.queue.limit||(this.effects.length<B.options.queue.limit)){this.effects.push(B)}if(!this.interval){this.interval=setInterval(this.loop.bind(this),15)}},remove:function(A){this.effects=this.effects.reject(function(B){return B==A});if(this.effects.length==0){clearInterval(this.interval);this.interval=null}},loop:function(){var C=new Date().getTime();for(var B=0,A=this.effects.length;B<A;B++){this.effects[B]&&this.effects[B].loop(C)}}});Effect.Queues={instances:$H(),get:function(A){if(!Object.isString(A)){return A}return this.instances.get(A)||this.instances.set(A,new Effect.ScopedQueue())}};Effect.Queue=Effect.Queues.get("global");Effect.Base=Class.create({position:null,start:function(options){function codeForEvent(options,eventName){return((options[eventName+"Internal"]?"this.options."+eventName+"Internal(this);":"")+(options[eventName]?"this.options."+eventName+"(this);":""))}if(options&&options.transition===false){options.transition=Effect.Transitions.linear}this.options=Object.extend(Object.extend({},Effect.DefaultOptions),options||{});this.currentFrame=0;this.state="idle";this.startOn=this.options.delay*1000;this.finishOn=this.startOn+(this.options.duration*1000);this.fromToDelta=this.options.to-this.options.from;this.totalTime=this.finishOn-this.startOn;this.totalFrames=this.options.fps*this.options.duration;eval('this.render = function(pos){ if (this.state=="idle"){this.state="running";'+codeForEvent(this.options,"beforeSetup")+(this.setup?"this.setup();":"")+codeForEvent(this.options,"afterSetup")+'};if (this.state=="running"){pos=this.options.transition(pos)*'+this.fromToDelta+"+"+this.options.from+";this.position=pos;"+codeForEvent(this.options,"beforeUpdate")+(this.update?"this.update(pos);":"")+codeForEvent(this.options,"afterUpdate")+"}}");this.event("beforeStart");if(!this.options.sync){Effect.Queues.get(Object.isString(this.options.queue)?"global":this.options.queue.scope).add(this)}},loop:function(C){if(C>=this.startOn){if(C>=this.finishOn){this.render(1);this.cancel();this.event("beforeFinish");if(this.finish){this.finish()}this.event("afterFinish");return }var B=(C-this.startOn)/this.totalTime,A=(B*this.totalFrames).round();if(A>this.currentFrame){this.render(B);this.currentFrame=A}}},cancel:function(){if(!this.options.sync){Effect.Queues.get(Object.isString(this.options.queue)?"global":this.options.queue.scope).remove(this)}this.state="finished"},event:function(A){if(this.options[A+"Internal"]){this.options[A+"Internal"](this)}if(this.options[A]){this.options[A](this)}},inspect:function(){var A=$H();for(property in this){if(!Object.isFunction(this[property])){A.set(property,this[property])}}return"#<Effect:"+A.inspect()+",options:"+$H(this.options).inspect()+">"}});Effect.Parallel=Class.create(Effect.Base,{initialize:function(A){this.effects=A||[];this.start(arguments[1])},update:function(A){this.effects.invoke("render",A)},finish:function(A){this.effects.each(function(B){B.render(1);B.cancel();B.event("beforeFinish");if(B.finish){B.finish(A)}B.event("afterFinish")})}});Effect.Tween=Class.create(Effect.Base,{initialize:function(C,F,E){C=Object.isString(C)?$(C):C;var B=$A(arguments),D=B.last(),A=B.length==5?B[3]:null;this.method=Object.isFunction(D)?D.bind(C):Object.isFunction(C[D])?C[D].bind(C):function(G){C[D]=G};this.start(Object.extend({from:F,to:E},A||{}))},update:function(A){this.method(A)}});Effect.Event=Class.create(Effect.Base,{initialize:function(){this.start(Object.extend({duration:0},arguments[0]||{}))},update:Prototype.emptyFunction});Effect.Opacity=Class.create(Effect.Base,{initialize:function(B){this.element=$(B);if(!this.element){throw (Effect._elementDoesNotExistError)}if(Prototype.Browser.IE&&(!this.element.currentStyle.hasLayout)){this.element.setStyle({zoom:1})}var A=Object.extend({from:this.element.getOpacity()||0,to:1},arguments[1]||{});this.start(A)},update:function(A){this.element.setOpacity(A)}});Effect.Move=Class.create(Effect.Base,{initialize:function(B){this.element=$(B);if(!this.element){throw (Effect._elementDoesNotExistError)}var A=Object.extend({x:0,y:0,mode:"relative"},arguments[1]||{});this.start(A)},setup:function(){this.element.makePositioned();this.originalLeft=parseFloat(this.element.getStyle("left")||"0");this.originalTop=parseFloat(this.element.getStyle("top")||"0");if(this.options.mode=="absolute"){this.options.x=this.options.x-this.originalLeft;this.options.y=this.options.y-this.originalTop}},update:function(A){this.element.setStyle({left:(this.options.x*A+this.originalLeft).round()+"px",top:(this.options.y*A+this.originalTop).round()+"px"})}});Effect.MoveBy=function(B,A,C){return new Effect.Move(B,Object.extend({x:C,y:A},arguments[3]||{}))};Effect.Scale=Class.create(Effect.Base,{initialize:function(B,C){this.element=$(B);if(!this.element){throw (Effect._elementDoesNotExistError)}var A=Object.extend({scaleX:true,scaleY:true,scaleContent:true,scaleFromCenter:false,scaleMode:"box",scaleFrom:100,scaleTo:C},arguments[2]||{});this.start(A)},setup:function(){this.restoreAfterFinish=this.options.restoreAfterFinish||false;this.elementPositioning=this.element.getStyle("position");this.originalStyle={};["top","left","width","height","fontSize"].each(function(B){this.originalStyle[B]=this.element.style[B]}.bind(this));this.originalTop=this.element.offsetTop;this.originalLeft=this.element.offsetLeft;var A=this.element.getStyle("font-size")||"100%";["em","px","%","pt"].each(function(B){if(A.indexOf(B)>0){this.fontSize=parseFloat(A);this.fontSizeType=B}}.bind(this));this.factor=(this.options.scaleTo-this.options.scaleFrom)/100;this.dims=null;if(this.options.scaleMode=="box"){this.dims=[this.element.offsetHeight,this.element.offsetWidth]}if(/^content/.test(this.options.scaleMode)){this.dims=[this.element.scrollHeight,this.element.scrollWidth]}if(!this.dims){this.dims=[this.options.scaleMode.originalHeight,this.options.scaleMode.originalWidth]}},update:function(A){var B=(this.options.scaleFrom/100)+(this.factor*A);if(this.options.scaleContent&&this.fontSize){this.element.setStyle({fontSize:this.fontSize*B+this.fontSizeType})}this.setDimensions(this.dims[0]*B,this.dims[1]*B)},finish:function(A){if(this.restoreAfterFinish){this.element.setStyle(this.originalStyle)}},setDimensions:function(A,D){var E={};if(this.options.scaleX){E.width=D.round()+"px"}if(this.options.scaleY){E.height=A.round()+"px"}if(this.options.scaleFromCenter){var C=(A-this.dims[0])/2;var B=(D-this.dims[1])/2;if(this.elementPositioning=="absolute"){if(this.options.scaleY){E.top=this.originalTop-C+"px"}if(this.options.scaleX){E.left=this.originalLeft-B+"px"}}else{if(this.options.scaleY){E.top=-C+"px"}if(this.options.scaleX){E.left=-B+"px"}}}this.element.setStyle(E)}});Effect.Highlight=Class.create(Effect.Base,{initialize:function(B){this.element=$(B);if(!this.element){throw (Effect._elementDoesNotExistError)}var A=Object.extend({startcolor:"#ffff99"},arguments[1]||{});this.start(A)},setup:function(){if(this.element.getStyle("display")=="none"){this.cancel();return }this.oldStyle={};if(!this.options.keepBackgroundImage){this.oldStyle.backgroundImage=this.element.getStyle("background-image");this.element.setStyle({backgroundImage:"none"})}if(!this.options.endcolor){this.options.endcolor=this.element.getStyle("background-color").parseColor("#ffffff")}if(!this.options.restorecolor){this.options.restorecolor=this.element.getStyle("background-color")}this._base=$R(0,2).map(function(A){return parseInt(this.options.startcolor.slice(A*2+1,A*2+3),16)}.bind(this));this._delta=$R(0,2).map(function(A){return parseInt(this.options.endcolor.slice(A*2+1,A*2+3),16)-this._base[A]}.bind(this))},update:function(A){this.element.setStyle({backgroundColor:$R(0,2).inject("#",function(B,C,D){return B+((this._base[D]+(this._delta[D]*A)).round().toColorPart())}.bind(this))})},finish:function(){this.element.setStyle(Object.extend(this.oldStyle,{backgroundColor:this.options.restorecolor}))}});Effect.ScrollTo=function(D){var C=arguments[1]||{},B=document.viewport.getScrollOffsets(),E=$(D).cumulativeOffset(),A=(window.height||document.body.scrollHeight)-document.viewport.getHeight();if(C.offset){E[1]+=C.offset}return new Effect.Tween(null,B.top,E[1]>A?A:E[1],C,function(F){scrollTo(B.left,F.round())})};Effect.Fade=function(C){C=$(C);try{var A=C.getInlineOpacity()}catch(D){}var B=Object.extend({from:C.getOpacity()||1,to:0,afterFinishInternal:function(E){if(E.options.to!=0){return }E.element.hide().setStyle({opacity:A})}},arguments[1]||{});return new Effect.Opacity(C,B)};Effect.Appear=function(B){B=$(B);var A=Object.extend({from:(B.getStyle("display")=="none"?0:B.getOpacity()||0),to:1,afterFinishInternal:function(C){C.element.forceRerendering()},beforeSetup:function(C){C.element.setOpacity(C.options.from).show()}},arguments[1]||{});return new Effect.Opacity(B,A)};Effect.Puff=function(B){B=$(B);var A={opacity:B.getInlineOpacity(),position:B.getStyle("position"),top:B.style.top,left:B.style.left,width:B.style.width,height:B.style.height};return new Effect.Parallel([new Effect.Scale(B,200,{sync:true,scaleFromCenter:true,scaleContent:true,restoreAfterFinish:true}),new Effect.Opacity(B,{sync:true,to:0})],Object.extend({duration:1,beforeSetupInternal:function(C){Position.absolutize(C.effects[0].element)},afterFinishInternal:function(C){C.effects[0].element.hide().setStyle(A)}},arguments[1]||{}))};Effect.BlindUp=function(A){A=$(A);A.makeClipping();return new Effect.Scale(A,0,Object.extend({scaleContent:false,scaleX:false,restoreAfterFinish:true,afterFinishInternal:function(B){B.element.hide().undoClipping()}},arguments[1]||{}))};Effect.BlindDown=function(B){B=$(B);var A=B.getDimensions();return new Effect.Scale(B,100,Object.extend({scaleContent:false,scaleX:false,scaleFrom:0,scaleMode:{originalHeight:A.height,originalWidth:A.width},restoreAfterFinish:true,afterSetup:function(C){C.element.makeClipping().setStyle({height:"0px"}).show()},afterFinishInternal:function(C){C.element.undoClipping()}},arguments[1]||{}))};Effect.SwitchOff=function(B){B=$(B);var A=B.getInlineOpacity();return new Effect.Appear(B,Object.extend({duration:0.4,from:0,transition:Effect.Transitions.flicker,afterFinishInternal:function(C){new Effect.Scale(C.element,1,{duration:0.3,scaleFromCenter:true,scaleX:false,scaleContent:false,restoreAfterFinish:true,beforeSetup:function(D){D.element.makePositioned().makeClipping()},afterFinishInternal:function(D){D.element.hide().undoClipping().undoPositioned().setStyle({opacity:A})}})}},arguments[1]||{}))};Effect.DropOut=function(B){B=$(B);var A={top:B.getStyle("top"),left:B.getStyle("left"),opacity:B.getInlineOpacity()};return new Effect.Parallel([new Effect.Move(B,{x:0,y:100,sync:true}),new Effect.Opacity(B,{sync:true,to:0})],Object.extend({duration:0.5,beforeSetup:function(C){C.effects[0].element.makePositioned()},afterFinishInternal:function(C){C.effects[0].element.hide().undoPositioned().setStyle(A)}},arguments[1]||{}))};Effect.Shake=function(D){D=$(D);var B=Object.extend({distance:20,duration:0.5},arguments[1]||{});var E=parseFloat(B.distance);var C=parseFloat(B.duration)/10;var A={top:D.getStyle("top"),left:D.getStyle("left")};return new Effect.Move(D,{x:E,y:0,duration:C,afterFinishInternal:function(F){new Effect.Move(F.element,{x:-E*2,y:0,duration:C*2,afterFinishInternal:function(G){new Effect.Move(G.element,{x:E*2,y:0,duration:C*2,afterFinishInternal:function(H){new Effect.Move(H.element,{x:-E*2,y:0,duration:C*2,afterFinishInternal:function(I){new Effect.Move(I.element,{x:E*2,y:0,duration:C*2,afterFinishInternal:function(J){new Effect.Move(J.element,{x:-E,y:0,duration:C,afterFinishInternal:function(K){K.element.undoPositioned().setStyle(A)}})}})}})}})}})}})};Effect.SlideDown=function(C){C=$(C).cleanWhitespace();var A=C.down().getStyle("bottom");var B=C.getDimensions();return new Effect.Scale(C,100,Object.extend({scaleContent:false,scaleX:false,scaleFrom:window.opera?0:1,scaleMode:{originalHeight:B.height,originalWidth:B.width},restoreAfterFinish:true,afterSetup:function(D){D.element.makePositioned();D.element.down().makePositioned();if(window.opera){D.element.setStyle({top:""})}D.element.makeClipping().setStyle({height:"0px"}).show()},afterUpdateInternal:function(D){D.element.down().setStyle({bottom:(D.dims[0]-D.element.clientHeight)+"px"})},afterFinishInternal:function(D){D.element.undoClipping().undoPositioned();D.element.down().undoPositioned().setStyle({bottom:A})}},arguments[1]||{}))};Effect.SlideUp=function(C){C=$(C).cleanWhitespace();var A=C.down().getStyle("bottom");var B=C.getDimensions();return new Effect.Scale(C,window.opera?0:1,Object.extend({scaleContent:false,scaleX:false,scaleMode:"box",scaleFrom:100,scaleMode:{originalHeight:B.height,originalWidth:B.width},restoreAfterFinish:true,afterSetup:function(D){D.element.makePositioned();D.element.down().makePositioned();if(window.opera){D.element.setStyle({top:""})}D.element.makeClipping().show()},afterUpdateInternal:function(D){D.element.down().setStyle({bottom:(D.dims[0]-D.element.clientHeight)+"px"})},afterFinishInternal:function(D){D.element.hide().undoClipping().undoPositioned();D.element.down().undoPositioned().setStyle({bottom:A})}},arguments[1]||{}))};Effect.Squish=function(A){return new Effect.Scale(A,window.opera?1:0,{restoreAfterFinish:true,beforeSetup:function(B){B.element.makeClipping()},afterFinishInternal:function(B){B.element.hide().undoClipping()}})};Effect.Grow=function(C){C=$(C);var B=Object.extend({direction:"center",moveTransition:Effect.Transitions.sinoidal,scaleTransition:Effect.Transitions.sinoidal,opacityTransition:Effect.Transitions.full},arguments[1]||{});var A={top:C.style.top,left:C.style.left,height:C.style.height,width:C.style.width,opacity:C.getInlineOpacity()};var G=C.getDimensions();var H,F;var E,D;switch(B.direction){case"top-left":H=F=E=D=0;break;case"top-right":H=G.width;F=D=0;E=-G.width;break;case"bottom-left":H=E=0;F=G.height;D=-G.height;break;case"bottom-right":H=G.width;F=G.height;E=-G.width;D=-G.height;break;case"center":H=G.width/2;F=G.height/2;E=-G.width/2;D=-G.height/2;break}return new Effect.Move(C,{x:H,y:F,duration:0.01,beforeSetup:function(I){I.element.hide().makeClipping().makePositioned()},afterFinishInternal:function(I){new Effect.Parallel([new Effect.Opacity(I.element,{sync:true,to:1,from:0,transition:B.opacityTransition}),new Effect.Move(I.element,{x:E,y:D,sync:true,transition:B.moveTransition}),new Effect.Scale(I.element,100,{scaleMode:{originalHeight:G.height,originalWidth:G.width},sync:true,scaleFrom:window.opera?1:0,transition:B.scaleTransition,restoreAfterFinish:true})],Object.extend({beforeSetup:function(J){J.effects[0].element.setStyle({height:"0px"}).show()},afterFinishInternal:function(J){J.effects[0].element.undoClipping().undoPositioned().setStyle(A)}},B))}})};Effect.Shrink=function(C){C=$(C);var B=Object.extend({direction:"center",moveTransition:Effect.Transitions.sinoidal,scaleTransition:Effect.Transitions.sinoidal,opacityTransition:Effect.Transitions.none},arguments[1]||{});var A={top:C.style.top,left:C.style.left,height:C.style.height,width:C.style.width,opacity:C.getInlineOpacity()};var F=C.getDimensions();var E,D;switch(B.direction){case"top-left":E=D=0;break;case"top-right":E=F.width;D=0;break;case"bottom-left":E=0;D=F.height;break;case"bottom-right":E=F.width;D=F.height;break;case"center":E=F.width/2;D=F.height/2;break}return new Effect.Parallel([new Effect.Opacity(C,{sync:true,to:0,from:1,transition:B.opacityTransition}),new Effect.Scale(C,window.opera?1:0,{sync:true,transition:B.scaleTransition,restoreAfterFinish:true}),new Effect.Move(C,{x:E,y:D,sync:true,transition:B.moveTransition})],Object.extend({beforeStartInternal:function(G){G.effects[0].element.makePositioned().makeClipping()},afterFinishInternal:function(G){G.effects[0].element.hide().undoClipping().undoPositioned().setStyle(A)}},B))};Effect.Pulsate=function(C){C=$(C);var B=arguments[1]||{};var A=C.getInlineOpacity();var E=B.transition||Effect.Transitions.sinoidal;var D=function(F){return E(1-Effect.Transitions.pulse(F,B.pulses))};D.bind(E);return new Effect.Opacity(C,Object.extend(Object.extend({duration:2,from:0,afterFinishInternal:function(F){F.element.setStyle({opacity:A})}},B),{transition:D}))};Effect.Fold=function(B){B=$(B);var A={top:B.style.top,left:B.style.left,width:B.style.width,height:B.style.height};B.makeClipping();return new Effect.Scale(B,5,Object.extend({scaleContent:false,scaleX:false,afterFinishInternal:function(C){new Effect.Scale(B,1,{scaleContent:false,scaleY:false,afterFinishInternal:function(D){D.element.hide().undoClipping().setStyle(A)}})}},arguments[1]||{}))};Effect.Morph=Class.create(Effect.Base,{initialize:function(C){this.element=$(C);if(!this.element){throw (Effect._elementDoesNotExistError)}var A=Object.extend({style:{}},arguments[1]||{});if(!Object.isString(A.style)){this.style=$H(A.style)}else{if(A.style.include(":")){this.style=A.style.parseStyle()}else{this.element.addClassName(A.style);this.style=$H(this.element.getStyles());this.element.removeClassName(A.style);var B=this.element.getStyles();this.style=this.style.reject(function(D){return D.value==B[D.key]});A.afterFinishInternal=function(D){D.element.addClassName(D.options.style);D.transforms.each(function(E){D.element.style[E.style]=""})}}}this.start(A)},setup:function(){function A(B){if(!B||["rgba(0, 0, 0, 0)","transparent"].include(B)){B="#ffffff"}B=B.parseColor();return $R(0,2).map(function(C){return parseInt(B.slice(C*2+1,C*2+3),16)})}this.transforms=this.style.map(function(G){var F=G[0],E=G[1],D=null;if(E.parseColor("#zzzzzz")!="#zzzzzz"){E=E.parseColor();D="color"}else{if(F=="opacity"){E=parseFloat(E);if(Prototype.Browser.IE&&(!this.element.currentStyle.hasLayout)){this.element.setStyle({zoom:1})}}else{if(Element.CSS_LENGTH.test(E)){var C=E.match(/^([\+\-]?[0-9\.]+)(.*)$/);E=parseFloat(C[1]);D=(C.length==3)?C[2]:null}}}var B=this.element.getStyle(F);return{style:F.camelize(),originalValue:D=="color"?A(B):parseFloat(B||0),targetValue:D=="color"?A(E):E,unit:D}}.bind(this)).reject(function(B){return((B.originalValue==B.targetValue)||(B.unit!="color"&&(isNaN(B.originalValue)||isNaN(B.targetValue))))})},update:function(A){var D={},B,C=this.transforms.length;while(C--){D[(B=this.transforms[C]).style]=B.unit=="color"?"#"+(Math.round(B.originalValue[0]+(B.targetValue[0]-B.originalValue[0])*A)).toColorPart()+(Math.round(B.originalValue[1]+(B.targetValue[1]-B.originalValue[1])*A)).toColorPart()+(Math.round(B.originalValue[2]+(B.targetValue[2]-B.originalValue[2])*A)).toColorPart():(B.originalValue+(B.targetValue-B.originalValue)*A).toFixed(3)+(B.unit===null?"":B.unit)}this.element.setStyle(D,true)}});Effect.Transform=Class.create({initialize:function(A){this.tracks=[];this.options=arguments[1]||{};this.addTracks(A)},addTracks:function(A){A.each(function(B){B=$H(B);var C=B.values().first();this.tracks.push($H({ids:B.keys().first(),effect:Effect.Morph,options:{style:C}}))}.bind(this));return this},play:function(){return new Effect.Parallel(this.tracks.map(function(A){var D=A.get("ids"),C=A.get("effect"),B=A.get("options");var E=[$(D)||$$(D)].flatten();return E.map(function(F){return new C(F,Object.extend({sync:true},B))})}).flatten(),this.options)}});Element.CSS_PROPERTIES=$w("backgroundColor backgroundPosition borderBottomColor borderBottomStyle borderBottomWidth borderLeftColor borderLeftStyle borderLeftWidth borderRightColor borderRightStyle borderRightWidth borderSpacing borderTopColor borderTopStyle borderTopWidth bottom clip color fontSize fontWeight height left letterSpacing lineHeight marginBottom marginLeft marginRight marginTop markerOffset maxHeight maxWidth minHeight minWidth opacity outlineColor outlineOffset outlineWidth paddingBottom paddingLeft paddingRight paddingTop right textIndent top width wordSpacing zIndex");Element.CSS_LENGTH=/^(([\+\-]?[0-9\.]+)(em|ex|px|in|cm|mm|pt|pc|\%))|0$/;String.__parseStyleElement=document.createElement("div");String.prototype.parseStyle=function(){var B,A=$H();if(Prototype.Browser.WebKit){B=new Element("div",{style:this}).style}else{String.__parseStyleElement.innerHTML='<div style="'+this+'"></div>';B=String.__parseStyleElement.childNodes[0].style}Element.CSS_PROPERTIES.each(function(C){if(B[C]){A.set(C,B[C])}});if(Prototype.Browser.IE&&this.include("opacity")){A.set("opacity",this.match(/opacity:\s*((?:0|1)?(?:\.\d*)?)/)[1])}return A};if(document.defaultView&&document.defaultView.getComputedStyle){Element.getStyles=function(B){var A=document.defaultView.getComputedStyle($(B),null);return Element.CSS_PROPERTIES.inject({},function(C,D){C[D]=A[D];return C})}}else{Element.getStyles=function(B){B=$(B);var A=B.currentStyle,C;C=Element.CSS_PROPERTIES.inject({},function(D,E){D[E]=A[E];return D});if(!C.opacity){C.opacity=B.getOpacity()}return C}}Effect.Methods={morph:function(A,B){A=$(A);new Effect.Morph(A,Object.extend({style:B},arguments[2]||{}));return A},visualEffect:function(C,E,B){C=$(C);var D=E.dasherize().camelize(),A=D.charAt(0).toUpperCase()+D.substring(1);new Effect[A](C,B);return C},highlight:function(B,A){B=$(B);new Effect.Highlight(B,A);return B}};$w("fade appear grow shrink fold blindUp blindDown slideUp slideDown pulsate shake puff squish switchOff dropOut").each(function(A){Effect.Methods[A]=function(C,B){C=$(C);Effect[A.charAt(0).toUpperCase()+A.substring(1)](C,B);return C}});$w("getInlineOpacity forceRerendering setContentZoom collectTextNodes collectTextNodesIgnoreClass getStyles").each(function(A){Effect.Methods[A]=Element[A]});Element.addMethods(Effect.Methods);if(typeof Effect=="undefined"){throw ("controls.js requires including script.aculo.us' effects.js library")}var Autocompleter={};Autocompleter.Base=Class.create({baseInitialize:function(B,C,A){B=$(B);this.element=B;this.update=$(C);this.hasFocus=false;this.changed=false;this.active=false;this.index=0;this.entryCount=0;this.oldElementValue=this.element.value;if(this.setOptions){this.setOptions(A)}else{this.options=A||{}}this.options.paramName=this.options.paramName||this.element.name;this.options.tokens=this.options.tokens||[];this.options.frequency=this.options.frequency||0.4;this.options.minChars=this.options.minChars||1;this.options.onShow=this.options.onShow||function(D,E){if(!E.style.position||E.style.position=="absolute"){E.style.position="absolute";Position.clone(D,E,{setHeight:false,offsetTop:D.offsetHeight})}Effect.Appear(E,{duration:0.15})};this.options.onHide=this.options.onHide||function(D,E){new Effect.Fade(E,{duration:0.15})};if(typeof (this.options.tokens)=="string"){this.options.tokens=new Array(this.options.tokens)}if(!this.options.tokens.include("\n")){this.options.tokens.push("\n")}this.observer=null;this.element.setAttribute("autocomplete","off");Element.hide(this.update);Event.observe(this.element,"blur",this.onBlur.bindAsEventListener(this));Event.observe(this.element,"keydown",this.onKeyPress.bindAsEventListener(this))},show:function(){if(Element.getStyle(this.update,"display")=="none"){this.options.onShow(this.element,this.update)}if(!this.iefix&&(Prototype.Browser.IE)&&(Element.getStyle(this.update,"position")=="absolute")){new Insertion.After(this.update,'<iframe id="'+this.update.id+'_iefix" style="display:none;position:absolute;filter:progid:DXImageTransform.Microsoft.Alpha(opacity=0);" src="javascript:false;" frameborder="0" scrolling="no"></iframe>');this.iefix=$(this.update.id+"_iefix")}if(this.iefix){setTimeout(this.fixIEOverlapping.bind(this),50)}},fixIEOverlapping:function(){Position.clone(this.update,this.iefix,{setTop:(!this.update.style.height)});this.iefix.style.zIndex=1;this.update.style.zIndex=2;Element.show(this.iefix)},hide:function(){this.stopIndicator();if(Element.getStyle(this.update,"display")!="none"){this.options.onHide(this.element,this.update)}if(this.iefix){Element.hide(this.iefix)}},startIndicator:function(){if(this.options.indicator){Element.show(this.options.indicator)}},stopIndicator:function(){if(this.options.indicator){Element.hide(this.options.indicator)}},onKeyPress:function(A){if(this.active){switch(A.keyCode){case Event.KEY_TAB:case Event.KEY_RETURN:this.selectEntry();Event.stop(A);case Event.KEY_ESC:this.hide();this.active=false;Event.stop(A);return ;case Event.KEY_LEFT:case Event.KEY_RIGHT:return ;case Event.KEY_UP:this.markPrevious();this.render();Event.stop(A);return ;case Event.KEY_DOWN:this.markNext();this.render();Event.stop(A);return }}else{if(A.keyCode==Event.KEY_TAB||A.keyCode==Event.KEY_RETURN||(Prototype.Browser.WebKit>0&&A.keyCode==0)){return }}this.changed=true;this.hasFocus=true;if(this.observer){clearTimeout(this.observer)}this.observer=setTimeout(this.onObserverEvent.bind(this),this.options.frequency*1000)},activate:function(){this.changed=false;this.hasFocus=true;this.getUpdatedChoices()},onHover:function(B){var A=Event.findElement(B,"LI");if(this.index!=A.autocompleteIndex){this.index=A.autocompleteIndex;this.render()}Event.stop(B)},onClick:function(B){var A=Event.findElement(B,"LI");this.index=A.autocompleteIndex;this.selectEntry();this.hide()},onBlur:function(A){setTimeout(this.hide.bind(this),250);this.hasFocus=false;this.active=false},render:function(){if(this.entryCount>0){for(var A=0;A<this.entryCount;A++){this.index==A?Element.addClassName(this.getEntry(A),"selected"):Element.removeClassName(this.getEntry(A),"selected")}if(this.hasFocus){this.show();this.active=true}}else{this.active=false;this.hide()}},markPrevious:function(){if(this.index>0){this.index--}else{this.index=this.entryCount-1}this.getEntry(this.index).scrollIntoView(true)},markNext:function(){if(this.index<this.entryCount-1){this.index++}else{this.index=0}this.getEntry(this.index).scrollIntoView(false)},getEntry:function(A){return this.update.firstChild.childNodes[A]},getCurrentEntry:function(){return this.getEntry(this.index)},selectEntry:function(){this.active=false;this.updateElement(this.getCurrentEntry())},updateElement:function(F){if(this.options.updateElement){this.options.updateElement(F);return }var D="";if(this.options.select){var A=$(F).select("."+this.options.select)||[];if(A.length>0){D=Element.collectTextNodes(A[0],this.options.select)}}else{D=Element.collectTextNodesIgnoreClass(F,"informal")}var C=this.getTokenBounds();if(C[0]!=-1){var E=this.element.value.substr(0,C[0]);var B=this.element.value.substr(C[0]).match(/^\s+/);if(B){E+=B[0]}this.element.value=E+D+this.element.value.substr(C[1])}else{this.element.value=D}this.oldElementValue=this.element.value;this.element.focus();if(this.options.afterUpdateElement){this.options.afterUpdateElement(this.element,F)}},updateChoices:function(C){if(!this.changed&&this.hasFocus){this.update.innerHTML=C;Element.cleanWhitespace(this.update);Element.cleanWhitespace(this.update.down());if(this.update.firstChild&&this.update.down().childNodes){this.entryCount=this.update.down().childNodes.length;for(var A=0;A<this.entryCount;A++){var B=this.getEntry(A);B.autocompleteIndex=A;this.addObservers(B)}}else{this.entryCount=0}this.stopIndicator();this.index=0;if(this.entryCount==1&&this.options.autoSelect){this.selectEntry();this.hide()}else{this.render()}}},addObservers:function(A){Event.observe(A,"mouseover",this.onHover.bindAsEventListener(this));Event.observe(A,"click",this.onClick.bindAsEventListener(this))},onObserverEvent:function(){this.changed=false;this.tokenBounds=null;if(this.getToken().length>=this.options.minChars){this.getUpdatedChoices()}else{this.active=false;this.hide()}this.oldElementValue=this.element.value},getToken:function(){var A=this.getTokenBounds();return this.element.value.substring(A[0],A[1]).strip()},getTokenBounds:function(){if(null!=this.tokenBounds){return this.tokenBounds}var E=this.element.value;if(E.strip().empty()){return[-1,0]}var F=arguments.callee.getFirstDifferencePos(E,this.oldElementValue);var H=(F==this.oldElementValue.length?1:0);var D=-1,C=E.length;var G;for(var B=0,A=this.options.tokens.length;B<A;++B){G=E.lastIndexOf(this.options.tokens[B],F+H-1);if(G>D){D=G}G=E.indexOf(this.options.tokens[B],F+H);if(-1!=G&&G<C){C=G}}return(this.tokenBounds=[D+1,C])}});Autocompleter.Base.prototype.getTokenBounds.getFirstDifferencePos=function(C,A){var D=Math.min(C.length,A.length);for(var B=0;B<D;++B){if(C[B]!=A[B]){return B}}return D};Ajax.Autocompleter=Class.create(Autocompleter.Base,{initialize:function(C,D,B,A){this.baseInitialize(C,D,A);this.options.asynchronous=true;this.options.onComplete=this.onComplete.bind(this);this.options.defaultParams=this.options.parameters||null;this.url=B},getUpdatedChoices:function(){this.startIndicator();var A=encodeURIComponent(this.options.paramName)+"="+encodeURIComponent(this.getToken());this.options.parameters=this.options.callback?this.options.callback(this.element,A):A;if(this.options.defaultParams){this.options.parameters+="&"+this.options.defaultParams}new Ajax.Request(this.url,this.options)},onComplete:function(A){this.updateChoices(A.responseText)}});Autocompleter.Local=Class.create(Autocompleter.Base,{initialize:function(B,D,C,A){this.baseInitialize(B,D,A);this.options.array=C},getUpdatedChoices:function(){this.updateChoices(this.options.selector(this))},setOptions:function(A){this.options=Object.extend({choices:10,partialSearch:true,partialChars:2,ignoreCase:true,fullSearch:false,selector:function(B){var D=[];var C=[];var H=B.getToken();var G=0;for(var E=0;E<B.options.array.length&&D.length<B.options.choices;E++){var F=B.options.array[E];var I=B.options.ignoreCase?F.toLowerCase().indexOf(H.toLowerCase()):F.indexOf(H);while(I!=-1){if(I==0&&F.length!=H.length){D.push("<li><strong>"+F.substr(0,H.length)+"</strong>"+F.substr(H.length)+"</li>");break}else{if(H.length>=B.options.partialChars&&B.options.partialSearch&&I!=-1){if(B.options.fullSearch||/\s/.test(F.substr(I-1,1))){C.push("<li>"+F.substr(0,I)+"<strong>"+F.substr(I,H.length)+"</strong>"+F.substr(I+H.length)+"</li>");break}}}I=B.options.ignoreCase?F.toLowerCase().indexOf(H.toLowerCase(),I+1):F.indexOf(H,I+1)}}if(C.length){D=D.concat(C.slice(0,B.options.choices-D.length))}return"<ul>"+D.join("")+"</ul>"}},A||{})}});Field.scrollFreeActivate=function(A){setTimeout(function(){Field.activate(A)},1)};Ajax.InPlaceEditor=Class.create({initialize:function(C,B,A){this.url=B;this.element=C=$(C);this.prepareOptions();this._controls={};arguments.callee.dealWithDeprecatedOptions(A);Object.extend(this.options,A||{});if(!this.options.formId&&this.element.id){this.options.formId=this.element.id+"-inplaceeditor";if($(this.options.formId)){this.options.formId=""}}if(this.options.externalControl){this.options.externalControl=$(this.options.externalControl)}if(!this.options.externalControl){this.options.externalControlOnly=false}this._originalBackground=this.element.getStyle("background-color")||"transparent";this.element.title=this.options.clickToEditText;this._boundCancelHandler=this.handleFormCancellation.bind(this);this._boundComplete=(this.options.onComplete||Prototype.emptyFunction).bind(this);this._boundFailureHandler=this.handleAJAXFailure.bind(this);this._boundSubmitHandler=this.handleFormSubmission.bind(this);this._boundWrapperHandler=this.wrapUp.bind(this);this.registerListeners()},checkForEscapeOrReturn:function(A){if(!this._editing||A.ctrlKey||A.altKey||A.shiftKey){return }if(Event.KEY_ESC==A.keyCode){this.handleFormCancellation(A)}else{if(Event.KEY_RETURN==A.keyCode){this.handleFormSubmission(A)}}},createControl:function(G,C,B){var E=this.options[G+"Control"];var F=this.options[G+"Text"];if("button"==E){var A=document.createElement("input");A.type="submit";A.value=F;A.className="editor_"+G+"_button";if("cancel"==G){A.onclick=this._boundCancelHandler}this._form.appendChild(A);this._controls[G]=A}else{if("link"==E){var D=document.createElement("a");D.href="#";D.appendChild(document.createTextNode(F));D.onclick="cancel"==G?this._boundCancelHandler:this._boundSubmitHandler;D.className="editor_"+G+"_link";if(B){D.className+=" "+B}this._form.appendChild(D);this._controls[G]=D}}},createEditField:function(){var C=(this.options.loadTextURL?this.options.loadingText:this.getText());var B;if(1>=this.options.rows&&!/\r|\n/.test(this.getText())){B=document.createElement("input");B.type="text";var A=this.options.size||this.options.cols||0;if(0<A){B.size=A}}else{B=document.createElement("textarea");B.rows=(1>=this.options.rows?this.options.autoRows:this.options.rows);B.cols=this.options.cols||40}B.name=this.options.paramName;B.value=C;B.className="editor_field";if(this.options.submitOnBlur){B.onblur=this._boundSubmitHandler}this._controls.editor=B;if(this.options.loadTextURL){this.loadExternalText()}this._form.appendChild(this._controls.editor)},createForm:function(){var B=this;function A(D,E){var C=B.options["text"+D+"Controls"];if(!C||E===false){return }B._form.appendChild(document.createTextNode(C))}this._form=$(document.createElement("form"));this._form.id=this.options.formId;this._form.addClassName(this.options.formClassName);this._form.onsubmit=this._boundSubmitHandler;this.createEditField();if("textarea"==this._controls.editor.tagName.toLowerCase()){this._form.appendChild(document.createElement("br"))}if(this.options.onFormCustomization){this.options.onFormCustomization(this,this._form)}A("Before",this.options.okControl||this.options.cancelControl);this.createControl("ok",this._boundSubmitHandler);A("Between",this.options.okControl&&this.options.cancelControl);this.createControl("cancel",this._boundCancelHandler,"editor_cancel");A("After",this.options.okControl||this.options.cancelControl)},destroy:function(){if(this._oldInnerHTML){this.element.innerHTML=this._oldInnerHTML}this.leaveEditMode();this.unregisterListeners()},enterEditMode:function(A){if(this._saving||this._editing){return }this._editing=true;this.triggerCallback("onEnterEditMode");if(this.options.externalControl){this.options.externalControl.hide()}this.element.hide();this.createForm();this.element.parentNode.insertBefore(this._form,this.element);if(!this.options.loadTextURL){this.postProcessEditField()}if(A){Event.stop(A)}},enterHover:function(A){if(this.options.hoverClassName){this.element.addClassName(this.options.hoverClassName)}if(this._saving){return }this.triggerCallback("onEnterHover")},getText:function(){return this.element.innerHTML},handleAJAXFailure:function(A){this.triggerCallback("onFailure",A);if(this._oldInnerHTML){this.element.innerHTML=this._oldInnerHTML;this._oldInnerHTML=null}},handleFormCancellation:function(A){this.wrapUp();if(A){Event.stop(A)}},handleFormSubmission:function(D){var B=this._form;var C=$F(this._controls.editor);this.prepareSubmission();var E=this.options.callback(B,C)||"";if(Object.isString(E)){E=E.toQueryParams()}E.editorId=this.element.id;if(this.options.htmlResponse){var A=Object.extend({evalScripts:true},this.options.ajaxOptions);Object.extend(A,{parameters:E,onComplete:this._boundWrapperHandler,onFailure:this._boundFailureHandler});new Ajax.Updater({success:this.element},this.url,A)}else{var A=Object.extend({method:"get"},this.options.ajaxOptions);Object.extend(A,{parameters:E,onComplete:this._boundWrapperHandler,onFailure:this._boundFailureHandler});new Ajax.Request(this.url,A)}if(D){Event.stop(D)}},leaveEditMode:function(){this.element.removeClassName(this.options.savingClassName);this.removeForm();this.leaveHover();this.element.style.backgroundColor=this._originalBackground;this.element.show();if(this.options.externalControl){this.options.externalControl.show()}this._saving=false;this._editing=false;this._oldInnerHTML=null;this.triggerCallback("onLeaveEditMode")},leaveHover:function(A){if(this.options.hoverClassName){this.element.removeClassName(this.options.hoverClassName)}if(this._saving){return }this.triggerCallback("onLeaveHover")},loadExternalText:function(){this._form.addClassName(this.options.loadingClassName);this._controls.editor.disabled=true;var A=Object.extend({method:"get"},this.options.ajaxOptions);Object.extend(A,{parameters:"editorId="+encodeURIComponent(this.element.id),onComplete:Prototype.emptyFunction,onSuccess:function(C){this._form.removeClassName(this.options.loadingClassName);var B=C.responseText;if(this.options.stripLoadedTextTags){B=B.stripTags()}this._controls.editor.value=B;this._controls.editor.disabled=false;this.postProcessEditField()}.bind(this),onFailure:this._boundFailureHandler});new Ajax.Request(this.options.loadTextURL,A)},postProcessEditField:function(){var A=this.options.fieldPostCreation;if(A){$(this._controls.editor)["focus"==A?"focus":"activate"]()}},prepareOptions:function(){this.options=Object.clone(Ajax.InPlaceEditor.DefaultOptions);Object.extend(this.options,Ajax.InPlaceEditor.DefaultCallbacks);[this._extraDefaultOptions].flatten().compact().each(function(A){Object.extend(this.options,A)}.bind(this))},prepareSubmission:function(){this._saving=true;this.removeForm();this.leaveHover();this.showSaving()},registerListeners:function(){this._listeners={};var A;$H(Ajax.InPlaceEditor.Listeners).each(function(B){A=this[B.value].bind(this);this._listeners[B.key]=A;if(!this.options.externalControlOnly){this.element.observe(B.key,A)}if(this.options.externalControl){this.options.externalControl.observe(B.key,A)}}.bind(this))},removeForm:function(){if(!this._form){return }this._form.remove();this._form=null;this._controls={}},showSaving:function(){this._oldInnerHTML=this.element.innerHTML;this.element.innerHTML=this.options.savingText;this.element.addClassName(this.options.savingClassName);this.element.style.backgroundColor=this._originalBackground;this.element.show()},triggerCallback:function(B,A){if("function"==typeof this.options[B]){this.options[B](this,A)}},unregisterListeners:function(){$H(this._listeners).each(function(A){if(!this.options.externalControlOnly){this.element.stopObserving(A.key,A.value)}if(this.options.externalControl){this.options.externalControl.stopObserving(A.key,A.value)}}.bind(this))},wrapUp:function(A){this.leaveEditMode();this._boundComplete(A,this.element)}});Object.extend(Ajax.InPlaceEditor.prototype,{dispose:Ajax.InPlaceEditor.prototype.destroy});Ajax.InPlaceCollectionEditor=Class.create(Ajax.InPlaceEditor,{initialize:function($super,C,B,A){this._extraDefaultOptions=Ajax.InPlaceCollectionEditor.DefaultOptions;$super(C,B,A)},createEditField:function(){var A=document.createElement("select");A.name=this.options.paramName;A.size=1;this._controls.editor=A;this._collection=this.options.collection||[];if(this.options.loadCollectionURL){this.loadCollection()}else{this.checkForExternalText()}this._form.appendChild(this._controls.editor)},loadCollection:function(){this._form.addClassName(this.options.loadingClassName);this.showLoadingText(this.options.loadingCollectionText);var options=Object.extend({method:"get"},this.options.ajaxOptions);Object.extend(options,{parameters:"editorId="+encodeURIComponent(this.element.id),onComplete:Prototype.emptyFunction,onSuccess:function(transport){var js=transport.responseText.strip();if(!/^\[.*\]$/.test(js)){throw"Server returned an invalid collection representation."}this._collection=eval(js);this.checkForExternalText()}.bind(this),onFailure:this.onFailure});new Ajax.Request(this.options.loadCollectionURL,options)},showLoadingText:function(B){this._controls.editor.disabled=true;var A=this._controls.editor.firstChild;if(!A){A=document.createElement("option");A.value="";this._controls.editor.appendChild(A);A.selected=true}A.update((B||"").stripScripts().stripTags())},checkForExternalText:function(){this._text=this.getText();if(this.options.loadTextURL){this.loadExternalText()}else{this.buildOptionList()}},loadExternalText:function(){this.showLoadingText(this.options.loadingText);var A=Object.extend({method:"get"},this.options.ajaxOptions);Object.extend(A,{parameters:"editorId="+encodeURIComponent(this.element.id),onComplete:Prototype.emptyFunction,onSuccess:function(B){this._text=B.responseText.strip();this.buildOptionList()}.bind(this),onFailure:this.onFailure});new Ajax.Request(this.options.loadTextURL,A)},buildOptionList:function(){this._form.removeClassName(this.options.loadingClassName);this._collection=this._collection.map(function(D){return 2===D.length?D:[D,D].flatten()});var B=("value" in this.options)?this.options.value:this._text;var A=this._collection.any(function(D){return D[0]==B}.bind(this));this._controls.editor.update("");var C;this._collection.each(function(E,D){C=document.createElement("option");C.value=E[0];C.selected=A?E[0]==B:0==D;C.appendChild(document.createTextNode(E[1]));this._controls.editor.appendChild(C)}.bind(this));this._controls.editor.disabled=false;Field.scrollFreeActivate(this._controls.editor)}});Ajax.InPlaceEditor.prototype.initialize.dealWithDeprecatedOptions=function(A){if(!A){return }function B(C,D){if(C in A||D===undefined){return }A[C]=D}B("cancelControl",(A.cancelLink?"link":(A.cancelButton?"button":A.cancelLink==A.cancelButton==false?false:undefined)));B("okControl",(A.okLink?"link":(A.okButton?"button":A.okLink==A.okButton==false?false:undefined)));B("highlightColor",A.highlightcolor);B("highlightEndColor",A.highlightendcolor)};Object.extend(Ajax.InPlaceEditor,{DefaultOptions:{ajaxOptions:{},autoRows:3,cancelControl:"link",cancelText:"cancel",clickToEditText:"Click to edit",externalControl:null,externalControlOnly:false,fieldPostCreation:"activate",formClassName:"inplaceeditor-form",formId:null,highlightColor:"#ffff99",highlightEndColor:"#ffffff",hoverClassName:"",htmlResponse:true,loadingClassName:"inplaceeditor-loading",loadingText:"Loading...",okControl:"button",okText:"ok",paramName:"value",rows:1,savingClassName:"inplaceeditor-saving",savingText:"Saving...",size:0,stripLoadedTextTags:false,submitOnBlur:false,textAfterControls:"",textBeforeControls:"",textBetweenControls:""},DefaultCallbacks:{callback:function(A){return Form.serialize(A)},onComplete:function(B,A){new Effect.Highlight(A,{startcolor:this.options.highlightColor,keepBackgroundImage:true})},onEnterEditMode:null,onEnterHover:function(A){A.element.style.backgroundColor=A.options.highlightColor;if(A._effect){A._effect.cancel()}},onFailure:function(B,A){alert("Error communication with the server: "+B.responseText.stripTags())},onFormCustomization:null,onLeaveEditMode:null,onLeaveHover:function(A){A._effect=new Effect.Highlight(A.element,{startcolor:A.options.highlightColor,endcolor:A.options.highlightEndColor,restorecolor:A._originalBackground,keepBackgroundImage:true})}},Listeners:{click:"enterEditMode",keydown:"checkForEscapeOrReturn",mouseover:"enterHover",mouseout:"leaveHover"}});Ajax.InPlaceCollectionEditor.DefaultOptions={loadingCollectionText:"Loading options..."};Form.Element.DelayedObserver=Class.create({initialize:function(B,A,C){this.delay=A||0.5;this.element=$(B);this.callback=C;this.timer=null;this.lastValue=$F(this.element);Event.observe(this.element,"keyup",this.delayedListener.bindAsEventListener(this))},delayedListener:function(A){if(this.lastValue==$F(this.element)){return }if(this.timer){clearTimeout(this.timer)}this.timer=setTimeout(this.onTimerEvent.bind(this),this.delay*1000);this.lastValue=$F(this.element)},onTimerEvent:function(){this.timer=null;this.callback(this.element,$F(this.element))}});if(!Control){var Control={}}Control.Slider=Class.create({initialize:function(D,A,B){var C=this;if(Object.isArray(D)){this.handles=D.collect(function(E){return $(E)})}else{this.handles=[$(D)]}this.track=$(A);this.options=B||{};this.axis=this.options.axis||"horizontal";this.increment=this.options.increment||1;this.step=parseInt(this.options.step||"1");this.range=this.options.range||$R(0,1);this.value=0;this.values=this.handles.map(function(){return 0});this.spans=this.options.spans?this.options.spans.map(function(E){return $(E)}):false;this.options.startSpan=$(this.options.startSpan||null);this.options.endSpan=$(this.options.endSpan||null);this.restricted=this.options.restricted||false;this.maximum=this.options.maximum||this.range.end;this.minimum=this.options.minimum||this.range.start;this.alignX=parseInt(this.options.alignX||"0");this.alignY=parseInt(this.options.alignY||"0");this.trackLength=this.maximumOffset()-this.minimumOffset();this.handleLength=this.isVertical()?(this.handles[0].offsetHeight!=0?this.handles[0].offsetHeight:this.handles[0].style.height.replace(/px$/,"")):(this.handles[0].offsetWidth!=0?this.handles[0].offsetWidth:this.handles[0].style.width.replace(/px$/,""));this.active=false;this.dragging=false;this.disabled=false;if(this.options.disabled){this.setDisabled()}this.allowedValues=this.options.values?this.options.values.sortBy(Prototype.K):false;if(this.allowedValues){this.minimum=this.allowedValues.min();this.maximum=this.allowedValues.max()}this.eventMouseDown=this.startDrag.bindAsEventListener(this);this.eventMouseUp=this.endDrag.bindAsEventListener(this);this.eventMouseMove=this.update.bindAsEventListener(this);this.handles.each(function(F,E){E=C.handles.length-1-E;C.setValue(parseFloat((Object.isArray(C.options.sliderValue)?C.options.sliderValue[E]:C.options.sliderValue)||C.range.start),E);F.makePositioned().observe("mousedown",C.eventMouseDown)});this.track.observe("mousedown",this.eventMouseDown);document.observe("mouseup",this.eventMouseUp);document.observe("mousemove",this.eventMouseMove);this.initialized=true},dispose:function(){var A=this;Event.stopObserving(this.track,"mousedown",this.eventMouseDown);Event.stopObserving(document,"mouseup",this.eventMouseUp);Event.stopObserving(document,"mousemove",this.eventMouseMove);this.handles.each(function(B){Event.stopObserving(B,"mousedown",A.eventMouseDown)})},setDisabled:function(){this.disabled=true},setEnabled:function(){this.disabled=false},getNearestValue:function(A){if(this.allowedValues){if(A>=this.allowedValues.max()){return(this.allowedValues.max())}if(A<=this.allowedValues.min()){return(this.allowedValues.min())}var C=Math.abs(this.allowedValues[0]-A);var B=this.allowedValues[0];this.allowedValues.each(function(D){var E=Math.abs(D-A);if(E<=C){B=D;C=E}});return B}if(A>this.range.end){return this.range.end}if(A<this.range.start){return this.range.start}return A},setValue:function(B,A){if(!this.active){this.activeHandleIdx=A||0;this.activeHandle=this.handles[this.activeHandleIdx];this.updateStyles()}A=A||this.activeHandleIdx||0;if(this.initialized&&this.restricted){if((A>0)&&(B<this.values[A-1])){B=this.values[A-1]}if((A<(this.handles.length-1))&&(B>this.values[A+1])){B=this.values[A+1]}}B=this.getNearestValue(B);this.values[A]=B;this.value=this.values[0];this.handles[A].style[this.isVertical()?"top":"left"]=this.translateToPx(B);this.drawSpans();if(!this.dragging||!this.event){this.updateFinished()}},setValueBy:function(B,A){this.setValue(this.values[A||this.activeHandleIdx||0]+B,A||this.activeHandleIdx||0)},translateToPx:function(A){return Math.round(((this.trackLength-this.handleLength)/(this.range.end-this.range.start))*(A-this.range.start))+"px"},translateToValue:function(A){return((A/(this.trackLength-this.handleLength)*(this.range.end-this.range.start))+this.range.start)},getRange:function(B){var A=this.values.sortBy(Prototype.K);B=B||0;return $R(A[B],A[B+1])},minimumOffset:function(){return(this.isVertical()?this.alignY:this.alignX)},maximumOffset:function(){return(this.isVertical()?(this.track.offsetHeight!=0?this.track.offsetHeight:this.track.style.height.replace(/px$/,""))-this.alignY:(this.track.offsetWidth!=0?this.track.offsetWidth:this.track.style.width.replace(/px$/,""))-this.alignX)},isVertical:function(){return(this.axis=="vertical")},drawSpans:function(){var A=this;if(this.spans){$R(0,this.spans.length-1).each(function(B){A.setSpan(A.spans[B],A.getRange(B))})}if(this.options.startSpan){this.setSpan(this.options.startSpan,$R(0,this.values.length>1?this.getRange(0).min():this.value))}if(this.options.endSpan){this.setSpan(this.options.endSpan,$R(this.values.length>1?this.getRange(this.spans.length-1).max():this.value,this.maximum))}},setSpan:function(B,A){if(this.isVertical()){B.style.top=this.translateToPx(A.start);B.style.height=this.translateToPx(A.end-A.start+this.range.start)}else{B.style.left=this.translateToPx(A.start);B.style.width=this.translateToPx(A.end-A.start+this.range.start)}},updateStyles:function(){this.handles.each(function(A){Element.removeClassName(A,"selected")});Element.addClassName(this.activeHandle,"selected")},startDrag:function(C){if(Event.isLeftClick(C)){if(!this.disabled){this.active=true;var D=Event.element(C);var E=[Event.pointerX(C),Event.pointerY(C)];var A=D;if(A==this.track){var B=Position.cumulativeOffset(this.track);this.event=C;this.setValue(this.translateToValue((this.isVertical()?E[1]-B[1]:E[0]-B[0])-(this.handleLength/2)));var B=Position.cumulativeOffset(this.activeHandle);this.offsetX=(E[0]-B[0]);this.offsetY=(E[1]-B[1])}else{while((this.handles.indexOf(D)==-1)&&D.parentNode){D=D.parentNode}if(this.handles.indexOf(D)!=-1){this.activeHandle=D;this.activeHandleIdx=this.handles.indexOf(this.activeHandle);this.updateStyles();var B=Position.cumulativeOffset(this.activeHandle);this.offsetX=(E[0]-B[0]);this.offsetY=(E[1]-B[1])}}}Event.stop(C)}},update:function(A){if(this.active){if(!this.dragging){this.dragging=true}this.draw(A);if(Prototype.Browser.WebKit){window.scrollBy(0,0)}Event.stop(A)}},draw:function(B){var C=[Event.pointerX(B),Event.pointerY(B)];var A=Position.cumulativeOffset(this.track);C[0]-=this.offsetX+A[0];C[1]-=this.offsetY+A[1];this.event=B;this.setValue(this.translateToValue(this.isVertical()?C[1]:C[0]));if(this.initialized&&this.options.onSlide){this.options.onSlide(this.values.length>1?this.values:this.value,this)}},endDrag:function(A){if(this.active&&this.dragging){this.finishDrag(A,true);Event.stop(A)}this.active=false;this.dragging=false},finishDrag:function(A,B){this.active=false;this.dragging=false;this.updateFinished()},updateFinished:function(){if(this.initialized&&this.options.onChange){this.options.onChange(this.values.length>1?this.values:this.value,this)}this.event=null}});var YAHOO=function(){return{util:{}}}();YAHOO.util.Color=new function(){this.hsv2rgb=function(C,K,H){var B,D,G;if(K==0){B=H*255;D=H*255;G=H*255}else{var F=C*6;if(F==6){F=0}var E=Math.floor(F);var A=H*(1-K);var J=H*(1-K*(F-E));var I=H*(1-K*(1-(F-E)));if(E==0){var_r=H;var_g=I;var_b=A}else{if(E==1){var_r=J;var_g=H;var_b=A}else{if(E==2){var_r=A;var_g=H;var_b=I}else{if(E==3){var_r=A;var_g=J;var_b=H}else{if(E==4){var_r=I;var_g=A;var_b=H}else{var_r=H;var_g=A;var_b=J}}}}}B=var_r*255;D=var_g*255;G=var_b*255}return[Math.round(B),Math.round(D),Math.round(G)]};this.rgb2hsv=function(A,F,G){var A=(A/255);var F=(F/255);var G=(G/255);var D=Math.min(A,F,G);var H=Math.max(A,F,G);deltaMax=H-D;var I=H;var K,E;var J,B,C;if(deltaMax==0){E=0;K=0}else{K=deltaMax/H;J=(((H-A)/6)+(deltaMax/2))/deltaMax;B=(((H-F)/6)+(deltaMax/2))/deltaMax;C=(((H-G)/6)+(deltaMax/2))/deltaMax;if(A==H){E=C-B}else{if(F==H){E=(1/3)+J-C}else{if(G==H){E=(2/3)+B-J}}}if(E<0){E+=1}if(E>1){E-=1}}return[E,K,I]};this.rgb2hex=function(C,B,A){return this.toHex(C)+this.toHex(B)+this.toHex(A)};this.hexchars="0123456789ABCDEF";this.toHex=function(A){A=A||0;A=parseInt(A,10);if(isNaN(A)){A=0}A=Math.round(Math.min(Math.max(0,A),255));return this.hexchars.charAt((A-A%16)/16)+this.hexchars.charAt(A%16)};this.toDec=function(A){return this.hexchars.indexOf(A.toUpperCase())};this.hex2rgb=function(B){var A=[];A[0]=(this.toDec(B.substr(0,1))*16)+this.toDec(B.substr(1,1));A[1]=(this.toDec(B.substr(2,1))*16)+this.toDec(B.substr(3,1));A[2]=(this.toDec(B.substr(4,1))*16)+this.toDec(B.substr(5,1));return A};this.isValidRGB=function(A){if((!A[0]&&A[0]!=0)||isNaN(A[0])||A[0]<0||A[0]>255){return false}if((!A[1]&&A[1]!=0)||isNaN(A[1])||A[1]<0||A[1]>255){return false}if((!A[2]&&A[2]!=0)||isNaN(A[2])||A[2]<0||A[2]>255){return false}return true}};if(!Control){var Control={}}Control.colorPickers=[];Control.ColorPicker=Class.create();Control.ColorPicker.activeColorPicker;Control.ColorPicker.CONTROL;Control.ColorPicker.prototype={initialize:function(F,C){var A=this;Control.colorPickers.push(A);this.field=$(F);this.fieldName=this.field.name||this.field.id;this.options=Object.extend({IMAGE_BASE:"/shared/images/colorpicker/"},C||{});this.swatch=$(this.options.swatch)||this.field;this.rgb={};this.hsv={};this.isOpen=false;if(!Control.ColorPicker.CONTROL){Control.ColorPicker.CONTROL={};if(!$("colorpicker")){var E=new Element("div");E.setAttribute("id","colorpicker");E.innerHTML='<div id="colorpicker-div">'+((/MSIE ((6)|(5\.5))/gi.test(navigator.userAgent)&&/windows/i.test(navigator.userAgent)&&!/opera/i.test(navigator.userAgent))?'<img id="colorpicker-bg" src="'+this.options.IMAGE_BASE+'blank.gif" style="filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(src=\''+this.options.IMAGE_BASE+"pickerbg.png', sizingMethod='scale')\" alt=\"\">":'<img id="colorpicker-bg" src="'+this.options.IMAGE_BASE+'pickerbg.png" alt="">')+'<div id="colorpicker-bg-overlay" style="z-index: 1002;"></div><div id="colorpicker-selector"><img src="'+this.options.IMAGE_BASE+'select.gif" width="11" height="11" alt="" /></div></div><div id="colorpicker-hue-container"><img src="'+this.options.IMAGE_BASE+'hue.png" id="colorpicker-hue-bg-img"><div id="colorpicker-hue-slider"><div id="colorpicker-hue-thumb"><img src="'+this.options.IMAGE_BASE+'hline.png"></div></div></div><div id="colorpicker-footer"><span id="colorpicker-value">#<input type="text" onclick="this.select()" id="colorpicker-value-input" name="colorpicker-value" value=""></input></span><button id="colorpicker-okbutton">OK</button>'+($("colorwells")?'<div class="colorwells">'+$("colorwells").innerHTML+"</div>":"")+"</div>";if($("colorwells")){E.style.height="215px"}document.body.appendChild(E)}Control.ColorPicker.CONTROL={popUp:$("colorpicker"),pickerArea:$("colorpicker-div"),selector:$("colorpicker-selector"),okButton:$("colorpicker-okbutton"),value:$("colorpicker-value"),input:$("colorpicker-value-input"),picker:new Draggable($("colorpicker-selector"),{snap:function(G,H){return[Math.min(Math.max(G,0),Control.ColorPicker.activeColorPicker.control.pickerArea.offsetWidth),Math.min(Math.max(H,0),Control.ColorPicker.activeColorPicker.control.pickerArea.offsetHeight)]},zindex:10009,change:function(G){var H=G.currentDelta();Control.ColorPicker.activeColorPicker.update(H[0],H[1])}}),hueSlider:new Control.Slider("colorpicker-hue-thumb","colorpicker-hue-slider",{axis:"vertical",onChange:function(G){Control.ColorPicker.activeColorPicker.updateHue(G)}})};Element.hide($("colorpicker"))}this.control=Control.ColorPicker.CONTROL;this.toggleOnClickListener=this.toggle.bindAsEventListener(this);this.updateOnChangeListener=this.updateFromFieldValue.bindAsEventListener(this);this.closeOnClickOkListener=this.close.bindAsEventListener(this);this.updateOnClickPickerListener=this.updateSelector.bindAsEventListener(this);Event.observe(this.swatch,"click",this.toggleOnClickListener);Event.observe(this.field,"change",this.updateOnChangeListener);Event.observe(this.control.input,"change",this.updateOnChangeListener);var B=$("colorpicker").select(".colorwell");for(var D=0;D<B.length;D++){B[D].stopObserving("click");B[D].observe("click",this.wellClick.bindAsEventListener(this))}},wellClick:function(B){var A=Event.element(B);this.field.value=A.innerHTML.replace("#","");this.updateFromFieldValue()},toggle:function(A){this[(this.isOpen)?"close":"open"](A);Event.stop(A)},open:function(A){Control.colorPickers.each(function(C){C.close()});Control.ColorPicker.activeColorPicker=this;this.isOpen=true;Element.show(this.control.popUp);if(this.options.getPopUpPosition){var B=this.options.getPopUpPosition.bind(this)(A)}else{var B=Position.cumulativeOffset(this.swatch||this.field);B[0]=(B[0]+(this.swatch||this.field).offsetWidth+10)}this.control.popUp.style.left=(B[0])+"px";this.control.popUp.style.top=(B[1])+"px";this.updateFromFieldValue();Event.observe(this.control.okButton,"click",this.closeOnClickOkListener);Event.observe(this.control.pickerArea,"mousedown",this.updateOnClickPickerListener);if(this.options.onOpen){this.options.onOpen.bind(this)(A)}},close:function(A){if(Control.ColorPicker.activeColorPicker==this){Control.ColorPicker.activeColorPicker=null}this.isOpen=false;Element.hide(this.control.popUp);Event.stopObserving(this.control.okButton,"click",this.closeOnClickOkListener);Event.stopObserving(this.control.pickerArea,"mousedown",this.updateOnClickPickerListener);if(this.options.onClose){this.options.onClose.bind(this)()}},updateHue:function(A){var C=(this.control.pickerArea.offsetHeight-A*100)/this.control.pickerArea.offsetHeight;if(C==1){C=0}var B=YAHOO.util.Color.hsv2rgb(C,1,1);if(!YAHOO.util.Color.isValidRGB(B)){return }this.control.pickerArea.style.backgroundColor="rgb("+B[0]+", "+B[1]+", "+B[2]+")";this.update()},updateFromFieldValue:function(C){if(!this.isOpen){return }var D=(C&&Event.findElement(C,"input"))||this.field;var B=YAHOO.util.Color.hex2rgb(D.value.replace("#",""));if(!YAHOO.util.Color.isValidRGB(B)){return }var A=YAHOO.util.Color.rgb2hsv(B[0],B[1],B[2]);this.control.selector.style.left=Math.round(A[1]*this.control.pickerArea.offsetWidth)+"px";this.control.selector.style.top=Math.round((1-A[2])*this.control.pickerArea.offsetWidth)+"px";this.control.hueSlider.setValue((1-A[0]))},updateSelector:function(B){var C=Event.pointerX(B);var A=Event.pointerY(B);var D=Position.cumulativeOffset($("colorpicker-bg"));this.control.selector.style.left=(C-D[0]-6)+"px";this.control.selector.style.top=(A-D[1]-6)+"px";this.update((C-D[0]),(A-D[1]));this.control.picker.initDrag(B)},updateSwatch:function(){var B=YAHOO.util.Color.hex2rgb(this.field.value);if(!YAHOO.util.Color.isValidRGB(B)){return }this.swatch.style.backgroundColor="rgb("+B[0]+", "+B[1]+", "+B[2]+")";var A=YAHOO.util.Color.rgb2hsv(B[0],B[1],B[2]);this.swatch.style.color=(A[2]>0.65)?"#000000":"#FFFFFF"},update:function(A,D){if(!A){A=this.control.picker.currentDelta()[0]}if(!D){D=this.control.picker.currentDelta()[1]}var C=(this.control.pickerArea.offsetHeight-this.control.hueSlider.value*100)/this.control.pickerArea.offsetHeight;if(C==1){C=0}this.hsv={hue:1-this.control.hueSlider.value,saturation:A/this.control.pickerArea.offsetWidth,brightness:(this.control.pickerArea.offsetHeight-D)/this.control.pickerArea.offsetHeight};var B=YAHOO.util.Color.hsv2rgb(this.hsv.hue,this.hsv.saturation,this.hsv.brightness);this.rgb={red:B[0],green:B[1],blue:B[2]};this.field.value=YAHOO.util.Color.rgb2hex(B[0],B[1],B[2]);this.control.input.value=this.field.value;if(this.options.onUpdate){this.options.onUpdate.bind(this)(this.field.value)}}};PBwiki.Plugins={};PBwiki.Plugins.Core=Class.create({initialize:function(A){this.options=A},getConfigurationFormHTML:function(){return false},setupConfiguration:function(){},getFormInputs:function(){var A={};var C=$("spec_plugin_form").down("form");for(i=0;i<C.elements.length;i++){var B=C.elements[i].name;var D=C.elements[i].value;if(C.elements[i].type=="checkbox"){if(!C.elements[i].checked){D=""}else{if(!D){D=B}}}A[B]=D}return A},getConfigurationAttributes:function(){return{plugin:this.options.name}},getPreviewHTML:function(){return this.getPluginMarkerHTML()+"<p>This is what you will see in the editor until you save the page.</p>"},getPluginMarkerQS:function(){return Object.toQueryString(this.getConfigurationAttributes())},getPluginMarkerURL:function(){return"/plugin_helper.php?"+this.getPluginMarkerQS()},getPluginMarkerHTML:function(){return'<img src="'+this.getPluginMarkerURL()+'"/>'}});Object.Event.extend(PBwiki.Plugins.Core);PBwiki.Plugins.Spec=Class.create(PBwiki.Plugins.Core,{initialize:function(A){this.options=A},getConfigurationFormHTML:function(){return'<div id="spec_plugin_form"></div>'},setupConfiguration:function(){var A=this.options.pluginOpts||{};A.plugin=this.options.name;this.specFormLoad(A)},specFormLoad:function(A){$("spec_plugin_form").hide();$("plugin-loading").show();(new Ajax.Request("/plugin_get_form_mce.php?"+Object.toQueryString(A),{onSuccess:function(C){$("plugin-loading").hide();$("spec_plugin_form").show();if(C.responseText.indexOf('id="txtName"')!=-1){this.specPreviewHTML=C.responseText;this.options.dialog.step3()}else{var B=$("spec_plugin_form");B.update(C.responseText);var D=B.down("form");D.observe("submit",this.specFormSubmit.bind(this))}}.bind(this)}))},specFormSubmit:function(B){var A=this.getFormInputs();if(B){B.stop()}this.specFormLoad(A)},getConfigurationAttributes:function(){if(this.specPreviewHTML){return true}this.specFormSubmit();return false},getPreviewHTML:function(){return this.specPreviewHTML},getPluginMarkerURL:function(){return $("txtName").value}});PBwiki.Plugins["30boxes_pbwiki"]=Class.create(PBwiki.Plugins.Core,{getConfigurationAttributes:function($super){var A=$super();A.size="L";return A}});PBwiki.Plugins.template_variables=Class.create(PBwiki.Plugins.Core,{getConfigurationFormHTML:function(){return'<div>Add or select a variable below that will be entered and replaced at this location when a workspace is created with this template.</div>\n<div class="secondarypagetoolbar" id="template_variables_toolbar">\n  <a id="template_variables_button" class="button"><span class="iconbutton applicationform">Add New Variable</span></a>\n</div>\n<ul id="template_variables_list"></ul>'},refresh:function(){this.variableList.addClassName("loading");new PBwiki.APIRequest("GetTemplateVariables",{},{onSuccess:function(A){this.variableList.removeClassName("loading");this.variables=$H(A.variables);this.redraw()}.bind(this),onFailure:function(A){alert(A)}})},getSelectedVariable:function(){var A=this.variableList.down("li.active");if(!A){return false}return A.variableData},redraw:function(){this.variableList.update("");this.variables.each(function(H){var A=new Element("li");this.variableList.appendChild(A);A.variableData=H.value;var E=new Element("input",{type:"radio",name:"variable",value:H.key});A.appendChild(E);if(this.pluginOpts.id==H.key){A.addClassName("active");E.checked=true}var C=function(I){this.variableList.select("li").invoke("removeClassName","active");A.addClassName("active");this.pluginOpts.id=H.key;E.checked=true}.bind(this);E.observe("click",C);var B=new Element("div",{"class":"variable-delete"});delLink=new Element("a",{href:"#"}).update('<img src="/shared/network/images/icon-cross.png" />');delLink.observe("click",function(I){I.stop();if(confirm("Note: This variable will be inactive. Existing copies of this variable on this template will no longer work.")){this.variables.unset(H.key);this.save()}}.bind(this));B.appendChild(delLink);A.appendChild(B);var D=new Element("div",{"class":"variable-name"}).update(H.value.name.escapeHTML());D.observe("click",C);A.appendChild(D);var G=new Element("div",{"class":"variable-edit"});var F=new Element("a",{href:"#"}).update("edit");F.observe("click",function(I){I.stop();new PBwiki.DialogCommands.EditTemplateVariable({reuseDialogs:false,data:this.variables.get(H.key),onData:function(J){var K=H.key;J.id=K;this.variables.set(K,J);this.pluginOpts.id=K;this.save()}.bind(this)})}.bind(this));G.appendChild(F);A.appendChild(G)},this)},save:function(){new PBwiki.APIRequest("SetTemplateVariables",{},{parameters:{variables:Object.toJSON(this.variables)}});this.redraw()},setupConfiguration:function(){this.pluginOpts=this.options.pluginOpts||{};this.variableList=$("template_variables_list");this.refresh();$("template_variables_button").observe("click",function(A){A.stop();new PBwiki.DialogCommands.EditTemplateVariable({reuseDialogs:false,onData:function(B){var C=new Date().getTime().toString();B.id=C;this.variables.set(C,B);this.pluginOpts.id=C;this.save()}.bind(this)})}.bind(this))},getConfigurationAttributes:function($super){var B=$super();var A=this.getSelectedVariable();if(!A){alert("You must select a variable for this plugin");return false}B.id=A.id;return B}});PBwiki.Plugins.views=Class.create(PBwiki.Plugins.Core,{});PBwiki.Plugins.translate=Class.create(PBwiki.Plugins.Core,{});PBwiki.DialogCommands.PluginDialog=Class.create(PBwiki.DialogCommands.TemplateDialog,{title:"Insert Plugin",templateSrc:'<div id="plugin-steps">\n  <div id="plugin-loading" style="display: none;">\n    <span>Loading...</span>\n  </div>\n\n  <div id="plugin-step1" class="plugin-step">\n    <ul style="margin-left: 1em;" class="badges"></ul>\n  </div>\n  <div id="plugin-step2" class="plugin-step">\n\n  </div>\n  <div id="plugin-step3" class="plugin-step">\n\n  </div>\n  <div id="plugin-controls">\n    <div class="modal_buttons">\n      <input value="&laquo; Back" class="btn primarybutton prevbutton" type="button"> &nbsp; <input value="Next &raquo;" id="sf_submit" style="float: none !important;" class="btn primarybutton nextbutton" type="button"> &nbsp; <span>or <a href="javascript:void(0);" onclick="PBwiki.DialogFactory.close(); return false;">cancel</a></span>\n    </div>  \n  </div>\n</div>',numSteps:3,pluginMarker:"/plugin_helper.php?",setupDialog:function($super){$super();this.categoryList=this.dialog.down("ul");this.pluginControls=$("plugin-controls");this.prevButton=this.pluginControls.down("input.prevbutton");this.prevButton.observe("click",this.prevStep.bind(this));this.nextButton=this.pluginControls.down("input.nextbutton");this.nextButton.observe("click",this.nextStep.bind(this));if(this.options.marker){this.setTitle("Edit Plugin");this.pluginOpts=this.parsePluginURL(this.options.marker.getAttribute("src"));this.step2(this.pluginOpts.plugin,1);return }else{if(this.options.plugin){this.step2(this.options.plugin,1);return }else{this.showPluginStep(1)}}$("plugin-loading").show();(new PBwiki.APIRequest("GetPlugins",{},{onSuccess:function(B){$("plugin-loading").hide();if(PBwiki.feature("encrypt")){this.categoryList.parentNode.insertBefore(new Element("div",{"class":"yellow-note",style:"margin-top: 0;"}).update("To keep this workspace's content secure, some plugins (which store data on other sites) are not available."),this.categoryList)}try{var A=100;$H(B.plugins).each(function(G){A--;var E=new Element("li",{"class":"badge"}).setStyle({zIndex:A});E.observe((Prototype.Browser.IE)?"mouseenter":"mouseover",function(H){E.addClassName("badgeon")}).observe((Prototype.Browser.IE)?"mouseleave":"mouseout",function(H){E.removeClassName("badgeon")});E.appendChild(new Element("div",{"class":"badgebutton"}));E.appendChild(new Element("div",{"class":"label"}).update(G.key));var F=new Element("div",{"class":"plugins"});var D=new Element("ul");$H(G.value).each(function(J){var I=new Element("li");I.appendChild(new Element("div",{"class":"mybull"}).update("&bull;"));var H=new Element("a",{"class":"dispatch"}).update(J.value).observe("click",this.step2.bind(this,J.key,1));I.appendChild(H);D.appendChild(I)},this);F.appendChild(D);E.appendChild(F);this.categoryList.appendChild(E)},this)}catch(C){alert(C.message)}}.bind(this),onFailure:function(A){alert(A)},method:"get"}))},parsePluginURL:function(A){var B=A.indexOf(this.pluginMarker);if(B==-1){return false}return A.substr(B+this.pluginMarker.length).replace(/\+/g," ").toQueryParams()},finshed:function(){this.notify("onFinshed",this.selectedPlugin.getPluginMarkerURL());document.fire("dialog:close")},nextStep:function(){var A=this.currentStep+1;if(A>this.numSteps){this.finshed()}else{if(A==3){this.step3()}}},prevStep:function(){var A=this.currentStep-1;if(A==2){this.step2(this.selectedName,3)}else{if(A==1){this.step1()}}},showPluginStep:function(A){this.currentStep=A;this.dialog.select("div.plugin-step").each(function(B){B.hide()});$("plugin-step"+A).show();((A==1)?this.pluginControls.hide():this.pluginControls.show());if((A==3&&this.options.marker&&!this.selectedPlugin.getConfigurationFormHTML())||(A==2&&(this.options.marker||this.options.plugin))){this.prevButton.hide()}else{this.prevButton.show()}this.nextButton.setAttribute("value",(A==this.numSteps)?((this.pluginOpts)?"Update Plugin":"Insert Plugin"):"Next ")},step1:function(){this.showPluginStep(1)},step2:function(B,A){this.selectedName=B;if(!PBwiki.Plugins[B]){PBwiki.Plugins[B]=Class.create(PBwiki.Plugins.Spec,{})}if(A!=3){this.selectedPlugin=new PBwiki.Plugins[B]({name:B,dialog:this,pluginOpts:this.pluginOpts});this.configFormHTML=this.selectedPlugin.getConfigurationFormHTML()}if(!this.configFormHTML){((A==1)?this.step3():this.step1())}else{this.showPluginStep(2);if(A!=3){$("plugin-step2").update(this.configFormHTML);this.selectedPlugin.setupConfiguration()}}},step3:function(){var A=this.selectedPlugin.getConfigurationAttributes();if(!A){return }$("plugin-step3").update(this.selectedPlugin.getPreviewHTML());this.showPluginStep(3)}});Object.Event.extend(PBwiki.DialogCommands.PluginDialog);PBwiki.DialogCommands.EditSource=Class.create(PBwiki.DialogCommands.TemplateDialog,{title:"Edit Source",templateSrc:'<textarea class="text" style="margin-bottom: 5px;"></textarea>\n<div class="modal_buttons">\n  <input value="Apply Changes" class="btn primarybutton" type="button"> &nbsp; <span>or <a href="javascript:PBwiki.DialogFactory.close()">cancel</a></span>\n</div>',setupDialog:function($super){$super();var A=this.dialog.down("textarea");A.setStyle({width:(this.options.dimensions.width-15)+"px",height:(this.options.dimensions.height-60)+"px"});A.value=this.options.html;this.dialog.down("input").observe("click",function(){this.notify("onSource",A.value);document.fire("dialog:close")}.bind(this))}});Object.Event.extend(PBwiki.DialogCommands.EditSource);PBwiki.DialogCommands.EditDialog=Class.create(PBwiki.DialogCommands.TemplateDialog,{autoAttributes:[],autoStyles:[],autoClassToggle:[],initialize:function($super,A){A.onClosed=function(){PBwiki.currentEditor.focus()};$super(A)},setupDialog:function($super){$super();this.elms=this.getEditElements();if(this.elms){this.elm=this.elms[0]}this.findInputs();this.setDialogAttributes(this.getElementAttributes());this.editForm=this.dialog.down("form");this.editForm.observe("submit",function(A){A.stop();this.setElementAttributes(this.getDialogAttributes());this.notify("onComplete");document.fire("dialog:close")}.bind(this));document.observe("dialog:closed",this.onClosed.bind(this))},onClosed:function(){},getEditElements:function(){return[PBwiki.currentEditor.getSelectedElement(this.editNode)]},getElementAttributes:function(){if(!this.elm){return{}}var A={};this.autoAttributes.each(function(B){var C=this.elm.getAttribute(B);switch(B){case"width":case"height":A[B]=isNaN(parseInt(C,10))?"":parseInt(C,10);break;default:A[B]=C}}.bind(this));this.autoStyles.each(function(B){var C=this.elm.style[B];switch(B){case"marginLeft":case"marginRight":case"marginTop":case"marginBottom":A[B]=isNaN(parseInt(C,10))?"":parseInt(C,10);break;case"width":case"height":A[B]=isNaN(parseInt(C,10))?"":parseInt(C,10);A[B+"_type"]=(C.indexOf("%")!==-1)?1:0;break;case"backgroundColor":A[B]=C||this.elm.getAttribute("bgcolor");break;default:A[B]=C}}.bind(this));this.autoClassToggle.each(function(B){A[B]=(this.elm.className.split(" ").indexOf(B)!=-1)}.bind(this));return A},setDialogAttributes:function(A){this.autoAttributes.concat(this.autoStyles).each(function(B){if(A[B]){this.inputs[B].value=A[B]}if((B=="height"||B=="width")&&this.inputs[B+"_type"]){if(A[B+"_type"]===0||A[B+"_type"]===1){this.inputs[B+"_type"].selectedIndex=A[B+"_type"]}}}.bind(this));this.autoClassToggle.each(function(B){this.inputs[B].checked=A[B]}.bind(this))},getDialogAttributes:function(){var A={};this.autoAttributes.concat(this.autoStyles).each(function(B){var C=this.inputs[B].value;switch(B){case"marginLeft":case"marginRight":case"marginTop":case"marginBottom":A[B]=isNaN(parseInt(C,10))?"":parseInt(C,10)+"px";break;case"width":case"height":A[B]=isNaN(parseInt(C,10))?"":parseInt(C,10);if(A[B]&&this.inputs[B+"_type"]&&this.inputs[B+"_type"].selectedIndex===1){A[B]=A[B].toString()+"%"}else{if(A[B]){A[B]=A[B]+"px"}}break;default:A[B]=C}}.bind(this));this.autoClassToggle.each(function(B){A[B]=this.inputs[B].checked}.bind(this));return A},setElementAttributes:function(A){this.elms.each(function(B){this.autoAttributes.each(function(C){if(A[C]){B.setAttribute(C,A[C])}else{B.setAttribute(C,"")}}.bind(this));this.autoStyles.each(function(C){if(A[C]){B.style[C]=A[C]}else{B.style[C]=""}}.bind(this));B.setAttribute("_mce_style",B.style.cssText);this.autoClassToggle.each(function(C){var D=PBwiki.currentEditor.editor.dom;if(A[C]){D.addClass(B,C+" ")}else{D.removeClass(B,C)}}.bind(this))}.bind(this))},getElementAlignment:function(){var B=this.elm.style.cssFloat||this.elm.style.styleFloat;var A=this.elm.style.textAlign;if(B&&B=="right"){return"right"}else{if(B&&B=="left"){return"left"}else{if(A&&A=="center"){return"center"}else{return""}}}},getAttributeHexColor:function(A){if(!A){return }var B=tinymce.DOM.toHex(A);if(!B){return }return B.charAt(0)=="#"?B.substr(1):B},setElementAlignment:function(A){if(A==this.getElementAlignment()){return }this.elm.style.marginLeft=(A=="center")?"auto":0;this.elm.style.marginRight=(A=="center")?"auto":0;this.elm.style.textAlign=(A=="center")?"center":"";this.elm.style[(Prototype.Browser.IE)?"styleFloat":"cssFloat"]=(A=="left"||A=="right")?A:""}});Object.Event.extend(PBwiki.DialogCommands.EditDialog);PBwiki.DialogCommands.EditImage=Class.create(PBwiki.DialogCommands.EditDialog,{title:"Edit Image",templateSrc:'<form id="edit_image_form">\n  <div class="form-section edit-form">\n    <div class="form-row">\n      <label>URL</label>\n      <input type="text" name="src" style="width: 260px;" />\n    </div>\n    <div class="form-row">\n      <label>Alternate Text</label>\n      <input type="text" name="alt" />\n    </div>\n    <div id="edit_image_dimensions">\n      <div class="form-row">\n        <label>Width</label>\n        <input type="text" class="numeric" id="edit_image_width" name="width" /> pixels\n      </div>\n      <div class="form-row">\n        <label>Height</label>\n        <input type="text" class="numeric" id="edit_image_height" name="height" /> pixels\n        <a href="#" title="Unlock Proportions" id="edit_image_locking"><img src="/shared/icons/lock.png"></a>\n      </div>\n    </div>\n    <div class="form-row">\n      <label>Has Border</label>\n      <input type="checkbox" name="border" />\n    </div>\n    <div class="form-row image-margins">\n      <label>Margin</label>\n      <img src="/shared/images/icon_margin_left_24x24.png" /> <input type="text" class="numeric" name="marginLeft" /> \n      <img src="/shared/images/icon_margin_right_24x24.png" /> <input type="text" class="numeric" name="marginRight" />\n      <img src="/shared/images/icon_margin_top_24x24.png" /> <input type="text" class="numeric" name="marginTop" />\n      <img src="/shared/images/icon_margin_bottom_24x24.png" /> <input type="text" class="numeric" name="marginBottom" />\n      pixels\n    </div>    \n    <div class="form-row">\n      <label>Alignment</label>\n      <select name="align">\n        <option value="">&lt;Not set&gt;</option>\n        <option value="left">Left</option>\n        <option value="center">Center</option>\n        <option value="right">Right</option>		\n      </select>\n    </div>\n  </div>\n  <div class="modal_buttons">\n    <input value="Save Changes" class="btn primarybutton" type="submit"> &nbsp; <span>or <a href="javascript:void(0);" onclick="PBwiki.DialogFactory.close(); return false;">cancel</a></span>\n  </div>\n</form>',editNode:"IMG",autoAttributes:["src","alt","width","height"],autoStyles:["marginLeft","marginRight","marginTop","marginBottom"],setupDialog:function($super){$super();var E=$("edit_image_locking");var C=$("edit_image_width");var A=$("edit_image_height");this.lockAspect=true;this.aspect=this.elm.clientHeight/this.elm.clientWidth;E.observe("click",function(F){F.stop();this.lockAspect=!this.lockAspect;if(this.lockAspect){C.value=this.elm.clientWidth;A.value=this.elm.clientHeight}E.down("img").src="/shared/icons/lock"+(!this.lockAspect?"_open":"")+".png";E.setAttribute("title",this.lockAspect?"Unlock Proportions":"Lock Proportions")}.bind(this));var D=function(){if(this.lockAspect){A.value=Math.round(C.value*this.aspect)||""}}.bind(this);var B=function(){if(this.lockAspect){C.value=Math.round(A.value/this.aspect)||""}}.bind(this);["keyup","change","paste","input"].each(function(F){C.observe(F,D);A.observe(F,B)})},getElementAttributes:function($super){var B=$super();B.align=this.getElementAlignment();B.height=this.elm.clientHeight;B.width=this.elm.clientWidth;var A=/(\d+)px/.exec(this.elm.style.borderTop);B.border=A?A[1]:0;return B},setDialogAttributes:function($super,A){$super(A);var D=A.align;var C=this.inputs.align;for(var B=0;B<C.options.length;B++){if(C.options[B].value==D){C.selectedIndex=B;break}}this.inputs.border.checked=A.border>0},getDialogAttributes:function($super){var B=this.inputs.align;var A=$super();A.align=B.options[B.selectedIndex].value;A.border=this.inputs.border.checked?2:0;return A},setElementAttributes:function($super,A){this.elm.style.border=(A.border)?A.border+"px solid #000":0;if(A.width){A.width=parseInt(A.width);this.elm.style.width=""}if(A.height){A.height=parseInt(A.height);this.elm.style.height=""}this.setElementAlignment(A.align);$super(A)},setElementAlignment:function($super,A){this.elm.style.display=(A=="center")?"block":"";$super(A)}});Object.Event.extend(PBwiki.DialogCommands.EditImage);PBwiki.DialogCommands.EditTable=Class.create(PBwiki.DialogCommands.EditDialog,{title:"Edit Table",templateSrc:'<form id="edit_table_form">\n  <div class="form-section edit-form">\n    <div id="edit_table_dimensions" style="display: none;">\n      <div class="form-row">\n        <label>Columns</label>\n        <input type="text" class="numeric" name="cols" value="1" />\n      </div>\n      <div class="form-row">\n        <label>Rows</label>\n        <input type="text" class="numeric" name="rows" value="1" />\n      </div>\n    </div>  \n    <div class="form-row">\n      <label>Alignment</label>\n      <select name="align" id="edit-table-align">\n		<option value="">&lt;Not Set&gt;</option>\n        <option value="left">Left</option>\n        <option value="center">Center</option>\n        <option value="right">Right</option>		\n      </select>\n    </div>\n    <div class="form-row">\n      <label>Width</label>\n      <input type="text" size="5" name="width" />\n      <select name="width_type" id="edit-table-width">\n        <option value="">pixels</option>\n        <option value="%">percent</option>\n      </select>\n    </div>\n    <div class="form-row">\n      <label>Background<br />Color:</label>\n      <input type="text" class="color" name="backgroundColor" size="7" id="edit-table-bgcolor" />&nbsp;<span id="edit-table-bgcolor-swatch" class="iconbutton colorselect">&nbsp;</span>\n    </div>\n    <div class="form-row">\n      <label>Border<br />Color:</label>\n      <input type="text" class="color" name="borderColor" size="7" id="edit-table-bordercolor" />&nbsp;<span id="edit-table-bordercolor-swatch" class="iconbutton colorselect">&nbsp;</span>\n    </div>    \n    <div class="form-row">\n      <label>Has Border</label>\n      <input type="checkbox" name="pbHasBorder"  id="edit-table-border" />\n    </div>    \n    <div class="form-row">\n      <label>Allow Sorting</label>\n      <input type="checkbox" name="pbSortable"  id="edit-table-sorting" />\n    </div>\n  </div>\n  <div class="modal_buttons">\n    <input value="Save Changes" class="btn newpagesubmit" id="edit-table-submit" type="submit"> &nbsp; <span>or <a href="javascript:void(0);" onclick="PBwiki.DialogFactory.close(); return false;">cancel</a></span>\n  </div>\n</form>',editNode:"TABLE",autoAttributes:["align"],autoStyles:["width","backgroundColor","borderColor"],autoClassToggle:["pbSortable"],setupDialog:function($super){$super();this.bgselector=new Control.ColorPicker("edit-table-bgcolor",{swatch:$("edit-table-bgcolor-swatch")});this.borderselector=new Control.ColorPicker("edit-table-bordercolor",{swatch:$("edit-table-bordercolor-swatch")})},onClosed:function(){this.bgselector.close()},getElementAttributes:function($super){if(!this.elm){return{}}var B=$super();B.backgroundColor=this.getAttributeHexColor(B.backgroundColor);var A=this.elm.getElementsByTagName("td");if(A.length>0){B.borderColor=this.getAttributeHexColor(A[0].style.borderTopColor)}B.pbHasBorder=this.getElementHasBorder();B.align=this.getElementAlignment();this.initialAttributes=B;return B},setDialogAttributes:function($super,A){$super(A);this.inputs.pbHasBorder.checked=A.pbHasBorder},getDialogAttributes:function($super){var A=$super();A.pbHasBorder=this.inputs.pbHasBorder.checked;if(A.backgroundColor){A.backgroundColor=A.backgroundColor.substr(0,1)!="#"?"#"+A.backgroundColor:A.backgroundColor}if(A.borderColor){A.borderColor=A.borderColor.substr(0,1)!="#"?"#"+A.borderColor:A.borderColor}return A},setElementAttributes:function($super,B){var A=PBwiki.currentEditor.editor.dom;var E=this.getElementHasBorder();if(!E&&B.pbHasBorder){A.removeClass(this.elm,"pbNoBorder")}else{if(E&&!B.pbHasBorder){A.addClass(this.elm,"pbNoBorder")}}this.setElementAlignment(B.align);try{this.elm.removeAttribute("bgcolor")}catch(F){}var C=(this.initialAttributes&&this.initialAttributes.borderColor)?"#"+this.initialAttributes.borderColor:"";if(!B.borderColor){B.borderColor=""}if(B.borderColor!=C){tinymce.each(A.select("td,th",this.elm),function(G){G.style.borderColor=B.borderColor;G.removeAttribute("bordercolor",false);G.removeAttribute("_mce_style")})}delete B.borderColor;var D=(this.initialAttributes&&this.initialAttributes.backgroundColor)?"#"+this.initialAttributes.backgroundColor:"";if(!B.backgroundColor){B.backgroundColor=""}if(B.backgroundColor!=D){tinymce.each(A.select("td,th",this.elm),function(G){G.style.backgroundColor="";G.removeAttribute("bgcolor",false);G.removeAttribute("_mce_style")})}$super(B)},getElementHasBorder:function(){return(this.elm.className.split(" ").indexOf("pbNoBorder")==-1)}});Object.Event.extend(PBwiki.DialogCommands.EditTable);PBwiki.DialogCommands.CreateTable=Class.create(PBwiki.DialogCommands.EditTable,{title:"Create Table",templateSrc:'<form id="edit_table_form">\n  <div class="form-section edit-form">\n    <div id="edit_table_dimensions" style="display: none;">\n      <div class="form-row">\n        <label>Columns</label>\n        <input type="text" class="numeric" name="cols" value="1" />\n      </div>\n      <div class="form-row">\n        <label>Rows</label>\n        <input type="text" class="numeric" name="rows" value="1" />\n      </div>\n    </div>  \n    <div class="form-row">\n      <label>Alignment</label>\n      <select name="align" id="edit-table-align">\n		<option value="">&lt;Not Set&gt;</option>\n        <option value="left">Left</option>\n        <option value="center">Center</option>\n        <option value="right">Right</option>		\n      </select>\n    </div>\n    <div class="form-row">\n      <label>Width</label>\n      <input type="text" size="5" name="width" />\n      <select name="width_type" id="edit-table-width">\n        <option value="">pixels</option>\n        <option value="%">percent</option>\n      </select>\n    </div>\n    <div class="form-row">\n      <label>Background<br />Color:</label>\n      <input type="text" class="color" name="backgroundColor" size="7" id="edit-table-bgcolor" />&nbsp;<span id="edit-table-bgcolor-swatch" class="iconbutton colorselect">&nbsp;</span>\n    </div>\n    <div class="form-row">\n      <label>Border<br />Color:</label>\n      <input type="text" class="color" name="borderColor" size="7" id="edit-table-bordercolor" />&nbsp;<span id="edit-table-bordercolor-swatch" class="iconbutton colorselect">&nbsp;</span>\n    </div>    \n    <div class="form-row">\n      <label>Has Border</label>\n      <input type="checkbox" name="pbHasBorder"  id="edit-table-border" />\n    </div>    \n    <div class="form-row">\n      <label>Allow Sorting</label>\n      <input type="checkbox" name="pbSortable"  id="edit-table-sorting" />\n    </div>\n  </div>\n  <div class="modal_buttons">\n    <input value="Save Changes" class="btn newpagesubmit" id="edit-table-submit" type="submit"> &nbsp; <span>or <a href="javascript:void(0);" onclick="PBwiki.DialogFactory.close(); return false;">cancel</a></span>\n  </div>\n</form>',autoAttributes:["align"],autoStyles:["width","backgroundColor"],autoClassToggle:["pbSortable"],setupDialog:function($super){$super();$("edit_table_dimensions").show()},getEditElements:function(){return false},setElementAttributes:function($super,B){var C=Math.max(this.inputs.rows.value,1);var E=Math.max(this.inputs.cols.value,1);var D=this.options.insertion_function(C,E);var A=PBwiki.currentEditor.editor;if(D){this.elm=D;this.elms=[D]}$super(B)}});Object.Event.extend(PBwiki.DialogCommands.CreateTable);PBwiki.DialogCommands.EditCell=Class.create(PBwiki.DialogCommands.EditDialog,{title:"Edit Cell",templateSrc:'<form id="edit_table_form">\n  <div class="form-section edit-form">\n    <div class="form-row">\n      <label>Width</label>\n      <input type="text" class="numeric" name="width" id="edit-cell-width" />\n      <select name="width_type">\n        <option value="">pixels</option>\n        <option value="%">percent</option>\n      </select>\n    </div>\n    <div class="form-row">\n      <label>Height</label>\n      <input type="etext" class="numeric" name="height" id="edit-cell-height" />\n      <select name="height_type">\n        <option value="">pixels</option>\n        <option value="%">percent</option>\n      </select>\n    </div>\n    <div class="form-row">\n      <label>Background<br />Color:</label>\n      <input type="text" class="color" name="backgroundColor" size="7" id="edit-cell-bgcolor" />&nbsp;<span id="edit-cell-bgcolor-swatch" class="iconbutton colorselect">&nbsp;</span>\n    </div>\n    <div class="form-row">\n      <label>Border<br />Color:</label>\n      <input type="text" class="color" name="borderColor" size="7" id="edit-cell-bordercolor" />&nbsp;<span id="edit-cell-bordercolor-swatch" class="iconbutton colorselect">&nbsp;</span>\n    </div>\n  </div>\n  <div class="modal_buttons">\n    <input value="Save Changes" class="btn primarybutton" type="submit"> &nbsp; <span>or <a href="javascript:void(0);" onclick="PBwiki.DialogFactory.close(); return false;">cancel</a></span>\n  </div>\n</form>',editNode:"TD",autoStyles:["width","height","backgroundColor","borderColor"],getElementAttributes:function($super){var A=$super();A.backgroundColor=this.getAttributeHexColor(A.backgroundColor);A.borderColor=this.getAttributeHexColor(this.elm.style.borderTopColor);return A},getEditElements:function(){return this.options.cells},setElementAttributes:function($super,A){$super(A);this.elm.removeAttribute("bordercolor",false);this.elm.removeAttribute("bgcolor",false)},getDialogAttributes:function($super){var A=$super();if(A.backgroundColor){A.backgroundColor=A.backgroundColor.substr(0,1)!="#"?"#"+A.backgroundColor:A.backgroundColor}if(A.borderColor){A.borderColor=A.borderColor.substr(0,1)!="#"?"#"+A.borderColor:A.borderColor}return A},setupDialog:function($super){$super();this.bgselector=new Control.ColorPicker("edit-cell-bgcolor",{swatch:$("edit-cell-bgcolor-swatch")});this.borderselector=new Control.ColorPicker("edit-cell-bordercolor",{swatch:$("edit-cell-bordercolor-swatch")})},onClosed:function(){this.bgselector.close();this.borderselector.close()}});Object.Event.extend(PBwiki.DialogCommands.EditCell);PBwiki.DialogCommands.EditCellMerge=Class.create(PBwiki.DialogCommands.EditDialog,{title:"Merge Cells",templateSrc:'<form id="edit_table_merge_form">\n  <div class="form-section edit-form">\n    <div class="form-row">\n      <label>Columns</label>\n      <input type="text" class="numeric" name="colspan" />\n    </div>\n    <div class="form-row">\n      <label>Rows</label>\n      <input type="text" class="numeric" name="rowspan" />\n    </div>\n  <div class="modal_buttons">\n    <input value="Save Changes" class="btn primarybutton" type="submit"> &nbsp; <span>or <a href="javascript:void(0);" onclick="PBwiki.DialogFactory.close(); return false;">cancel</a></span>\n  </div>\n</form>',editNode:"TD",autoAttributes:["colspan","rowspan"],getElementAttributes:function($super){var A=$super();if(!A.colspan){A.colspan=1}if(!A.rowspan){A.rowspan=1}return A},getDialogAttributes:function($super){var A=$super();A.colspan=parseInt(A.colspan);if(A.colspan<1){A.colspan=1}A.rowspan=parseInt(A.rowspan);if(A.rowspan<1){A.rowspan=1}return A},setElementAttributes:function($super,A){this.notify("onSave",{numcols:A.colspan,numrows:A.rowspan})}});Object.Event.extend(PBwiki.DialogCommands.EditCellMerge);PBwiki.DialogCommands.PageNoLock=Class.create(PBwiki.DialogCommands.TemplateDialog,{title:"Page is Locked",templateSrc:'<div id="page-no-lock">\n  <p id="page-no-lock-msg">This page is being edited by <span id="page-no-lock-user"></span>.</p>\n</div>\n\n<div class="modal_buttons">\n  <input type="button" class="primarybutton" value="Steal lock" id="page-lock-steal" /> &nbsp; or <a href="#" onclick="document.fire(\'dialog:close\'); return false;">cancel</a>\n</div>\n\n',setupDialog:function($super){$super();$("page-lock-steal").observe("click",function(){this.notify("onSteal")}.bind(this));$("page-no-lock-user").update(this.options.lockinfo.editname.escapeHTML())}});Object.Event.extend(PBwiki.DialogCommands.PageNoLock);PBwiki.DialogCommands.PasteDialog=Class.create(PBwiki.DialogCommands.TemplateDialog,{title:"Paste - Use Ctrl+V",templateSrc:'<div style="margin-bottom: 0.75em;">\n  Your browser\'s security settings prevent direct pasting with this editor button. Please close this dialog, move your cursor into the desired location, and <strong>use <span id="editpaste-shortcut-text">Ctrl+V</span> on your keyboard to paste</strong> content from your clipboard.\n</div>',setupDialog:function($super){$super();if(tinymce.isMac){this.setTitle("Paste - Use &#8984;P");$("editpaste-shortcut-text").innerHTML="&#8984;P"}}});PBwiki.DialogCommands.CopyDialog=Class.create(PBwiki.DialogCommands.TemplateDialog,{title:"Copy - Use Ctrl+C",templateSrc:'<div style="margin-bottom: 0.75em;">\n  Your browser\'s security settings prevent direct copying with this editor button. Please close this dialog, select contents, and <strong>use <span id="editcopy-shortcut-text">Ctrl+C</span> on your keyboard to copy</strong> content to your clipboard.\n</div>',setupDialog:function($super){$super();if(tinymce.isMac){this.setTitle("Copy - Use &#8984;C");$("editcopy-shortcut-text").innerHTML="&#8984;C"}}});PBwiki.DialogCommands.SelectColor=Class.create(PBwiki.DialogCommands.TemplateDialog,{title:"Choose a Color",templateSrc:'<form id="select_color_form">\n  <div class="form-section" style="margin: 0 10px">\n    <input type="text" id="color-select-input" class="color" value="">\n  </div>\n  <div class="modal_buttons">\n    <input value="Select Color" class="btn primarybutton" type="submit"> &nbsp; <span>or <a href="javascript:PBwiki.DialogFactory.close()">cancel</a></span>\n  </div>\n</form>',initialize:function($super,A){Object.extend(A,{dimensions:{width:300}});$super(A)},setupDialog:function($super){$super();var S="/shared/images/crosshairs.png";var A="/shared/images/h.png";var J="/shared/images/position.png";var D="/shared/images/sv.png";function U(e,j){if(j==undefined){j=null}if(e.substr(0,1)=="#"){e=e.substr(1)}var h;var f;var a;if(e.length==3){h=e.substr(0,1);h+=h;f=e.substr(1,1);f+=f;a=e.substr(2,1);a+=a}else{if(e.length==6){h=e.substr(0,2);f=e.substr(2,2);a=e.substr(4,2)}else{return j}}h=parseInt(h,16);f=parseInt(f,16);a=parseInt(a,16);if(isNaN(h)||isNaN(f)||isNaN(a)){return j}else{return{r:h/255,g:f/255,b:a/255}}}function Q(f,e,a,h){f=Math.round(f*255);e=Math.round(e*255);a=Math.round(a*255);if(h==undefined){h=true}f=f.toString(16);if(f.length==1){f="0"+f}e=e.toString(16);if(e.length==1){e="0"+e}a=a.toString(16);if(a.length==1){a="0"+a}return((h?"#":"")+f+e+a).toUpperCase()}var T=navigator.appVersion.split("MSIE");var C=parseFloat(T[1]);function H(a){if((C>=5.5)&&(C<7)&&(document.body.filters)){var b=document.createElement("span");b.id=a.id;b.className=a.className;b.title=a.title;b.style.cssText=a.style.cssText;b.style.setAttribute("filter","progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+a.src+"', sizingMethod='scale')");b.style.fontSize="0";b.style.width=a.width.toString()+"px";b.style.height=a.height.toString()+"px";b.style.display="inline-block";return b}else{return a.cloneNode(false)}}function B(f,e){function b(g,j){var h=M(f);g=(g-h.x)+document.documentElement.scrollLeft;j=(j-h.y)+document.documentElement.scrollTop;if(g<0){g=0}if(j<0){j=0}if(g>f.offsetWidth-1){g=f.offsetWidth-1}if(j>f.offsetHeight-1){j=f.offsetHeight-1}return{x:g,y:j}}function a(j){var m=b(j.clientX,j.clientY);var l=m.x;var h=m.y;e(m.x,m.y);function k(o){var p=b(o.clientX,o.clientY);if(p.x!=l||p.y!=h){l=p.x;h=p.y;e(p.x,p.y)}}function g(o){Z(document,"mouseup",g);Z(document,"mousemove",k);F(f,"mousedown",a)}F(document,"mouseup",g);F(document,"mousemove",k);Z(f,"mousedown",a);if(j.preventDefault){j.preventDefault()}}F(f,"mousedown",a);f.onmousedown=function(g){return false};f.onselectstart=function(g){return false};f.ondragstart=function(g){return false}}var E=[];function I(f,e,b){var a;for(a in E){if(E[a].node==f&&E[a].event==e&&E[a].handler==b){return a}}return null}function F(e,b,a){if(I(e,b,a)!=null){return }if(!e.addEventListener){e.attachEvent("on"+b,a)}else{e.addEventListener(b,a,false)}E.push({node:e,event:b,handler:a})}function X(b){var a=E[b];delete E[b];if(!a.node.removeEventListener){a.node.detachEvent("on"+a.event,a.handler)}else{a.node.removeEventListener(a.event,a.handler,false)}}function Z(e,b,a){X(I(e,b,a))}function N(){var a;for(a=E.length;a>0;a--){if(E[a]!=undefined){X(a)}}}F(window,"unload",N);function P(k,j,m){var e;var g;var o;if(m==0){e=0;g=0;o=0}else{var h=Math.floor(k*6);var l=(k*6)-h;var b=m*(1-j);var a=m*(1-(j*l));var u=m*(1-(j*(1-l)));switch(h){case 1:e=a;g=m;o=b;break;case 2:e=b;g=m;o=u;break;case 3:e=b;g=a;o=m;break;case 4:e=u;g=b;o=m;break;case 5:e=m;g=b;o=a;break;case 6:case 0:e=m;g=u;o=b;break}}return{r:e,g:g,b:o}}function L(a,b,k){var h=Math.max(Math.max(a,b),k);var e=Math.min(Math.min(a,b),k);var g;var f;var j=h;if(e==h){g=0;f=0}else{var l=(h-e);f=l/h;if(a==h){g=(b-k)/l}else{if(b==h){g=2+((k-a)/l)}else{g=4+((a-b)/l)}}g/=6;if(g<0){g+=1}if(g>1){g-=1}}return{h:g,s:f,v:j}}function M(e){var a=e.offsetLeft;var f=e.offsetTop;var b=e.offsetParent;while(b!=null){a+=b.offsetLeft;f+=b.offsetTop;b=b.offsetParent}return{x:a,y:f}}var O=document.createElement("img");O.galleryImg=false;O.width=35;O.height=11;O.src=J;O.style.position="absolute";var R=document.createElement("img");R.galleryImg=false;R.width=35;R.height=200;R.src=A;R.style.display="block";var V=document.createElement("img");V.galleryImg=false;V.width=200;V.height=200;V.src=D;V.style.display="block";var K=document.createElement("img");K.galleryImg=false;K.width=21;K.height=21;K.src=S;K.style.position="absolute";function Y(g){var t,j;function m(){var AA=Q(t.r,t.g,t.b);var AB=P(j.h,1,1);var z=Q(AB.r,AB.g,AB.b);o.style.background=AA;g.value=AA;e.style.background=z;h.style.left=((j.v*199)-10).toString()+"px";h.style.top=(((1-j.s)*199)-10).toString()+"px";a.style.top=((j.h*199)-5).toString()+"px"}function v(){j=L(t.r,t.g,t.b);m()}function f(){t=P(j.h,j.s,j.v);m()}var u=document.createElement("div");u.style.padding="15px";u.style.position="relative";u.style.height="265px";u.style.width="250px";var e=document.createElement("div");e.style.position="relative";e.style.width="200px";e.style.height="200px";var l=H(V);e.appendChild(l);var h=K.cloneNode(false);e.appendChild(h);function q(z,AA){j.s=1-(AA/199);j.v=(z/199);f()}B(e,q);u.appendChild(e);var k=document.createElement("div");k.style.position="absolute";k.style.left="230px";k.style.top="15px";k.style.width="35px";k.style.height="200px";var a=H(O);k.appendChild(R.cloneNode(false));k.appendChild(a);function p(z,AA){j.h=AA/199;f()}B(k,p);u.appendChild(k);var o=document.createElement("div");o.style.height="50px";o.style.width="50px";o.style.position="absolute";o.style.top="225px";o.style.left="15px";o.style.border="1px solid black";u.appendChild(o);function b(){t=U(g.value,{r:0,g:0,b:0});v()}F(g,"change",b);g.size=8;g.style.position="absolute";g.style.right="15px";g.style.top=(225+(25-(g.offsetHeight/2))).toString()+"px";u.appendChild(g);b();return u}function W(j){var h=document.getElementsByTagName("input");var e;for(e=0;e<h.length;e++){var g=h[e];if(g.className!="color"){continue}var f=g.parentNode;var b=g.previousSibling;var a=Y(g);f.insertBefore(a,(b?b.nextSibling:null))}}var G=$("color-select-input");G.value=this.options.color;this.dialog.down("input.primarybutton").observe("click",function(a){a.stop();this.notify("onSelected",G.value);document.fire("dialog:close")}.bind(this));W()}});Object.Event.extend(PBwiki.DialogCommands.SelectColor);PBwiki.DragUploader=Class.create({initialize:function(A){if(!this.isSupportedBrowser()){return }this.options=A;this.elm=A.elm;this.files=[];PBwiki.dragUploader=this;this.onDragEnter=function(B){if(!this.eventHasFiles(B)){return }this.showMessage();B.dataTransfer.dropEffect="none";B.preventDefault()}.bind(this);this.onDragOver=function(B){if(!this.eventHasFiles(B)){return }B.dataTransfer.dropEffect="none";this.showOverlay();clearTimeout(this.overlayTimeout);if(!this.isRunning){this.overlayTimeout=setTimeout(this.hideOverlay.bind(this),250)}B.preventDefault()}.bind(this);this.onDrop=function(B){if(!this.eventHasFiles(B)){return }B.preventDefault()}.bind(this);Event.observe(window,"dragenter",this.onDragEnter);Event.observe(window,"dragover",this.onDragOver);Event.observe(window,"drop",this.onDrop);if(this.options.targetWin){Event.observe(this.options.targetWin,"dragover",this.onDragOver)}},eventHasFiles:function(A){if(A.dataTransfer.types&&$A(A.dataTransfer.types).indexOf("Files")!=-1){return true}if(A.dataTransfer.files&&A.dataTransfer.files.length>0){return true}return false},isSupportedBrowser:function(){return !Prototype.Browser.IE},enqueue:function(B){if(B.length==0){this.hideOverlay();return }for(var A=0;A<B.length;A++){if(B[A].size>100000000){alert("Files larger than 100MB cannot be uploaded via drag and drop, click the upload files button in Pages & Files and select your files");this.hideOverlay();return }if(A!=0&&B[A].fileName===B[0].fileName){alert("Only 1 file can be uploaded via drag and drop, drop a single file or click the upload files button in Pages & Files to select multiple files");this.hideOverlay();return }}this.files=B;this.uploadedFiles=[];this.lastUploadError=null;this.uploadCount=1;if(this.xhr){this.xhr.abort()}this.isRunning=true;this.runQueue()},runQueue:function(){if(this.uploadCount<=this.files.length){var A=this.files[this.uploadCount-1];this.uploadFile(A)}else{this.hideOverlay();this.isRunning=false;this.notify("onUploaded",{count:this.files.length,success:this.uploadedFiles})}},getUploadUrl:function(){var A={op:"PutFile",verbose:"true",raw:"true"};Object.extend(A,PBwiki.getSessCookie());if(this.options.onGetFolder){var B=this.options.onGetFolder();if(B){A.folder=this.options.onGetFolder()}}return"/api_v2/?"+Object.toQueryString(A)},showMessage:function(A){this.showOverlay(A)},showStatus:function(A){this.showOverlay()},showOverlay:function(B){if(this.overlay){return }var I=Element.getDimensions(this.elm);var D=this.elm.cumulativeOffset();var E=D.top-2;var A=E+I.height+4;if(document.viewport.getScrollOffsets().top>E){E=document.viewport.getScrollOffsets().top}if(document.viewport.getScrollOffsets().top+document.viewport.getHeight()<A){A=document.viewport.getScrollOffsets().top+document.viewport.getHeight()}var G=A-E;this.overlay=new Element("div").setStyle({top:E+"px",left:(D.left-2)+"px",width:(I.width+4)+"px",height:G+"px"}).addClassName("dragupload_overlay");document.body.appendChild(this.overlay);if(!B){B="To upload to this workspace"}var C=new Element("div");C.innerHTML="<strong>Drag files here</strong><br />"+B;this.overlay.appendChild(C);C.style.marginTop=(G/2)-(C.offsetHeight/2)+"px";var H=function(J){J.dataTransfer.effectAllowed="copy";J.dataTransfer.dropEffect="copy";if(typeof window.FileReader==="function"){J.preventDefault()}J.stopPropagation()};Event.observe(this.overlay,"dragenter",function(J){if(this.isRunning){return }H(J)}.bind(this));Event.observe(this.overlay,"dragover",function(J){if(this.isRunning){return }H(J);clearTimeout(this.overlayTimeout);this.overlayTimeout=setTimeout(this.hideOverlay.bind(this),250)}.bind(this));Event.observe(this.overlay,"dragleave",H);if(typeof window.FileReader==="function"){Event.observe(this.overlay,"drop",function(J){if(this.isRunning){return }clearTimeout(this.overlayTimeout);this.enqueue(J.dataTransfer.files);J.preventDefault();J.stopPropagation()}.bind(this))}else{var F=new Element("input",{type:"file",multiple:"true"}).setStyle({width:"100%",height:"100%",position:"absolute",opacity:0,top:"0px",left:"0px"});this.overlay.appendChild(F);Event.observe(F,"change",function(J){if(this.isRunning){return }clearTimeout(this.overlayTimeout);this.enqueue(F.files)}.bind(this))}},hideOverlay:function(){if(!this.overlay){return }this.overlay.parentNode.removeChild(this.overlay);delete this.overlay},showProgress:function(A,B){if(!this.overlay){this.showOverlay()}this.overlay.style.opacity=1;this.overlay.innerHTML="";var E=A/B;var D=Element.getDimensions(this.elm);var G=this.elm.cumulativeOffset();var C=new Element("div").setStyle({top:(D.height/2)-15+"px",left:(D.width/2)-100+"px"}).addClassName("dragupload_progress");var F=new Element("div").setStyle({width:Math.max(100,Math.round(E*100)*2)+"px",height:"30px",backgroundColor:"#899FA5"});C.appendChild(F);this.overlay.appendChild(C)},uploadFile:function(F){var G=new XMLHttpRequest();this.xhr=G;var C=G.upload;var B=0,A=0;for(var E=1;E<=this.files.length;E++){var D=this.files[E-1].size||this.files[E-1].fileSize;B+=D;if(E<this.uploadCount){A+=D}}Event.observe(C,"progress",function(H){if(H.lengthComputable){this.showProgress(A+H.position,B)}}.bind(this));G.onreadystatechange=function(){if(G.readyState==4){var H=G.responseText;var I=JSON.parse(H.split("\n")[1]);if(I.metadata&&I.metadata.acceptedFiles&&I.metadata.acceptedFiles.length==1){this.uploadedFiles.push({name:I.metadata.acceptedFiles[0].name})}else{alert(I.error_string);this.hideOverlay();return }this.uploadCount++;this.runQueue()}}.bind(this);G.open("POST",this.getUploadUrl());G.setRequestHeader("X-File-Name",F.fileName);G.setRequestHeader("X-File-Size",F.fileSize);G.send(F)},remove:function(){if(!this.isSupportedBrowser()){return }try{this.xhr.abort()}catch(A){}this.hideOverlay();Event.stopObserving(window,"dragenter",this.onDragEnter);Event.stopObserving(window,"dragover",this.onDragOver);Event.stopObserving(window,"drop",this.onDrop);if(this.options.targetWin){Event.stopObserving(this.options.targetWin,"dragover",this.onDragOver)}}});Object.Event.extend(PBwiki.DragUploader);PBwiki.Components=PBwiki.Components||{};PBwiki.Components.Editor=Class.create({getContent:function(){},setContent:function(){},setHeight:function(){},isDirty:function(){},insertLink:function(){},addOnKeyHandler:function(){},removeKeyHandler:function(){},insertImage:function(){},getSelectedText:function(){},getSelectedImage:function(){},getSelectedLink:function(){},setSelectedLink:function(){},disable:function(){},enable:function(){},focus:function(){},destroy:function(){}});PBwiki.Components.mceEditor=Class.create(PBwiki.Components.Editor,{kEditorNotInitialized:"Editor has not finshed loading",id:"content",initialize:function(D,B){this.options=B;this.id=D.id;var A={mode:"none",theme:"advanced",skin:"pbworks",id:this.id,height:B.height,theme_advanced_row_height:28,width:"100%",indentation:"40px",apply_source_formatting:(typeof (B.apply_source_formatting)!="undefined")?B.apply_source_formatting:true,gecko_spellcheck:true,plugins:"paste,spellchecker,contextmenu,table,tableextras,fsedit,pbnbsp,pbcode,pbhr,pbindent,preelementfix,pbtips,pblist,webkitimgsize,linkify,pbinsert,pbtablemenu,pbquicklink",theme_advanced_toolbar_location:"top",theme_advanced_statusbar_location:"none",theme_advanced_toolbar_align:"left",theme_advanced_buttons1:"bold,underline,italic,strikethrough,bullist,numlist,|,outdent,indent,justifyleft,justifycenter,justifyright,|,pbcopy,pbpaste,|,undo,|,pbtable,|,pbplugin",theme_advanced_buttons2:"forecolor,backcolor,formatselect,fontselect,fontsizeselect,spellchecker,hr,removeformat,|,pbcode,|,pblink",theme_advanced_buttons2_edu:"forecolor,backcolor,formatselect,fontselect,fontsizeselect,sup,sub,|,spellchecker,hr,removeformat,|,pbcode,|,pblink",theme_advanced_buttons3:"",font_size_style_values:"75%,85%,100%,115%,130%,150%,200%",theme_advanced_font_sizes:"8pt=75%,9pt=85%,10pt=100%,12pt=115%,14pt=130%,18pt=150%,24pt=200%",theme_advanced_blockformats:"p,h1,h2,h3,h4,pre",theme_advanced_fonts:"Normal=Segoe UI,Lucida Grande,Arial;Arial=Arial;Comic Sans=Comic Sans MS;Courier New=Courier New;Georgia=Georgia;Tahoma=Tahoma;Times New Roman=Times New Roman;Verdana=Verdana",theme_advanced_more_colors:true,theme_advanced_default_foreground_color:"#444444",theme_advanced_default_background_color:"#FFFFFF",theme_advanced_default_font_size:"100%",theme_advanced_default_font_family:"Segoe UI,Lucida Grande,Arial",doctype:'<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">',fix_list_elements:false,removeformat_selector:"b,strong,em,i,span,ins,font,big,small,strike,sub,sup,u,tt",paste_retain_style_properties:"marginLeft,paddingLeft,background,backgroundColor,textDecoration,color",relative_urls:false,constrain_menus:false,button_tile_map:true,valid_elements:"@[id|class|style|title|dir<ltr?rtl|lang|xml::lang],a[rel|rev|charset|hreflang|tabindex|accesskey|type|name|href|target|title|class],#strong/#b,#em/#i,#strike/#s,#u,#p[align],-ol[type|compact|start],-ul[type|compact|start],#li,br,img[longdesc|usemap|src|border|alt=|title|hspace|vspace|width|height|align],-sub,-sup,-blockquote[cite],-table[border=0|cellspacing|cellpadding|width|frame|rules|height|align|summary|bgcolor|background|bordercolor],-tr[rowspan|width|height|align|valign|bgcolor|background|bordercolor],tbody,thead,tfoot,#td[colspan|rowspan|width|height|align|valign|bgcolor|background|bordercolor|scope],#th[colspan|rowspan|width|height|align|valign|scope],caption,-div,-span,-code,-pre,address,#h1[align],#h2[align],#h3[align],#h4[align],#h5[align],#h6[align],hr[size|noshade],-font[face|size|color],dd,dl,dt,cite,abbr,acronym,del[datetime|cite],ins[datetime|cite],map[name],area[shape|coords|href|alt|target],bdo,button,col[align|char|charoff|span|valign|width],colgroup[align|char|charoff|span|valign|width],dfn,fieldset,form[action|accept|accept-charset|enctype|method],input[accept|alt|checked|disabled|maxlength|name|readonly|size|src|type|value|tabindex|accesskey],kbd,label[for],legend,noscript,optgroup[label|disabled],option[disabled|label|selected|value],q[cite],samp,select[disabled|multiple|name|size],small,textarea[cols|rows|disabled|name|readonly],tt,var,big,iframe[src|scrolling|width|height],style,applet[archive|code|codebase|width|height],object[classid|width|height|codebase|*],param[name|value],embed[type|width|height|src|*]",content_css_txt:'/* -------------------------------------------------------------- \n  \n   reset.css\n   * Resets default browser CSS.\n   \n   Based on work by Eric Meyer:\n   * meyerweb.com/eric/thoughts/2007/05/01/reset-reloaded/\n   \n-------------------------------------------------------------- */\n\nhtml, body, div, span, object, iframe,\nh1, h2, h3, h4, h5, h6, p, blockquote, pre,\na, abbr, acronym, address, code,\ndel, dfn, img, q, dl, dt, dd, ol, ul, li,\nfieldset, form, label, legend,\ntable, caption, tbody, tfoot, thead, tr, th, td {\n	margin: 0;\n	padding: 0;\n	border: 0;\n	font-weight: inherit;\n	font-style: inherit;\n	font-size: 100%;\n	font-family: inherit;\n	vertical-align: baseline;\n}\n\n\nbody { line-height: 1.5; background: #fff; margin:1.5em 0; }\n\n/* Tables still need \'cellspacing="0"\' in the markup. */\ntable { border-collapse: separate; border-spacing: 0; }\ncaption, th, td { text-align: left; font-weight:400; }\n\n/* Remove possible quote marks (") from <q>, <blockquote>. */\nblockquote:before, blockquote:after, q:before, q:after { content: ""; }\nblockquote, q { quotes: "" ""; }\n\na img { border: none; }\n\n html { overflow-y: scroll; }\nbody { margin: 1.5em 0; }\nhtml, body { height:100%; }\n*+body { height: auto; min-height: 100%; } /* IE7 only hack */\n\n/* wikistyles */\nbody.wikistyle { margin: 0; font-size: 13px; background: white; padding-left: 4px;}\n.wikistyle { color: #444; font-family: Segoe UI, "Lucida Grande", Arial; }\n.wikistyle p { margin: 0 }\n.wikistyle p span { line-height: 1.2em; }\n.wikistyle hr { height: 1px; font-size: 1px; color: #ccc; background: #ccc; border: 0; margin: 9px 0 8px 0;}\n.wikistyle a { color: #148 !important; }\n.wikistyle a.iconbutton { text-decoration: underline; }\n.wikistyle a[name] { background: none; border: none; padding-left: 0; }\n\n.wikistyle ul,\n.wikistyle ol { margin: 0; margin-left: 3em; }\n\n.wikistyle h1,\n.wikistyle h2,\n.wikistyle h3,\n.wikistyle h4 { line-height: 1.25em; color: #444; font-weight: bold;font-family: Segoe UI, "Lucida Grande", Arial, sans-serif; margin-bottom: 0px}\n.wikistyle h1 { font-size: 20px }\n.wikistyle h2 { font-size: 17px }\n.wikistyle h3 { font-size: 15px }\n.wikistyle h4 { font-size: 13px }\n\n.wikistyle table { border-collapse: collapse }\n.wikistyle table td,\n.wikistyle table th { border: 1px solid #bbb; padding: 2px 4px; vertical-align: top; }\n.wikistyle div.toc { font-size: 13px; }\n\n.mceItemHiddenSpellWord {background:url(/shared/editor/plugins/spellchecker/img/wline.gif) repeat-x bottom left; cursor:default;}\n\n.tipbox { background-color: #EEF8FF; border-top:1px solid #cde; border-bottom: 1px solid #cde; padding: 1em 1em 1em 3em; background-repeat: no-repeat; background-position: 0.75em 1em; }\n.tipbox p { margin: 0 }\n\npre { font-family: monospace; }\np { margin-bottom:1.5em; line-height: 1.5em }\n\nbody.mceContentBody table.pbNoBorder, body.mceContentBody table.pbNoBorder > tr > td, body.mceContentBody table.pbNoBorder > tr > th, body.mceContentBody table.pbNoBorder > tbody > tr > td, body.mceContentBody table.pbNoBorder > tbody > tr > th, body.mceContentBody table.pbNoBorder > thead > tr > td, body.mceContentBody table.pbNoBorder > thead > tr > th, body.mceContentBody table.pbNoBorder > tfoot > tr > td, body.mceContentBody table.pbNoBorder > tfoot > tr > th {\n  border:1px dotted #D3D3D3;\n}\n\n.wikistyle td.mceSelected, .wikistyle th.mceSelected { background-color: #3399ff !important; }\n\n.iconbutton   { padding: 2px 0px 2px 20px; text-decoration: none; background: url(/shared/icons/image.png) no-repeat center left; }\n.ob_item_pdf { background-image: url(/shared/icons/page_white_acrobat.png) !important; }\n.ob_item_doc { background-image: url(/shared/icons/page_white_word.png) !important; }\n.ob_item_xls { background-image: url(/shared/icons/page_white_excel.png) !important; }\n.ob_item_ppt { background-image: url(/shared/icons/page_white_powerpoint.png) !important; }\n.ob_item_zip { background-image: url(/shared/icons/page_white_compressed.png) !important; }\n.ob_item_jpg { background-image: url(/shared/icons/page_white_picture.png) !important; }\n.ob_item_txt { background-image: url(/shared/icons/page_white_text2.png) !important; }\n.ob_item_audio { background-image: url(/shared/icons/page_white_audio.png) !important; }\n.ob_item_html { background-image: url(/shared/icons/page_white_world.png) !important; }\n',body_class:"wikistyle",cleanup_on_startup:false,init_instance_callback:function(E){this.editor=E;this.notify("onInit",E)}.bind(this),urlconverter_callback:function(F,G,E,H){if(!this.baseURL){this.baseURL=window.location.protocol+"//"+window.location.host}if(F.indexOf(this.baseURL)===0){F=F.substr(this.baseURL.length)}return F}.bind(this),paste_postprocess:function(E,F){this.editor.dom.cleanupListNesting(F.node);this.editor.dom.cleanupAllLists(F.node);this.editor.dom.cleanupForPBStyles(F.node);this.editor.dom.cleanupStructuralMarkup(F.node)}.bind(this),setup:function(E){E.addCommand("mcePbLink",function(){document.fire("ui:hidetips");if(PBwiki.feature("linking_v2")&&!this.getSelectedLink()){var F=this.getSelectedText();if(Util.is_valid_email(F)===true){this.setSelectedLink({href:"mailto:"+F,txt:F});return }E.execCommand("mcePbLinkTip")}else{E.execCommand("mcePbLinkDialog")}}.bind(this));E.addCommand("mcePbLinkDialog",function(){var F=this.getSelectedLink();var H=this.getSelectedText();var G=PBwiki.feature("linking_v2")?"InsertLink2":"InsertLink";var I=E.selection.getPBBookmark();(new PBwiki.DialogCommands[G]({url:(F?F.getAttribute("_mce_href")||F.getAttribute("href"):false),txt:H,onSelect:function(J){E.selection.moveToPBBookmark(I);this.setSelectedLink(J)}.bind(this),onClosed:function(){E.selection.moveToPBBookmark(I);E.focus();E.nodeChanged()}}))}.bind(this));E.addCommand("mcePbSetLink",function(G,F){this.setSelectedLink(F)}.bind(this));E.addCommand("mcePbNewTask",function(G,F){if(!PBinfo.CurrentWiki){return }if(!PBwiki.feature("tasks")){new PBwiki.DialogCommands.CantMakeTask({});return }var H=this.editor.selection.getNode();if(H.nodeName.toUpperCase()=="IMG"&&H.getAttribute("src").indexOf("/plugin_helper.php?plugin=task")!=-1){this.editor.execCommand("mcePbEditTask");return }PBwiki.ResourceLoader.loadManifest("extras.js",function(){var J=this.editor.selection.getBookmark();var I=this.getSelectedText();I=I.replace(/\s+/g," ").replace(/\ufeff/g,"");I=I.substr(0,PBconst.kMaxActionLength).strip();new PBwiki.DialogCommands.NewAction({on_empty_create_milestone:true,title:I,onFinished:function(L){this.editor.selection.moveToBookmark(J);var K="";L.each(function(M){K+='<img class="pluginslug" src="/plugin_helper.php?plugin=task&amp;taskid='+M+'" alt="" />'});if(K){this.editor.execCommand("mceInsertContent",false,K)}}.bind(this)})}.bind(this))}.bind(this));E.addCommand("mcePbEditTask",function(I,G){if(!PBinfo.CurrentWiki||!PBwiki.feature("tasks")){return }var L=this.editor.selection.getNode(),K=L.getAttribute("src");if(!L||!L.nodeName.toUpperCase()=="IMG"||K.indexOf("/plugin_helper.php?plugin=task")==-1){return }var H=/taskid=(\d+)/.exec(K);if(!H){return }var F=H[1];var J=this.editor.selection.getBookmark();PBwiki.ResourceLoader.loadManifest("extras.js",function(){new PBwiki.DialogCommands.EditAction({id:F,onFinished:function(){L.setAttribute("src","/plugin_helper.php?plugin=task&amp;taskid="+F+"&amp;ts="+PBwiki.getTimestamp());this.editor.selection.moveToBookmark(J)}.bind(this)})}.bind(this))}.bind(this));E.addCommand("mcePbAddGliffyDiagram",function(G,F){var H=this.editor.selection.getBookmark();new PBwiki.Components.OverlayFrame({src:"/w/gliffy/?token="+Cookie.get(PBinfo.CurrentPage.sessCookie),onFinished:function(I){this.editor.selection.moveToBookmark(H);var J='<img class="pluginslug" src="/plugin_helper.php?plugin=gliffy&amp;diagramId='+I+"&amp;ts="+PBwiki.getTimestamp()+'" alt="" />';this.editor.execCommand("mceInsertContent",false,J)}.bind(this)})}.bind(this));E.addCommand("mcePbEditGliffyDiagram",function(I,G){var K=this.editor.selection.getNode(),J=K.getAttribute("src");if(!K||!K.nodeName.toUpperCase()=="IMG"||J.indexOf("/plugin_helper.php?plugin=gliffy")==-1){return }var H=/diagramId=(\d+)/.exec(J);if(!H){return }var F=H[1];new PBwiki.Components.OverlayFrame({src:"/w/gliffy/?token="+Cookie.get(PBinfo.CurrentPage.sessCookie)+"&diagramId="+F,onFinished:function(L){var M="/plugin_helper.php?plugin=gliffy&amp;diagramId="+L+"&amp;ts="+PBwiki.getTimestamp();K.setAttribute("src",M);K.setAttribute("_mce_src",M)}.bind(this)})}.bind(this));if(PBwiki.userCanCreateTask()){E.addShortcut("ctrl+k","New Task","mcePbNewTask")}E.addShortcut("ctrl+l","Create Link","mcePbLink");E.addCommand("mcePbSave",function(){this.notify("onSave")}.bind(this));E.addShortcut("ctrl+s","Save content","mcePbSave");E.onKeyDown.add(function(F,I){if(I.keyCode==9&&!I.altKey&&!I.ctrlKey){var L=F.selection.getNode();if(F.dom.getParent(L,"TABLE")){if(!tinymce.isOpera){tinyMCE.execInstanceCommand(F.editorId,"mceTableMoveToNextRow",true);return tinymce.dom.Event.cancel(I)}F.undoManager.add()}else{if(!F.dom.getParent(L,"UL")&&!F.dom.getParent(L,"OL")){F.execCommand("mceInsertContent",false,"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;");return tinymce.dom.Event.cancel(I)}}}if(I.keyCode==8){var G=F.selection,L=G.getNode();if(!L||!G.isCollapsed()||!F.selection.isAtBlockStart()){return }var H=F.dom.isBlock(L)?L:F.dom.getParent(L,F.dom.isBlock);if(!H){return }var K=H.previousSibling;while(K&&K.nodeType==3){K=K.previousSibling}if(["P","LI"].indexOf(L.nodeName.toUpperCase())!=-1){if(K&&["HR","TABLE"].indexOf(K.nodeName.toUpperCase())!=-1){var J=F.selection.getPBBookmark();F.dom.remove(K);F.selection.moveToPBBookmark(J);return tinymce.dom.Event.cancel(I)}}if(F.dom.getParent(H,F.dom.isList)||F.dom.isList(K)){setTimeout(function(){try{F.dom.combineAllAdjacentLists()}catch(M){}},200)}}});E.onDblClick.add(function(F,I){var H=F.selection.getNode(),G=H.nodeName.toUpperCase()=="IMG";if(G&&H.src.indexOf("/plugin_helper.php")!=-1){if(H.src.indexOf("plugin=task")!=-1){this.editor.execCommand("mcePbEditTask")}else{if(H.src.indexOf("plugin=gliffy")){this.editor.execCommand("mcePbEditGliffyDiagram")}else{if(H.src.indexOf("plugin=avplayer")==-1){this.editor.execCommand("mcePbPlugin")}}}}else{if(G){this.editor.execCommand("mceImage")}}}.bind(this));E.onSetContent.add(function(F,G){F.dom.cleanupAllLists()});E.onPreProcess.add(function(G,I){if(!I.get){return }var H=I.node.getElementsByTagName("p"),F;tinymce.each(H,function(J){F=J.textContent||J.innerText;if(F&&F.length>1){return }if(!G.dom.isEmpty(J)){return }var K=J;while(K){K=J.getElementsByTagName("*");if(K.length==0||K[0].nodeType!=1||["EM","STRONG"].indexOf(K[0].nodeName)==-1){break}J=K[0]}J.innerHTML="&nbsp;"})});E.addCommand("mcePbCopy",function(){var G=E.getDoc();try{var H=G.execCommand("Copy",false,null);if(!H||!G.queryCommandSupported("Copy")||Prototype.Browser.WebKit){throw"Error"}}catch(F){(new PBwiki.DialogCommands.CopyDialog({}))}});E.addCommand("mcePbPaste",function(){var G=E.getDoc();try{var H=G.execCommand("Paste",false,null);if(!H||!G.queryCommandSupported("Copy")||Prototype.Browser.WebKit){throw"Error"}}catch(F){(new PBwiki.DialogCommands.PasteDialog({}))}}.bind(this));E.addButton("pblink",{label:"Add Link",onclick:function(){this.editor.execCommand("mcePbLink")}.bind(this)});E.addCommand("mcePbRemoveIcon",function(){var F=this.getSelectedLink();if(!F){return }E.dom.setAttrib(F,"class","")}.bind(this));E.addButton("pbtask",{title:"Add task",onclick:function(){this.editor.execCommand("pbNewTask")}.bind(this)});E.addCommand("mcePbOpenLink",function(){var F=this.getSelectedLink();if(!F){return }window.open(F.getAttribute("href"))}.bind(this));E.addButton("pbpaste",{title:"Paste",onclick:function(){this.editor.execCommand("mcePbPaste")}.bind(this)});E.addButton("pbcopy",{title:"Copy",onclick:function(){this.editor.execCommand("mcePbCopy")}.bind(this)});E.addCommand("mcePbPlugin",function(I,H){var G=this.getSelectedImage(),F=false;var J=E.selection.getPBBookmark();(new PBwiki.DialogCommands.PluginDialog({marker:G,onFinshed:function(K){E.selection.moveToPBBookmark(J);F=true;if(G){G.setAttribute("src",K);G.setAttribute("_mce_src",K)}else{var L='<img class="pluginslug" src="'+K+'" />';this.editor.execCommand("mceInsertContent",false,L)}}.bind(this),onClosed:function(){E.focus();if(!F){E.selection.moveToPBBookmark(J)}},plugin:H}))}.bind(this));E.addButton("pbplugin",{label:"Insert Plugin",onclick:function(){this.editor.execCommand("mcePbPlugin")}.bind(this)});E.addButton("pbtable",{label:"Add Table",onclick:function(){if(this.editor.dom.getParent(this.editor.selection.getNode(),"td")||this.editor.dom.getParent(this.editor.selection.getNode(),"th")){this.editor.execCommand("mceInsertTable",true)}else{this.editor.execCommand("teCmdTableDraw")}}.bind(this)})}.bind(this)};if(PBinfo&&PBinfo.CurrentWiki&&PBinfo.CurrentWiki.cat=="edu"){A.theme_advanced_buttons1="bold,underline,italic,strikethrough,|,sub,sup,|,bullist,numlist,outdent,indent,|,justifyleft,justifycenter,justifyright,|,undo,|,pbcopy,pbpaste,|,pbtablemenu,|,pbinsert";A.theme_advanced_buttons2="forecolor,backcolor,formatselect,fontselect,fontsizeselect,spellchecker,hr,removeformat,|,pbcode,|,pblink"}else{A.theme_advanced_buttons1="bold,underline,italic,strikethrough,bullist,numlist,|,outdent,indent,justifyleft,justifycenter,justifyright,|,undo,|,pbcopy,pbpaste,|,pbtablemenu,|,pbinsert";A.theme_advanced_buttons2="forecolor,backcolor,formatselect,fontselect,fontsizeselect,spellchecker,removeformat,|,pbcode,|,pblink"}if(PBwiki.feature("nofilter")){A.valid_elements="*[*]"}if(this.overrideSettings){Object.extend(A,this.overrideSettings)}function C(E){tinymce.ScriptLoader.markDone(tinyMCE.baseURI.toAbsolute(E))}C("langs/en.js");A.plugins.split(",").each(function(E){C("plugins/"+E+"/editor_plugin.js");C("plugins/"+E+"/langs/en.js")});C("themes/advanced/editor_template.js");C("themes/advanced/langs/en.js");tinymce.dom.Event.domLoaded=true;if(Prototype.Browser.IE){$(D.parentNode).addClassName("mceIE");this.resizeSourceModeHandler=this.resizeSourceMode.bind(this);Event.observe(window,"resize",this.resizeSourceModeHandler)}(new tinymce.Editor(D.id,A).render())},resizeSourceMode:function(A){if(Prototype.Browser.IE&&this.isSourceMode&&this.txt){this.txt.style.width=0;this.txt.style.width=($(this.id+"_parent").getWidth()-2)+"px"}},setSourceMode:function(B){if(this.isSourceMode==B){return }var C=this.editor.getContent();this.isSourceMode=B;if(!this.iframe){this.iframe=$(this.id+"_ifr")}if(!this.txt){this.txt=new Element("textarea",{id:this.id+"-pbcode-area",spellcheck:"false"});this.iframe.insert({after:this.txt})}var A=this.iframe.getHeight();(B?this.iframe.hide():this.iframe.show());if(B){this.txt.setStyle({height:A+"px"});if(this.editor){this.txt.value=C}this.txt.show();this.txt.focus()}else{this.editor.setContent(this.txt.value);this.txt.hide();this.focus()}if(Prototype.Browser.IE&&B){this.resizeSourceMode()}},disable:function(){if(!this.editor){throw this.kEditorNotInitialized}this.editor.setProgressState(true)},enable:function(){if(!this.editor){throw this.kEditorNotInitialized}this.editor.setProgressState(false)},getContent:function(A){if(!this.editor){return""}return(this.isSourceMode)?this.txt.value:this.editor.getContent(A?{format:"raw"}:{})},getSelectedText:function(){if(!this.editor){throw this.kEditorNotInitialized}return this.editor.selection.getContent({format:"text"})},getSelectedLink:function(){return this.getSelectedElement("A")},getSelectedImage:function(){return this.getSelectedElement("IMG")},getSelectedElement:function(B){if(!this.editor){throw this.kEditorNotInitialized}var A=this.editor.selection.getNode();return(A.nodeName.toUpperCase()==B)?A:this.editor.dom.getParent(A,B)},insertLink:function(){if(!this.editor){throw this.kEditorNotInitialized}this.editor.execCommand("mcePbLink")},setSelectedLink:function(E){if(!this.editor){throw this.kEditorNotInitialized}var K=E.link||this.getSelectedLink();var L=this.getSelectedText();var D=this.editor.selection.getNode();var I,A,H;if(K){K.setAttribute("href",E.href);K.setAttribute("_mce_href",E.href);K.setAttribute("target",(E.newWin?"_blank":""));K.setAttribute("class",(E.type=="file")?"iconbutton "+Util.getFileIcon(E.href):"")}else{if(!L&&!this.getSelectedImage()){if(E.type=="file"){if(Util.isImageFile(E.href)){I="pbImage"+Math.round(Math.random()*1000000);H='<img id="'+I+'">'}else{if(PBwiki.feature("inlineav")&&(Util.isVideoFile(E.href)||Util.isAudioFile(E.href))){A=E.href.sub(/^\/f\//,"");H='<img class="pluginslug" src="/plugin_helper.php?plugin=avplayer&amp;file='+A+'" alt="" />';var C=PBconst.PagePlugin_AVPlayer.kUserPrefInterstitialKey;if(!PBinfo.GetUserPrefs[C]){new PBwiki.DialogCommands.VideoInterstitial({onClosed:function(){new PBwiki.APIRequest("SetUserPref",{key:C,value:true,wikiname:"my"})}})}}}}if(!H){H='<a href="'+E.href+'" ';if(E.type=="file"){var B=Util.getFileIcon(E.href);if(B!="fileicon"){H+='class="iconbutton '+B+'" '}}H+='target="'+(E.newWin?"_blank":"")+'">';H+=(L||E.txt);H+="</a> "}this.editor.execCommand("mceInsertContent",false,H);if(I){this.disable();var G=new Image();G.onload=function(){this.enable();var O=$(this.id+"_ifr").getWidth()-30,N=this.editor.dom.get(I),M=G.width;N.src=G.src;if(M>O){N.width=O}}.bind(this);G.onerror=function(){this.enable();this.editor.dom.get(I).src=E.href}.bind(this);G.src=E.href}}else{if(D.nodeName.toUpperCase()=="IMG"){var F=this.editor.dom;var J=F.create("a");F.setAttribs(J,{target:(E.newWin?"_blank":""),href:E.href});D.parentNode.insertBefore(J,D);J.appendChild(D);this.editor.selection.select(D)}else{this.editor.execCommand("mceInsertLink",false,{target:(E.newWin?"_blank":""),href:E.href})}}}},setContent:function(A){if(!this.editor){throw this.kEditorNotInitialized}this.editor.setContent(A);this.editor.isNotDirty=true;this.editor.undoManager.clear();this.lastContent=this.editor.getContent();if(this.isSourceMode){this.txt.value=this.lastContent}},focus:function(){if(!this.editor){throw this.kEditorNotInitialized}this.editor.focus()},isDirty:function(){if(!this.editor){return false}return(this.lastContent!=this.editor.getContent())},resetDirty:function(){if(!this.editor){throw this.kEditorNotInitialized}this.lastContent=this.editor.getContent()},addKeyHandler:function(A){if(!this.editor){throw this.kEditorNotInitialized}this.editor.onKeyDown.add(A)},removeKeyHandler:function(A){if(!this.editor){throw this.kEditorNotInitialized}this.editor.onKeyDown.remove(A)},setHeight:function(A){if(!this.editor){return false}try{this.editor.theme.resizeTo(0,A)}catch(B){alert(A+" "+B.message)}if(this.isSourceMode){this.txt.setStyle({height:(A-$(this.id+"_tbl").down("td").getHeight())+"px"})}},getBookmark:function(){return this.editor.selection.getPBBookmark()},moveToBookmark:function(A){return this.editor.selection.moveToPBBookmark(A)},scrollTo:function(A){if(!this.editor){return }this.editor.getDoc().documentElement.scrollTop=A},destroy:function(){if(!this.editor){return }if(this.resizeSourceModeHandler){Event.stopObserving(window,"resize",this.resizeSourceModeHandler)}this.editor.remove()}});PBwiki.Components.mceSimpleNetworkEditor=Class.create(PBwiki.Components.mceEditor,{overrideSettings:{theme_advanced_buttons1:"bold,underline,italic,strikethrough,bullist,numlist,|,outdent,indent,|,forecolor,backcolor,|,pbcode",theme_advanced_buttons2:"",theme_advanced_buttons3:"",plugins:"paste,spellchecker,contextmenu,table,tableextras,pbnbsp,pbcode,pbhr,pbindent,preelementfix,pbtips,pblist,webkitimgsize,linkify,pbinsert,pbtablemenu"}});PBwiki.Components.mceSimpleWorkspaceEditor=Class.create(PBwiki.Components.mceEditor,{overrideSettings:{theme_advanced_buttons1:"bold,underline,italic,strikethrough,bullist,numlist,|,outdent,indent,|,forecolor,backcolor,|,pblink,|,pbcode",theme_advanced_buttons2:"",theme_advanced_buttons3:"",plugins:"paste,spellchecker,contextmenu,table,tableextras,pbnbsp,pbcode,pbhr,pbindent,preelementfix,pbtips,pbquicklink,pblist,webkitimgsize,linkify,pbinsert,pbtablemenu"}});PBwiki.DialogCommands.CantMakeTask=Class.create(PBwiki.DialogCommands.TemplateDialog,{templateName:"cantmaketask",dialogPath:"/shared/network/dialog/",title:"Create a task",dialogOptions:{closeable:true},initialize:function($super,A){$super(A)}});PBwiki.DialogCommands.VideoInterstitial=Class.create(PBwiki.DialogCommands.TemplateDialog,{templateName:"video_interstitial",title:"New! Insert video",dialogOptions:{closeable:true}});Object.Event.extend(PBwiki.Components.mceEditor);PBwiki.Views.edit=Class.create(PBwiki.Views.page,{isDisabled:false,isCanceled:false,isFullscreen:false,hasBeginEditing:false,hasEditorInit:false,hasFinshedLoading:false,hasLock:false,cancel:false,isAutosaving:false,isEditingTags:false,lastAutosave:0,autosaveType:"default",autosaveSettings:{"default":{minSendInterval:45,maxLockInterval:150,contentPollInterval:45,useEditorEvents:false},live:{minSendInterval:1,maxLockInterval:150,contentPollInterval:2,useEditorEvents:true}},initialize:function(A){this.options=A||{};this.setChromeVisibility(true);this.setActiveTab("edit");this.setEditLoading(true);this.saveHandler=this.save.bind(this,true);this.saveAndContinueHandler=this.save.bind(this,false);this.cancelHandler=function(D){D.stop();this.isCanceled=true;this.cancel()}.bind(this);this.tagToggleHandler=this.toggleTagEditor.bind(this);this.saveButton=$("saveButton").up("a");this.saveButton.onclick=null;this.saveButton.observe("click",this.saveHandler);this.saveAndContinue=$("saveAndContinue").up("a");this.saveAndContinue.observe("click",this.saveAndContinueHandler);this.cancelLink=$("cancelButton");this.cancelLink.observe("click",this.cancelHandler);this.tagLink=$("edit_tags");this.tagLink.observe("click",this.tagToggleHandler);this.tagfield=$("tagfield");this.initialTags=this.tagfield.value;this.wikipage=$("wikipage-inner");this.qs=decodeURI(window.location.search).toQueryParams()||{};var B={height:this.getEditHeight()};this.beginEditing();Page.Thingbar.doLoad();Page.EditPage.Tags.initialize();this.editContainer=new Element("div",{id:"content"}).setStyle({height:B.height,display:"none"});$("editframe").insert({after:this.editContainer});try{this.editor=PBwiki.currentEditor=new PBwiki.Components.mceEditor(this.editContainer,B)}catch(C){PBwiki.error(C,"editor-init")}this.editor.observe("onInit",function(D){this.hasEditorInit=true;if(this.hasBeginEditing){this.onFinshedLoading()}}.bind(this));this.editor.observe("onSave",this.save.bind(this,true))},getPageName:function(){return PBwiki.getPageName()},beginEditing:function(){var A={page:this.getPageName(),steal:!!this.options.steal};if(this.qs["new"]&&this.qs.template){A.template=this.qs.template}(new PBwiki.APIRequest("BeginEditing",A,{onSuccess:function(B){this.initialHTML=B.html||"";this.hasBeginEditing=true;if(this.hasEditorInit){this.onFinshedLoading()}this.setLockInfo(B.lockinfo);if(!B.lockinfo.hasLock){(new PBwiki.DialogCommands.PageNoLock({lockinfo:B.lockinfo,onClosed:function(){if(!this.hasLock){document.fire("ui:changeview","page")}}.bind(this),onSteal:function(){$("page-lock-steal").disabled=true;(new PBwiki.APIRequest("SetPageLock",{page:this.getPageName(),steal:true},{onSuccess:function(C){this.setLockInfo(C.lockinfo);this.hasLock=C.lockinfo.hasLock;document.fire("dialog:close");this.editor.focus()}.bind(this),onFailure:this.error.bind(this)}))}.bind(this)}))}else{this.hasLock=true}}.bind(this),onFailure:this.error.bind(this),onException:this.error.bind(this)}))},stopEditing:function(){if(this.hasLock){(new PBwiki.APIRequest("UnlockPage",{page:this.getPageName()}))}},onFinshedLoading:function(){this.hasFinshedLoading=true;this.editor.setContent(this.initialHTML);$("content_parent").show();$("editframe").hide();this.lastAutosaveContent=this.editor.getContent();this.setAutosaveType("default");window.onresize=this.resizeChromeHeight.bind(this);this.resizeChromeHeight();window.onbeforeunload=function(){if(!this.isCanceled&&(this.editor&&this.editor.isDirty())){return"You have unsaved changes. Continue and discard those changes?"}}.bind(this);document.observe("ui:fullscreen",this.setFullscreenMode.bind(this,true));document.observe("ui:nofullscreen",this.setFullscreenMode.bind(this,false));document.observe("ui:insertlink",function(){this.editor.insertLink()}.bind(this));document.observe("ui:autosaveTrigger",this.autosave.bind(this));this.editor.focus();if(this.options.offset){this.editor.scrollTo(this.options.offset)}if($("live_edit_toggle")){this.startLiveEditHandler=this.startLiveEdit.bind(this);$("live_edit_toggle").observe("click",this.startLiveEditHandler);this.onLiveEditStartHandler=this.onLiveEditStart.bind(this);document.observe("live:start_live_editing",this.onLiveEditStartHandler);this.endLiveEditHandler=this.onLiveEditEnd.bind(this);document.observe("live:end_live_editing",this.endLiveEditHandler);this.editDenyRequestHandler=this.onLiveEditDenyRequest.bind(this);document.observe("live:deny_edit_request",this.editDenyRequestHandler)}this.setLockLostHandler=this.setLostLock.bind(this);document.observe("ui:edit_lock_stolen",this.setLockLostHandler);this.liveLockedHandler=function(B){if(!this.editMode){return }var A=B.memo;if(!A.page||A.page!=PBwiki.getPageName()){return }if(A.owner!=PBwiki.getUID()){document.fire("ui:edit_lock_stolen",A)}}.bind(this);document.observe("live:locked",this.liveLockedHandler);this.saveKeyHandler=function(B){var A=String.fromCharCode(B.charCode?B.charCode:B.keyCode).toLowerCase();if(B.ctrlKey&&A=="s"){this.save();B.stop()}}.bind(this);document.observe("keydown",this.saveKeyHandler);this.checkPageSize();this.dragUploader=new PBwiki.DragUploader({elm:$("editwikipage"),targetWin:this.editor.editor.getWin(),onGetFolder:function(){return PBinfo.CurrentPage.folder},onUploaded:function(A){A.success.each(function(B){this.editor.focus();this.editor.setSelectedLink({type:"file",txt:B.name,href:"/f/"+encodeURIComponent(B.name)})},this)}.bind(this)})},setAutosaveType:function(A,B){this.autosaveType=A;this.autosaveOpts=B||{};if(this.autosaveInterval){clearInterval(this.autosaveInterval)}this.autosaveInterval=setInterval(this.autosave.bind(this),this.autosaveSettings[this.autosaveType].contentPollInterval*1000);this.autosave()},resizeChromeHeight:function($super){var A=this.getEditHeight();if(this.editor){if(this.isFullscreen){this.editor.setHeight(document.documentElement.clientHeight-$("edit-toolbar-outer").getHeight()-3);$("editwikipage").setStyle({width:Math.max(document.documentElement.clientWidth,$("main-content").getWidth())+"px"})}else{this.editor.setHeight(A)}this.editor.resizeSourceMode()}else{$("editframe").setStyle({height:A+"px"})}var B=A-$("thingbar-pages").offsetTop-$("editor-column").down("p.aux").getHeight()-25;$("thingbar-pages").setStyle({maxHeight:B+"px"});$("thingbar-images").setStyle({maxHeight:B+"px"});$super()},save:function(D,C){if(C){C.stop()}if(this.isDisabled){return }this.disable();this.setSaveMessage("Saving "+this.getPageName().escapeHTML()+"...",true);var B=[];if((this.qs.folder||this.qs.security)&&!this.alreadyCreatedPage){var A={page:PBwiki.getPageName()};if(this.qs.folder){A.folder=decodeURIComponent(this.qs.folder.toString().replace(/\+/g," "))}if(this.qs.security){A.security=this.qs.security}A.html=this.editor.getContent();B.push(["CreatePage",A,{}])}else{B.push(["PutPage",{page:this.getPageName(),create_if_missing:true,html:this.editor.getContent()},{}])}if(this.initialTags!=this.tagfield.value){B.push(["SetPageTags",{page:PBwiki.getPageName(),tags:this.tagfield.value},{}])}if(D){B.push(["UnlockPage",{page:PBwiki.getPageName()},{}])}(new PBwiki.MultiAPIRequest(B,{incUsess:true,onFailure:function(E){this.enable();this.setSaveMessage(E)}.bind(this),onAllComplete:function(E){if(!E.lastError){if(D){this.isCanceled=true;window.location.href="/"+Util.dashified_link(this.getPageName())}else{this.enable();this.setSaveMessage("Saved Page Successfully",true);this.autosaveTime=new Date();this.alreadyCreatedPage=true;this.editor.resetDirty();this.refresh()}}else{this.enable();this.setSaveMessage(E.lastError)}}.bind(this)}))},autosave:function(C){if(!this.editor||this.isDisabled||!this.hasLock||this.isAutosaving){return }var B=(new Date()-this.autosaveTime)/1000,D=(C&&C.memo===true);if(B<this.autosaveSettings[this.autosaveType].minSendInterval&&!D){return }var A=this.editor.getContent();if(A!=this.lastAutosaveContent||D){this.isAutosaving=true;if(this.autosaveOpts.draft&&this.autosaveOpts.draft.draft_id&&!D){this.autosaveDraft(A,false)}else{this.autosavePut(A,D)}}else{if(B>=this.autosaveSettings[this.autosaveType].maxLockInterval){this.isAutosaving=true;this.autosaveLock()}}},autosavePut:function(A,C){var B={page:this.getPageName()};if(C){B.spellcheck=C}this.autosaveRequest=new PBwiki.APIRequest("PutAutosave",B,{parameters:{html:A},onSuccess:this.autosaveSuccess.bind(this,A,C),onFailure:this.autosaveFailure.bind(this),onComplete:function(){this.isAutosaving=false}.bind(this)})},autosaveDraft:function(D,A){var E={onSuccess:this.autosaveSuccess.bind(this,D,false),onFailure:this.draftFailure.bind(this),onComplete:function(){this.isAutosaving=false}.bind(this)};var C={draft_id:this.autosaveOpts.draft.draft_id,page:PBwiki.getPageName()};var F="PutDraft";if(!A){var B=new diff_match_patch();E.parameters={delta:B.diff_toDelta(B.diff_main(this.lastAutosaveContent,D)),version:this.autosaveOpts.draft.v}}else{E.parameters={html:D}}this.autosaveRequest=new PBwiki.APIRequest(F,C,E)},autosaveLock:function(){this.autosaveRequest=new PBwiki.APIRequest("SetPageLock",{page:this.getPageName()},{onSuccess:this.autosaveSuccess.bind(this,null,false),onFailure:this.autosaveFailure.bind(this),onComplete:function(A){this.isAutosaving=false}.bind(this)})},autosaveSuccess:function(B,C,A){if(B){this.lastAutosaveContent=B}if(!A.lockinfo){return }if(!A.lockinfo.hasLock){this.setLostLock(A.lockinfo)}else{this.autosaveTime=new Date();if(A.wordcount){this.autosaveWordcount=A.wordcount}this.setAutosaveMsg()}if(C){document.fire("spellcheck:update",A.spellcheck)}if(A.draft){this.autosaveOpts.draft=A.draft}},draftFailure:function(B,A){if(A===600){this.autosaveDraft(this.editor.getContent(),true);return }else{this.autosaveTime=new Date()}this.setAutosaveMsg(B)},autosaveFailure:function(A){this.autosaveTime=new Date();this.setAutosaveMsg(A)},setLostLock:function(A){alert(((A.editname)?A.editname:"Somebody")+" has stolen your lock on this page.  You will no longer be able to save changes.");this.saveButton.addClassName("disabled");this.saveAndContinue.addClassName("disabled");this.isDisabled=true},toggleTagEditor:function(A){if(A){A.stop()}this.isEditingTags=!this.isEditingTags;this.tagLink.update((this.isEditingTags?"Hide tags":"Edit tags"));(this.isEditingTags?$("tag-settings").show():$("tag-settings").hide());this.editHeight=this.getEditHeight();this.resizeChromeHeight()},setAutosaveMsg:function(B){if(!B&&this.autosaveTime){var A=((new Date()-this.autosaveTime)/1000/60).toFixed();if(this.autosaveWordcount){B="Saved "+this.autosaveWordcount+" word"+((this.autosaveWordcount>1)?"s":"")+" at "}else{B="Draft saved "}B+=new Date(this.autosaveTime).strftime(PBconst.kPolicySimpleTimeFormat);B+=" ("+((A==0)?"less than a ":A);B+=" minute"+((A>1)?"s":"")+" ago)"}if(B){$("autosave_msg").update(B)}},setSaveMessage:function(B,A){var C=$("save_msg");C.style.display="inline";C.innerHTML=B;if(A){if(this.saveMessageTimer){clearTimeout(this.saveMessageTimer)}this.saveMessageTimer=setTimeout(function(){C.hide();delete this.saveMessageTimer}.bind(this),10000)}},setFullscreenMode:function(A){if(this.isFullscreen==A){return }try{var C=this.editor.getBookmark()}catch(B){}(A?$("editwikipage").addClassName("fullscreen"):$("editwikipage").removeClassName("fullscreen"));$("editwikipage").setStyle({width:""});if($("top-content")){$("top-content").style.display=(A)?"none":"block"}$("editor-column").style.display=(A)?"none":"block";$("show_tags").style.display=(A)?"none":"block";if($("editor_v3_toggle")){$("editor_v3_toggle").style.display=(A)?"none":"block"}$$("table.mceToolbar").invoke("setStyle",{"float":((A)?"left":"")});this.isFullscreen=A;this.resizeChromeHeight();try{$("content_fsedit").focus();this.editor.editor.focus();this.editor.moveToBookmark(C)}catch(B){}},cancel:function(A){if(A){A.stop()}document.fire("ui:changeview","page")},enable:function(){this.isDisabled=false;this.editor.enable();this.saveButton.removeClassName("disabled");this.saveAndContinue.removeClassName("disabled")},disable:function(){this.isDisabled=true;this.editor.disable();this.saveButton.addClassName("disabled");this.saveAndContinue.addClassName("disabled")},error:function(A){this.isCanceled=true;document.fire("ui:changeview","page");document.fire("ui:onNotifyUser",{message:A})},startLiveEdit:function(A){A.stop();(new PBwiki.DialogCommands.FindUsers({title:"Invite users to Live View",isLiveEdit:true,isLiveEditor:true,showGroupChats:true,onSelect:function(B){document.fire("live:start_live_editing",B)}.bind(this)}))},onLiveEditStart:function(A){(new PBwiki.APIRequest("SetPageLock",{page:PBwiki.getPageName(),"private":false},{onSuccess:function(B){PBinfo.GetPage.lockinfo=B.lockinfo;this.setAutosaveType("live",{draft:{draft_id:B.lockinfo.draft_id,v:0}});var E=A.memo;var D={wiki:PBinfo.CurrentWiki.name};var C={request_wiki_name:PBinfo.CurrentWiki.name,link:Util.URLRelativeToContext("/"+PBwiki.getPageName()+"#view=liveview",D)};E.each(function(G){C.live_edit_link_for_user=Strophe.getNodeFromJid(G);var H=$J.message({to:G,type:"chat"}).c("body",{unique:PBwiki.Live.randomString()}).c("link-to-page",C).t(PBwiki.getPageName());PBwiki.Live.connection.send(H)});var F=PBwiki.Live.getLiveEditChatForCurrentPage();if(!F){F=new PBwiki.Live.ChatBox(PBwiki.getUID(),true,true);F.show(true)}}.bind(this)}))},onLiveEditDenyRequest:function(F){var D=F.memo;var C=D+"@"+PBwiki.Live.basedomain;var B={wiki:PBinfo.CurrentWiki.name};var A={request_wiki_name:PBinfo.CurrentWiki.name,live_edit_request_deny_for_user:D,link:Util.URLRelativeToContext("/"+PBwiki.getPageName()+"#view=liveview",B)};var E=$J.message({to:C,type:"chat"}).c("body",{unique:PBwiki.Live.randomString()}).c("link-to-page",A).t(PBwiki.getPageName());PBwiki.Live.connection.send(E)},onLiveEditEnd:function(){(new PBwiki.APIRequest("SetPageLock",{page:PBwiki.getPageName(),"private":true},{onSuccess:function(A){PBinfo.GetPage.lockinfo=A.lockinfo;this.setAutosaveType("default")}.bind(this)}))},checkPageSize:function(){var A=Math.round(this.editor.getContent().length/1024);var B=PBconst.kPolicyPageSizeWarning/1024;if(A>B&&!this.sizeWarned){document.fire("ui:onNotifyUser",{mode:"warning",message:"Warning: This page is "+A+'KB. We <a target="doc" href="https://usermanual.pbworks.com/Best-Practices#Addingnewpages">recommend splitting pages</a> larger than '+B+"KB up into several smaller pages for easier readability and best performance."});this.sizeWarned=true}},destroy:function(){if(this.editor){if(this.editor.isDirty()&&!this.isCanceled){if(!confirm("You have unsaved changes. Continue and discard those changes?")){return false}}if(this.isFullscreen){this.setFullscreenMode(false)}if(this.isEditingTags){this.toggleTagEditor()}if(this.dragUploader){this.dragUploader.remove()}this.editor.destroy();delete PBwiki.editorInstance}this.setSaveMessage("");$("editframe").update("");window.onbeforeunload=null;window.onresize=null;this.stopEditing();clearInterval(this.autosaveInterval);this.saveButton.stopObserving("click",this.saveHandler);this.saveAndContinue.stopObserving("click",this.saveAndContinueHandler);this.cancelLink.stopObserving("click",this.cancelHandler);this.tagLink.stopObserving("click",this.tagToggleHandler);if($("live_edit_toggle")){$("live_edit_toggle").stopObserving("click",this.startLiveEditHandler);document.stopObserving("ui:edit_lock_stolen",this.setLockLostHandler);document.stopObserving("live:locked",this.liveLockedHandler);document.stopObserving("live:start_live_editing",this.onLiveEditStartHandler);document.stopObserving("live:end_live_editing",this.endLiveEditHandler);document.stopObserving("live:deny_edit_request",this.editDenyRequestHandler)}if(this.saveKeyHandler){document.stopObserving("keydown",this.saveKeyHandler)}return true}});PBwiki.Views.newpage=Class.create(PBwiki.Views.edit,{initialize:function($super){$super();$("view-tab").stopObserving("click")},cancel:function(){window.location.href="/"+Util.dashified_link(this.getPageName())},destroy:function(){return false}});
/* 
 * a backwards compatable implementation of postMessage
 * by Josh Fraser (joshfraser.com)
 * released under the Apache 2.0 license.  
 *
 * this code was adapted from Ben Alman's jQuery postMessage code found at:
 * http://benalman.com/projects/jquery-postmessage-plugin/
 * 
 * other inspiration was taken from Luke Shepard's code for Facebook Connect:
 * http://github.com/facebook/connect-js/blob/master/src/core/xd.js
 *
 * the goal of this project was to make a backwards compatable version of postMessage
 * without having any dependency on jQuery or the FB Connect libraries
 *
 * my goal was to keep this as terse as possible since my own purpose was to use this 
 * as part of a distributed widget where filesize could be sensative.
 * 
 */
var PBwiki=PBwiki||{};PBwiki.CrossDomain=function(){var E,D,B=1,C,A=this;return{postMessage:function(F,H,G){if(!H){return }G=G||parent;if(A.postMessage){G.postMessage(F,H.replace(/([^:]+:\/\/[^\/]+).*/,"$1"))}else{if(H){G.location=H.replace(/#.*$/,"")+"#"+(+new Date)+(B++)+"&"+F}}},receiveMessage:function(G,F){if(A.postMessage){if(G){C=function(H){if((typeof F==="string"&&H.origin!==F)||(Object.prototype.toString.call(F)==="[object Function]"&&F(H.origin)===!1)){return !1}G(H)}}if(A.addEventListener){A[G?"addEventListener":"removeEventListener"]("message",C,!1)}else{A[G?"attachEvent":"detachEvent"]("onmessage",C)}}else{E&&clearInterval(E);E=null;if(G){E=setInterval(function(){var I=document.location.hash,H=/^#?\d+&/;if(I!==D&&H.test(I)){D=I;G({data:I.replace(H,"")})}},100)}}},stop:function(){if(A.postMessage){if(A.addEventListener){A.removeEventListener("message",C,false)}else{A.detachEvent("onmessage",C)}}else{clearInterval(E)}}}}();PBwiki.Components=PBwiki.Components||{};PBwiki.Components.OverlayFrame=Class.create({initialize:function(A){this.options=A;PBwiki.currentOverlayFrame=this;PBwiki.CrossDomain.receiveMessage(function(B){var C=B.data.evalJSON();this.close(C.diagramId)}.bind(this),window.location.protocol+"//"+window.location.host);this.show();this.resizeHandler=this.resize.bind(this);Event.observe(window,"resize",this.resizeHandler)},show:function(){var B=this.iframe=new Element("iframe");var C=this.div=new Element("div");var A=this.idiv=new Element("div");C.style.background="#696969";C.style.opacity=0.8;C.style.filter="alpha(opacity=80)";if(Util.isInternetExplorer6()){C.style.position="absolute";C.style.width=document.viewport.getWidth()+"px";C.style.height=document.viewport.getHeight()+"px";C.style.setExpression("top","(t=document.documentElement.scrollTop||document.body.scrollTop)+'px'");C.style.setExpression("left","(l=document.documentElement.scrollLeft||document.body.scrollLeft)+'px'")}else{C.style.width="100%";C.style.height="100%";C.style.top="0";C.style.left="0";C.style.position="fixed"}C.style.zIndex=99998;A.style.border="1px solid #2c2c2c";if(Util.isInternetExplorer6()){A.style.position="absolute";A.style.setExpression("top","15+((t=document.documentElement.scrollTop||document.body.scrollTop))+'px'");A.style.setExpression("left","15+((l=document.documentElement.scrollLeft||document.body.scrollLeft))+'px'")}else{A.style.position="fixed";A.style.top="15px";A.style.left="15px"}A.style.zIndex=99999;document.body.appendChild(C);document.body.appendChild(A);B.style.border="1px solid #b1b1b1";B.style.backgroundColor="#606060";B.style.display="block";B.frameBorder=0;B.src=this.options.src+"#"+encodeURIComponent(document.location.href);this.resize();A.appendChild(B)},resize:function(){if(!this.iframe){return }this.iframe.style.width=(this.div.offsetWidth-30)+"px";this.iframe.style.height=(this.div.offsetHeight-30)+"px"},close:function(A){this.hide();Event.stopObserving(window,"resize",this.resizeHandler);PBwiki.CrossDomain.stop();this.notify("onFinished",A)},hide:function(){if(!this.div){return }this.div.remove();this.idiv.remove();this.idiv=this.div=this.iframe=null}});Object.Event.extend(PBwiki.Components.OverlayFrame);